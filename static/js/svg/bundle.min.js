(function(){
function dismiss_warning(){document.querySelector("#browser_compat").style.display="none"}function make_tangram_shapes(){svg=d3.select("#zoomfield"),object_mapper.tan_triangle.make(svg,[3500,2500],{width:100*Math.sqrt(2),height:50*Math.sqrt(2)}),object_mapper.tan_triangle.make(svg,[3650,2500],{width:100*Math.sqrt(2),height:50*Math.sqrt(2)}),object_mapper.tan_square.make(svg,[3800,2500],{width:100,height:100}),object_mapper.tan_triangle.make(svg,[4e3,2500],{width:200,height:100}),object_mapper.tan_triangle.make(svg,[3500,2700],{width:200*Math.sqrt(2),height:100*Math.sqrt(2)}),object_mapper.tan_triangle.make(svg,[3800,2700],{width:200*Math.sqrt(2),height:100*Math.sqrt(2)}),object_mapper.tan_paral.make(svg,[4100,2700],{width:200,height:100})}function drag_discrete(){function e(e){return Math.round(1e5*e)/1e5}function t(e){return e<0?Math.ceil(e):Math.floor(e)}var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=0,o=0
return{add:function(a,i){n=e(a+n),o=e(o+i)
var s=t(n/(r||mdd))*(r||mdd),_=t(o/(r||mdd))*(r||mdd)
return n%=r||mdd,o%=r||mdd,[s,_]},reset:function(){var e=0!=n&&0!=o
return n=0,o=0,e},status:function(){return[n,o]}}}function matrix_to_transform_object(e){function t(e,t){return e[0]*t[0]+e[1]*t[1]}function r(e){var r=Math.sqrt(t(e,e))
return r&&(e[0]/=r,e[1]/=r),r}var n=180/Math.PI,o=[e.a,e.b],a=[e.c,e.d],i=r(o),s=t(o,a),_=r(function(e,t,r){return e[0]+=r*t[0],e[1]+=r*t[1],e}(a,o,-s))||0
o[0]*a[1]<a[0]*o[1]&&(o[0]*=-1,o[1]*=-1,i*=-1,s*=-1)
var c={}
return c.rotate=round_to((i?Math.atan2(o[1],o[0]):Math.atan2(-a[0],a[1]))*n,2),c.translate=[e.e,e.f].map(function(e){return round_to(e,2)}),c.scale=[i,_].map(function(e){return round_to(e,2)}),c.skew=_?Math.atan2(s,_)*n:0,c}function clear_path_attrs(){path_attrs.forEach(function(e){cpa[e]=null})}function set_path_attrs(e){if(path_attrs.forEach(function(t){cpa[t]=e.attr(t)}),!e.classed("example")){var t=path_id_to_el_ids(cpa.class)
cpa.e1=document.querySelector("#mainsvg "+t[0]),cpa.e2=document.querySelector("#mainsvg "+t[1])}if(e.select(".arrow_1").empty()||(cpa.arrow_head=e.select(".arrow_1").attr("type"),cpa.head_style=e.select(".arrow_1").attr("style")),e.select(".arrow_0").empty()||(cpa.arrow_tail=e.select(".arrow_0").attr("type"),cpa.tail_style=e.select(".arrow_0").attr("style")),e.classed("flasher")&&(cpa.flasher=!0),cpa.arrow_head||cpa.arrow_tail){var r=e.select(".arrow_1, .arrow_0")
if(r.empty()){var n=parseFloat(currentElement.querySelector(".mainpath").style["stroke-width"])
cpa.arrow_width=10+n,cpa.arrow_height=17+n}else cpa.arrow_width=parseFloat(r.attr("arrow_width"))||10,cpa.arrow_height=parseFloat(r.attr("arrow_height"))||17}cpa.path_g=e.node(),cpa.hg=e.classed("hg")&&"knot"!=iama(cpa.e2),cpa.pos1=find_pos_for_par(cpa.e1)||parseFloat(cpa.pos1)||.5,cpa.pos2=find_pos_for_par(cpa.e2)||parseFloat(cpa.pos2)||.5,cpa.octo_flipped=e.node().hasAttribute("octo_flipped"),cpa.offset_from=e.attr("offset_from")||0,cpa.offset_to=e.attr("offset_to")||0,cpa.offset_from=parseInt(cpa.offset_from),cpa.offset_to=parseInt(cpa.offset_to)}function getPosition(e){for(var t=0,r=0;e;)t+=e.offsetLeft-e.scrollLeft+e.clientLeft,r+=e.offsetTop-e.scrollTop+e.clientTop,e=e.offsetParent
return{x:t,y:r}}function pos_for_path_to_par(e){return bbox_p=e.getBoundingClientRect(),bbox_g=find_g(e).querySelector(".mainfig").getBoundingClientRect(),mid_p=bbox_p.top+bbox_p.height/1.7-bbox_g.top,mid_p/bbox_g.height}function find_pos_for_par(e){var t=e.querySelector('p[connect="'+cpa.id+'"]')
return!!t&&pos_for_path_to_par(t)}function cp_drag_start(){currentElement=this.parentElement,"path_basic"==iama(currentElement)&&gui.remove_all()}function cp_drag_end(){copy_control_points_to_top()
var e=find_g(this)
"path_basic"==iama(e)&&ido(e)._update_path_flow(e),roughing.roughen_if_needed(e),toggle_zoom.temp_disable_off()}function is_cubic_cp_of_type(e,t){return 1==e||e==t?"free":e%3==0?"mid":"bound"}function straighten_cps(e){var t=e.querySelector("path").getAttribute("d"),r=path_to_array(t)
if(r.length>4&&e.hasAttribute("custom_flow"))for(var n=3;n<r.length-2;n+=3){var o=function(e){var t=_slicedToArray(e,3),r=t[0],n=t[1],o=t[2]
return n.x=(r.x+o.x)/2,n.y=(r.y+o.y)/2,[n.x,n.y]}(r.slice(n-1,n+2)),a=_slicedToArray(o,2),i=a[0],s=a[1],_=e.querySelector('circle[my_index="'+n+'"]')
_.setAttribute("cx",i),_.setAttribute("cy",s)}d3.select(e).selectAll("path").attr("d",array_to_path(r)),d3.select(e).attr("custom_flow",get_path_custom_flow_attrs(r)).attr("fixed_side","true"),add_lines_to_control_points(r)}function add_lines_to_control_points(e){function t(e,t){svg.append("line").attr({x1:e.x,x2:t.x,y1:e.y,y2:t.y}).attr("class","cp_helper_line")}var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1]
if(svg.selectAll(".cp_helper_line").remove(),e.length>4)for(var n=e.slice(2,-2),o=0;o<n.length-1;o+=3)if(r){var a={x:n[o].x+r[0],y:n[o].y+r[1]},i={x:n[o+1].x+r[0],y:n[o+1].y+r[1]},s={x:n[o+2].x+r[0],y:n[o+2].y+r[1]}
t(a,i),t(i,s)}else t(n[o],n[o+1]),t(n[o+1],n[o+2])}function get_rcs_for_cps(e,t,r){var n=r.x-e.x==t.x-r.x,o=r.y-e.y==t.y-r.y
return n&&o}function move_cubic_cp(e,t,r,n,o,a){var i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=void 0!=o?o:r[0]-e[t].x,a=void 0!=o?a:r[1]-e[t].y,s=[]
if("mid"!=(n=n||is_cubic_cp_of_type(t,e.length-2))||all_cp_free||i)if("bound"!=n||all_cp_free||i)e[t].x+=o,e[t].y+=a,s=[t]
else{var _=t%3==2?t+2:t-2
e[t].x+=o,e[t].y+=a,e[_].x-=o,e[_].y-=a,s=[t,_]}else s=[t-1,t,t+1],s.forEach(function(t){e[t].x+=o,e[t].y+=a})
if("path_basic"==iama(currentElement)||"country_basic"==iama(currentElement))var c=path_basic.get_path_offset(currentElement)
else c=[0,0]
s.forEach(function(t){svg.select('.cp[my_index="'+t+'"]').attr("cx",c[0]+e[t].x).attr("cy",c[1]+e[t].y)})}function copy_control_points_to_top(){var e=document.querySelectorAll(".cp")
new Set(_.map(e,function(e){return e.parentElement})).forEach(function(e){return e.parentElement.appendChild(e)})}function copy_path(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1]
gui.remove_all()
for(var r=find_path(),n=e.querySelectorAll('g[i_am_a="text_block"], g[i_am_a="text_path"]'),o=[],a=0;a<n.length;a++)o.push(n[a].cloneNode(!0))
var i=manage_groups.remove_element_if_present(e),s=get_path_style_attributes(e)
e.remove(),function(){cpa.class=cpa.class.replace(/ connection/g,"")}()
var _=make_path(svg,r).node()
return e.hasAttribute("custom_flow")&&_.setAttribute("custom_flow",e.getAttribute("custom_flow")),t&&set_path_style_attributes(_,s),o.forEach(function(e){_.appendChild(e),object_mapper[e.getAttribute("i_am_a")].add_drag(d3.select(e)),object_mapper[e.getAttribute("i_am_a")].add_events(d3.select(e))}),manage_groups.add_element_to_multiple_groups(i,_),manage_groups.element_in_active_group(_)&&manage_groups.add_filter_to_el(_),currentElement=_,_}function path_to_nothing(e,t){var r=object_mapper.knot.make(svg,e);[d3.select(t),r].forEach(function(e){return make_new_connection(e)}),path_end_fig="curved_arrow",currentElement=cpa.path_g,cpa.arrow_to=path_end_fig,cpa.arrow_head=path_end_fig,change_path_end_fig("head",!0)}function detach_path(e,t,r,n,o){var a=manage_groups.remove_element_if_present(document.querySelector("#"+cpa.id)),i=path_to_array(e.querySelector(".mainpath").getAttribute("d"))[3-3*t],s=t?cpa.from_side:cpa.to_side
if(0==s&&(i.y-=15),1==s&&(i.x+=15),2==s&&(i.y+=15),3==s&&(i.x-=15),d3.select(e).classed("hg"))var _="knot"==iama(cpa.e1),c=_?cpa.e1:cpa.e2
r&&(n=object_mapper.knot.make(svg,[i.x,i.y]).node())
var l=t?cpa.e2:cpa.e1,u=t?cpa.e1:cpa.e2
if(l==n)return text_to_feedback_pane("cannot connect to same shape twice"),!1
if(r&&u.id<l.id||!r&&l.id<u.id!=l.id<n.id){var d=[cpa.to_side,cpa.from_side]
cpa.from_side=d[0],cpa.to_side=d[1]
var p=[cpa.pos2,cpa.pos1]
cpa.pos1=p[0],cpa.pos2=p[1]
var f=[cpa.arrow_tail,cpa.arrow_head]
cpa.arrow_head=f[0],cpa.arrow_tail=f[1]}set_path_id_and_class(d3.select(n),d3.select(l)),currentElement=e
var m=copy_path(e)
if(r&&d3.select(e).classed("hg")){var g=[m]
n&&g.push(n),hierarchies.check_and_alter_classes_for_detach(t,_,c,e.getAttribute("id"),g)}r||(d3.select(n).classed("hg")||d3.select(o).classed("hg"))&&hierarchies.check_and_alter_classes_for_attach(o,n,m),a.length>0&&manage_groups.add_element_to_multiple_groups(a,m),remake_path(find_path(!0,!0)),remove_plumb_lines()}function path_id_to_el_ids(e,t){return t?[e.slice(4,9),e.slice(12,17)]:["#"+e.slice(4,9),"#"+e.slice(12,17)]}function extract_elements_from_path_id(e){return[e.slice(4,9),e.slice(12,17)]}function find_paths_on_my_side(e,t){function r(e,t,r){return document.getElementById(e).getAttribute(t)==r}var n=find_connections(e),o=n.filter(function(t){var r=extract_elements_from_path_id(t),n=_slicedToArray(r,2)
return n[0],n[1]!=e}),a=n.filter(function(t){var r=extract_elements_from_path_id(t),n=_slicedToArray(r,2)
return n[0],n[1]==e})
return o=o.filter(function(e){return r(e,"from_side",t)}),a=a.filter(function(e){return r(e,"to_side",t)}),o=o.map(function(e){var t=extract_elements_from_path_id(e),r=_slicedToArray(t,2)
return r[0],{path:e,fig:r[1],side:"to_"}}),a=a.map(function(e){var t=extract_elements_from_path_id(e),r=_slicedToArray(t,2),n=r[0]
return r[1],{path:e,fig:n,side:"from_"}}),o.concat(a)}function disperse_path_over_side(e,t,r){var n=e.getAttribute("id"),o=function(r){for(var n=[],o=[],a="hg"+e.getAttribute("id")+"_"+t,i=0;i<r.length;i++)obj=r[i],"from_"==obj.side?n.push(obj):svg.select("#"+obj.path).classed(a)?o.push(obj):n.push(obj)
if(o.length>1){var s=o.splice(-1)[0]
n=n.concat(s)}return[n,o,s]}(find_paths_on_my_side(n,t)),a=_slicedToArray(o,3),i=a[0],s=a[1],c=a[2],l=!1
if(i.length<1)return!1
if("knot"==iama(e))return!1
if(!l&&1==i.length){var u=d3.select("#"+i[0].path),d=u.attr("pos1"),p=u.attr("pos2")
"0.5"==d&&"0.5"==p||(l=!0)}var f=(1-2*r)/(i.length+1),m=r,g=i.map(function(e){return e.class=e.path.slice(0,17),e.box=document.getElementById(e.fig).querySelector(".mainfig").getBoundingClientRect(),e})
func=t%2==0?function(e,t){return e.box.left+e.box.width/2-(t.box.left+t.box.width/2)}:function(e,t){return e.box.top+e.box.height/2-(t.box.top+t.box.height/2)}
for(var h=g.sort(function(e,t){return func(e,t)}),y=_.groupBy(h,function(e,t){return e.class}),v=0;v<h.length;v++){for(var b=y[h[v].class].sort(function(e,t){return e.path<t.path}),x=b.length,k=0;k<x;k++){var w=b[k]
set_path_attrs(svg.select("#"+w.path)),"from_"==w.side?cpa.pos2=m+f*(1+v+k):function(e,t){return!((e+t)%2==0&&e!=t||0==e&&3==t||3==e&&0==t||1==e&&2==t||2==e&&1==t)}(parseInt(cpa.from_side),parseInt(cpa.to_side))?cpa.pos1=m+f*(v+x)-f*k:cpa.pos1=m+f*(1+v+k),remake_path(find_path(!0,!0))}v+=k-1}if(s.length>0){set_path_attrs(svg.select("#"+c.path))
var E=cpa.pos1
s.forEach(function(e){set_path_attrs(svg.select("#"+e.path)),cpa.pos1=E,cpa.fixed_side=!0,remake_path(find_path(!0,!0))})}}function find_path(e,t){function r(e){return s.dist-e.dist<MARGIN_PREFERRED}var n,o,a,i,s,c=find_direct_routes_sorted(),l=[]
if(path_buffer.check_path("#"+cpa.id)&&(t=!0),(e||t)&&(function(){var e=parseInt(_.findIndex(c,function(e){return e.i==cpa.from_side&&e.j==cpa.to_side}))
s=c.splice(e,1)[0]
var t=check_path_for_collision(s)
n=t[0],o=t[1],i=t[2]}(),l.push([o,s,i,n])),t||0==c.length)return[o,s,i,n]
if(e&&r(c[c.length-1])&&!n)return[o,s,i,n]
for(;c.length>0;){var a=c.pop(),u=check_path_for_collision(a),d=u[0]
if(o=u[1],i=u[2],!d)return!n&&e&&r(a)?l[0]:[o,a,i,!1]
l.push([o,a,i,!0])}return l[0]}function make_d(e,t){if("manhattan"!=cpa.flow||cpa.custom_flow)if(cpa.custom_flow)var r=get_path_from_custom_flow(cpa.custom_flow,e.midpoints[0],e.midpoints[1],"lineto"==cpa.flow||"manhattan"==cpa.flow)
else{if(e.i==e.j)var n=get_control_point_for_bow(e,e.i,0),o=get_control_point_for_bow(e,e.j,1)
else var n=get_control_point(e,e.i,0,cpa.flow,t),o=get_control_point(e,e.j,1,cpa.flow,t)
var r=make_cubic_bezier_path([e.midpoints[0],n,o,e.midpoints[1]])
e.cp1=n,e.cp2=o}else{var a=make_manhattan_path(e),r=a[0]
e.manhattan_midpoint=a[1]}return r}function check_path_for_collision(e){elements=d3.select("#mainsvg").selectAll("g.evade_me")[0]
var t=make_d(e),r=document.createElementNS("http://www.w3.org/2000/svg","path")
r.setAttribute("d",t)
var n=find_collision(r,elements)
return[_.values(n).some(function(e){return e}),t,n]}function find_direct_routes_sorted(){var e=(cpa.e1,cpa.e2,cpa.from_side),t=cpa.to_side,r=(cpa.pos1,cpa.pos2,[]),n=find_midpoints(cpa.e1,cpa.pos1,cpa.offset_from),o=find_midpoints(cpa.e2,cpa.pos2,cpa.offset_to)
if(cpa.fixed_side&&e&&t){var a=o[t][0]-n[e][0],i=o[t][1]-n[e][1]
return r.push({i:e,j:t,dist:Math.sqrt(a*a+i*i),dx:a,dy:i,midpoints:[n[e],o[t]]}),r}var s=cpa.fixed_side&&e?[e]:[0,1,2,3],_=cpa.fixed_side&&t?[t]:[0,1,2,3]
for(var c in s){var l=s[c]
for(var u in _){var d=_[u],a=o[d][0]-n[l][0],i=o[d][1]-n[l][1]
r.push({i:l,j:d,dist:Math.sqrt(a*a+i*i),dx:a,dy:i,midpoints:[n[l],o[d]]})}}return r.sort(function(e,t){var r=e.i%2==e.j%2?1:path_corner_penalty,n=t.i%2==t.j%2?1:path_corner_penalty
return t.dist*n-e.dist*r})}function to_valid_trans_object(e){var t=e
return delete t.skew,t.scale=t.scale[0],_typeof("number"==t.rotate)&&(t.rotate=[t.rotate]),t}function positioning_and_store(e){function t(e){return delete e.skew,e.scale=e.scale[0],_typeof("number"==e.rotate)&&(e.rotate=[e.rotate]),e}function r(e){l[e]={tl:[],br:[],trans:{},for_grouped_abs:!1}}function n(n){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=i||e
n.classList.contains("i_am_grouped")&&!a&&(s=n.parentElement)
var _=o(n,s)
n.id in l||r(n.id),l[n.id].trans=t(_),l[n.id].tl=_.translate,l[n.id].for_grouped_abs=a}function o(e,t){return matrix_to_transform_object(e.getTransformToElement(t))}function a(e){var t=l[e.id].trans,r=s(e),n=_slicedToArray(r,2),o=n[0],a=n[1],i=conv_angle(-t.rotate[0],o,a)
l[e.id].br=[t.translate[0]+i[0],t.translate[1]+i[1]]}function i(e){var t=document.querySelector("#"+e)
t&&t.classList.contains("i_have_a_group")&&_.forEach(t.querySelectorAll(".i_am_grouped"),function(e){delete l[e.id]})}function s(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])var t=l[e.id].trans.scale,r=parseInt(e.getAttribute("width"))*t||1,n=parseInt(e.getAttribute("height"))*t||1
else var r=parseInt(e.getAttribute("width")||1),n=parseInt(e.getAttribute("height")||1)
return[r,n]}function c(e,t){try{return!(e.id in l&&(!e.classList.contains("i_am_grouped")||t==l[e.id].abs))}catch(e){return!1}}var l={}
return{load_shapes_pos:function(){var e=this
Array.from(document.querySelectorAll("g[i_am_a]")).filter(function(e){return"path_group"!=iama(e)}).filter(function(e){return!e.classList.contains("example_fig")}).forEach(function(t){return e.get_top_left(t)})},reset:function(){l={}},delete_item:function(e){return delete l[e]},get_trans_from_string:function(e){return t(d3.transform(e))},get_top_left:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]
return c(e,t)&&n(e,t),l[e.id].tl},get_bottom_right:function(e){return e.id in l||n(e),0==l[e.id].br.length&&a(e),l[e.id].br},get_w_h_hor:function(e){var t=this.get_top_left(e),r=this.get_bottom_right(e)
return[r[0]-t[0],r[1]-t[1]]},get_w_h:s,get_trans:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3]
return r&&!c(e,t)||n(e,t,o),l[e.id].trans},set_trans:function(e,t){delete l[e],r(e),l[e].trans=t,l[e].tl=t.translate,i(e)},tlbr:function(e){if("path_group"==iama(e))return this.tlbr_path(e)
var t=this.get_top_left(e,!0),r=this.get_w_h(e),n=_slicedToArray(r,2),o=n[0],a=n[1]
return{top:t[1],left:t[0],bottom:t[1]+a,right:t[0]+o}},tlbr_path:function(e){var t=e.getBBox()
return{top:t.y,left:t.x,bottom:t.y+t.height,right:t.x+t.width}},tlbr_to_coords:function(e){return[[e.left,e.top],[e.right,e.top],[e.right,e.bottom],[e.left,e.bottom]]},get_transform_of_shape:o,show:function(){return l},get_bbox_inc_all_covered:function(e){var t=this,r=[]
if(e.classList.contains("i_have_a_group")){var n=direct_child_only_selector("g","g[i_am_a]"),o=_.map(n,function(e){return t.get_bbox_inc_all_covered(e)})
r=r.concat(o)}else r.push(this.tlbr(e))
if(1==r.length)return r[0]
var a=msvg_h,i=msvg_w,s=0,c=0
return r.forEach(function(e){a=Math.min(a,e.top),s=Math.max(s,e.bottom),i=Math.min(i,e.left),c=Math.max(c,e.right)}),{top:a,bottom:s,left:i,right:c}},get_mid_of_side:function(e,t){try{var r=this.get_top_left(e,!0),n=_slicedToArray(r,2),o=n[0],a=n[1],i=this.get_w_h(e),s=_slicedToArray(i,2),_=s[0],c=s[1]
if(0==t)return[o+_/2,a]
if(1==t)return[o+_,a+c/2]
if(2==t)return[o+_/2,a+c]
if(3==t)return[o,a+c/2]}catch(e){return[1e4,1e4]}},get_mid_of_shape:function(e){var t=this.get_top_left(e,!0),r=_slicedToArray(t,2),n=r[0],o=r[1],a=this.get_w_h(e),i=_slicedToArray(a,2)
return[n+i[0]/2,o+i[1]/2]}}}function find_closest_neighbour_fallback(e,t){var r=posit2.show(),n=Object.keys(r)
n=n.filter(function(e){return 5==e.length}),n=n.map(function(e){return document.getElementById(e)}).filter(function(e){return e})
var o,a=n.map(function(e){return posit2.get_mid_of_side(e,(t+2)%4)}),i=posit2.get_mid_of_side(e,t)
0==t&&(o=function(e){return e[1]<i[1]}),2==t&&(o=function(e){return e[1]>i[1]}),3==t&&(o=function(e){return e[0]<i[0]}),1==t&&(o=function(e){return e[0]>i[0]}),a=_.zip(n,a)
var s=a.filter(function(e){return o(e[1])})
if(0==s.length)return!1
for(var c=s.map(function(e){return pyth_dist(e[1],i)}),l=1/0,u=0,d=0;d<c.length;d++)c[d]<l&&(l=c[d],u=d)
return s[u][0].id}function find_closest_neighbour(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3]
if(!r){var o=posit2.show()
r=Object.keys(o)}r=r.filter(function(e){return 5==e.length})
var a,i=r.map(function(e){return document.getElementById(e)}).filter(function(e){return e}),s=i.map(function(e){return posit2.tlbr(e)}),c=posit2.tlbr(e)
0==t&&(a=[(c.left+c.right)/2,c.bottom]),2==t&&(a=[(c.left+c.right)/2,c.top]),1==t&&(a=[c.left,(c.bottom+c.top)/2]),3==t&&(a=[c.right,(c.bottom+c.top)/2])
var l
0==t&&(l=function(e){return a[1]>e.bottom&&(inbetween(c.left,c.right,e.left)||inbetween(c.left,c.right,e.right)||covered(c.left,c.right,e.left,e.right))}),2==t&&(l=function(e){return a[1]<e.top&&(inbetween(c.left,c.right,e.left)||inbetween(c.left,c.right,e.right)||covered(c.left,c.right,e.left,e.right))}),1==t&&(l=function(e){return a[0]<e.left&&(inbetween(c.top,c.bottom,e.top)||inbetween(c.top,c.bottom,e.bottom)||covered(c.top,c.bottom,e.top,e.bottom))}),3==t&&(l=function(e){return a[0]>e.right&&(inbetween(c.top,c.bottom,e.top)||inbetween(c.top,c.bottom,e.bottom)||covered(c.top,c.bottom,e.top,e.bottom))}),s=_.zip(i,s)
var u=s.filter(function(e){return l(e[1])})
if(0==u.length)return!!n&&find_closest_neighbour_fallback(e,t)
for(var d=u.map(function(e){return pyth_dist([e[1].left,e[1].top],a)}),p=1/0,f=0,m=0;m<d.length;m++)d[m]<p&&(p=d[m],f=m)
return d[f]<1e6||!n?u[f][0].id:!!n&&find_closest_neighbour_fallback(e,t)}function align_neatly(e){var t=document.querySelector("#form_sort_by_font_size").checked,r=document.querySelector("#form_sort_by_font_family").checked,n=document.querySelector("#form_sort_by_style").checked,o=e.map(function(e){return[e,posit2.tlbr(e)]})
if(document.querySelector("#form_undo_alignment").style.display="flex",document.querySelector("#form_undo_alignment").onclick=function(e){return function(){e.forEach(function(e){ido(e[0]).reposition_me(e[0],e[1].left,e[1].top)}),document.querySelector("#form_undo_alignment").style.display="none"}}(o),t||r||n){var a=function(e){var o=window.getComputedStyle(e),a=""
return t&&(a+=o.fontSize),r&&(a+=o.fontFamily),n&&(a+=o.fill),a},i=_.groupBy(e,a)
Object.keys(i).forEach(function(e){align_sub_group(i[e])})}else align_sub_group(e)}function align_sub_group(e){function t(e,t){ks_copy=n.slice()
for(var o=[];e.length>0;){var a=[],i=e.pop()
a.push(i)
for(var s;s=r(i,ks_copy,t);)a.push(s),e=e.filter(function(e){return e!=s}),ks_copy=ks_copy.filter(function(e){return e!=s}),i=s
a.length>1&&o.push(a)}return o}function r(e,t,r){var n=find_closest_neighbour(document.getElementById(e),r,t,!1)
if(!n)return!1
var o=find_closest_neighbour(document.getElementById(n),(r+2)%4,t,!1)
return!!o&&(o!=e&&find_closest_neighbour(document.getElementById(e),r,t.filter(function(e){return e!=n}).slice(),!1),n)}var n=e.map(function(e){return e.id}),o=e.map(function(e){return[e.id,posit2.tlbr(e)]}),a=o.sort(function(e,t){return t[1].top-e[1].top}).map(function(e){return e[0]}),i=o.sort(function(e,t){return t[1].left-e[1].left}).map(function(e){return e[0]}),s=t(i,1),_=t(a,2)
s.forEach(function(e){var t=e.map(function(e){return document.getElementById(e)})
manage_groups.activate_temp_group(t),align_figs(t[0],t,"hor",!0)}),_.forEach(function(e){var t=e.map(function(e){return document.getElementById(e)})
manage_groups.activate_temp_group(t),align_figs(t[0],t,"vert",!0)}),manage_groups.reset()}function find_midpoints(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=d3.select(e),o=posit2.get_top_left(e,!0),a=_slicedToArray(o,2),i=a[0],s=a[1],c=posit2.get_w_h(e),l=_slicedToArray(c,2),u=l[0],d=l[1],p=!1
0!=u||e.classList.contains("hg")||(u=1,d=1)
var f=posit2.get_trans(e,!0),m=_slicedToArray(f.translate,2),g=m[0],h=m[1],y=f.rotate,v=iama(e)
return object_mapper[v].path_placement_correction&&0==r?(p=object_mapper[v].path_placement_correction(n,t,i,s,u,d),p=p.map(function(e){return conv_angle(-y,e[0],e[1])}),e.setAttribute("offset_for_path",_.flatten(p).map(function(e){return round_to(e,2)}))):p=[conv_angle(-y,u*t,0),conv_angle(-y,u,d*t),conv_angle(-y,u*t,d),conv_angle(-y,0,d*t)],p[0][1]-=r,p[1][0]+=r,p[2][1]+=r,p[3][0]-=r,p.map(function(e){return[g+e[0]*f.scale,h+e[1]*f.scale]})}function get_control_point_for_bow(e,t,r){var n=.3*e.dist
switch(parseInt(t)){case 0:cp=[e.midpoints[r][0],e.midpoints[r][1]-n]
break
case 1:cp=[e.midpoints[r][0]+n,e.midpoints[r][1]]
break
case 2:cp=[e.midpoints[r][0],e.midpoints[r][1]+n]
break
case 3:cp=[e.midpoints[r][0]-n,e.midpoints[r][1]]}return cp}function get_control_point(e,t,r,n,o){if(o=o||0,void 0==n)var a=line_styles[active_line_flow].perpendicular,i=line_styles[active_line_flow].inline
else var a=line_styles[n].perpendicular,i=line_styles[n].inline
a=Math.min(a+o,1),i=Math.min(i+o,1)
var s=e.dx,_=e.dy,c=e.midpoints[r][0],l=e.midpoints[r][1],u=0==r?1:-1
switch(parseInt(t)){case 0:cp=[c+s*i*u,l+_*a*u]
break
case 1:cp=[c+s*a*u,l+_*i*u]
break
case 2:cp=[c+s*i*u,l+_*a*u]
break
case 3:cp=[c+s*a*u,l+_*i*u]}return cp}function make_manhattan_path(e){function t(e,t,r){return r*e[0][t]+(1-r)*e[1][t]}var r,n,o=correct_path_end_points_for_arrows(cpa.path_g,e.midpoints),a=_slicedToArray(o,2),i=a[0],s=a[1]
if(cpa.hg&&hierarchies.need_to_use_example_path(cpa.e1,cpa.e2))!function(){var t=cpa.e2.classList.contains("helper_hg"),o=t?hierarchies.get_example_path_points(cpa.e1):hierarchies.get_example_path_points(cpa.e2),a=o[0],_=o[1]
r=_
var c=t?i:s
if(e.i==e.j?(n=e.i%2==0?[c[0],_[1]]:[_[0],c[1]],cpa.manhattan_perc=manhattan_offset_for_bow_if_hg([i,r,n,s])):e.i%2!=e.j%2?n=r=e.i%2==1?[c[0],_[1]]:[_[0],c[1]]:e.i%2==1?(n=[_[0],c[1]],cpa.manhattan_perc=1-Math.abs((a[0]-_[0])/(i[0]-s[0]))):e.i%2==0&&(n=[c[0],_[1]],cpa.manhattan_perc=1-Math.abs((a[1]-_[1])/(i[1]-s[1]))),t){var l=[n,r]
r=l[0],n=l[1],cpa.manhattan_perc>=0&&cpa.manhattan_perc<=1&&(cpa.manhattan_perc=1-cpa.manhattan_perc)}}()
else if(e.i==e.j){var _=cpa.manhattan_perc||MANH_OFFSET
if(e.i%2==0){var c=0==e.i?Math.min:Math.max
l=c(i[1],s[1])+_*(1-2*(0==e.i)),r=[i[0],l],n=[s[0],l]}else{var c=3==e.i?Math.min:Math.max,l=c(i[0],s[0])+_*(1-2*(3==e.i))
r=[l,i[1]],n=[l,s[1]]}}else if(e.i%2!=e.j%2)r=n=e.i%2==1?[s[0],i[1]]:[i[0],s[1]]
else if(e.i%2==1){var u=cpa.manhattan_perc?cpa.manhattan_perc:.5
r=[t(e.midpoints,0,u),i[1]],n=[r[0],s[1]]}else if(e.i%2==0){var u=cpa.manhattan_perc?cpa.manhattan_perc:.5
r=[i[0],t(e.midpoints,1,u)],n=[s[0],r[1]]}return[("M"+i+"L"+r+"L"+n+"L"+s).replace(/[\]\[]/g,""),function(){return[(r[0]+n[0])/2,(r[1]+n[1])/2]}()]}function manhattan_offset_for_bow_if_hg(e,t){4!=e.length&&text_to_feedback_pane("corrupted path")
var r=cpa.to_side%2==0?1:0
e[0].hasOwnProperty("x")&&(r=1==r?"y":"x")
var n=_slicedToArray(e,4),o=n[0],a=n[1],i=n[2],s=n[3]
return 1==cpa.from_side||2==cpa.from_side?t?i[r]-s[r]:Math.min(a[r]-o[r],i[r]-s[r]):t?s[r]-i[r]:Math.min(o[r]-a[r],s[r]-i[r])}function change_cubic_path_to_line(e){var t=e.querySelector("path").getAttribute("d")
t=cubic_d_to_line_d(t),d3.select(e).selectAll("path.mainfig, path.catcher").attr("d",t)
var r=path_to_array(t),n=get_path_custom_flow_attrs(r)
e.setAttribute("custom_flow",n),e.setAttribute("flow","lineto"),e.querySelector(".cp")&&(toggle_visible(),toggle_visible())}function cubic_d_to_line_d(e){function t(e,t){new_ps.push([e,t])}if(ps=path_to_array(e),new_ps=[],t(ps[0].x,ps[0].y),ps.length<5)for(var r=1;r<ps.length;r+=1)t(ps[r].x,ps[r].y)
else{t(ps[1].x,ps[1].y)
for(var r=3;r<ps.length-2;r+=3)t(ps[r].x,ps[r].y)
var n=ps.length-1
t(ps[n].x,ps[n].y)}return make_line_d(new_ps)}function make_line_d(e){return array_to_line(e.map(function(e){return{x:e[0],y:e[1]}}))}function make_cubic_bezier_path(e){return array_to_path(e.map(function(e){return{x:round_to(e[0],0),y:round_to(e[1],0)}}))}function get_points_along_path(e,t,r){for(var n=e.getTotalLength(),o=[],a=r;a<n-r;a+=t){var i=e.getPointAtLength(a)
o.push([i.x,i.y])}return o}function find_collision(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,o={},a=get_points_along_path(e,n,5)
if(0==a.length)return{geenpunt:!1}
for(var i=0;i<t.length;i++){var s=d3.select(t[i]),c=points_in_area(a,object_mapper[s.attr("i_am_a")].get_bbox_of_figure(s,!1,!0),_.any)
if(o[s.attr("id")]=c,c)return r?[o,a]:o}return r?[o,a]:o}function points_in_area(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_.all,n=[t.x0y0,t.x1y0,t.x1y1,t.x0y1],o=[]
return e.forEach(function(e){o.push(point_is_inside(e,n))}),r(o)}function element_overlaps_area(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!1,o=!1
return(inbetween(e.top,e.bottom,t.top)||inbetween(t.top,t.bottom,e.top))&&(n=!0),(inbetween(e.left,e.right,t.left)||inbetween(t.left,t.right,e.left))&&(o=!0),r?[n,o]:n&&o}function inbetween(e,t,r){return e<=r&&t>=r}function covered(e,t,r,n){return e<r&&t>n||r<e&&n>t}function find_path_for_text(e){paths=document.querySelectorAll("#zoomfield .mainpath")
for(var t=0;t<paths.length;t++)if(res=find_collision(paths[t],[e],!1,20),res[e.getAttribute("id")])return paths[t]
return!1}function parse_to_bbox(e,t,r,n){function o(r,n){return[e+r,t+n]}var a=(arguments.length>4&&void 0!==arguments[4]&&arguments[4],{})
return a.x0y0=[e,t],a.x1y0=o(r,0),a.x0y1=o(0,n),a.x1y1=o(r,n),a}function get_bbox_for_path(e){try{var t=e.getBBox()
return parse_to_bbox(t.x,t.y,t.width,t.height)}catch(e){return!1}}function add_shape_to_line_end(e,t,r,n){var o=get_g_for_add_on(e,r,n),a=1==r?t.j:t.i
if("hinter"==n)if(r)var i=t.original_point_head||t.midpoints[r]
else var i=t.original_point_tail||t.midpoints[r]
else var i=r?t.original_point_head:t.original_point_tail
o=path_end_figs[n].func(o,cpa.arrow_width,cpa.arrow_height,i),o.attr("transform","rotate("+[calc_arrow_angle(i,t.midpoints[r],a),i[0],i[1]]+")").attr("arrow_width",cpa.arrow_width).attr("arrow_height",cpa.arrow_height).attr("orig_p",i).on("click",function(e){if(currentElement=this,copied_styles){currentElement.style=copied_styles.style_attr
var t=currentElement.getAttribute("orig_p").split(",").map(function(e){return parseInt(e)})
d3.selectAll(currentElement.children).remove(),path_end_figs[n].func(d3.select(currentElement),copied_styles.width,copied_styles.height,t).attr("arrow_width",copied_styles.width).attr("arrow_height",copied_styles.height),copied_styles=!1,text_to_feedback_pane("pasted styles to path end fig")}else text_to_feedback_pane("selected arrow for styling"),display_fs_for_shape(currentElement),fill_forms(currentElement),gui.frame_element(currentElement)
d3.event.stopPropagation()})}function get_g_for_add_on(e,t,r){if("hinter"==r)var n="hinter_"+t
else var n="arrow_"+t
return e.select("."+n).empty()||e.select("."+n).remove(),e.append("g").attr("class",n).attr("type",r)}function recalc_paths_between_shapes_on_merged_parent(e){e.classList.contains("i_have_a_group")&&Array.from(e.querySelectorAll(".i_am_grouped")).forEach(function(e){recalc_connections(e.id)})}function calc_stroke_width_from_double(e){var t=currentElement.querySelector(".inner_path").style.strokeWidth,r=currentElement.querySelector(".mainpath").style.strokeWidth
return(parseFloat(r)-parseFloat(t))/2}function color_add_ons(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"g.arrow_0, g.arrow_1"
if("double"!=cpa.type){var r=window.getComputedStyle(e.select("path").node())
e.selectAll(t)[0].forEach(function(e){e.style.stroke=r.stroke,e.style.strokeWidth=r.strokeWidth,"rev_arrow"!=e.getAttribute("type")&&"arrow"!=e.getAttribute("type")||(e.style.fill="none"==r.fill?r.stroke:r.fill)})}else{var n=window.getComputedStyle(e.select(".mainpath").node()),o=window.getComputedStyle(e.select(".inner_path").node())
e.selectAll(t)[0].forEach(function(e){e.style.stroke=n.stroke,e.style.strokeWidth=(parseFloat(n.strokeWidth)-parseFloat(o.strokeWidth))/2,"rev_arrow"!=e.getAttribute("type")&&"arrow"!=e.getAttribute("type")||(e.style.fill=o.stroke)})}}function make_zero_one(e,t,r,n){var o=_slicedToArray(n,2),a=o[0],i=o[1],s=["M "+a+" "+i+" L "+(a+r)+" "+i+" M "+(a+r/2)+" "+(i-t/2)+" L "+(a+r/2)+" "+(i+t/2)],_=e.select("path")
return _.empty()&&(_=e.append("path")),_.attr("d",s),add_circle(e,t,r,n)}function add_circle(e,t,r,n){var o=e.select("circle")
return o.empty()&&(o=e.append("circle")),o.attr("r",4).attr("cx",n[0]+r).attr("cy",n[1]).style("fill","white"),e}function make_zero_tripod(e,t,r,n){var e=make_tripod(e,t,r,n)
return add_circle(e,t,r,n)}function make_one_only_one(e,t,r,n){var o=_slicedToArray(n,2),a=o[0],i=o[1],s=["M "+a+" "+i+" L "+(a+r)+" "+i+" M "+(a+r/2)+" "+(i-t/2)+" L "+(a+r/2)+" "+(i+t/2)+" M "+(a+r)+" "+(i-t/2)+" L "+(a+r)+" "+(i+t/2)],_=e.select("path")
return _.empty()&&(_=e.append("path")),_.attr("d",s),e}function make_tripod_one(e,t,r,n){var o=_slicedToArray(n,2),a=o[0],i=o[1],s=[a,i+t/2,a+r,i,a,i,a+r,i,a,i-t/2,a+r,i,a+r,i-t/2,a+r,i+t/2],_=e.select("polyline")
return _.empty()&&(_=e.append("polyline")),_.attr("points",s),e}function make_tripod(e,t,r,n){var o=_slicedToArray(n,2),a=o[0],i=o[1],s=[a,i+t/2,a+r,i,a,i,a+r,i,a,i-t/2,a+r,i],_=e.select("polyline")
return _.empty()&&(_=e.append("polyline")),_.attr("points",s),e}function make_arrow_head(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=""
a+=n[0]+","+n[1]+" ",a+=n[0]+r+","+(n[1]+t/2)+" "+(n[0]+r)+","+(n[1]-t/2)
var i=e.select("polygon")
return i.empty()&&(i=e.append("polygon")),i.attr("points",a),o&&e.append("line").attr({x1:n[0],y1:0,x2:n[0],y2:n[0]+2*t,"stroke-width":"3px",stroke:"grey"}),e}function make_arrow_head_rev(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=""
a+=n[0]+r+","+n[1]+" ",a+=n[0]+","+(n[1]+t/2)+" "+n[0]+","+(n[1]-t/2)
var i=e.select("polygon")
return i.empty()&&(i=e.append("polygon")),i.attr("points",a),o&&e.append("line").attr({x1:n[0],y1:0,x2:n[0],y2:n[0]+2*t,"stroke-width":"3px",stroke:"grey"}),e}function make_curved_arrow_head(e,t,r,n){var o=(arguments.length>4&&void 0!==arguments[4]&&arguments[4],"M "+(n[0]+r)+", "+(n[1]-t/2))
o+=" C "+(n[0]-.33*r)+", "+(n[1]+t/2),o+=" "+(n[0]-.33*r)+", "+(n[1]-t/2),o+=" "+(n[0]+r)+", "+(n[1]+t/2)
var a=e.select("path")
return a.empty()&&(a=e.append("path")),cpa.path_g&&cpa.path_g.classList.contains("rough")&&(o=roughing.hook.path(o,{roughness:2}).querySelector("path").getAttribute("d")),a.attr("d",o),e}function make_hinter(e,t,r,n){return arguments.length>4&&void 0!==arguments[4]&&arguments[4],e.select(".hinter").empty()&&e.append("circle").attr("r","4px").attr("cx",n[0]).attr("cy",n[1]).attr("class","hinter"),e}function calc_arrow_angle(e,t,r){if(e[0]==t[0]&&e[1]==t[1])return 0
if(r||(dx=e[0]-t[0],dy=e[1]-t[1],dxa=Math.abs(dx),dya=Math.abs(dy),r=dx>0&&dxa>dya?3:dx<0&dxa<dya?1:dy>0?0:2),r%2==0)var n=t[1]-e[1],o=t[0]-e[0]
else var o=-(e[1]-t[1]),n=e[0]-t[0]
return Math.atan(o/n)*(-360/(2*Math.PI))+90*r-90}function path_click_handler(){cmm.status()&&cmm.off(),copied_styles&&"path_group"==copied_styles.me?set_styles_for_copy(this,copied_styles):(set_currentElement(this),display_fs_for_shape(currentElement),d3.event.ctrlKey&&"click"==d3.event.type&&manage_groups.toggle_element(currentElement),gui.frame_element(currentElement),clear_path_attrs(),set_path_attrs(d3.select(currentElement))),d3.event.stopPropagation()}function path_double_click_handler(){toggle_visible(),d3.event.stopPropagation()}function make_path(e,t){var r=path_post_processing(t,cpa.type),n=t[1],o=e.append("g").attr("id",cpa.id).attr("i_am_a","path_group").attr("class",cpa.class+" connection").attr("tabindex",1).attr("from_side",n.i).attr("to_side",n.j).attr("type",cpa.type).attr("flow",cpa.flow).attr("pos1",cpa.pos1).attr("pos2",cpa.pos2).on("click",path_click_handler).on("dblclick",path_double_click_handler)
return cpa.fixed_side&&o.attr("fixed_side","true"),cpa.manhattan_perc&&o.attr("manhattan_perc",cpa.manhattan_perc),o.append("path").attr("d",r).attr("class","mainpath").style(path_specs[cpa.type].style),o.append("path").attr("d",r).attr("class","click_catcher").style(path_specs.click_catcher.style),"double"==cpa.type&&o.append("path").attr("d",r).attr("class","inner_path").style(path_specs.double_inner.style),cpa.arrow_head&&add_shape_to_line_end(o,n,1,cpa.arrow_head),cpa.arrow_tail&&add_shape_to_line_end(o,n,0,cpa.arrow_tail),"knot"==cpa.e1.getAttribute("i_am_a")&&move_element_to_top(cpa.e1),"knot"==cpa.e2.getAttribute("i_am_a")&&move_element_to_top(cpa.e2),path_post_post_processing(t[2],o),roughen_all&&roughing.roughen(o.node()),o}function remake_path(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=(e[1],d3.select("#"+cpa.id))
r.attr("deltas")&&(r.attr("deltas",null),r.attr("transform",null))
var n=path_post_processing(e,cpa.type),o=r.selectAll("path")
return r.attr("from_side",e[1].i).attr("to_side",e[1].j).attr("pos1",cpa.pos1).attr("pos2",cpa.pos2).attr("type",cpa.type).attr("flow",cpa.flow),(cpa.offset_from||r.attr("offset_from"))&&r.attr("offset_from",cpa.offset_from),(cpa.offset_to||r.attr("offset_to"))&&r.attr("offset_to",cpa.offset_to),cpa.manhattan_perc&&r.attr("manhattan_perc",cpa.manhattan_perc),o.attr("d",n),g=o.node().parentElement,cpa.fixed_side?g.setAttribute("fixed_side",!0):g.removeAttribute("fixed_side"),r.selectAll("text").each(function(){d3.select(this).select("textPath").empty()?(object_mapper.text_block.repos_along_path(this.parentElement,r.node()),recalc_connections(g.getAttribute("id"))):object_mapper.text_path.parent_path_move(r.node(),this.parentElement)}),r.selectAll("circle").empty()||(move_path_control_points(n,r,e),"manhattan"!=cpa.flow&&add_lines_to_control_points(path_to_array(n))),cpa.arrow_head&&add_shape_to_line_end(r,e[1],1,cpa.arrow_head),cpa.arrow_tail&&add_shape_to_line_end(r,e[1],0,cpa.arrow_tail),cpa.path_g.classList.contains("flasher")&&(add_shape_to_line_end(r,e[1],1,"hinter"),add_shape_to_line_end(r,e[1],0,"hinter")),cpa.tail_style&&r.select(".arrow_0").attr("style",cpa.tail_style),cpa.head_style&&r.select(".arrow_1").attr("style",cpa.head_style),cpa.arrow_head&&!cpa.head_style&&color_add_ons(r,"g.arrow_1"),cpa.arrow_tail&&!cpa.tail_style&&color_add_ons(r,"g.arrow_0"),cpa.on_top&&move_element_to_top(g),t&&path_post_post_processing(e[2],g),roughing.roughen_if_needed(g),r}function correct_path_end_points_for_arrows(e,t){if(cpa.arrow_tail&&e.querySelector(".arrow_0")){var r=e.querySelector(".arrow_0").getAttribute("orig_p").split(",").map(function(e){return parseInt(e)}),n=_slicedToArray(r,2),o=n[0],a=n[1]
t[0].x=o,t[0].y=a}if(cpa.arrow_head&&e.querySelector(".arrow_1")){var i=e.querySelector(".arrow_1").getAttribute("orig_p").split(",").map(function(e){return parseInt(e)}),s=_slicedToArray(i,2),_=s[0],c=s[1]
t[t.length-1].x=_,t[t.length-1].y=c}return t}function move_path_control_points(e,t,r,n){var o="path_group"==iama(t)
n=n||[0,0]
var a=path_to_array(e)
a=correct_path_end_points_for_arrows(t.node(),a),o&&"manhattan"==cpa.flow?cpa.custom_flow?a.slice(1,-1).forEach(function(e,r){t.select('circle.free_endpoint[my_index="'+(r+1)+'"]').attr("cx",e.x+n[0]).attr("cy",e.y+n[1])}):t.select("circle.manhattan").attr("cx",r[1].manhattan_midpoint[0]+n[0]).attr("cy",r[1].manhattan_midpoint[1]+n[1]):a.slice(1,-1).forEach(function(e,r){t.select('circle.bezier[my_index="'+(r+1)+'"]').attr("cx",e.x+n[0]).attr("cy",e.y+n[1])}),t.select("circle.endpoint_from").attr("cx",a[0].x+n[0]).attr("cy",a[0].y+n[1]),o&&"octopus"==cpa.type?t.select("circle.endpoint_to").attr("cx",a[3].x+n[0]).attr("cy",a[3].y+n[1]):t.select("circle.endpoint_to").attr("cx",a.slice(-1)[0].x+n[0]).attr("cy",a.slice(-1)[0].y+n[1])}function get_path_custom_flow_attrs(e){function t(e,t,r,n){var a=Math.round((e-t)/r*1e4)/1e4
if(a<0||a>1){var i
return 0==n&&e<o.x&&(i=e-o.x),0==n&&e>o.x&&(i=e-o.x-o.width),1==n&&e<o.y&&(i=e-o.y),1==n&&e>o.y&&(i=e-o.y-o.height),Math.round(1e4*i)/1e4}return a}var r=e[0],n=e[e.length-1],o=calc_bbox_endpoints(r.x,r.y,n.x,n.y),a=n.x-r.x||1,i=n.y-r.y||1,s=[]
return s=e.slice(1,e.length-1).map(function(e){return[t(e.x,r.x,a,0),t(e.y,r.y,i,1)]}),s.join(", ")}function get_path_from_custom_flow(e,t,r){function n(e,t,r,n){if(e<0||e>1){if(0==n&&e<0)return i.x+e
if(0==n&&e>0)return i.x+i.width+e
if(1==n&&e<0)return i.y+e
if(1==n&&e>0)return i.y+i.height+e}return e*r+t}var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.split(",").map(function(e){return parseFloat(e)}),i=calc_bbox_endpoints(t[0],t[1],r[0],r[1]),s=r[0]-t[0],_=r[1]-t[1]
a=a.map(function(e,r){return n(e,t[r%2],r%2==0?s:_,r%2)})
for(var c=[],l=0;l<a.length;l+=2)c.push([a[l],a[l+1]])
return o?make_line_d([t].concat(c).concat([r])):make_cubic_bezier_path([t].concat(c).concat([r]))}function calc_bbox_endpoints(e,t,r,n){return{x:Math.min(e,r),y:Math.min(t,n),width:Math.abs(e-r),height:Math.abs(t-n)}}function recalc_connections(e){function t(e,t){if(!e||!t)return!1
for(var r=t.parentElement;"zoomfield"!=r.id;){if(r==e)return!0
r=r.parentElement}return!1}var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=find_connections(e)
if(0==i.length)return!1
for(var s=0;s<i.length;s++){var _=svg.select("#"+i[s])
if(!(_.classed("hg")||(set_path_attrs(_),o&&cpa.id in paths_on_canvas_done)))if(o&&t(o,cpa.e2)&&t(o,cpa.e1))translate_path(cpa.path_g,a[0],a[1])
else{var c=find_path(!0,r)
c[3]&&path_buffer.add_path("#"+i[s]),remake_path(c,n),DISP_AFTER&&(disperse_path_over_side(cpa.e2,cpa.to_side,.1),disperse_path_over_side(cpa.e1,cpa.from_side,.1))}}return!0}function add_cp_to_path(e,t){var r=path_to_array(e.querySelector(".click_catcher").getAttribute("d")).map(function(e){return[e.x,e.y]}),n="octopus"==e.getAttribute("type"),o="manhattan"==e.getAttribute("flow")
if(n&&(r=r.slice(0,(r.length+1)/2)),o)var a=r.pop(),i=r.pop(),s=[(a[0]+i[0])/2,(a[1]+i[1])/2],_=r.concat([i,s,a])
else if(r.length>4){var _=casteljau_insert(r.splice(0,4),.5)
_=_.concat(r)}else var _=casteljau_insert(r,.5)
_=_.map(function(e){return{x:e[0],y:e[1]}}),n&&make_wide_path(_)
var c=o?array_to_line(_):array_to_path(_)
direct_child_only_selector(e,"path").forEach(function(e){e.setAttribute("d",c)})}function casteljau_insert(e,t){function r(r){var n=e.map(function(e){return e[r]}),o=_slicedToArray(n,4),a=o[0],i=o[1],s=o[2],_=o[3],c=(1-t)*a+t*i,l=(1-t)*i+t*s,u=(1-t)*s+t*_,d=(1-t)*c+t*l,p=(1-t)*l+t*u,f=(1-t)*d+t*p
return[[a,c,d,f],[f,p,u,_]]}var n=r(0),o=_slicedToArray(n,2),a=o[0],i=o[1],s=r(1),c=_slicedToArray(s,2),l=c[0],u=c[1],d=_.zip(a,l),p=_.zip(i,u)
return d.concat(p.splice(1))}function translate_path(e,t,r){var n=e.getAttribute("deltas")
n&&(n=n.split(","),t+=parseFloat(n[0]),r+=parseFloat(n[1])),e.setAttribute("transform","translate("+[t,r]+")"),e.setAttribute("deltas",[t,r]),paths_on_canvas_done[e.id]=!0}function get_manhattan_perc(e,t){var r=find_g(e),n=path_to_array(r.querySelector("path").getAttribute("d")),o=n[0],a=n.slice(-1)[0],o=[o.x,o.y],a=[a.x,a.y],i=parseInt(r.getAttribute("from_side"))%2,s=1*!i
if(cpa.from_side==cpa.to_side){var _=Math.min.apply(null,[o,a].map(function(e){return e[s]-t[s]}))
return 1==cpa.from_side||2==cpa.from_side?-_:_}return 1-(t[s]-o[s])/(a[s]-o[s])}function path_correction_for_arrow(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg","path")
if(r.setAttribute("d",e[0]),c_to_c=e[1],t)n=r.getTotalLength(),n-=cpa.arrow_height*OVERLAP+0
else var n=cpa.arrow_height*OVERLAP+0
var o=r.getPointAtLength(n)
return original_point=c_to_c.midpoints[t].slice(),c_to_c.midpoints[t]=[o.x,o.y],cpa.arrow_height+=0,[make_d(c_to_c,1-OVERLAP),original_point]}function manhattan_perc_correction_for_arrow(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg","path")
r.setAttribute("d",e[0])
var n=cpa.arrow_height*OVERLAP,o=e[1]
cpa.manhattan_perc=cpa.manhattan_perc||.5
var a=cpa.manhattan_perc,i=parseInt(cpa.from_side),s=i%2==0?"y":"x",_=r.getTotalLength(),c=r.getPointAtLength(_)[s]-r.getPointAtLength(0)[s]
if(t)var l=r.getPointAtLength(_-n)[s]-r.getPointAtLength(0)[s],u=1-c*(1-cpa.manhattan_perc)/l
else var l=r.getPointAtLength(_)[s]-r.getPointAtLength(n)[s],u=c*cpa.manhattan_perc/l
cpa.manhattan_perc=u
var d=make_d(o,1-OVERLAP)
return cpa.manhattan_perc=a,d}function path_post_processing(e,t){var r=e[1],t=t||active_line_style
if(cpa.e1.classList.contains("hg"),cpa.arrow_head||cpa.arrow_tail){if(cpa.arrow_head){var n=path_correction_for_arrow(e,1)
e[0]=n[0],r.original_point_head=n[1]}if(cpa.arrow_tail){var n=path_correction_for_arrow(e,0)
e[0]=n[0],r.original_point_tail=n[1]}}if("single_stroke"==path_specs[t].thickness||"double"==path_specs[t].thickness)d=e[0]
else{var o=path_to_array(e[0])
make_wide_path(o,r),d=array_to_path(o,r)}return d}function path_post_post_processing(e,t){if(Object.keys(e).forEach(function(t){if(e[t]){var r=document.querySelector("#"+t)
r.parentElement.appendChild(r)}}),"knot"!=iama(cpa.e1)){var r=cpa.e1
r.parentElement.appendChild(r)}if("knot"!=iama(cpa.e2)){var r=cpa.e2
r.parentElement.appendChild(r)}}function toggle_visible(){if(currentElement.querySelector(".cp"))svg.selectAll(".cp_helper_line").remove(),svg.selectAll(".cp").remove()
else{svg.selectAll(".cp_helper_line").remove(),svg.selectAll(".cp").remove()
var e=currentElement.querySelector(".click_catcher, .catcher").getAttribute("d"),t=path_to_array(e),r=d3.select(currentElement),n=7,o="path_group"==iama(currentElement),a=!1
if(currentElement.hasAttribute("flow")&&(a="lineto"==currentElement.getAttribute("flow")),o&&(t=correct_path_end_points_for_arrows(currentElement,t)),o?("knot"!=iama(cpa.e1)&&add_control_point(r,t[0],"endpoint_from",cpa.from_side),"knot"!=iama(cpa.e2)&&"octopus"!=cpa.type&&add_control_point(r,t[t.length-1],"endpoint_to",cpa.to_side)):(n=5,add_control_point(r,t[0],"free_endpoint",0,void 0,n),add_control_point(r,t[t.length-1],"free_endpoint",t.length-1,void 0,n)),o&&"manhattan"==cpa.flow)if(cpa.custom_flow)t.slice(1,t.length-1).forEach(function(e,o){return add_control_point(r,e,"free_endpoint",o+1,t.length-2,n)})
else if(t[1].x==t[2].x&&t[1].y==t[2].y)text_to_feedback_pane("only endpoins movable",!1,!0)
else{var i={}
i.x=(t[1].x+t[2].x)/2,i.y=(t[1].y+t[2].y)/2,add_control_point(r,i,"manhattan")}else if(o&&"lineto"==cpa.flow||!o&&a)t.slice(1,t.length-1).forEach(function(e,o){return add_control_point(r,e,"free_endpoint",o+1,t.length-2,n)})
else if(o&&"octopus"==cpa.type)add_control_point(r,t[(t.length-1)/2],"endpoint_to",cpa.to_side),t.slice(1,(t.length-1)/2).forEach(function(e,o){return add_control_point(r,e,"bezier",o+1,t.length-2,n)})
else{if(t.slice(1,-1).forEach(function(e,o){return add_control_point(r,e,"bezier",o+1,t.length-2,n)}),"path_basic"==iama(currentElement))var s=ido(currentElement).get_offset_path_to_canvas(currentElement),_=d3.transform(d3.select(currentElement).select("path.mainfig").attr("transform")).translate,c=[s[0]+_[0],s[1]+_[1]]
else var c=!1
t.slice(1,-1).length>2&&add_lines_to_control_points(t,c)}move_element_to_top(currentElement)}}function stop_poly_point_when_rotated(e){return 0!=posit2.get_trans(e).rotate[0]&&(text_to_feedback_pane(["cannot modify rotated polypoint shape","reset to default rotation first (Figure Controls, advanced)"],!0,!0),!0)}function toggle_poly_points(e){var e=d3.select(e)
if(e.select(".poly_point").empty()){svg.selectAll(".cp").remove()
var t=iama(e)
if(Object.keys(poly_config).find(function(e){return e==t}))r=[]
else{if(stop_poly_point_when_rotated(e.node()))return!1
document.querySelector("#cm-fig-menu-addon-pp .cm_button_add_point").style.display="flex"
var r=object_mapper[iama(e)].set_poly_points(e)}r.forEach(function(t,r){add_control_point(e,{x:t[0],y:t[1]},"poly_point",r.toString())})}else svg.selectAll(".cp").remove(),e.selectAll(".poly_point").remove(),document.querySelector("#cm-fig-menu-addon-pp .cm_button_add_point").style.display="none"}function add_control_point(e,t,r,n,o){var a,i
if(arguments.length>5&&void 0!==arguments[5]&&arguments[5],"endpoint"==r.slice(0,8)){var s=end_point_move
a="red",i=n%2==1?"ns-resize":"ew-resize",n=!1}else if("manhattan"==r){var s=manhattan_move
a="purple",i=cpa.to_side%2==1?"ew-resize":"ns-resize"}else if("bezier"==r){var _=is_cubic_cp_of_type(n,o),s=cubic_move
a="free"==_?"yellow":"bound"==_?"greenyellow":"purple",i="move"}else if("poly_point"==r){var s=poly_point_move
a="yellow",i="slide"==e.attr("i_am_a")?["nw-resize","ne-resize","se-resize","sw-resize"][n]:"cell"}else if("free_endpoint"==r){var s=free_move
a="pink"}else console.log("onbekende dragtype in add control_point")
var c=[0,0]
if("path_basic"==iama(e)||"country_basic"==iama(e))var c=d3.transform(e.select("path.mainfig").attr("transform")).translate
var l=toggle_zoom.get_zoom_factor(),u=e.append("circle").attr("r",parseInt(7/l)).attr("class","cp "+r).attr("cx",t.x+c[0]).attr("cy",t.y+c[1]).attr("fill",a).attr("fill-opacity",.8).attr("stroke","black").attr("stroke-width","0.2%").on("mouseover",function(){toggle_zoom.temp_disable_on()}).on("mouseout",function(){toggle_zoom.temp_disable_off()}).on("touchstart",function(){toggle_zoom.temp_disable_on()}).on("touchend",function(){toggle_zoom.temp_disable_off()}).style("cursor",i).call(s)
return n&&u.attr("my_index",n),u}function make_wide_path(e,t){var r,n,o=cpa.octo_flipped||!1,a=o?"e2":"e1",i=o?"pos2":"pos1",s=o?cpa.to_side||t.j:cpa.from_side||t.i
o&&e.reverse()
var c=e.length-2
_.range(c,0,-1).forEach(function(t){e.push({start:t==c,type:"C",x:e[t].x+2*(c-t),y:e[t].y+2*(c-t)})})
var l=cpa[a].getAttribute("i_am_a"),u=posit2.get_top_left(cpa[a])
if("ellipse"==l.split("_")[0]){var d=parseInt(cpa[a].querySelector("ellipse").getAttribute("rx")),p=parseInt(cpa[a].querySelector("ellipse").getAttribute("ry"))
r=u[0]+d,n=u[1]+p,offset=object_mapper[l].get_offset(r,d,n,p,s,parseFloat(cpa[i])+.07),r=u[0]+offset[0],n=u[1]+offset[1]}else if(_.contains(polygon_shapes,l)){var f=parseInt(cpa[a].getAttribute("width")),m=parseInt(cpa[a].getAttribute("height"))
r=u[0],n=u[1],object_mapper[l].set_poly_points(d3.select(cpa[a])),offset=object_mapper[l].get_offset(r,n,f,m,s,parseFloat(cpa[i])+.07),r=u[0]+offset[0],n=u[1]+offset[1]}else 0==s||2==s?(r=e[0].x+10,n=e[0].y):(r=e[0].x,n=e[0].y+10)
e.push({start:!1,type:"C",x:r,y:n}),o&&e.reverse()}function array_to_path(e){for(var t="M"+e[0].x+","+e[0].y+" ",r=1;r<e.length;r++)r%3==1&&(t+="C"),t+=e[r].x+","+e[r].y+" "
return t}function array_to_line(e){for(var t="M"+e[0].x+","+e[0].y+" ",r=1;r<e.length;r++)t+="L"+e[r].x+","+e[r].y+" "
return t}function path_to_array(e){data=e.match(/([A-Z])|(-?\d+\.?\d*)/g)
for(var t=[],r="",n=0;n<data.length;n+=0)isNaN(parseFloat(data[n]))?(r=data[n],n+=1,start_of_el=!0):(t.push({x:parseFloat(data[n]),y:parseFloat(data[n+1]),i:n,type:r,start:start_of_el}),n+=2,start_of_el=!1)
return t}function copy_part_of_path(e,t,r,n,o,a){for(var i,s=n/(o-1),_=[],c=0;c<o;c++){if(i=e.getPointAtLength(path_len_to_check(t+c*s,r)),a){var l=e.getPointAtLength(path_len_to_check(t+c*s+2,r))
i=function(e,t){var r=t.x-e.x,n=t.y-e.y,o=Math.atan(n/r),i=r<0?-1:1
return{x:e.x+Math.sin(o)*a[0]*i,y:e.y+Math.cos(o)*a[1]*i}}(i,l)}_.push(i)}return line_generator(_)}function path_len_to_check(e,t){var r=e%(2*t)
return r>t&&(r=t-r%t),Math.abs(r)}function make_flasher(e){set_path_attrs(d3.select(e)),e.classList.add("flasher"),e.classList.add("flasher_hide"),ps=path_to_array(e.querySelector("path").getAttribute("d"))
var t=[ps[0].x,ps[0].y],r=[ps[ps.length-1].x,ps[ps.length-1].y],n={i:cpa.from_size,j:cpa.to_side,original_point_head:t,original_point_tail:r,midpoints:[t,r]}
add_shape_to_line_end(d3.select(e),n,0,"hinter"),add_shape_to_line_end(d3.select(e),n,1,"hinter")}function unmake_flasher(e){e.classList.remove("flasher"),e.classList.remove("flasher_hide"),d3.select(e).selectAll(".hinter").remove()}function find_highest_ids_per_prefix(e){for(var t={},r=0;r<e.length;r++)if(e[r].hasAttribute("id")&&e[r].hasAttribute("i_am_a")&&"path_group"!=e[r].getAttribute("i_am_a")){var n=function(e){return[e.slice(0,1),e.slice(1)]}(e[r].getAttribute("id")),o=_slicedToArray(n,2),a=o[0],i=o[1]
a in t||(t[a]="0000"),t[a]=get_max(t[a],i)}return t}function get_max(e,t){return"_"==e&&(e="0"),"_"==t&&(t="0"),e>t?e:t}function pad_id(e){return res="",e<10&&(res+="0"),e<100&&(res+="0"),e<1e3&&(res+="0"),res}function next_id_gen(e,t){var r=t
return function(){if(r>9999){var t=get_new_id_prefix_and_num(),n=_slicedToArray(t,2),o=n[0],a=n[1]
e=o,r=a}return res=pad_id(r),res+=r.toString(),r+=1,e+res}}function get_new_id_prefix_and_num(){var e=find_highest_ids_per_prefix(svg.selectAll("g")[0]),t=Object.keys(e).filter(function(e){return"_"!=e}).sort()
if(t.length>0){for(var r=0;r<t.length;r++)if(e[t[r]]<9999)return[t[r],parseInt(e[t[r]])+1]
return[String.fromCharCode(t.slice(-1)[0].charCodeAt(0)+1),0]}return["A",0]}function make_table_id_func(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"t",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0
return function(){return t+=1,e+"0".repeat(4-t.toString().length)+t.toString()}}function table_init(){tables={}
var e=Array.from(svg.node().querySelectorAll("g[table]"))
if(0==e.length)t=0
else{s=Array.from(new Set(e.map(function(e){return e.getAttribute("table")}))),s.forEach(function(e){return reconstruct_table(e)})
var t=Math.max.apply(void 0,s.map(function(e){return parseInt(e.slice(1))}))}get_id_for_table=make_table_id_func("t",t)}function get_custom_bbox(e){e=find_g(e)
var t=object_mapper[iama(e)].get_bbox_of_figure(d3.select(e),!0,!0),r=_slicedToArray(t,4)
return x=r[0],y=r[1],w=r[2],h=r[3],{top:y,bottom:y+h,left:x,right:x+w,width:w,height:h}}function Fig(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3]
this.svg_fig=e.svg_fig,this.my_name=e.my_name,this.dims=e.dims,this.styles=e.styles,this.constructs=t||[],this.events=r,this.drag=void 0,this.myclasses=e.myclasses,this.my_style_classes=e.my_style_classes,this.my_form_elements=e.my_form_elements,this.merge=e.merge,this.style_on_fig="style_on_fig"in e,this.id_less=n,this.my_shape=e.my_shape,this.attrs={},this.attrs.g={}}function transform_to_string(e){return"translate("+e.translate+") scale("+e.scale+") rotate("+e.rotate+")"}function get_scale_chain(e){for(var t=1;"zoomfield"!=e.parentElement.id;)e=e.parentElement,t*=posit2.get_trans(e).scale
return t}function check_if_custom_par_margin(e){return!!e.style.marginLeft||!!e.style.marginRight}function look_for_free_space(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,n=toggle_zoom.get_screen_pos(find_g(e))
free=document.querySelector(".overlay")
var o=n.left+10,a=n.right-10,i=(a-o)/t,s=_.range(t).map(function(e){return[o+i*e,n.bottom+r]}),c=s.map(function(e){return document.elementFromPoint(e[0],e[1])==free})
if(_.all(c))return 2
var o=n.top,a=n.bottom,i=(a-o)/t,s=_.range(t).map(function(e){return[n.right+r,o+i*e]}),c=s.map(function(e){return document.elementFromPoint(e[0],e[1])==free})
return _.all(c)?1:c}function selectElementContents(e){var t=document.createRange()
t.selectNodeContents(e)
var r=window.getSelection()
r.removeAllRanges(),r.addRange(t)}function filter_elements_to_search(e){var t=["text_path","text_block"]
return e.filter(function(e){return!d3.select(e).classed("gui")&&!t.find(function(t){return t==iama(e)})})}function find_elements_in_bbox_test(e,t,r){var n=(!(arguments.length>3&&void 0!==arguments[3])||arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4])
n||(n=svg)
var o=t?n.selectAll("g[i_am_a]")[0]:svg.selectAll("g.evade_me")[0]
o=o.filter(function(e){return!e.classList.contains("axis")}),o=r?o.filter(function(e){return!d3.select(e).classed("gui")}):filter_elements_to_search(o),res=[]
for(var a=0;a<o.length;a++){var i=iama(o[a])
if(["path_group","text_path"].find(function(e){return e==i}))bbox=get_bbox_for_path(o[a])
else try{bbox=ido(o[a]).get_bbox_of_figure(d3.select(o[a]),void 0,!0)}catch(e){}points_in_area(_.values(bbox),e)&&res.push(o[a])}return res}function clean_specs(e,t){var r=e.children.find(function(e){return"catcher"==e.attrs.class})
"ellipse"==object_mapper[t].svg_fig?(e.children[0].attrs.rx=e.attrs.width/2,e.children[0].attrs.ry=e.attrs.height/2,r.attrs.rx=e.attrs.width/2,r.attrs.ry=e.attrs.height/2,delete r.attrs.transform):"ellipse"==object_mapper[e.attrs.i_am_a].svg_fig&&(delete e.children[0].attrs.rx,delete e.children[0].attrs.ry,delete r.attrs.rx,delete r.attrs.ry),"polygon"==object_mapper[t].svg_fig?(e.attrs.class+=" polygon_basic",e.children[0].attrs.points=object_mapper[t].points_to_string(object_mapper[t].calc_polygon_points(150,200))):"polygon"==object_mapper[e.attrs.i_am_a].svg_fig&&(e.attrs.class=e.attrs.class.replace(/polygon_basic /,""))
var n=object_mapper[t].calc_catcher_attrs(parseInt(e.attrs.height),parseInt(e.attrs.width))
for(var o in n)r.attrs[o]=n[o]
return r.element=object_mapper[t].svg_fig,e.attrs.i_am_a=t,e.children[0].element=object_mapper[t].svg_fig,e}function FO(e,t,r,n){Fig.call(this,e,t,r,n)}function RectBasic(e,t,r,n){Fig.call(this,e,t,r,n)}function EllipseBasic(e,t,r,n){Fig.call(this,e,t,r,n)}function MathBasic(e,t,r,n){Fig.call(this,e,t,r,n)}function SvgIcon(e,t,r,n){Fig.call(this,e,t,r,n)}function Polygon(e,t,r,n){Fig.call(this,e,t,r,n)}function calc_x_from_y(e,t,r,n,o){var a=t[0]-e[0],i=t[1]-e[1],s=i/a,_=e[1]-e[0]*s
if(0==s)return o?[r,e[1]]:r
if(s==1/0||s==-1/0)return o?[e[0],r]:r
var c=_+s*r,l=(r-_)/s
return o?n?[r,c]:[l,r]:n?c:l}function between_two_lines(e,t,r){function n(e,t,r,n,o){return function(a){svg.selectAll("circle.ptest."+o).data(_.range(e,t,r)).enter().append("circle").attr("class","ptest").attr("r",5).attr("cx",function(e){return e}).attr("cy",function(e){return n(e)+a}).attr("r",2).style("fill",o)}}for(var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=t[0]-e[0],s=t[1]-e[1],c=s/i,l=e[1]-e[0]*c,u=0;u<r.length;u++){var d=r[u]
if(c==1/0||c==-1/0?(t1=e[0]+a,t2=e[0]-a,o=0):0==c?(t1=e[1]+a,t2=e[1]-a,o=1):(t1=c*d[0]+l+a,t2=c*d[0]+l-a,o=1,testers.push(n(e[0]-400,e[0]+400,5,function(e){return c*e+l},"blue")),testers.push(n(t[0]-400,t[0]+400,5,function(e){return c*e+l},"red"))),!(d[o]>t1&&d[o]<t2||d[o]<t1&&d[o]>t2))return!1}return!0}function find_closest_projectable(e,t,r){var n=_.range(t.length).map(function(e){return[e,(e+1)%t.length]}),o=0==e||2==e?0:1,a=0==e||2==e?1:0,i=n.map(function(e){return[t[e[0]][o],t[e[1]][o]].sort(function(e,t){return e>t})}),s=n.map(function(e){return[t[e[0]][a],t[e[1]][a]].sort(function(e,t){return e>t})}),c=r[o]
projections=i.map(function(e,t){return c>=e[0]&&c<=e[1]?Math.min(Math.abs(r[a]-s[t][a]),Math.abs(r[a]-s[t][a])):1/0})
var l=Math.min.apply(null,projections)
return n[projections.indexOf(l)]}function find_index_of_closest_point(e,t){var r=e.map(function(e){return pyth_dist(e,t)})
return r.indexOf(d3.min(r))}function pyth_dist(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)}function PolyPoints(e,t,r,n){Polygon.call(this,e,t,r,n)}function Slide(e,t,r,n){PolyPoints.call(this,e,t,r,n)}function find_scale_factor(e,t,r,n){return Math.min(e/r,t/n)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t]
return r}return Array.from(e)}function TextBasic(e,t,r,n){Fig.call(this,e,t,r,n)}function TextBlock(e,t,r,n){TextBasic.call(this,e,t,r,n),this.XCOR=6,this.YCOR=3,this.TRANSCOR=[-3,0]}function TextPath(e,t,r,n){TextBasic.call(this,e,t,r,n),this.OFFSET=[-5,5]}function PathBasic(e,t,r,n){Fig.call(this,e,t,r,n)}function get_path_points_min_max(e){var t=path_to_array(e.querySelector("path").getAttribute("d"))
return[Math.min.apply(null,t.map(function(e){return e.x})),Math.max.apply(null,t.map(function(e){return e.x})),Math.min.apply(null,t.map(function(e){return e.y})),Math.max.apply(null,t.map(function(e){return e.y}))]}function CountryBasic(e,t,r,n){Fig.call(this,e,t,r,n)}function find_my_neighbours(e,t){var r=t.getAttribute("vt").split("_").map(function(e){return parseInt(e)}),n=_slicedToArray(r,2),o=n[0],a=n[1],i=o>0&&e[o-1][a],s=o<e.length-1&&e[o+1][a],_=e[0].length,c=a>0&&e[o][a-1]
return[i,s,a<_-1&&e[o][a+1],c]}function AxisBasic(e,t,r,n){Fig.call(this,e,t,r,n)}function LineForGraph(e,t,r,n){Fig.call(this,e,t,r,n)}function RectCanvas(e,t,r,n){RectBasic.call(this,e,t,r,n)}function AxesBoard(e,t,r,n){Fig.call(this,e,t,r,n)}function GraphBasic(e,t,r,n){AxesBoard.call(this,e,t,r,n)}function CellBasic(e,t,r,n){RectBasic.call(this,e,t,r,n)}function catcher_flash(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100
0==t?(e.classList.add("catcher"),e.style.stroke=null,e.style.opacity=null,e.style.strokeWidth=r,e.classList.remove("shine")):d3.select(e).transition().style("stroke-width","1px").style("opacity",1).duration(n).transition().style("stroke-width","1px").style("opacity",.2).duration(n).each("end",function(){catcher_flash(this,t-1,r)})}function _origin(){var e=d3.select(currentElement),t=d3.transform(e.attr("transform"))
return{x:t.translate[0],y:t.translate[1]}}function _origin_for_rotate(){var e=d3.select(currentElement),t=toggle_zoom.get_zoom_factor(),r=posit2.get_trans(currentElement).scale,n=parseFloat(e.attr("width"))*t*r,o=parseFloat(e.attr("height"))*t*r,a=currentElement.getCTM(),i=posit2.get_trans(e.node()),s=rotate_point(-i.rotate[0]*Math.PI/180,n/2,o/2)
dx=s[0],dy=s[1]
var _="touchstart"==d3.event.type?[d3.event.touches[0].clientX,d3.event.touches[0].clientY]:[d3.event.clientX,d3.event.clientY],c=_slicedToArray(_,2),l=c[0],u=c[1]
return{x:l-(a.e+dx),y:u-(a.f+dy)}}function to_discrete_position(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:parseInt,r=e[0],n=e[1]
return[t(r/mdd)*mdd,t(n/mdd)*mdd]}function drag_treshold(e){var t=0
return{add:function(r,n){return t+=Math.abs(r)+Math.abs(n),t>e?[r,n]:[0,0]},reset:function(){t=0},treshold_reached:function(){return t>e}}}function double_tap_detect(e){function t(e){return!(1!=e.touches.length||e.timeStamp-n.time>500||e.target!=n.target||Math.abs(e.touches[0].clientX-n.pos[0])>5||Math.abs(e.touches[0].clientY-n.pos[1])>5)}function r(e){n.target=e.target,n.time=e.timeStamp,n.pos=[e.touches[0].clientX,e.touches[0].clientY]}var n={target:null,time:0,pos:[0,0]}
return function(){t(d3.event)&&(d3.event.preventDefault(),e.bind(this)()),r(d3.event)}}function add_point_to_end_of_path(e){var t=find_connections(e.id)[0],r=document.getElementById(t).querySelector("path"),n=r.getAttribute("d"),o=path_to_array(n).map(function(e){return[e.x,e.y]}),a=casteljau_insert(o.splice(o.length-4),.95)
o=o.concat(a).map(function(e){return{x:e[0],y:e[1]}})
var n=array_to_path(o)
direct_child_only_selector(document.getElementById(t),"path").forEach(function(e){e.setAttribute("d",n)}),cpa.custom_flow=get_path_custom_flow_attrs(path_to_array(n)),d3.select("#"+t).attr("custom_flow",cpa.custom_flow).attr("fixed_side","true")}function shift_drag_knot_update(e,t,r){var n=find_connections(e.id)[0],o=document.getElementById(n).querySelector("path"),a=o.getAttribute("d"),i=path_to_array(a),s=i.length
i[s-1].x+=t,i[s-1].y+=r,i[s-2].x+=t,i[s-2].y+=r
var a=array_to_path(i)
direct_child_only_selector(document.getElementById(n),"path").forEach(function(e){e.setAttribute("d",a)}),cpa.custom_flow=get_path_custom_flow_attrs(path_to_array(a)),d3.select("#"+n).attr("custom_flow",cpa.custom_flow)}function el_under_dragged_shape(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0]
el_under&&el_under.select(".under").classed("under",!1),el_under=!1
var t=window.event,e=check_if_el_under(t,e)
e&&check_connectable(e)&&(el_under=d3.select(find_g(e)),el_under.classed("rough")?el_under.select("path[is_border]").classed("under",!0):el_under.select(".mainfig").classed("under",!0))}function get_x_position_for_path_to_bind(e){return posit2.get_top_left(e)[0]}function draw_shape_close_circle(e){var t=1/toggle_zoom.get_zoom_factor()
svg.append("circle").attr("class","close_circle").attr("r","10px").attr("transform"," translate("+e+") scale("+t+")").style("fill","yellowgreen").style("opacity",.5)}function create_zoom_filter_adjuster(e,t,r){var n=_slicedToArray(t,2),o=n[0],a=n[1],i=d3.select("#mainsvg"),s=function(t){if(o==a)var n=1
else var n=Math.max(.05,Math.min((t-o)/(a-o),1))
i.select("#"+e+" feFuncA").attr("tableValues","0 "+n),i.select("#"+e+" feGaussianBlur").attr("stdDeviation",r-r*n)}
return s(1),s}function zoom_func(){!d3.event.sourceEvent||d3.event.sourceEvent.deltaX||d3.event.sourceEvent.deltaY||svg_zoom_filters_on&&(turn_off_zoom_filters(),turn_on_filters=!0),svg.node().dispatchEvent(slide_exit),svg.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")"),printer.set_new_zoom_factor(d3.event.scale),iama(currentElement)&&gui.frame_element(currentElement),svg.select(".cp").empty()||svg.selectAll(".cp").attr("r",7/d3.event.scale)}function time_func(e){return function(){return console.time("a"),console.log(arguments),res=e.apply(void 0,arguments),console.timeEnd("a"),res}}function resize_elements(e,t,r){var n=parseFloat(e.getAttribute("width")),o=parseFloat(e.getAttribute("height"))
t.forEach(function(e,t){var a="height"==r?parseFloat(e.getAttribute("width")):n,i="width"==r?parseFloat(e.getAttribute("height")):o
t>0&&e.hasAttribute("table")?object_mapper[iama(e)].resize_me(d3.select(e),a,i,!0,!0):(object_mapper[iama(e)].resize_me(d3.select(e),a,i,!0),recalc_connections(e.getAttribute("id")))})}function find_boundaries(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=1/0,o=0,a=1/0,i=0,s=0;s<e.length;s++){var _=[posit2.get_top_left(e[s]),posit2.get_bottom_right(e[s])],c=t?0:1,l=r?1:0
n=Math.min(n,_[c][0]),a=Math.min(a,_[c][1]),o=Math.max(o,_[l][0]),i=Math.max(i,_[l][1])}return[n,a,o,i]}function find_dim_for_alignment(e){var t=find_boundaries(e,!0,!1),r=_slicedToArray(t,4)
return minX=r[0],minY=r[1],maxX=r[2],maxY=r[3],maxY-minY>maxX-minX?"vert":"hor"}function find_start_end_position(e,t){var r=find_boundaries(e,!0,!0),n=_slicedToArray(r,4)
minX=n[0],minY=n[1],maxX=n[2],maxY=n[3]
var o=posit2.get_top_left(e[0]),a=posit2.get_bottom_right(e[0])
return"hor"==t?(minY=o[1],maxY=a[1]):"vert"==t&&(minX=o[0],maxX=a[0]),[minX,maxX,minY,maxY]}function sort_els(e,t){var r=e.filter(function(e){return"path_group"!=iama(e)})
return r=r.sort(function(e,r){return posit2.get_top_left(e)[t]-posit2.get_top_left(r)[t]})}function align_figs(e,t,r,n){function o(e,t,r){var n=get_custom_bbox(e),o=get_custom_bbox(t)
return 0==r?n.top-n.bottom:1==r?o.left-n.right:2==r?o.top-n.bottom:3==r?n.left-o.right:void 0}function a(){var e=get_custom_bbox(i.querySelector(".mainfig")),t=get_custom_bbox(c.querySelector(".mainfig"))
return"hor"==u?t.right+v-e.left:t.bottom+v-e.top}var i,s,_,c
t=t.filter(function(t){return t!=e})
var l=[e].concat(t)
if(l.length<2)return!1
var u=find_dim_for_alignment(l),d=find_start_end_position([e]),p=_slicedToArray(d,4),f=p[0],m=(p[1],p[2]),g=(p[3],"hor"==u?0:1),h=0==g?1:2
l=sort_els(l,g)
var y=l.indexOf(e)
if(y==l.length-1)var v=o(l[0],l[1],h)
else var v=o(l[y],l[y+1],h)
for(var y=0;y<l.length;y++)i=l[y],me=iama(i),me&&(y>0&&(c=l[y-1]),"hor"==u?(s=y>0?a():0,_=m-posit2.get_top_left(i)[1]):(_=y>0?a():0,s=f-posit2.get_top_left(i)[0]),"hor"==r&&(s=0),"vert"==r&&(_=0),object_mapper[me].reposition_me(i,s,_,!0))
n||resize_protocol(parent,0,0)}function get_w_h(e){return e=find_g(e),e?[parseInt(e.getAttribute("width"))||1,parseInt(e.getAttribute("height"))||1]:[0,0]}function get_w_h_trans(e){return e=find_g(e),e?[parseInt(e.getAttribute("width")),parseInt(e.getAttribute("height")),posit2.get_trans(e)]:[0,0,{}]}function find_sticky_and_reposition(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4]
reposition_protocol(e,t,r,find_sticky_els(e),n,!1,!0,!1,o)}function check_if_i_am_a(e){return!!iama(e)||(text_to_feedback_pane(["no valid element selected"],!1,!0),!1)}function snap_to_grid(e){e=e||currentElement,manage_groups.get_group(e,!1).forEach(function(e){if(check_if_i_am_a(e)){var t=posit2.get_trans(e).translate
find_sticky_and_reposition(e,-t[0]%mdd,-t[1]%mdd,!0)}})}function size_to_grid(){manage_groups.get_group(currentElement,!1).forEach(function(e){if(check_if_i_am_a(e)){var t=parseInt(e.getAttribute("width")),r=parseInt(e.getAttribute("height"))
resize_protocol(e,t%mdd==0?0:mdd-t%mdd,r%mdd==0?0:mdd-r%mdd,!0)}})}function check_if_snap_to_grid_possible(e){try{var t=parseInt(e.getAttribute("width")),r=parseInt(e.getAttribute("height")),n=posit2.get_trans(e).translate
return[n[0]%mdd!=0||n[1]%mdd!=0,t%mdd!=0||r%mdd!=0]}catch(e){return[!1,!1]}}function reposition_protocol(e,t,r,n,o){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],_=arguments.length>8&&void 0!==arguments[8]&&arguments[8]
if(no_feedback=!0,cmm.status())return!1
var c=(e.getAttribute("i_am_a"),o?[e]:e.hasAttribute("table")?manage_groups.get_group(e,!0):manage_groups.get_group(e,!1))
c=c.filter(function(e){return"path_group"!=iama(e)&&"P"!=e.tagName}),no_table=!(1==c.length&&c[0].hasAttribute("table")&&!_),n&&n.length>0&&(c=new Set(c),n.forEach(function(e){return c.add(e)}),c=Array.from(c),c=c.filter(function(t){return!e.querySelector("#"+t.id)}))
var l=e.classList.contains("hg")
if(c.forEach(function(e,n){f=ido(e).reposition_me(e,t,r,!0),no_table&&recalc_connections(e.id,a,i)}),no_table||"cell_basic"!=iama(e)||cell_basic.recalc_connections_of_table(e),l){hierarchies.realign_children_of_realigned_group(c)
var u=e
if(u.getAttribute("id"),d3.select(u).classed("helper_hg")){var d=hierarchies.is_child_of(u),p=_slicedToArray(d,2),f=p[0],m=p[1],g=document.querySelector(f)
hierarchies.recalc_parent_child(g,m),hierarchies.realign_paths(g,m)}if(hierarchies.is_child(u)){var h=hierarchies.is_child_of(u),y=_slicedToArray(h,2),v=y[0],b=y[1]
hierarchies.realign_paths(svg.select(v).node(),b)}}no_table=!0,d3.select(e),paths_on_canvas_done={},c.forEach(function(e){if(e=d3.select(e),e.classed("i_have_a_group")&&!e.classed("hg"))if(s){var n=direct_child_only_selector(e.node(),"g"),o=posit2.get_trans(e.node()).scale
n.forEach(function(e){ido(e).reposition_me(e,-t/o,-r/o,!0)})}else{var a=find_merged_shapes(e.node())
a.forEach(function(n){recalc_connections(n.id,!0,i,e.node(),[t,r])})}}),no_feedback=!1,ido(e).set_info(e),plumbs&&gui.move_plumbs(e)}function find_merged_shapes(e){var t=direct_child_only_selector(e,"g"),r=[]
return t.forEach(function(e){e.classList.contains("i_have_a_group")&&!e.classList.contains("hg")&&(r=r.concat(find_merged_shapes(e)))}),t.concat(r)}function show_print_region_size(e){var t=toggle_zoom.get_zoom_factor(),r=parseInt(e.getAttribute("width")).toFixed(0)*t,n=parseInt(e.getAttribute("height")).toFixed(0)*t
text_to_feedback_pane("size: "+r+" by "+n+" pixels"),text_to_help_pane(help_text.print_region,!1,!1)}function get_x_y_from_event(e){return"touch"==e.type.slice(0,5)?"touchend"==e.type?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[e.touches[0].clientX,e.touches[0].clientY]:[e.clientX,e.clientY]}function check_if_el_under(e,t){if(t)var r=toggle_zoom.get_screen_pos(t)
else var n=get_x_y_from_event(e),o=_slicedToArray(n,2),a=o[0],i=o[1],r={top:i-4,bottom:i+4,left:a-4,right:a+4}
var s=[]
s.push(document.elementFromPoint(r.left-2,r.top-2)),s.push(document.elementFromPoint(r.right+2,r.bottom+2)),s.push(document.elementFromPoint(r.left-2,r.bottom+2)),s.push(document.elementFromPoint(r.right+2,r.top-2))
for(var _=0;_<s.length;_++)if(function(e){return!(!e||e.classList.contains("gui_dummy_path")||e.classList.contains("overlay")||e.classList.contains("catcher")&&"text"!==e.tagName||"circle"==e.tagName&&!e.classList.contains("close_circle")||e.parentElement==currentElement&&!drag_for_drawing||(me=iama(find_g(e)),e===t||"path_group"==me||"text_path"==me||"text_block"==me||e===currentElement))}(s[_]))return s[_]
return!1}function check_connectable(e){var t=iama(find_g(e))
return!["knot","poly_points","slide"].find(function(e){return e==t})}function find_sticky_els(e){if(arguments.length>1&&void 0!==arguments[1]&&!arguments[1])var t=[e]
else var t=manage_groups.get_group(e)
var r=[]
return t.forEach(function(e){e.classList.contains("sticky")&&(r=r.concat(object_mapper[iama(e)].find_elements_in_bbox(d3.select(e),!0,!0)))}),t.forEach(function(e){find_merged_shapes(e).forEach(function(e){e.classList.contains("sticky")&&(r=r.concat(find_sticky_els(e,!1)))})}),r=r.filter(function(e){return e.id}),r.forEach(function(e){return move_element_to_top(e)}),r}function conv_angle(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=-e/(180/Math.PI),a=t*Math.cos(o)-r*Math.sin(o),i=t*Math.sin(o)+r*Math.cos(o)
return n?[a-t,i-r]:[Math.round(1e5*a)/1e5,Math.round(1e5*i)/1e5]}function conv_angle_co(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3]
if(0==e)return[t,r]
var o=-e/(180/Math.PI),a=t*Math.cos(o)+r*Math.sin(o),i=-t*Math.sin(o)+r*Math.cos(o)
return n?[a-t,i-r]:[Math.round(1e5*a)/1e5,Math.round(1e5*i)/1e5]}function convert_dx_dy_for_zoom_and_rotate(e){var t=toggle_zoom.get_zoom_factor(),r=e.dx/t,n=e.dy/t
return conv_angle(posit2.get_trans(currentElement).rotate[0],r,n)}function check_if_pen_on_shape(e){set_attr_of_rule(makemap_css,".no_pointing_temp","pointer-events","inherit")
var t=check_if_el_under(e)
return set_attr_of_rule(makemap_css,".no_pointing_temp","pointer-events","none"),!(!t||!find_g(t).querySelector("foreignObject")&&!t.classList.contains("close_circle"))&&t}function handle_drag_select(e){var t=d3.select(".drag_select"),r=["width","height"].map(function(e){return parseFloat(t.attr(e))}),n=_slicedToArray(r,2),o=n[0],a=n[1],i=_slicedToArray(posit2.get_transform_of_shape(t.node(),e).translate,2),s=i[0],_=i[1]
if(drag_select_for_slider){var c=slide.make(svg,[s,_],{width:o,height:a})
currentElement=c.node(),set_slides_buttons(!1,!0,!1,!1,!0)}else if(drag_select_for_print_region)printer.show_print_region([s,_],[o,a],!0)
else if(drag_select_for_merge){var l=parse_to_bbox(s,_,o,a),u=find_elements_in_bbox_test(l,!0)
u=u.filter(function(e){return e!=el_to_merge_to})
var d=ido(el_to_merge_to).stick_to_me(d3.select(el_to_merge_to),u)
0==d?text_to_feedback_pane("no elements found within this element",!1,!0):text_to_feedback_pane(d+" elements grouped",!1,!0)}else{var l=parse_to_bbox(s,_,o,a),p=find_elements_in_bbox_test(l,!0,!0,!0,d3.select(e))
manage_groups.toggle_elements(p)}t.remove()}function resize_protocol(e,t,r,n,o){var a=(e.getAttribute("i_am_a"),n?[e]:manage_groups.get_group(e,!0))
if(a=a.filter(function(e){return"path_group"!=iama(e)&&"P"!=e.tagName}),no_table=!1,no_feedback=!0,a[0].hasAttribute("table")&&!o){var i=get_rows_cols_of_grouped_cells(currentElement),s=_slicedToArray(i,2),_=s[0],c=s[1]
Object.keys(_).forEach(function(e){return _[e]=_[e].map(function(e){return e[2]})}),Object.keys(c).forEach(function(e){return c[e]=c[e].map(function(e){return e[2]})}),Object.keys(_).forEach(function(e){var t=_[e]
ido(t[0]).resize_me(d3.select(t[0]),0,r,!1)}),Object.keys(c).forEach(function(e){var r=c[e]
ido(r[0]).resize_me(d3.select(r[0]),t,0,!1)}),no_table=!0}else no_table=!0,a.forEach(function(e){ido(e).resize_me(d3.select(e),t,r),recalc_connections(e.getAttribute("id"))})
no_feedback=!1,ido(el).set_info(e),plumbs&&gui.move_plumbs(e)}function rotate_protocol(e,t,r){var n=e.getAttribute("i_am_a")
object_mapper[n].rotate_me(d3.select(e),t,r),recalc_connections(e.getAttribute("id")),recalc_paths_between_shapes_on_merged_parent(e),posit2.delete_item(e.id),gui.move_plumbs(e)}function rotate_point(e,t,r){return[Math.cos(e)*t+Math.sin(e)*r,-Math.sin(e)*t+Math.cos(e)*r]}function find_connections(e,t){return ids=t?t.selectAll(".connection")[0]:svg.selectAll(".connection")[0],ids.map(function(e){return e.getAttribute("id")}).filter(function(t){var r=extract_elements_from_path_id(t),n=_slicedToArray(r,2),o=n[0],a=n[1]
return o==e|a==e})}function order_ids_for_path(e,t){return[e.attr("id")<t.attr("id")?e.attr("id"):t.attr("id"),e.attr("id")>t.attr("id")?e.attr("id"):t.attr("id")]}function set_path_id_and_class(e,t){var r=order_ids_for_path(e,t),n=_slicedToArray(r,2),o=n[0],a=n[1]
cpa.class="from"+o+"_to"+a
var i=svg.selectAll("."+cpa.class).empty()?0:svg.selectAll("."+cpa.class)[0].length
cpa.id=cpa.class+"_"+i,cpa.e1=document.querySelector("#"+o),cpa.e2=document.querySelector("#"+a)}function get_propagation_chain(e){for(var t=[e],r=0;null!=(x=t[r++].parentNode);)t.push(x)
return t}function make_poly_line(e){var t=_slicedToArray(e,2),r=t[0],n=t[1],o=posit2.get_trans(r,!0,!1).translate,a=posit2.get_trans(n,!0,!1).translate
svg.append("path").attr("d","M"+o+" L "+a).attr("class","temp_poly_line")}function copy_prepped_shape_to_canvas(e,t,r){var r=to_discrete_position([r[0],r[1]]),n=copy_element(e,!document.querySelector(".form_copy_with_text").checked,r)
return"zoomfield"!=t.attr("id")&&group_elements(t,n),n&&(set_currentElement(n.node()),roughing.copy(e,currentElement),display_fs_for_shape(currentElement),gui.frame_element(currentElement)),d3.selectAll(".copy_on").classed("copy_on",!1),n}function corrected_mouse_position(e){var t=d3.transform(d3.select("#zoomfield").attr("transform"))
return[(e[0]-t.translate[0])/t.scale[0],(e[1]-t.translate[1])/t.scale[0]]}function corrected_mouse_position2(e){var t=d3.transform(d3.select("#zoomfield").attr("transform"))
return[e[0]*t.scale[0]+t.translate[0],e[1]*t.scale[1]+t.translate[1]]}function more_than_n_key_pressed(e){for(var t=0,r=0;r<key_pressed.length;r++)if(key_pressed[r]&&(t+=1),t>e)return!0
return!1}function F_key(){for(var e=112;e<124;e++)if(key_pressed[e])return!0
return!1}function check_and_remove_empty_par_tags(e){if(!e.parentElement){var t=clone_range(saveSelection())
set_currentElement(document.activeElement),medium_func(currentElement),gui.remove_all(),restoreSelection(clone_to_range(t))}}function tab_succes_flash(e){return!1}function save_and_download_key_press(){return _.all([16,17,27].map(function(e){return key_pressed[e]}))}function handle_keyboard(e){function t(e){for(var t=e.parentElement.querySelectorAll("p"),r=0;r<t.length&&t[r]!=e;r++);return r!=t.length&&r}function r(){return key_pressed[38]?0:key_pressed[40]?2:key_pressed[37]?3:key_pressed[39]?1:void 0}function n(){var t=find_g(currentElement),n=posit2.get_top_left(t,!0),o=posit2.get_w_h(t),a=_slicedToArray(o,2),i=a[0],s=a[1],c=_slicedToArray(n,2),l=c[0],u=c[1],d=_.any(key_pressed.slice(37,41))?r():2
0==d&&(last_pos=[l+.5*MIN_WIDTH,u-25]),1==d&&(last_pos=[l+i+25,u+.5*MIN_HEIGHT]),2==d&&(last_pos=[l+.5*MIN_WIDTH,u+s+25]),3==d&&(last_pos=[l-25,u+.5*MIN_HEIGHT]),active_canvas=currentElement,currentElement=d3.select("#mainsvg").node(),gui.remove_all(),text_to_feedback_pane("Ready for text!"),tab_succes_flash(last_pos),e.preventDefault()}if(key_pressed[e.keyCode]="keydown"==e.type,9==e.keyCode&&"flash_card_val_to_check"==e.target.id)return!0
if(27==e.keyCode&&"keydown"==e.type)return cmm.status()?(cmm.off(),!1):("none"!=document.querySelector("#search_form").style.display&&hide_search_form(),drag_for_drawing?drag_draw_off():svg.classed("copy_on")?text_to_feedback_pane("aborting copy",!1,!0):svg.classed("drag_select_on")?text_to_feedback_pane("aborting drag select",!1,!0):MORPH?text_to_feedback_pane("aborting morphing",!1,!0):waiting_for_par_bind?text_to_feedback_pane("aborting binding path to paragraph",!1,!0):copied_styles?text_to_feedback_pane("aborting style copy",!1,!0):study_one_by_one?(text_to_feedback_pane(["exiting one-by-one"," Study mode still on"],!1,!0),turn_study_one_by_one_off()):study_mode?(text_to_feedback_pane(["study mode off"],!1,!0),turn_study_mode_off()):"temp"==manage_groups.get_group_info()&&manage_groups.reset(),svg.classed("copy_on",!1),svg.classed("drag_select_on",!1),MORPH=!1,waiting_for_par_bind=!1,copied_styles=!1,set_attr_of_rule(find_sheet("map"),".mainfig:hover","cursor","all-scroll"),set_attr_of_rule(find_sheet("map"),"p:hover","cursor","text"),set_attr_of_rule(find_sheet("map"),".connection:hover","cursor","inherit"),key_pressed=[],!1)
var o=currentElement?currentElement.tagName:""
if(dragging_knot&&16==e.keyCode&&"keydown"==e.type&&first_shift_down)return add_point_to_end_of_path(dragging_knot),first_shift_down=!1,!1
if(dragging_knot&&16==e.keyCode&&"keyup"==e.type)return first_shift_down=!0,!1
if(13==e.keyCode&&"keydown"==e.type){if("form_text_field_break"==document.activeElement.id)return handle_text_break_button_click(),!1
if("cm-button-mathjax"==document.activeElement.id)return handle_math_jax_button_click(),!1
if("P"==currentElement.tagName||"CODE"==currentElement.tagName){var a=find_g(currentElement)
if(a.querySelector("foreignObject")){var i=currentElement.parentElement.querySelectorAll("p"),s=t(currentElement),c=object_mapper[a.getAttribute("i_am_a")].add_paragraph(a,"",!1,!0).node()
s+1<i.length&&(c.remove(),ido(a).add_paragraph_in_order(a,c,s+1),medium_func(c)),set_currentElement(c),display_fs_for_shape(c)}return e.preventDefault(),!1}}if(slide_manager.slide_show_on()){if(key_pressed[37]||key_pressed[38])return slide_manager.prev_slide(),!1
if(key_pressed[39]||key_pressed[40])return slide_manager.next_slide(),!1}if(key_pressed[17]&&key_pressed[220]&&(currentElement||"mainsvg"!=currentElement.id)&&(manage_groups.toggle_element(currentElement),update_quick_grouping_forms()),key_pressed[17]&&key_pressed[190]&&"P"==currentElement.tagName)return currentElement.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp"+currentElement.innerText,!1
if(key_pressed[17]&&key_pressed[192]){var l=currentElement.getBoundingClientRect(),u=new MouseEvent("contextmenu",{view:window,bubbles:!0,cancelable:!0,target:currentElement,clientX:l.left+l.width/2,clientY:l.top+l.height/2})
currentElement.dispatchEvent(u)}if("keyup"==e.type&&(46==e.keyCode||8==e.keyCode))return is_par_tag(currentElement)&&check_and_remove_empty_par_tags(currentElement),!1
if(poly_draw&&"keyup"==e.type&&(17==e.keyCode||16==e.keyCode)){if(17==e.keyCode)points_for_poly.length>2&&poly_points_fo.make(svg,points_for_poly)
else if(16==e.keyCode&&points_for_poly.length>1){var d=_slicedToArray(points_for_poly[0],2),p=d[0],f=d[1],m=path_basic.make(svg,[p,f])
points_for_poly=points_for_poly.map(function(e){return[e[0]-p,e[1]-f]})
var g=points_for_poly.slice(1).reduce(function(e,t){return e+"L "+t},"M0,0")
if(2==points_for_poly.length){var h=m.select("path").attr("d",g)
m.attr("flow","lineto")}else var h=m.select("path").attr("d",drawn_line_to_bezier(g))
path_basic.remake_path(h.node(),!1)}points_for_poly=[],poly_draw=!1,svg.selectAll('g[i_am_a="poly_point"] circle').transition().attr("r",1).style("fill","red").duration(1e3),svg.selectAll(".temp_poly_line").transition().style("stroke-width",0).style("fill","palegoldenrod").duration(1e3),setTimeout(function(){return svg.selectAll('g[i_am_a="poly_point"]').remove()},1100),setTimeout(function(){return svg.selectAll(".temp_poly_line").remove()},1100)}if("keydown"==e.type){if(key_pressed[17]&&key_pressed[70]||key_pressed[114])return show_search_form(),e.preventDefault(),!1
if(key_pressed[17]&&("66"==e.keyCode||"73"==e.keyCode|"85"==e.keyCode))return"66"==e.keyCode&&add_styling_to_par("b"),"73"==e.keyCode&&add_styling_to_par("i"),"85"==e.keyCode&&add_styling_to_par("u"),e.preventDefault(),e.stopPropagation(),!1
if(17==e.keyCode&&(last_selection_for_split=rangy.getSelection()),113==e.keyCode&&!more_than_n_key_pressed(1))return show_wait_spinner("","Saving"),setTimeout(function(){local_store.quick_save(),key_pressed=[],hide_wait_spinner()}.bind(this),50),!1
if(117==e.keyCode&&!more_than_n_key_pressed(1))return toggle_advanced_options(),key_pressed=[],e.preventDefault(),!1
if(118==e.keyCode&&!more_than_n_key_pressed(1))return toggle_size_fine(),key_pressed=[],!1
if(119==e.keyCode&&!more_than_n_key_pressed(1))return toggle_move_fine(),key_pressed=[],!1
if(120==e.keyCode&&!more_than_n_key_pressed(1))return toggle_slide_edit_menu(),key_pressed=[],!1
if(121==e.keyCode&&!more_than_n_key_pressed(1))return toggle_side_bar(),e.preventDefault(),key_pressed=[],!1
if(key_pressed[17]&&key_pressed[81])return undoer.undo(),!1
if(key_pressed[17]&&key_pressed[70])return key_pressed=[],!1
if(key_pressed[16]&&key_pressed[17]&&!more_than_n_key_pressed(2)&&!currentElement.hasAttribute("table"))return 16==e.keyCode?"free"==service&&drag_select_for_slider?text_to_feedback_pane("making slides not available in free version. Checkout the single subscription"):drag_select_on():"free"!=service?drag_draw_on():text_to_feedback_pane("drawing not available in free version. Checkout the single subscription"),!1
if(key_pressed[9]&&!more_than_n_key_pressed(1)&&"svg"!=o)return n(),!1
if(key_pressed[9]&&_.any(key_pressed.slice(37,41))&&"svg"!=o)return n(),!1
if(9==e.keyCode&&key_pressed[16]){if("P"==currentElement.tagName)set_currentElement(find_g(currentElement))
else{if("svg"==currentElement.tagName||!currentElement.querySelector("P"))return!1
set_currentElement(currentElement.querySelector("P")),medium_func(currentElement)}return display_fs_for_shape(currentElement),gui.remove_all(),gui.move_plumbs(currentElement),e.preventDefault(),!1}if(32==e.keyCode&&key_pressed[16]){if(currentElement.classList.contains("i_am_grouped"))var y=currentElement.parentElement
else if(currentElement.classList.contains("i_have_a_group")){var v=Array.from(currentElement.querySelectorAll("g[i_am_a]"))
v.forEach(function(e){posit2.get_trans(e)})
var y=currentElement.querySelector("g[i_am_a]")}return set_currentElement(y),display_fs_for_shape(currentElement),gui.remove_all(),gui.move_plumbs(currentElement),e.preventDefault(),key_pressed=[],!1}if(key_pressed[17]&&key_pressed[83])return e.preventDefault(),make_ready_for_style_copy(!1),key_pressed=[],!1
if(currentElement&&("svg"==currentElement.tagName||currentElement.classList.contains("canvas_layer"))){if(currentElement.classList.contains("canvas_layer")){if((key_pressed[46]||key_pressed[8])&&currentElement.classList.contains("canvas_layer"))return delete_shape(currentElement),e.stopPropagation(),e.preventDefault(),!1
if(e.ctrlKey&&key_pressed[71])return size_canvas_around_children(currentElement),e.preventDefault(),!1
var b=iama(currentElement)
if(b&&"path_group"!=b&&_.any(key_pressed.slice(37,41))&!e.shiftKey&&(gui.remove_all(),fine_position_element(e.keyCode,e.getModifierState("CapsLock"))),key_pressed[16]&&!key_pressed[17]&&_.any(key_pressed.slice(37,41))&&"P"!=currentElement.tagName){g=r()
var x=find_closest_neighbour(currentElement,g)
return x&&(set_currentElement(document.getElementById(x)),display_fs_for_shape(currentElement),gui.frame_element(currentElement)),!1}if(key_pressed[17]&&key_pressed[67])return make_ready_for_copy(!1),e.preventDefault(),!1}if(F_key())return!1
if(!no_modal)return!1
if((key_pressed[16]||key_pressed[17])&&!more_than_n_key_pressed(1))return!1
if(key_pressed[17]&&key_pressed[86])return!1
if((e.keyCode>47&&e.keyCode<91||220==e.keyCode)&&last_pos){var k=selected_figure.my_name,w=0
"text_basic"==k?w=15:"math_basic"==k&&(w=-25),"icon_basic"!=k&&"rect_canvas"!=k&&"graph_basic"!=k&&"axes_board"!=k||(k="rect_basic")
var E=object_mapper[k].make(svg,to_discrete_position([last_pos[0]+w,last_pos[1]+0]),{width:MIN_WIDTH,height:MIN_HEIGHT})
add_extra_styles_to_new_el(E.node()),roughen_all&&roughing.roughen(E.node()),active_canvas&&active_canvas.classList.contains("canvas_layer")&&group_elements(d3.select(active_canvas),E),active_canvas&&find_g(active_canvas).parentElement&&find_g(active_canvas).parentElement.classList.contains("canvas_layer")&&group_elements(d3.select(find_g(active_canvas).parentElement),E),set_currentElement(E.node()),E.select("foreignObject").empty()?("none"==document.querySelector("#fs_font .fs_toggle").style.display&&toggle_field_set(document.querySelector("#fs_font")),"text_basic"==k?(document.querySelector(".text_input").value=e.key,show_text_input_area(currentElement,!0)):"math_basic"==k&&(document.querySelector(".math_input").value=e.key,show_text_input_area(currentElement,!0))):set_currentElement(object_mapper[k].add_paragraph(E.node()).node()),display_fs_for_shape(currentElement)}}else{if(key_pressed[16]&&key_pressed[46]||key_pressed[46]&&quick_del||key_pressed[8]&&quick_del){var b=currentElement.getAttribute("i_am_a")
return"slide"==b?(slide_manager.delete_slide(currentElement),text_to_feedback_pane("slide removed"),!1):!key_pressed[16]&&(is_par_tag(currentElement)||b&&"text"==b.slice(0,4))?(text_to_feedback_pane(["press shift delete or shift backspace to remove this item","(to avoid accidental deletes when typing)"],!1,!0),!1):!currentElement.classList.contains("example_fig")&&(delete_shape(currentElement),e.stopPropagation(),e.preventDefault(),!1)}var b=iama(currentElement)
if("P"==o&&(38==e.keyCode||40==e.keyCode)){var A=38==e.keyCode,i=currentElement.parentElement.querySelectorAll("p"),S=t(currentElement)
A?S>0&&(set_currentElement(i[S-1]),medium_func(i[S-1]),gui.frame_element(currentElement)):S<i.length-1&&(set_currentElement(i[S+1]),medium_func(i[S+1]),gui.frame_element(currentElement))}if(key_pressed[17]&&key_pressed[67]&&_.any(key_pressed.slice(37,41))){var q=get_pos_from_direction(currentElement,e.keyCode),T=d3.select(currentElement),L=copy_prepped_shape_to_canvas(currentElement,d3.select(find_g(currentElement.parentElement)),q)
L&&[T,L].forEach(function(e){make_new_connection(e)}),text_to_feedback_pane("copying")}else if(key_pressed[17]&&key_pressed[88]&&_.any(key_pressed.slice(37,41))){if(-1==polygon_shapes.indexOf(b)&&!figs[b].copyable)return text_to_feedback_pane("cannot copy this type of element"),!1
var q=get_pos_from_direction(currentElement,e.keyCode)
copy_prepped_shape_to_canvas(currentElement,d3.select(find_g(currentElement.parentElement)),q)}else{if(key_pressed[17]&&!key_pressed[16]&&_.any(key_pressed.slice(37,41)))return gui.remove_all(),fine_resize_element(e.keyCode,e.getModifierState("CapsLock")),!1
if(key_pressed[16]&&!key_pressed[17]&&_.any(key_pressed.slice(37,41))&&"P"!=currentElement.tagName){g=r()
var z=find_closest_neighbour(currentElement,g)
return z&&(set_currentElement(document.getElementById(z)),display_fs_for_shape(currentElement),gui.frame_element(currentElement)),!1}if(key_pressed[17]&&key_pressed[67])make_ready_for_copy(!1)
else if(key_pressed[17]&&key_pressed[83]);else if(e.keyCode>47&&e.keyCode<91&&!e.ctrlKey)if(d3.select(currentElement).select("foreignObject").empty())"path_group"==b?show_path_text_input_new(!1,e.key):"text_block"!=b&&"text_path"!=b||cmm.status()?"text_basic"==b&&show_text_input_area(currentElement,!1,e.key):show_text_input_area(currentElement,!1,e.key)
else{var j=ido(currentElement).add_paragraph(currentElement,e.key,!1,!0)
set_currentElement(j.node()),display_fs_for_shape(currentElement)}else if(b&&"path_group"!=b&&_.any(key_pressed.slice(37,41)))gui.remove_all(),fine_position_element(e.keyCode,e.getModifierState("CapsLock"))
else if(e.ctrlKey&&key_pressed[71]){var M=find_g(currentElement)
M.querySelector("article")&&(ido(M).size_around_paragraphs(M,!1,e.altKey),e.preventDefault())}}}}return!find_svg(e.target)||key_pressed[17]&&key_pressed[86]||!currentElement||is_par_tag(currentElement)?void 0:(e.preventDefault(),!1)}function find_tag(e){return function(t){for(;t.tagName!=e||t.tagName==e&&t.classList.contains("gui")||t.classList.contains("relay");){if("BODY"==t.tagName)return!1
t=t.parentElement}return t}}function get_deltaxy_from_key_press(e){var t=0,r=0
return 38==e&&(r=-1),40==e&&(r=1),37==e&&(t=-1),39==e&&(t=1),[t,r]}function copy_element(e,t,r,n,o){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5]
if(gui.remove_all(),o=o||svg,e=find_g(e),e.querySelector(".cp")&&d3.select(e).selectAll(".cp").remove(),e.classList.contains("hg")&&a)return text_to_feedback_pane("cannot copy hierarchical shape...",!1,!0),!1
var i=parse_g(e)
i.attrs.table&&(delete i.attrs.table,delete i.attrs.vt,i.attrs.i_am_a="rect_basic")
var s=n?"dummy":Fig.prototype.next_id(),_=$.extend({},posit2.get_trans(e))
_.translate=r,i.attrs.transform=transform_to_string(_),i.attrs.id=s
var c=start_adding(o,i)
return n||posit2.set_trans(s,_),e.classList.contains("i_am_grouped")&&c.classed("i_am_grouped",!1),n||c.selectAll("g").each(function(e){this.setAttribute("id",Fig.prototype.next_id())}),t&&c.selectAll("P").remove(),d3.event&&d3.event.stopPropagation(),c}function toggle_draggability_of_element(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=d3.select(e).select(".mainfig").node()
return!!n&&((void 0===t?n.hasAttribute("undrag"):t)?(r&&n.hasAttribute("temp_drag_switch")?n.removeAttribute("temp_drag_switch"):(n.removeAttribute("undrag"),e.querySelector(".catcher")&&e.querySelector(".catcher").classList.remove("perm_off_catcher")),!0):(r&&n.hasAttribute("undrag")?n.setAttribute("temp_drag_switch",1):(n.setAttribute("undrag","1"),e.querySelector(".catcher")&&e.querySelector(".catcher").classList.add("perm_off_catcher")),!1))}function fine_position_element(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=get_deltaxy_from_key_press(e)
find_sticky_and_reposition(find_g(currentElement),r[0]*move_delta,r[1]*move_delta,t,t)}function fine_resize_element(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=get_deltaxy_from_key_press(e)
resize_protocol(find_g(currentElement),n[0]*size_delta,n[1]*size_delta,t,r),roughing.roughen_if_needed(currentElement)}function toggle_catcher_glow(e,t){var r=iama(e)
if(!r||"graph_basic"==r)return!1
var n=e.querySelector(".catcher")
n&&n.classList.toggle("shine",t)}function click_to_grid(){var e=currentElement
if("g"!=e.tagName)return console.log("geen group"),!1
var t=posit2.get_top_left(e),r=Math.round(t[0]/X_GRID)*X_GRID,n=Math.round(t[1]/Y_GRID)*Y_GRID
e.setAttribute("transform","translate("+[r,n]+")")}function make_gridpoints(e,t){svg.selectAll(".gridpoint").remove(),X_GRID=e,Y_GRID=t
for(var r=parseFloat(svg.node().getBoundingClientRect().width),n=parseFloat(svg.node().getBoundingClientRect().height),o=0;o<r;o+=e)for(var a=0;a<n;a+=t)svg.append("circle").attr("class","gridpoint").attr("r",1).attr("cx",o).attr("cy",a)}function make_gridlines(e,t){var r=svg.select("#grid")
r.empty()&&(r=svg.append("g").attr("id","grid")),add_grid_to_g(r,e,t,parseInt(svg.select(".overlay").attr("width")),parseInt(svg.select(".overlay").attr("height")))}function add_grid_to_g(e,t,r,n,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0
if(t>0)for(var s=0;s<n;s+=t)e.append("line").attr({x1:s+a,y1:0,x2:s+a,y2:o}).attr("class","gridlines")
if(r>0)for(var s=0;s<o;s+=r)e.append("line").attr({x1:0,y1:s+i,x2:n,y2:s+i}).attr("class","gridlines")}function remove_plumb_lines(){svg.select(".plumb-group").remove()}function show_text_input_area(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=find_g(e),o=iama(n),a="math_basic"==o?"#cm-math-field":"#cm-text-field",i=toggle_zoom.get_screen_pos(n)
cmm.position_and_display(i.left,i.bottom+5,a),t||("text_basic"==o?document.querySelector("#cm-text-field textarea").value=text_basic.get_text(n)+r:"math_basic"==o?document.querySelector("#cm-math-field textarea").value=n.getAttribute("raw_mj")+r:document.querySelector("#cm-text-field textarea").value=n.querySelector("text").textContent+r),"math_basic"==o?document.querySelector(".math_input").focus():document.querySelector(".text_input").focus()}function set_currentElement(e){is_par_tag(e)?currentElement=e:"svg"==e.tagName||"zoomfield"==e.id?(gui.remove_all(),currentElement=e):currentElement=find_g(e)}function change_selected_class(e){var t=document.querySelector(".selected")
t&&t.classList.remove("selected"),e.classList.add("selected")}function pick_me_example(e){change_halo(e),currentElement=e,set_color_picker(e)}function make_form_prelim(){document.querySelector("#form_path_lineto").style.display="none",document.querySelector("#form_border_inner_outer").style.display="none"}function set_fs(e){var t=e.getAttribute("i_am_a"),t=d3.select(e).classed("polygon_basic")&&"slide"!=t?"polygon":t
make_form_prelim(),minimal_menu&&all_form_elements.filter(function(e){return-1==non_minimal_fieldsets.indexOf(e)}),minimal_menu&&non_minimal_fieldsets.forEach(function(e){return d3.select("#"+e).style("display","none")}),e.querySelector("article")&&(e.querySelector("article").classList.contains("has_background")&&set_background_button(e.querySelector("article")),document.querySelector("#form_article_padding input").value=parseInt(e.querySelector("article").style.padding||0))}function fill_forms(e){is_par_tag(e)?(fill_fs_border(e),fill_fs_para(e),fill_fs_font(e)):"path_group"==me?(fill_fs_border(e),fill_fs_path(e),fill_fs_path_advanced(e),fill_fs_path_label(e)):e.hasAttribute("arrow_width")?fill_fs_path_label(e):"zoomfield"==e.id||"mainsvg"==e.id||("text_block"==me||"text_path"==me?fill_fs_border(e):me?(fill_fs_border(e),fill_fs_font(e),fill_fs_fig_stuff(e),"path_basic"==me&&fill_fs_drawing(e),"graph_basic"==me&&fill_fs_graphing(e),"axes_board"==me&&fill_fs_graphing(e),"line_for_graph"==me&&(fill_fs_line_for_graph(e),fill_fs_graphing(e))):console.log("fillform onbekend type",e)),help_on&&display_help(e),form_filled=!0}function display_help(e){var t=iama(e),r=e.tagName
"P"==r?text_to_help_pane(help_text.P):"svg"==r?text_to_help_pane(help_text.svg):t in help_text?text_to_help_pane(help_text[t]):-1!=polygon_shapes.indexOf(t)&&text_to_help_pane(help_text.polygon)}function set_invalid_form_inputs_to_zero(){return[[document.querySelector("#form_border_width input"),1],[document.querySelector("#form_border_radius input"),1],[document.querySelector("#form_paragraph_margin input"),0],[document.querySelector("#form_paragraph_padding input"),0],[document.querySelector("#form_font_size input"),0],[document.querySelector("#form_border_dash input"),0]].forEach(function(e){var t=_slicedToArray(e,2),r=t[0],n=t[1]
if("Nan"==r.value||""==r.value)r.value=0
else{var o=/[+-]?\d+(\.\d+)?/g,a=r.value,i=a.match(o)
i=i&&1==i.length?parseFloat(i[0]).toFixed(n):i?i.join(" "):"",r.value=i}}),Array.from(document.querySelectorAll(".form_scaling input, #cm_scaling input")).forEach(function(e){(isNaN(e.value)||0==e.value)&&(e.value=1)}),!1}function display_fs_for_shape(e){var t=minimal_menu?all_form_elements.filter(function(e){return-1==non_minimal_fieldsets.indexOf(e)}):all_form_elements
minimal_menu&&non_minimal_fieldsets.forEach(function(e){return d3.select("#"+e).style("display","none")}),me=iama(e)
var r
is_par_tag(e)?r=paragraph_form_elements:"path_group"==me?r=path_form_elements:e.hasAttribute("arrow_width")?r=path_add_on_form_elements:"zoomfield"==e.id||"mainsvg"==e.id?r=svg_form_elements:me?(r=me in poly_config?figs.polygon.my_form_elements:figs[me].my_form_elements,e.querySelector("article")&&e.querySelector("article").classList.contains("has_background")&&r.push("fs_image")):r=[],hide_or_display_form_fields(t,r),form_filled=!1,update_open_fs(e)}function hide_or_display_form_fields(e,t){e.forEach(function(e){-1!=t.indexOf(e)?el=d3.select("#"+e).style("display","flex"):d3.select("#"+e).style("display","none")})}function update_open_fs(e){var t=document.querySelectorAll("#edit_mode_menu fieldset:not(.collapsed):not(#fs_feedback):not(#fs_help)")
if(!form_hidden&&help_on&&display_help(e),1==t.length){if("none"==t[0].style.display)return!1
var r=t[0].id
"fs_border"==r?fill_fs_border(e):"fs_font"==r?fill_fs_font(e):"fs_fig_stuff"==r?fill_fs_fig_stuff(e):"fs_image"==r||("fs_para"==r?fill_fs_para(e):"fs_path"==r?fill_fs_path(e):"fs_path_label"==r?fill_fs_path_label(e):"fs_path_advanced"==r||("fs_graphing"==r||"fs_board"==r?(fill_fs_graphing(e),"line_for_graph"==iama(e)&&fill_fs_line_for_graph(e)):"fs_drawing"==r?fill_fs_drawing(e):"fs_board"==r||"fs_grouping_quick"==r&&update_quick_grouping_forms()))}}function fill_fs_line_for_graph(e){$(".cm_graph_formula_text").prop("value",find_g(e).getAttribute("my_func")),$(".form_graph_when_line").css("display","block")}function fill_fs_graphing(e){var t=if_line_to_graph(e)
$(".form_graph_crossed_axis").prop("checked",t.hasAttribute("graph_axis_crossed")),$(".form_graph_grid").prop("checked",t.hasAttribute("gridded"))
var r=t.getAttribute("domain_x").split(",").map(function(e){return parseFloat(e)}),n=_slicedToArray(r,2),o=n[0],a=n[1]
if($(".cm_graph_min_domain").val(o),$(".cm_graph_max_domain").val(a),$(".cm_graph_formula_text").val(""),$(".form_graph_num_ticks_x").val(t.querySelector(".x_axis").getAttribute("num_ticks")),$(".form_graph_num_ticks_y").val(t.querySelector(".y_axis").getAttribute("num_ticks")),t.hasAttribute("asymptotic")||t.hasAttribute("fixed_range")){var i=t.getAttribute("domain_y").split(",").map(function(e){return parseFloat(e)}),s=_slicedToArray(i,2),_=s[0],c=s[1]
$(".cm_graph_min_range").val(c),$(".cm_graph_max_range").val(_),document.querySelector("#form_if_asymptotic").style.display="flex"}else document.querySelector("#form_if_asymptotic").style.display="none"
if($(".form_show_axis_num").prop("checked",!t.classList.contains("no_nums")),"axes_board"==iama(t)){var l=t.classList.contains("no_nums")?"none":"block"
document.querySelector("#form_domain_and_ranges").style.display=l}}function fill_fs_path_advanced(e){"lineto"==e.getAttribute("flow")?(setup_smoothing_for_lineto(),document.querySelector("#form_undo_smoothing").style.display="none",document.querySelector("#form_path_custom_flow").style.display="none",document.querySelector("#form_path_lineto").style.display="block"):document.querySelector("#form_path_custom_flow").style.display="block"}function fill_fs_path_label(e){var t=e.querySelector(".arrow_0, .arrow_1")
if(!t)return $(".if-arrow").css("display","none"),!1
e=t,document.querySelector("#form_add_on_height").value=parseInt(e.getAttribute("arrow_height")),document.querySelector("#form_add_on_width").value=parseInt(e.getAttribute("arrow_width")),$(".if-arrow").css("display","block")}function fill_fs_path(e){toggle_path_reset_button(e),toggle_path_from_and_to(parseInt(e.getAttribute("from_side")),parseInt(e.getAttribute("to_side")))
var t=e.getAttribute("type")
$(".form_path_style2 select").val(t)}function fill_fs_para(e){d3.selectAll(".par_only").style("display","P"==e.tagName?"flex":"none"),d3.selectAll(".not_par_only").style("display","P"==e.tagName?"none":"flex"),d3.selectAll("#form_side_for_padding_and_margin button").classed("onoff-on",!1),document.querySelector(".form_dir_all").classList.add("onoff-on"),margin_for="all"
var t=window.getComputedStyle(e),r=e.style.lineHeight||t.lineHeight
document.querySelector("#form_paragraph_line_height input").value="normal"==r?1.4:parseFloat(r),document.querySelector("#form_paragraph_margin input").value=(e.style.margin||t.margin).split(" ")[0],document.querySelector("#form_paragraph_padding input").value=(e.style.padding||t.padding).split(" ")[0],d3.selectAll(".form_paragraph_prefix button").classed("onoff-on",!1)
var n=search_paragraph_bullet_point(e)
n&&d3.selectAll('.form_paragraph_prefix button[value="'+n+'"]').classed("onoff-on",!0),e.style.lineHeight&&(document.querySelector("#form_paragraph_line_height input").value=parseFloat(e.style.lineHeight))}function fill_fs_fig_stuff(e){var t=posit2.get_trans(e).scale||1
if(e.querySelector("article")&&(e.querySelector("article").classList.contains("has_background")&&set_background_button(e.querySelector("article")),document.querySelector("#form_article_padding input").value=parseInt(e.querySelector("article").style.padding||0)),e.classList.contains("i_am_grouped")?document.querySelector("#form_ungroup").parentElement.style.display="flex":document.querySelector("#form_ungroup").parentElement.style.display="none",e.classList.contains("flippable")?$(".form_make_flippable").css("display","none"):$(".form_make_flippable").css("display","block"),e.hasAttribute("transform")){var r=posit2.get_trans(e)
document.querySelector("#scale_reset_button").style.display=1==r.scale?"none":"flex"
var t=r.scale||1
document.querySelector("#fs_fig_stuff .form_scaling input").value=t,document.querySelector("#fs_rect_canvas .form_scaling input").value=t,document.querySelector("#cm_scaling input").value=t}e.querySelector(".mainfig")&&e.querySelector(".mainfig").hasAttribute("undrag"),$(".form_fig_has_path").css("display",0==find_connections(e.id).length?"none":"flex")}function fill_fs_font(e){var t=0
t="text_block"==iama(e)||"text_path"==iama(e)?e.querySelector("text"):e.style["font-size"]||find_attr_of_style_sheet("."+find_current_font_class(e),"font-size"),document.querySelector("#form_font_size input").value=t,toggle_font_class(e),toggle_font_alignment(e)}function fill_fs_border(e){var t=iama(e),r=e.tagName,n=(e.id,0)
if(n=is_par_tag(e)?e.style.borderWidth:"path_basic"==t||"path_group"==t?e.firstChild.style.strokeWidth:window.getComputedStyle(e).strokeWidth,document.getElementById("form_border_width").querySelector("input").value=n,document.getElementById("cm_border_width").querySelector("input").value=n,document.querySelector("#form_border_dash input").value=e.style["stroke-dasharray"],"rect_basic"==t||"P"==r){var o="P"!=r?e.querySelector(".mainfig").getAttribute("rx"):e.style.borderRadius
document.getElementById("form_border_radius").querySelector("input").value=o,e.classList.contains("rough")&&(document.getElementById("form_border_side").style.display="none",document.getElementById("form_border_radius").style.display="none")}"path_group"==t&&"double"==cpa.type||"text_block"==t?(document.querySelector("#form_border_inner_outer").style.display="block",set_stroke_width_for_double(document.querySelector("#form_border_inner").checked,"text_block"!=t)):e.classList.contains("rough")&&!roughing.shape_is_solid(e)?(document.querySelector("#form_border_inner_outer").style.display="block",set_stroke_width_for_rough_shape(document.querySelector("#form_border_inner").checked)):document.querySelector("#form_border_inner_outer").style.display="none",(t||"P"==r)&&toggle_border_buttons(e),set_invalid_form_inputs_to_zero()}function fill_fs_drawing(e){"lineto"==e.getAttribute("flow")?(document.querySelector("#form_path_lineto").style.display="block",setup_smoothing_for_lineto()):document.querySelector("#form_path_lineto").style.display="none"}function toggle_border_buttons(e){if(buttons=document.querySelectorAll("#form_border_side button"),e.hasAttribute("border_sides_arr")){var t=e.getAttribute("border_sides_arr").split(",").map(function(e){return"true"===e})
_.forEach(buttons,function(e,r){return e.classList.toggle("onoff-on",t[r])})}else _.forEach(buttons,function(e){return e.classList.toggle("onoff-on",!1)})}function toggle_font_class(e){var t=find_current_font_class(e)
if(d3.selectAll(".form_font_class button").classed("onoff-on",!1),t)for(var r=parseInt(t.slice(4))+1,n=document.querySelectorAll(".form_font_class button:nth-child("+r+")"),o=0;o<n.length;o++)n[o].classList.toggle("onoff-on",!0)
var a=e.style.fontFamily||find_attr_of_style_sheet("."+find_current_font_class(e),"font-family")
a=a?a.replace(/"/g,""):"default",$(".form_font_list").val(a)}function toggle_font_alignment(e){var t=".text_align_"+e.style.textAlign
d3.selectAll(".text_align_left, .text_align_center, .text_align_right").classed("onoff-on",!1),d3.selectAll(t).classed("onoff-on",!0)}function touching(){if(d3.event.touches.length>1&&"touchmove"==d3.event.type)return d3.event.preventDefault(),!1
2!=d3.event.touches.length&&d3.event.stopPropagation()}function svg_dbl_click(){if(document.querySelector("#print_region"))return text_to_feedback_pane("will not add figures when print region is active. Remove print region first(in export menu)",!0,!0),!1
var e=get_propagation_chain(d3.event.target)
if(!drag_for_drawing&&"zoomfield"!=e[0].id){var t=e.filter(function(e){return"g"==e.tagName&&e.hasAttribute("i_am_a")&&e.classList.contains("canvas_layer")})[0],r=selected_figure.make(svg,corrected_mouse_position(d3.mouse(this)),void 0,selected_figure.my_name)
roughen_all&&roughing.roughen(r.node()),set_currentElement(r.node()),display_fs_for_shape(currentElement),gui.frame_element(currentElement),"text_basic"!=selected_figure.my_name&&"icon_basic"!=selected_figure.my_name&&add_extra_styles_to_new_el(r.node()),t&&group_elements(d3.select(t),r)}d3.event.stopPropagation()}function add_extra_styles_to_new_el(e){selected_figure.my_style_classes&&selected_figure.my_style_classes[0]in predef_styles.extra.font_sizes&&e.classList.add(predef_styles.extra.font_sizes[selected_figure.my_style_classes[0]]),selected_figure.my_style_classes&&selected_figure.my_style_classes[0]in predef_styles.extra.padding&&d3.select(e).selectAll("article").style("padding",predef_styles.extra.padding[selected_figure.my_style_classes[0]]+"px")}function handle_math_jax_button_click(e){math_basic.trigger_math(d3.select(currentElement),document.querySelector(".math_input").value)}function change_text(e){var t=currentElement.getAttribute("i_am_a")
if(currentElement.classList.contains("example_fig"))return!1
"text"==t.slice(0,4)&&("text_basic"==t?(d3.select(currentElement).select("text").text(e),object_mapper[t].resize_text(d3.select(currentElement))):"text_path"==t?(d3.select(currentElement).select("textpath").text(e),text_path.resize_text(d3.select(currentElement))):"text_block"==t&&(d3.select(currentElement).select("text").text(e),text_block.resize_text(d3.select(currentElement))))}function close_modal(e){document.querySelector("#"+e).style.display="none",no_modal=!0,icon_to_change=!1}function open_modal(e){no_modal=!1,document.querySelector("#"+e).style.display="block"}function get_data_to_save(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0],gui.remove_all(),remove_plumb_lines(),JSON.stringify(svg_to_json("#zoomfield"))}function reset_save(){function e(e){return res=e.split("."),res[0]+".json"}prep_blob_for_download(get_data_to_save())
var t=document.getElementById("save_name")
t.value=current_map_name,document.querySelector("#dl_vis").style.visibility="inherit",document.querySelector("#save_name").focus(),t.onchange=function(){current_map_name=e(this.value),document.getElementById("dl_link").download=current_map_name}}function prep_blob_for_download(e){var t=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(t)
return current_map_name=current_map_name||"yourMap.json",[document.getElementById("dl_link")].forEach(function(e){e.download=current_map_name,e.href=r,e.textContent="Download"}),r}function append_options(e,t){t.forEach(function(t){$(e).append($("<option></option>").attr("value",t).text(t))})}function add_text_to_path(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=t||currentElement.querySelector(".click_catcher")
text_block.set_text(e)
var r=t.getPointAtLength(t.getTotalLength()/2),n=text_block.make(svg,[r.x,r.y])
return text_block.bind_to_path(t,n.node()),text_block.set_text(""),ido(n.node()).add_line_break(n.node()),object_mapper.text_block.repos_along_path(n.node(),t.parentElement,0),n.node()}function show_path_text_input_new(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=add_text_to_path("")
r.querySelector("text").textContent=t,set_currentElement(r),display_fs_for_shape(currentElement),gui.frame_element(currentElement),roughen_all&&roughing.roughen(r),setTimeout(function(){show_text_input_area(r.querySelector("text"))},10)}function show_path_text_input_existing(e){currentElement=currentElement.querySelector("g"),show_text_input_area(currentElement.querySelector("text")),event.stopPropagation()}function set_button_class(e,t){for(var r=e.querySelectorAll("button"),n=0;n<r.length;n++)r[n].classList.toggle("onoff-on",!1)
t.classList.toggle("onoff-on",!0)}function group_elements(e,t){if(t.node()==e.node().parentElement)return!1
var r=posit2.get_trans(t.node(),!0),n=posit2.get_top_left(t.node(),!0)
if(e.select(".mainfig").empty())if(e.select("path").empty())var o=e.node().parentElement,a=posit2.get_top_left(o,!0),i=posit2.get_trans(o,!0),s=[(n[0]-a[0])/i.scale,(n[1]-a[1])/i.scale]
else{var s=posit2.get_trans(t.node(),!0).translate
t.classed("i_am_grouped_notrans",!0)}else{var a=posit2.get_top_left(e.node(),!0),i=posit2.get_trans(e.node(),!0),s=[(n[0]-a[0])/i.scale,(n[1]-a[1])/i.scale]
t.classed("i_am_grouped",!0)}r.translate=s,t.attr("transform",transform_to_string(r)),posit2.delete_item(t.node().id),e.classed("i_have_a_group",!0),$(t.node()).appendTo(e.node())}function ungroup_element(e){if(!e.classed("i_am_grouped"))return text_to_feedback_pane("element is not grouped",!1,!0),!1
var t=e.node(),r=t.parentElement
return trans_child=posit2.get_trans(e.node(),!0),e.attr("transform",transform_to_string(trans_child)),e.classed("i_am_grouped",!1),e.classed("i_am_grouped_notrans",!1),$(e.node()).appendTo(svg.node()),d3.select(r).selectAll("g").empty()&&(d3.select(r).classed("i_have_a_group",!1),d3.select(r).classed("do_not_evade_me",!1),d3.select(r).classed("evade_me",!0)),posit2.delete_item(t.id),t}function ungroup_all_children(e){return direct_child_only_selector(e,"g.i_am_grouped").map(function(e){return ungroup_element(d3.select(e))})}function find_zoom_level_of_el(e){for(var t=0;t<zoom_levels.length;t++){var r=zoom_levels[t]
if(e.classList.contains(r))return t}return 0}function medium_func(e){article=e,medium&&(medium.element.removeAttribute("draggable"),medium.destroy()),medium=new Medium({element:e,mode:Medium.richMode,attributes:null,tags:null,pasteAsText:!1,modifiers:{}}),e.focus()}function add_styling_to_par(e){manage_groups.get_group(currentElement,!0).forEach(function(t){medium_func(t),Medium.activeElement=t,medium.invokeElement(e,{id:"lastmedium"})
var r=find_p(t).querySelector("#lastmedium")
r&&(r.onclick=par_child_click_handler,r.removeAttribute("id"),currentElement=r,gui.remove_all())})}function check_if_text_selected(){return s=rangy.getSelection(),s.isCollapsed?(text_to_feedback_pane("select a text to style, then press the button",!1,!0),!1):find_p(s._ranges[0].startContainer)==find_p(s._ranges[0].endContainer)||(text_to_feedback_pane("only works for one paragraph at a time",!1,!0),!1)}function test_url(e){return e.match(/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/)}function plus_minus_generator_multi(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2
r=r||1,e.forEach(function(e){return plus_minus_generator(e,t,r,n)})}function plus_minus_generator(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2
r=r||1
var o=e.querySelector(".plus"),a=e.querySelector(".minus"),i=e.querySelector("input")
o.onmousedown=function(){var e=parseFloat(i.value)
i.value=round_to(e+r,n),t(i)},a.onmousedown=function(){var e=parseFloat(i.value)
i.value=round_to(e-r,n),t(i)},i.onchange=function(){t(i)}}function func_for_scaling(e){manage_groups.get_group(currentElement,!1).forEach(function(t){var r=parseFloat(e.value)
ido(t).scale_me(t,r)}),gui.frame_element(currentElement)}function change_border_width(e){is_par_tag(currentElement)?manage_groups.get_group(currentElement,!0).forEach(function(t){d3.select(t).style("border-width",e.value+"px")}):manage_groups.get_group(currentElement,!0).forEach(function(t){var r=iama(currentElement)
if(t="path_group"==r||"path_basic"==r||"country_basic"==r?t.firstChild:t,"path_group"==r&&"double"==cpa.type)t=document.querySelector("#form_border_inner").checked?t.parentElement.querySelector(".inner_path"):t.parentElement.querySelector(".mainpath")
else if("text_block"==r)t=document.querySelector("#form_border_inner").checked?t.parentElement.querySelector(".mainfig"):t.classList.contains("rough")?t.querySelector("path[is_border]"):t.parentElement.querySelector("rect")
else if(t.classList.contains("rough")&&!roughing.shape_is_solid(t)&&document.querySelector("#form_border_inner").checked)return roughing.set_inner_width(t,e.value),!1
if(d3.select(t).style("stroke-width",e.value),t.querySelector("article")&&($(t).find("article").css("margin",e.value/2+"px"),parseFloat($(t).find("article p:first-child").css("margin-top"))<e.value/2&&$(t).find("article p:first-child").css("margin-top",e.value/2+"px")),"path_group"==r){var n="double"==cpa.type?calc_stroke_width_from_double():e.value
d3.select(t.parentElement).selectAll(".arrow_0, .arrow_1").style("stroke-width",n+"px")}})}function border_sides_attr_to_array(e){return e.getAttribute("border_sides_arr").split(",").map(function(e){return"true"===e})}function resize_if_wanted_after_font_change(e){var t=get_auto_resize_params_for_font_change(),r=_slicedToArray(t,2),n=r[0],o=r[1]
n&&ido(e).size_around_paragraphs(e,!1,o)}function get_auto_resize_params_for_font_change(){return[document.querySelector("#form_font_resize_on_change").checked,document.querySelector("#form_font_resize_height_only").checked]}function zoom_toggle_func(e){res=toggle_zoom.toggle_zoom(),toggle_button(e)}function search_paragraph_bullet_point(e){return["bullet","triangle","rhombus","check","cross","arrow"].find(function(t){return e.classList.contains(t)})}function fixed_path_side(e,t,r){return set_path_attrs(d3.select(e)),cpa.from_side=t,r=r||cpa.to_side||null,cpa.to_side=r,cpa.fixed_side=!0,find_path(void 0,!0)}function get_pos_from_direction(e,t){var r=posit2.get_top_left(e,!0),n=_slicedToArray(r,2),o=n[0],a=n[1],i=posit2.get_w_h(e),s=_slicedToArray(i,2),_=s[0],c=s[1],l=0,u=0
return 37==t&&(l=round_to_mdd_with_minimum(-_-marge_for_copy)),38==t&&(u=round_to_mdd_with_minimum(-c-marge_for_copy)),39==t&&(l=round_to_mdd_with_minimum(_+marge_for_copy)),40==t&&(u=round_to_mdd_with_minimum(c+marge_for_copy)),[o+l,a+u]}function round_to_mdd_with_minimum(e){return e/mdd==parseInt(e/mdd)?parseInt(e/mdd)*mdd:(parseInt(e/mdd)+1*Math.sign(e))*mdd}function copy_path_for_slide(e,t){var r=parse_g(e),n=start_adding(t,r)
return n.attr("id","dummy"),n}function make_all_path_basic_immobile(){els=_.filter(svg.node().querySelectorAll("g[i_am_a]"),function(e){return"path_group"!=iama(e)}),els.forEach(function(e){toggle_draggability_of_element(e,!1,!0),e.classList.add("no_pointing_temp")})}function make_all_path_basic_mobile(){els=_.filter(svg.node().querySelectorAll("g[i_am_a]"),function(e){return"path_group"!=iama(e)}),els.forEach(function(e){toggle_draggability_of_element(e,!0,!0),e.classList.remove("no_pointing_temp")})}function toggle_drag_listener(){var e="",t=manage_groups.get_group(currentElement,!1)
t.forEach(function(t){res=toggle_draggability_of_element(t),e=res?"draggable":"undraggable"}),1==t.length?text_to_feedback_pane("toggled to "+e,!1,!0):text_to_feedback_pane("toggled "+t.length+" elements")}function toggle_move_fine(e){move_delta=1==move_delta?mdd:1,toggle_button(document.querySelector("#form_move_delta"))}function toggle_size_fine(e){size_delta=1==size_delta?mdd:1,toggle_button(document.querySelector("#form_size_delta"))}function change_path_end_fig(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1]
if("octopus"==currentElement.getAttribute("type")&&(!cpa.octo_flipped&&"tail"==e||cpa.octo_flipped&&"head"==e))return text_to_feedback_pane("no tail arrow possible for octopus styled path",!1,!0),!1
d3.select(currentElement).classed("connection")&&manage_groups.get_group(currentElement,!0).forEach(function(r){currentElement=r,set_path_attrs(d3.select(r)),parseFloat(r.querySelector(".mainpath").style["stroke-width"]),cpa.arrow_width=10,cpa.arrow_height=17,cpa["arrow_"+e]=!!t&&path_end_fig,change_arrow("arrow_"+e)}.bind(this))}function change_arrow(e){cpa[e]||(d3.select(currentElement).select(function(){return"arrow_head"==e?".arrow_1":".arrow_0"}()).remove(),cpa[e]=!1),remake_path(find_path(!0))}function toggle_button(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]
if("DIV"!=e.tagName||e.classList.contains("toggle-button")?"LABEL"==e.tagName?e=e.parentElement.querySelector(".toggle-button"):"BUTTON"==e.tagName&&(e=e.parentElement):e=e.querySelector(".toggle-button"),e.classList.contains("toggle-button")){e.classList.toggle("toggle-button-selected")
var r=!!e.classList.contains("toggle-button-selected")
if(t){var n=r?[1,0]:[0,1],o=_slicedToArray(n,2),a=o[0],i=o[1]
e.parentElement.querySelectorAll("label")[a].classList.add("selected"),e.parentElement.querySelectorAll("label")[i].classList.remove("selected")}return r}}function change_font_class_of_shape(e,t){var r=find_current_font_class(e)
if(r&&e.classList.remove(r),r=="font"+t)return d3.selectAll(".form_font_class button").classed("onoff-on",!1),!1
add_font_class(e,t),toggle_font_class(e,t)
var n=find_g(e),o=iama(n);["text_basic","icon_basic","text_path","text_block","math_basic"].find(function(e){return e==o})||("P"!=e.tagName&&(e=e.querySelector("P")),no_table=!1,resize_if_wanted_after_font_change(n),no_table=!0),"resize_text"in object_mapper[o]&&object_mapper[o].resize_text(d3.select(n))}function add_font_class(e,t){e.classList.add("font"+t),e.style["font-size"]=null}function update_quick_grouping_forms(){manage_groups.permanent_group_active()?($(".when_group").css("display","flex"),$(".form_deselect_group").css("display","inline-block"),$(".form_temp_group_to_perm").css("display","none")):manage_groups.get_current_group().length>0?($(".when_group").css("display","flex"),$(".form_temp_group_to_perm").css("display","inline-block"),$(".form_deselect_group").css("display","none")):($(".when_group").css("display","none"),$("#fs_grouping_quick .when_group").css("display","none"))}function make_ready_for_copy(e){el_to_copy=currentElement
var t=iama(currentElement)
if((t in figs&&figs[t].copyable||t in poly_config)&&!currentElement.classList.contains("hg"))text_to_feedback_pane(["click canvas to paste","press escape key on keyboard to abort"],!1,!0),svg.classed("copy_on",!0),d3.selectAll(".canvas_layer").classed("copy_on",!0)
else{if(!currentElement.classList.contains("hg"))return!1
text_to_feedback_pane("Will not copy shapes that are part of a hierarchy",!1,!0)}element_to_json_to_hook(manage_groups.get_group(el_to_copy))}function element_to_json_to_hook(e){var t=svg_to_json("#mainsvg",e),r=document.createElement("p")
r.textContent="validator-bn;"+JSON.stringify(t.gs),document.querySelector("#dummy_copy_hook").appendChild(r),select_text_in_paragraph(r),document.execCommand("copy"),document.querySelector("#dummy_copy_hook").removeChild(r)}function toggle_slide_edit_menu(e){var t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=document.querySelector("#slides_menu"),a=document.querySelector("#edit_mode_menu")
t=r?n:!slides_mode,t?(drag_select_for_slider=!0,o.classList.remove("menu_hidden"),a.classList.add("menu_hidden"),slides_mode=!0,slide_manager.setup_menu()):(drag_select_for_slider=!1,o.classList.add("menu_hidden"),a.classList.remove("menu_hidden"),slides_mode=!1,slide_manager.slide_show_on()&&slide_manager.end_slide_show())}function move_element_to_top(e){e=e||currentElement,$(e).appendTo(e.parentElement)}function change_submenu(e){for(var t,r=e.target.parentElement.querySelectorAll("h4"),n=0;n<r.length;n++)r[n].classList.remove("active"),r[n]==e.target&&(t=n)
e.target.classList.add("active")
for(var o=direct_child_only_selector(e.target.parentElement.parentElement,".sub"),a=0;a<o.length;a++)o[a].style.display="none"
o[t].style.display="block"}function bind_text_to_path(e){var t=find_path_for_text(e)
if(!t)return text_to_feedback_pane("did not find one path to bind to",!1,!0),!1
var r=get_x_position_for_path_to_bind(e)
text_path.bind_to_path(d3.select("#mainsvg"),d3.select(t),d3.select(e).select("text"),r),t.parentElement.classList.add("i_have_a_group"),t.parentElement.setAttribute("rel_type","custom")}function bind_path_to_par(e){var t=find_g(e)
g_id=iami(t)
var r=path_id_to_el_ids(waiting_for_par_bind,!0),n=_slicedToArray(r,2),o=n[0],a=n[1]
if(g_id==o||g_id==a){e.setAttribute("connect",waiting_for_par_bind),set_path_attrs(svg.select("#"+waiting_for_par_bind))
var i=find_path(!0),t=remake_path(i)}else text_to_feedback_pane("parent of paragraph not connected to path",!1,!0)
waiting_for_par_bind=!1}function find_target_for_image(e){return"P"==e.tagName?e:find_g(e)}function handle_paste_event(e){"drop"==e.type&&((currentElement=find_g(e.target))||(currentElement=svg.node()))
var t="svg"==currentElement.tagName||"zoomfield"==currentElement.id
if(e.clientX&&(last_pos=corrected_mouse_position([e.clientX,e.clientY])),"INPUT"==e.target.tagName)return!0
var r="paste"==e.type?currentElement:e.target,n=(e.clipboardData||e.dataTransfer||e.originalEvent.clipboardData).items,o=!!e.mozInputSource
o&&(n=e.dataTransfer.files),e.preventDefault(),force_plain_text=document.querySelector("#form_import_force_plain_text").checked,t?(_.map(n,function(e){return e.type}).find(function(e){return"application/pdf"==e})?handle_pdf_drop_event(n,"text/plain",o):_.map(n,function(e){return e.type}).find(function(e){return"text/html"==e})&&!force_plain_text?handle_html_paste_data(n,o):_.map(n,function(e){return e.type}).find(function(e){return"image/svg+xml"==e})?handle_svg_drop_event(n,"image/svg+xml",o):_.map(n,function(e){return e.type}).find(function(e){return"text/plain"==e})?handle_text_drop_event(n,"text/plain",o):_.map(n,function(e){return e.type}).find(function(e){return"text/csv"==e})?handle_text_drop_event(n,"text/csv",o):_.map(n,function(e){return e.type}).find(function(e){return"application/vnd.openxmlformats-officedocument.wordprocessingml.document"==e})?handle_docx_paste_event(n,o):_.map(n,function(e){return e.type}).find(function(e){return"application/json"==e})?handle_json_drop_event(n,o):""==_.map(n,function(e){return e.type}).find(function(e){return""==e})&&handle_unknown_file(n,o),e.stopPropagation()):_.map(n,function(e){return e.type}).find(function(e){return 0===e.indexOf("image")})&&handle_pic_paste_event(n,r,o)}function set_print_region(){drag_select=!drag_select,drag_select?(drag_select_for_print_region=!0,drag_select_on()):(drag_select_off(),drag_select_for_print_region=!1)}function remove_print_region(){printer.remove_all_regions(),drag_select_off(),document.querySelector("#form_print_region_if_active").style.display="none",document.querySelector("#form_print_buttons").style.display="none"}function drag_select_on(){drag_for_drawing&&drag_draw_off(),drag_select=!0,svg.classed("drag_select_on",!0),svg.call(drag_svg_for_select),svg.selectAll("g[i_am_a]").classed("no_pointing_temp",!0)}function drag_select_off(){drag_select=!1,svg.classed("drag_select_on",!1),svg.on(".drag",null),drag_select_for_print_region=!1,drag_select_for_merge=!1,svg.selectAll("g[i_am_a]").classed("no_pointing_temp",!1)}function drag_draw_on(){make_all_path_basic_immobile(),drag_select_off(),drag_for_drawing=!0,svg.call(drag_draw),svg.classed("drag_draw",!0),svg.selectAll("g[i_am_a]").classed("drag_draw",!0),toggle_button_to_status(document.querySelector("#form_toggle_draw"),!0),toggle_button_to_status(document.querySelector("#cm_toggle_draw"),!0),text_to_feedback_pane("draw mode enabled",!1,!0),document.querySelector("#form_stroke_del").classList.remove("hidden")}function drag_draw_off(){make_all_path_basic_mobile(),drag_for_drawing=!1,svg.on(".drag",null),svg.classed("drag_draw",!1),svg.selectAll("g[i_am_a]").classed("drag_draw",!1),toggle_button_to_status(document.querySelector("#form_toggle_draw"),!1),toggle_button_to_status(document.querySelector("#cm_toggle_draw"),!1),toggle_zoom.temp_disable_off(),text_to_feedback_pane("draw mode disabled",!1,!0)
var e=document.querySelectorAll(".unhandled")
if(e.length>0)var t=get_bbox_of_group(e),r=is_drawing_on_shape(e,t)
r&&!r.classList.contains("overlay")&&"zoomfield"!=r.id&&(r=find_g(r),ido(r).stick_to_me(d3.select(r),Array.from(document.querySelectorAll(".unhandled")))),d3.selectAll(".unhandled")[0].forEach(function(e){var t=e.querySelector(".mainfig").getAttribute("d"),r=e.querySelector(".catcher")
r&&r.setAttribute("d",t)}),d3.selectAll(".unhandled").classed("unhandled",!1),document.querySelector("#form_stroke_del").classList.add("hidden"),document.querySelector("#form_draw_recog_del").classList.add("hidden"),new_draw_group=!1,display_fs_for_shape(find_g(currentElement))}function is_drawing_on_shape(e,t){var r=_slicedToArray(t,4),n=r[0],o=r[1],a=r[2],i=r[3],_=[[n,a],[o,a],[n,i],[o,i]]
res=_.map(function(e){var t=corrected_mouse_position2(e),r=_slicedToArray(t,2),n=r[0],o=r[1],a=document.elementFromPoint(n,o)
return!!a&&find_g(a)}).filter(function(e){return e})
var c=Array.from(e).map(function(e){return e.id})
if(s=new Set(res.filter(function(e){return-1==c.indexOf(e.id)})),1==s.size)return Array.from(s.values())[0]
var l=Array.from(s.values()).map(function(e){return e.classList.contains("i_am_grouped")?e.parentElement:e})
return s=new Set(l),1==s.size&&Array.from(s.values())[0]}function find_active_submenu(e){var t=document.querySelector("#"+e)
if(!t)return!1
for(var r=t.querySelectorAll(".submenus h4"),n=0;n<r.length;n++)if(r[n].classList.contains("active"))return r[n].innerText
return!1}function size_fig_to_image(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=find_g(e)
if(ratio=n.querySelector("article").getAttribute("img_ratio").split("/").map(function(e){return parseInt(e)}),r)var o=ratio,a=_slicedToArray(o,2),i=a[0],s=a[1]
else{var _=parseInt(ratio[0])/parseInt(ratio[1]),c=get_w_h(n),l=_slicedToArray(c,2),i=l[0],s=l[1]
i/s<_?t?i=s*_:s=i/_:t?s=i/_:i=s*_}ido(n).resize_me(d3.select(n),i,s,!0),gui.frame_element(n)}function make_ready_for_style_copy(e){var t="",r=iama(currentElement)
if(r in figs&&"copyable"in figs[r]&&!figs[r].copyable)return text_to_feedback_pane("cannot style copy a "+r,!1,!0),copied_styles=!1,!1
copied_styles=get_styles_for_copy(currentElement),is_par_tag(currentElement)?(set_attr_of_rule(find_sheet("map"),"p:hover","cursor","copy"),t="paragraph"):"path_group"==r?(set_attr_of_rule(find_sheet("map"),".connection:hover","cursor","copy"),t="path"):"text_block"==r?(copied_styles=get_text_block_style_attributes(currentElement),t="text_block"):null==r?(copied_styles.width=parseInt(currentElement.getAttribute("arrow_width")),copied_styles.height=parseInt(currentElement.getAttribute("arrow_height")),t="path_end_fig"):(set_attr_of_rule(find_sheet("map"),".mainfig:hover","cursor","copy"),set_attr_of_rule(find_sheet("map"),".catcher:hover","cursor","copy"),t="shape"),text_to_feedback_pane("click another "+t+" to copy style to it")}function get_min_max(e,t,r){var n=minY=1/0,o=maxY=0
return e.forEach(function(e){n=Math.min(n,t(e)),minY=Math.min(minY,r(e)),o=Math.max(o,t(e)),maxY=Math.max(maxY,r(e))}),[n,minY,o,maxY]}function delete_shape(e){gui.remove_all(),d3.selectAll(".plumb").remove()
var t=find_g(e.parentElement)
manage_groups.get_group(e,!0).forEach(function(e){var t=!currentElement.classList.contains("hg")
t&&undoer.start(),e.classList.contains("i_have_a_group")&&d3.select(e).selectAll("g")[0].forEach(function(e){find_connections(iami(e)).forEach(function(e){return undoer.remove(document.querySelector("#"+e))})})
var r=d3.select(e)
r.classed("hg")&&hierarchies.remove_element(e),find_connections(r.attr("id")).forEach(function(e){var t=document.querySelector("#"+e)
manage_groups.remove_element_if_present(t),undoer.remove(t)}),undoer.remove(r.node()),t?(undoer.stop(),text_to_feedback_pane("Deleted items: press control Q to undo",!1,!1)):text_to_feedback_pane("Element removed (not undoable because it is part of a hierarchical group)",!1,!0),e.classList.contains("rough")&&roughing.remove_filter(e),manage_groups.remove_element_if_present(e)}),set_currentElement(t.hasAttribute("i_am_a")?t:d3.select("#mainsvg").node()),display_fs_for_shape(currentElement),gui.frame_element(currentElement)}function is_user_logged_in(){return!("not logged in"==document.querySelector("#form_git_username span").innerText)}function get_user_name(){return document.querySelector("#form_git_username span").innerText}function show_wait_spinner(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:""
document.querySelector("#be_patient").style.display="block",document.querySelector("#be_patient h2").innerText=e,document.querySelector("#be_patient p").innerText=t}function hide_wait_spinner(){document.querySelector("#be_patient").style.display="none"}function make_feedback_func(e){return function(t,r,n){r&&e.classList.contains("collapsed")&&toggle_field_set(e),"string"==typeof t&&(t=[t])
var o=t.reduce(function(e,t){return e+"<p>"+t+"</p>"},"")
if(e.querySelector(".fs_toggle").innerHTML=o,n){var a=e.querySelector("legend")
a.classList.toggle("flash",!0),setTimeout(function(){return a.classList.toggle("flash",!1)},750)}}}function show_feedback_modal(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:""
return document.querySelector("#modal_feedback").style.display="block",document.querySelector("#modal_feedback h2").innerText=e,document.querySelector("#modal_feedback p").innerText=t,!0}function hide_feedback_modal(){document.querySelector("#modal_feedback").style.display="none"}function turn_study_mode_off(){document.querySelector("#input_menu").style.display="none",study_one_by_one=null,study_mode=!1,form_update=!0,unbind_catchers_to_quick_flipper(),text_to_feedback_pane("study mode turned off",!1,!0),document.querySelector("#fs_study_mode").style.display="none",document.querySelector("#form_one_by_one_controls").style.display="none"}function quick_study(){var e=find_g(this)
ido(e).flip_shape(e),reverse&&setTimeout(function(){ido(e).flip_shape(e)},reverse)}function bind_catchers_to_quick_flipper(){$(".mainfig, .catcher").on("click",quick_study)}function unbind_catchers_to_quick_flipper(){$(".mainfig, .catcher").unbind("click",quick_study)}function get_group_for_study_mode(){if(study_one_by_one)var e=study_one_by_one.get_group()
else var e=manage_groups.get_current_group()
return 0==e.length&&(e=svg.selectAll("g.evade_me")[0]),e}function paragraph_bounding_box_zoom_correction(e){return e/(toggle_zoom.get_zoom_factor()*window.devicePixelRatio)}function handle_text_break_button_click(e){if("text_path"==iama(currentElement))return!1
ido(currentElement).add_line_break(currentElement),"repos_along_path"in ido(currentElement)&&(ido(currentElement).repos_along_path(currentElement,currentElement.parentElement),roughing.roughen_if_needed(currentElement))}function turn_study_one_by_one_off(){document.querySelector("#input_menu").style.display="none",study_one_by_one=null,toggle_zoom.fade_callback(),document.querySelector("#form_one_by_one_controls").style.display="none"}function setup_smoothing_for_lineto(){var e={}
Array.from(document.querySelectorAll("#form_pencil_precision button")).forEach(function(t){t.onclick=function(t){document.querySelector("#form_undo_smoothing").style.display="flex",$(this.parentElement).find("button").toggleClass("onoff-on",!1),error_bezier_fit=parseInt(this.value),this.classList.add("onoff-on"),manage_groups.get_group(currentElement,!0).forEach(function(t){var r
t.id in e?r=e[t.id]:(r=t.querySelector("path").getAttribute("d"),e[t.id]=r)
var n=drawn_line_to_bezier(r,error_bezier_fit)
d3.select(t).selectAll("path").attr("d",n),t.removeAttribute("flow")})}}),document.querySelector("#form_undo_smoothing").onclick=function(t){manage_groups.get_group(currentElement,!0).forEach(function(t){t.setAttribute("flow","lineto"),d3.select(t).selectAll("path").attr("d",e[t.id])})}}function is_toggle_button_on(e){return e.querySelector(".toggle-button").classList.contains("toggle-button-selected")}function toggle_button_to_status(e,t){var r=is_toggle_button_on(e);(r&&!t||!r&&t)&&toggle_button(e)}function get_splitter_text(){return check_tab_enter(document.querySelector("#form_import_seperator").value.toString())}function get_splitter_text_primary(){return check_tab_enter(document.querySelector("#form_import_seperator_primary").value.toString())}function check_tab_enter(e){return"tab"==e?"\t":"enter"==e?"\n":e.match(/\\n/)?e.replace(/\\n/g,"\n"):e.match(/^\\t/)?e.replace(/\\t/g,"\t"):e}function make_congrats_modal(){div=document.createElement("div"),img=document.createElement("img"),div.innerHTML="<span onclick='(function(el){document.body.removeChild(el.parentElement)})(this)' style='float:right;size:24px'>x</span>\t\t\t<h2 style='margin:auto;margin-bottom:12px'>Congratulations! You did it!!</h2>\t\t\t<p>Thanks for playing. Hope you enjoyed it.</p>\t\t\t<p>Check out <a href='https:www.breakdown-notes.com/blog/maps'>this</a> for other maps.</p>",div.appendChild(img),div.style.position="absolute",div.style.left="40%",div.style.top="40%",Promise.resolve().then(function(e){document.body.appendChild(div)}).catch(function(e){console.log(e)})}function toggle_advanced_options(e){minimal_menu=!minimal_menu,toggle_button_to_status(document.querySelector("#form_toggle_advanced_options"),!minimal_menu),display_fs_for_shape(currentElement)}function make_vert_align_handler(e){return function(t){d3.selectAll(".form_vert_align").classed("onoff-on",!1),t.target.classList.add("onoff-on"),currentElement.style["vertical-align"]=e}}function is_par_tag(e){return-1!=["B","U","I","Q","P","SPAN"].indexOf(e.tagName)}function iama(e){try{return e.getAttribute("i_am_a")}catch(t){try{return e.attr("i_am_a")}catch(e){return""}}}function iami(e){try{return e.getAttribute("id")}catch(t){return e.attr("id")}}function ido(e){var t=iama(e)
return t in object_mapper?object_mapper[t]:object_mapper.knot}function par_child_click_handler(e){copied_styles&&set_styles_for_copy(this,copied_styles),currentElement=this,e.stopPropagation(),display_fs_for_shape(currentElement),gui.remove_all(),gui.frame_element(currentElement),medium_func(find_p(currentElement))}function text_path_click(){copied_styles&&set_styles_for_copy(find_g(this),copied_styles)
var e=find_g(this)
d3.event.ctrlKey&&"click"==d3.event.type&&manage_groups.toggle_element(e),set_currentElement(e),display_fs_for_shape(e),gui.frame_element(e),d3.event.stopPropagation()}function make_catcher(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"cp_helper",n=new Fig(figs.catcher,void 0,object_to_event[r])
return n.my_real_name=t,n.add_dragfunc(object_to_drag[r]),n.svg_fig=e,n}function fig_dblclick(){if(d3.event.shiftKey&&d3.event.ctrlKey);else if(d3.event.shiftKey)make_new_connection(d3.select(this.parentElement))
else{var e=find_g(this),t=iama(e)
if("text_basic"==t||"math_basic"==t)show_text_input_area(this)
else if("icon_basic"==t)icon_to_change=!e.classList.contains("example_fig"),open_modal("icon_modal")
else{var r=object_mapper[e.getAttribute("i_am_a")].add_paragraph(e)
set_currentElement(r.node()),display_fs_for_shape(currentElement)}}return d3.event.stopPropagation(),!1}function check_for_range_when_p_form_action(){window.getSelection().isCollapsed||add_styling_to_par("q")}function load_formulas(){formula_mapper={},arr=Array.from(document.querySelectorAll('g[i_am_a="line_for_graph"]')),arr.forEach(function(e){f_str=e.getAttribute("my_func")
var t=math_parser(f_str),r=_slicedToArray(t,2),n=r[0],o=r[1]
n?formula_mapper[e.id]=o:console.log(f_str,e)}),arr.forEach(function(e){graph_basic.resize_me(d3.select(e.parentElement),0,0,!1)})}function if_line_to_graph(e){return"line_for_graph"==iama(e)?e.parentElement:e}function get_min_max_for_graph(e,t,r){var n=e.querySelector(t),o=e.querySelector(r)
return[parseFloat(n.value),parseFloat(o.value)]}function get_selectors_for_color(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=iama(e),n=e.tagName
if(t=t||fill_what,is_par_tag(e))return["*","fill"==t?"background-color":"text"==t?"color":"border-color"]
if("svg"==n)return["*","background-color"]
if("path_group"!=r)return"text_path"==r?"fill"==t?["text","fill","fill-opacity"]:"stroke"==t?["text","stroke","stroke-opacity"]:[":first-child",t]:"text_block"==r?"text"==t?["text","fill","fill-opacity"]:"stroke"==t?["text","stroke","stroke-opacity"]:"border"==t?e.classList.contains("rough")?["path[is_border]","stroke"]:["rect","stroke"]:e.classList.contains("rough")?roughing.shape_is_solid(e)?["path[is_fill]","fill"]:["path[is_fill]","stroke"]:["rect","fill"]:"x_axis"==r||"y_axis"==r?"text"==t?["text","fill"]:"stroke"==t?["line, path","stroke"]:["line, path","fill"]:"fill"==t&&e.classList.contains("rough")&&!roughing.shape_is_solid(e)?e.hasAttribute("has_url")?["url",e.getAttribute("has_url")]:["path[is_fill]","stroke"]:"text"==t?["*","color"]:"stroke"==t?["*","stroke"]:"path"==n?["*","stroke"]:["*",t]
var o=currentElement.getAttribute("type")
return"plain"==o?["path","stroke"]:"octopus"==o?"fill"==t?["path","fill"]:["path","stroke"]:"double"==o?"fill"==t?[".inner_path","stroke"]:[".mainpath","stroke"]:void 0}function change_style_of_example(e,t){if("stroke"==fill_what||"fill"==fill_what||"text"==fill_what){var r="text"==fill_what?"color":fill_what
set_attr_of_rule(sheet,"."+e,r,t.toRgbString()),"fill"==fill_what&&set_attr_of_rule(sheet,"."+e,"background-color",t.toRgbString())}else text_to_feedback_pane("not for this: only set fill or stroke",!1,!0)}function change_color_test(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2]
if(t=t||currentElement,"P"==currentElement.tagName&&check_for_range_when_p_form_action(),!t)return text_to_feedback_pane("no element activate. Nothing to color",!1,!0),!1
if(t.parentElement.classList.contains("example_styles"))return change_style_of_example(t.classList[0],e),!1
if(drag_for_drawing)return path_basic.styles.stroke=e.toRgbString(),!1
var n=get_selectors_for_color(t,r),o=_slicedToArray(n,2),a=o[0],i=o[1]
manage_groups.get_group(t,!0).forEach(function(r){var n=find_current_style_class(r)
n&&"custom_style"!=n&&(from_style_class_to_custom_class(r,n),r.classList.remove(n),r.classList.add("custom_style")),"*"==a?d3.select(r).style(i,e.toRgbString()):"url"==a?d3.select(i).select("path").style("stroke",e.toRgbString()):d3.select(r).selectAll(a).style(i,e.toRgbString())
var o=iama(t)
"path_group"!=o&&"path_basic"!=o||color_add_ons(d3.select(r))}),"svg"==t.tagName&&set_attr_of_rule(sheet,".text_path_background","stroke",color_alpha_to_color(e.toRgbString())),"fill"==fill_what&&check_for_change_click_catcher_color(t)}function check_for_change_click_catcher_color(e){e.querySelector(".catcher")}function set_color_picker(e){var t,r
e=e||currentElement
var n=get_selectors_for_color(e),o=_slicedToArray(n,2),a=o[0],i=o[1]
if("*"==a){var s=window.getComputedStyle(e)
t=s[i],r=s[i+"-opacity"]||s.opacity}else if("url"==a)t=document.querySelector(i).querySelector("path").style.stroke,r="1"
else{var s=window.getComputedStyle(e.querySelector(a))
t=s[i],r=s[i+"-opacity"]}return color_t=tinycolor(t),"rgba"!=t.slice(0,4)&&(color_t._a=parseFloat(r)),colorpicker.spectrum("set",color_t),color_t}function set_background_button(e){var t=window.getComputedStyle(e)["background-size"]
_.forEach(document.querySelectorAll(".background_size button"),function(e){return e.classList.remove("onoff-on")}),d3.selectAll(".background_"+t).classed("onoff-on",!0)}function set_stroke_width_for_double(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0]
if(arguments.length>1&&void 0!==arguments[1]&&!arguments[1])var t=e?".mainfig":"rect"
else var t=e?".inner_path":".mainpath"
var r=currentElement.querySelector(t).style||window.getComputedStyle(currentElement.querySelector(t))
document.querySelector("#form_border_width input").value=r.strokeWidth,document.querySelector("#form_border_dash input").value=r["stroke-dasharray"]}function set_stroke_width_for_rough_shape(e){var t
t=e?roughing.get_stroke_width_of_inner(currentElement):currentElement.style.strokeWidth||find_attr_of_style_sheet("."+find_current_style_class(currentElement),"stroke-width"),document.querySelector("#form_border_width input").value=t}function toggle_path_reset_button(e){!e.hasAttribute("fixed_side")&&!e.hasAttribute("custom_flow")||e.classList.contains("hg")?$(".form_path_reset").css("display","none"):$(".form_path_reset").css("display","flex")}function toggle_path_from_and_to(e,t){d3.selectAll("#form_path_side button").classed("onoff-on",!1),document.querySelectorAll(".path_from .from_side")[e].classList.toggle("onoff-on",!0),document.querySelectorAll(".path_to .to_side")[t].classList.toggle("onoff-on",!0)}function find_sheet(e){for(var t=document.styleSheets,r=0;r<t.length;r++)if(document.styleSheets[r].ownerNode.id==e)return document.styleSheets[r]
return!1}function find_rule(e,t){for(var r=e.cssRules.length,n=0;n<r;n++)if(t(n))return e.cssRules[n]
return!1}function set_attr_of_rule(e,t,r,n){find_rule(e,function(r){return e.cssRules[r].selectorText==t}).style[r]=n}function set_attr_of_page_rule(e,t,r,n){find_rule(e,function(r){return e.cssRules[r].type==t}).style[r]=n}function clear_style_attributes(e,t){for(var r=find_rule(sheet,function(e){return sheet.cssRules[e].selectorText=="."+t}),n=0;n<r.style.length;n++)e.style[r.style[n]]=null
e.style["fill-opacity"]=null}function filter_css_list(e,t){for(var r=[],n=0;n<e.length;n++)t(e[n])&&r.push(e[n])
return r}function find_attr_of_style_sheet(e,t){var r=find_rule(sheet,function(t){return sheet.cssRules[t].selectorText==e})
return!!r&&r.style[t]}function get_styles_of_classes(){for(var e=sheet.cssRules.length,t=[],r=0;r<e;r++)t.push(sheet.cssRules[r].style.cssText)
return t}function set_styles_of_classes(e){var t={fill:!0,stroke:!0,"stroke-width":!0,"stroke-dasharray":!0,"background-color":!0,"font-family":!0,"font-size":!0,padding:!0,"fill-opacity":!0,"stroke-opacity":!0,color:!0,"line-height":!0,"text-align":!0}
if(e.length==sheet.cssRules.length)for(var r=sheet.cssRules.length,n=0;n<r;n++)check_styles(e[n],t)&&(sheet.cssRules[n].style.cssText=e[n])
else text_to_feedback_pane("using default styles because length incoherency")}function make_style_class_for_style_sheet(e,t,r,n,o,a){var i="fill: rgba("+e+", "+t+");background-color: rgba("+e+", "+t+");stroke-width: "+r+";stroke-dasharray: initial;stroke: "+n+";color: "+o+";"
i=".style_"+a+"{"+i+"}",sheet.insertRule(i,1)}function close_other_fieldsets(){var e=document.querySelectorAll("#edit_mode_menu fieldset:not(.collapsed):not(#fs_feedback):not(#fs_help):not(#fs_study_mode)")
_.forEach(e,function(e){return toggle_field_set(e)})
var e=document.querySelectorAll("#slides_menu fieldset:not(.collapsed):not(#fs_help_slides)")
_.forEach(e,function(e){return toggle_field_set(e)})}function toggle_field_set(e){var t=e.querySelector(".fs_toggle")
if(!t)return!1
t.style.display=""==t.style.display?"none":null,e.querySelector("legend").classList.toggle("collapsed"),e.classList.toggle("collapsed"),"fs_help"==e.id&&(help_on=!help_on),"fs_feedback"==e.id&&(fb_menu_open=!e.classList.contains("collapsed"))}function close_fieldset(e){e.querySelector(".fs_toggle").style.display="none",e.querySelector("legend").classList.add("collapsed"),e.classList.add("collapsed")}function color_alpha_to_color(e){if("rgba"==e.slice(0,4)){var t=e.match(/([0-9]+, ){3}([0-1]\.*[0-9]*)/g)[0].split(","),r=t[3],n=parseInt(t[0]),o=parseInt(t[1]),a=parseInt(t[2])
return"rgba("+[Math.round((255-n)*(1-r)+n),Math.round((255-o)*(1-r)+o),Math.round((255-a)*(1-r)+a),1]+")"}if("rgb"==e.slice(0,3))return e}function find_all_connected_elements(e,t){found={}
try{t=t.toString()}catch(e){t=!1}return find_els_connected_to_el(e,t),Object.keys(found)}function find_els_connected_to_el(e,t){found[e.getAttribute("id")]=!0
var r=find_connections(e.getAttribute("id")).filter(function(e){return!(e in found)}).map(function(e){return document.querySelector("#"+e)})
t&&(r=function(e,t,r){return e.filter(function(e){var n=extract_elements_from_path_id(e.getAttribute("id")),o=_slicedToArray(n,2),a=o[0],i=(o[1],r==a?"from_side":"to_side")
return e.getAttribute(i)!=t})}(r,t,e.getAttribute("id"))),r.forEach(function(e){return found[iami(e)]=!0}),function(e,t){return e.map(function(e){var r=extract_elements_from_path_id(e.getAttribute("id")),n=_slicedToArray(r,2),o=n[0],a=n[1]
return t==o?a:o}).map(function(e){return document.querySelector("#"+e)})}(r,e.getAttribute("id")).forEach(function(e){e.getAttribute("id")in found||(found[e.getAttribute("id")]=!0,find_els_connected_to_el(e,t))})}function create_nesw_button(e,t,r){function n(e,r,n,a,i){o.append("path").attr("d","M "+t+" "+t+"  L "+e+" "+r+" A "+t+" "+t+" 0 0 1 "+n+" "+a+" L "+t+" "+t).attr("class",i).attr("dir",i.split(" ")[0])}var o=d3.select(e).append("svg").attr("width",2*t).attr("height",2*t)
o.node().onclick=function(e){d3.select(e.target.parentElement).selectAll("path").classed("on",!1),e.target.classList.add("on")}
var a=180/Math.PI,i=t-Math.sin(45/a)*t,s=2*t-i
n(i,i,s,i,"north keep-open path_from_to "+r),n(s,i,s,s,"east keep-open path_from_to "+r),n(s,s,i,s,"south keep-open path_from_to "+r),n(i,s,i,i,"west keep-open path_from_to "+r)}function get_styles_for_copy(e){var t={}
if(t.me="P"==e.tagName?"p":iama(e),t.style_class=find_current_style_class(e),t.font_class=find_current_font_class(e),e.hasAttribute("border_sides_arr")&&(t.borders=e.getAttribute("border_sides_arr")),"text-align"in e.style&&(t.alignment=e.style["text-align"]),e.querySelector("article")){var r=e.querySelector("article").style
"padding"in r&&(t.padding=r.padding)}"path_group"==t.me?t.style_attr=get_path_style_attributes(e):"text_block"==me||(t.style_attr=e.getAttribute("style")||!1),"p"==t.me&&(t.prefix=["bullet","triangle","rhombus","check","cross","arrow"].map(function(t){return _.find(e.classList,function(e){return e==t})}).find(function(e){return e})),"rect_basic"!=t.me&&"rect_canvas"!=t.me||(t.radius=e.querySelector(".mainfig").getAttribute("rx"))
var n=e.querySelectorAll("p")
return t.ps=_.map(n,function(e){return get_styles_for_copy(e)}),t}function set_styles_for_copy(e,t){manage_groups.get_group(e,!0).forEach(function(e){if(me="P"==e.tagName?"p":iama(e),"P"==me&&"P"!=t.me||"P"==t.me&&"P"!=me)return text_to_feedback_pane("something went wrong... The copied element is not the same as target element"),!1
"path_group"==me?set_path_style_attributes(e,t.style_attr,!1):"text_block"==me?set_text_block_style(e,t):set_styles_to_element(e,t)}),copied_styles=!1,is_par_tag(e)?set_attr_of_rule(find_sheet("map"),"p:hover","cursor","text"):"path_group"==iama(e)?set_attr_of_rule(find_sheet("map"),".connection:hover","cursor","inherit"):(set_attr_of_rule(find_sheet("map"),".mainfig:hover","cursor","all-scroll"),set_attr_of_rule(find_sheet("map"),".catcher:hover","cursor","all-scroll"))}function set_styles_to_element(e,t){var r=find_current_style_class(e)
r&&e.classList.remove(r)
var r=find_current_font_class(e)
if(r&&e.classList.remove(r),t.style_class&&e.classList.add(t.style_class),t.font_class&&e.classList.add(t.font_class),t.prefix&&e.classList.add(t.prefix),t.alignment&&(e.style["text-align"]=t.alignment),t.style_attr?e.setAttribute("style",t.style_attr):e.removeAttribute("style"),t.borders){var n=t.borders.split(",").map(function(e){return"true"==e})
"p"!=me&&ido(e).calc_border(e,n),e.setAttribute("border_sides_arr",n)}if(e.querySelector(".mainfig")&&e.querySelector(".mainfig").hasAttribute("rx")&&t.radius&&(e.querySelector(".mainfig").setAttribute("rx",t.radius),e.querySelector(".mainfig").setAttribute("ry",t.radius)),t.padding&&(e.querySelector("article").style.padding=t.padding),!e.classList.contains("canvas_layer")){var o=e.querySelectorAll("p"),a=t.ps.length
_.forEach(o,function(e,r){r<a&&set_styles_for_copy(e,t.ps[r])}),find_g(e).classList.contains("i_have_a_group")||ido(find_g(e)).size_around_paragraphs(find_g(e))}}function set_styles_for_table_copy(e,t){var r=Object.keys(t)[0],n="row"==r?get_table_row:get_table_col
manage_groups.get_group(e,!0).forEach(function(e){els=n(e)
for(var o=Math.min(t[r].length,els.length),a=0;a<o;a++)set_styles_for_copy(els[a],t[r][a])}),copied_styles_for_table=!1}function random_paragraph_color_mod(e){var t=["brighten","saturate","lighten","desaturate","darken"]
f=t[Math.floor(5*Math.random())]
var r=tinycolor(window.getComputedStyle(e).backgroundColor),n=r[f]()
return n._roundA=parseFloat(Math.random().toPrecision(2)),n}function change_predef_style(e,t,r){set_attr_of_rule(sheet,"."+e,t,r)}function group_to_sub_canvas(){var e=manage_groups.get_current_group()
if(0==e.length)return!1
var t=get_bbox_of_group(e),r=_slicedToArray(t,4),n=r[0],o=r[1],a=r[2],i=r[3],s=o-n+20,_=i-a+20,c=[n-10+s/2,a-10+_/2],l=rect_canvas.make(svg,c,{width:s,height:_})
ido(l).stick_to_me(l,e),manage_groups.reset()}function size_canvas_around_children(e){var t=Array.from(currentElement.querySelectorAll("g[i_am_a]")),r=get_bbox_of_group(t),n=_slicedToArray(r,4),o=n[0],a=n[1],i=n[2],s=n[3],_=a-o+20,c=s-i+20,l=posit2.get_top_left(e),u=_slicedToArray(l,2),d=u[0],p=u[1],f=posit2.get_w_h(e),m=_slicedToArray(f,2),g=m[0],h=m[1]
ungroup_all_children(e),ido(e).reposition_me(e,o-d-10,i-p-10,!0),ido(e).resize_me(d3.select(e),_-g,c-h),ido(e).stick_to_me(d3.select(e),t)}function disperse_group(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1.1,n=get_bbox_of_group(e),o=_slicedToArray(n,4),a=o[0],i=(o[1],o[2])
o[3],e.forEach(function(e){var n=posit2.get_top_left(e,!0),o=_slicedToArray(n,2),s=o[0],_=o[1],s=(s-a)*t+a,_=(_-i)*r+i
ido(e).reposition_me(e,s,_,!1)}),resize_protocol(e[0],0,0)}function add_rect_around_group(e){var t=get_bbox_of_group(e),r=_slicedToArray(t,4),n=r[0],o=r[1],a=r[2],i=r[3],s=.06*(o-n),_=.06*(i-a)
svg.append("rect").attr("class","group_highlight").attr("x",n-s).attr("y",a-_).attr("width",o-n+2*s).attr("height",i-a+2*_).attr("stroke","#e87ab1").attr("stroke-width",parseInt(2/toggle_zoom.get_zoom_factor())).style("opacity",1).style("fill","none")}function add_group_hints(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]
if(remove_highlights(),t)var r=manage_groups.returninternals(),n=Object.keys(r.groups)
else var n=manage_groups.get_groups_of_element(e)
var o=!1
n.forEach(function(e){var t=manage_groups.get_group_from_color(e)
t.length>0&&(o=!0,add_rect_around_group(t))}),o||text_to_feedback_pane("There are no groups")}function remove_highlights(){d3.selectAll(".group_highlight").remove(),d3.selectAll(".shine").classed("shine",!1)}function make_cell(e,t,r,n,o,a){return v=cell_basic.make(svg,[0,0],{width:r,height:n}),ido(v).reposition_me(v.node(),t[0],t[1],!1,!1),v.attr("vt",o+"_"+a),v.attr("table",e),v.node()}function make_table(e){var t=[],r=get_table_dims(),n=r.w,o=r.h,a=_slicedToArray(e,2),i=a[0],s=a[1],c=get_id_for_table()
no_table=!0,_.range(r.nrows).forEach(function(e){var a=[]
_.range(r.ncols).forEach(function(t){var _=[i+t*(n+r.cm),s+e*(o+r.rm)],l=make_cell(c,_,n,o,e,t)
a.push(l)}),t.push(a)}),tables[c]=t}function get_table_dims(){if(cmm.status())var e=parseInt(document.querySelector("#cm_num_rows").value),t=parseInt(document.querySelector("#cm_num_cols").value)
else var e=parseInt(document.querySelector("#form_num_rows").value),t=parseInt(document.querySelector("#form_num_cols").value)
var r=parseInt(document.querySelector("#form_cell_height").value)
return{nrows:e,ncols:t,w:parseInt(document.querySelector("#form_cell_width").value),h:r,rm:parseInt(document.querySelector("#form_row_margin").value),cm:parseInt(document.querySelector("#form_col_margin").value)}}function get_r_c_id_from_cell(e){var t=e.getAttribute("vt").split("_").map(function(e){return parseInt(e)}),r=_slicedToArray(t,2),n=r[0],o=r[1],a=e.getAttribute("table")
return[parseInt(n),parseInt(o),a]}function get_table_row(e){var t=get_r_c_id_from_cell(e),r=_slicedToArray(t,3),n=r[0],o=(r[1],r[2])
return tables[o][n]}function get_table_col(e){var t=get_r_c_id_from_cell(e),r=_slicedToArray(t,3),n=(r[0],r[1]),o=r[2]
return tables[o].map(function(e){return e[n]})}function get_num_rc_from_table(e){return[tables[e].length,tables[e][0].length]}function add_rc_to_group(e){els=manage_groups.get_group(currentElement,!0),manage_groups.reset(!1),els.forEach(function(t){e(t).forEach(function(e){return manage_groups.add(e)})})}function add_rc_to_table(e,t,r,n,o){var a=get_num_rc_from_table(e),i=a,s=_slicedToArray(i,2),c=s[0],l=s[1]
a=a[0==o?1:0],no_table=!0
var u=[]
return _.range(a).forEach(function(o){var a=r(c,l,o),i=_slicedToArray(a,2),s=i[0],_=i[1],d=document.querySelector('g[table="'+e+'"][vt="'+s+"_"+_+'"]')
if(d)var p=posit2.get_top_left(d),f=_slicedToArray(p,2),m=f[0],g=f[1],h=posit2.get_w_h(d),y=_slicedToArray(h,2),v=y[0],b=y[1]
else var x=find_dummy_pos(tables[e],s,_),k=_slicedToArray(x,4),m=k[0],g=k[1],v=k[2],b=k[3]
var w=n(c,l,o),E=_slicedToArray(w,2),s=E[0],_=E[1],A=make_cell(e,t(m,g,v,b),v,b,s,_)
u.push(A)}),u}function table_update(e){var t=Array.from(e.querySelectorAll("g[table]"))
s=Array.from(new Set(t.map(function(e){return e.getAttribute("table")}))),s.forEach(function(t){var r=get_id_for_table()
d3.select(e).selectAll("g[table="+t+"]").attr("table",r),reconstruct_table(r)})}function reconstruct_table(e){var t=Array.from(document.querySelectorAll("g[table="+e+"]")),r=t.map(function(e){return e.getAttribute("vt").split("_")}).reduce(function(e,t){return e[0].push(parseInt(t[0])),e[1].push(parseInt(t[1])),e},[[],[]]),n=_slicedToArray(r,2),o=n[0],a=n[1]
max_r=Math.max.apply(void 0,o)+1,max_c=Math.max.apply(void 0,a)+1
var i=[]
_.range(max_r).forEach(function(t){var r=[]
_.range(max_c).forEach(function(n){var o=document.querySelector('g[table="'+e+'"][vt="'+t+"_"+n+'"]')||make_table_dummy_node(t,n,e)
r.push(o)}),i.push(r)}),tables[e]=i}function make_table_dummy_node(e,t,r){var n=document.createElement("span")
return n.setAttribute("table",r),n.setAttribute("vt",e+"_"+t),n.classList.add("dummy_cell"),n}function find_dummy_pos(e,t,r){function n(e,t){for(var r=t.length,n=1;n<t.length;n++){var a=t[(e+n)%r]
if(!a.classList.contains("dummy_cell")&&a!=o)return a}return!1}var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=n(t,e.map(function(e){return e[r]})),i=n(r,e[t]),s=_=l=c=0,s=posit2.get_top_left(a)[0],_=posit2.get_top_left(i)[1],c=posit2.get_w_h(i)[1],l=posit2.get_w_h(a)[0]
return[s,_,l,c]}function get_cell_pos(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]
if(e.classList.contains("dummy_cell")){var r=get_r_c_id_from_cell(e),n=_slicedToArray(r,3),o=n[0],a=n[1],i=n[2],s=find_dummy_pos(tables[i],o,a,e),_=_slicedToArray(s,4),c=_[0],l=_[1],u=_[2],d=_[3]
return t?[c,l,u,d]:[c,l]}var p=posit2.get_top_left(e),f=_slicedToArray(p,2),c=f[0],l=f[1]
if(t){var m=posit2.get_w_h(e),g=_slicedToArray(m,2),u=g[0],d=g[1]
return[c,l,u,d]}return[c,l]}function get_rows_cols_of_grouped_cells(e){var t=manage_groups.get_group(e,!0).map(function(e){var t=get_r_c_id_from_cell(e)
return t[2]=e,t})
return[_.groupBy(t,function(e){return e[0]}),_.groupBy(t,function(e){return e[1]})]}function find_new_pos_for_moved_cell(e){var t=posit2.get_top_left(e),r=_slicedToArray(t,2),n=r[0],o=r[1],a=get_r_c_id_from_cell(e),i=_slicedToArray(a,3),s=i[0],c=i[1]
i[2],row=table_with_pos[s].filter(function(e,t){return t!=c}).map(function(e){return e[0]})
var l=_.sortedIndex(row,n),u=table_with_pos.map(function(e){return e[c]}).filter(function(e,t){return t!=s}).map(function(e){return e[1]})
return[_.sortedIndex(u,o),l,s,c]}function swap_cells(e,t){function r(e,t){if(e.classList.contains("dummy_cell"))return!0
d3.select(e).transition().duration(300).attr("transform",function(){return n(this,t)})}function n(e,t){var r=posit2.get_trans(e)
return r.translate=t,posit2.set_trans(e.id,r),transform_to_string(r)}var o,a=_slicedToArray(e,4),i=a[0],s=a[1],c=a[2],l=a[3],u=Math.sign(i-c),d=Math.sign(s-l),p=t[c][l],f=table_with_pos[i][s]
if(d){o=table_with_pos[c][l]
var m=[c,l]
_.range(l+d,s+d,d).forEach(function(e){var n=t[c][e]
r(n,o),n.setAttribute("vt",m.join("_")),t[m[0]][m[1]]=n,m=[c,e],o=table_with_pos[c][e]})}u&&(o||(o=table_with_pos[c][l],m=[c,l]),_.range(c+u,i+u,u).forEach(function(e){var n=t[e][s]
r(n,o),n.setAttribute("vt",m.join("_")),t[m[0]][m[1]]=n,m=[e,s],o=o=table_with_pos[e][s]})),r(p,f),p.setAttribute("vt",i+"_"+s),t[i][s]=p}function table_to_cols(e){var t=tables[e],r=_.range(t[0].length).map(function(e){return[]})
return t.forEach(function(e){e.forEach(function(e,t){return r[t].push(e)})}),r}function set_borders_of_group_of_cells(e,t){cells=manage_groups.get_group(currentElement,!0)
var r=get_rows_cols_of_grouped_cells(t),n=_slicedToArray(r,2),o=n[0],a=n[1]
max_col=Math.max.apply(null,Object.keys(a)),max_row=Math.max.apply(null,Object.keys(o)),min_col=Math.min.apply(null,Object.keys(a)),min_row=Math.min.apply(null,Object.keys(o))
var i=o[min_row].map(function(e){return e[2]}),s=o[max_row].map(function(e){return e[2]}),_=a[max_col].map(function(e){return e[2]}),c=a[min_col].map(function(e){return e[2]})
cells.forEach(function(e){var t=r=n=o=!1,t=-1!=i.indexOf(e),r=-1!=_.indexOf(e),n=-1!=s.indexOf(e),o=-1!=c.indexOf(e)
ido(e).calc_border(e,[t,r,n,o])})}function make_table_from_existing_shapes(e){var t=manage_groups.get_current_group(),r=t.filter(function(e){return"rect_basic"==iama(e)}),r=t.filter(function(e){return!e.classList.contains("i_am_grouped")})
return r.length<2?(text_to_feedback_pane(["can only make tables from rect basic","you can morph shape to rect basic from the shape menu"]),!1):!!place_existing(r)&&(manage_groups.reset(),!0)}function place_existing(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]
return get_placer_to_table(e,parseInt(document.querySelector("#form_col_margin").value),parseInt(document.querySelector("#form_row_margin").value)).make_table(t)}function get_shapes_in_table(e){var t=[]
return tables[e].forEach(function(e){t=t.concat(e)}),t.filter(function(e){return!e.classList.contains("dummy_cell")})}function unmake_table(e){tables[e].forEach(function(e){e.forEach(function(e){e.setAttribute("i_am_a","rect_basic"),e.removeAttribute("vt"),e.removeAttribute("table")})}),delete tables[e]}function set_row_height(e){var t=get_table_row(e),r=Math.max.apply(void 0,t.map(function(e){return posit2.get_w_h(e)[1]}))
t.forEach(function(e,t){e.classList.contains("dummy_cell")||ido(e).resize_me(d3.select(e),0,r-posit2.get_w_h(e)[1])})}function set_col_width(e){var t=get_table_col(e),r=Math.max.apply(void 0,t.map(function(e){return posit2.get_w_h(e)[0]}))
t.forEach(function(e,t){e.classList.contains("dummy_cell")||ido(e).resize_me(d3.select(e),r-posit2.get_w_h(e)[0],0)})}function alter_id(e,t){e.attr("id",e.attr("id")+t)}function fill_example_figs(){var e=d3.select("body").select("#shapes_svg").append("g").attr("id","example_fig").attr("transform","scale(0.275)")
!function(t,r,n){for(var o=_.keys(t),a=0;a<o.length;a++){var i=object_mapper[o[a]],s=i.make(e,t[o[a]][0],void 0,o[a])
alter_id(s,"_example"),s.style("stroke-width","4px"),s.style("stroke","#CF5544"),s.style("fill","white"),s.classed("example_fig",!0),s.attr("transform",s.attr("transform")+" scale("+t[o[a]][1]+")"),s.select(".mainfig").on("click",null),s.select(".mainfig").on(".drag",null),s.select(".catcher").remove(),s.select(".mainfig").classed("no-drag",!0),s.classed("L1",!1),s.on("click",function(e,t){return function(){n(e,t)}}(o[a],s.node())),s.select(".mainfig").call(drag_warning)}}(fig_to_pos,0,select_shape)
var e=d3.select("body").select("#example_fig")
e.select('g[i_am_a="icon_basic"]').select("text").attr("font-family","FontAwesome").attr("font-size","25px").text(selected_icon).style("stroke-width","1px").style("fill","black"),e.select('g[i_am_a="text_basic"]').select("text").style("stroke-width","0px").style("fill","black"),add_math_basic_as_example_fig(e,select_shape)
var t=d3.select('#shapes_svg  g[i_am_a="graph_basic"]')
t.select(".x_axis").style("stroke-width","5px"),t.select(".y_axis").style("stroke-width","5px"),t.append("line").attr({x1:0,y1:0,x2:250,y2:250}).style("stroke-width","8px"),d3.select('#shapes_svg  g[i_am_a="axes_board"]').select(".x_axis").style("stroke-width","7px")}function select_shape(e,t){if(MORPH){if(!prev_element||d3.select(prev_element).classed("example_fig"))return text_to_feedback_pane("first choose valid element to morph",!1,!0),MORPH=!1,!1
if("text_basic"==e||"icon_basic"==e)return text_to_feedback_pane("cannot morph to text or icon",!1,!0),MORPH=!1,!1
var r
manage_groups.get_group(prev_element,!0).forEach(function(t){var n=manage_groups.remove_element_if_present(t)
r=ido(t).morph(d3.select(t),e),n.length>0&&manage_groups.add_element_to_multiple_groups(n,r.node())}),MORPH=!1,text_to_feedback_pane("morphed to "+e),currentElement=r.node()}else selected_figure=object_mapper[e],pick_me_example(t),currentElement=document.querySelector("#mainsvg"),text_to_feedback_pane("selected: "+e+" Double click canvas to add",!1,!1)
prev_element=void 0}function change_path_flow_and_style(e,t,r){var n=!!currentElement&&d3.select(currentElement).classed("connection")
n&&set_path_attrs(d3.select(currentElement)),e?(cpa.flow=t||"fluid",currentElement&&(cpa.type=currentElement.getAttribute("type"),cpa.custom_flow=null,currentElement.removeAttribute("custom_flow")),currentElement.firstChild.getAttribute("style"),active_line_flow=cpa.flow):(cpa.type=r||"plain",currentElement&&(cpa.flow=currentElement.getAttribute("flow")),active_line_style=cpa.type),n&&(copy_path(currentElement,!0),currentElement.querySelector(".arrow_0, .arrow_1")&&color_add_ons(d3.select(currentElement))),form_update&&update_open_fs(currentElement)}function add_end_figs_for_path_to_buttons(){for(var e=document.querySelectorAll(".form_path_end_fig .svg_holder"),t=0;t<e.length;t++){var r=Object.keys(path_end_figs)[t%6],n=e[t]
!function(e){n.onclick=function(){(currentElement.classList.contains("arrow_1")||currentElement.classList.contains("arrow_0"))&&(currentElement=currentElement.parentElement)
var t=""
t=this.hasAttribute("side")?this.getAttribute("side"):document.querySelector("#side_of_path").innerText.toLowerCase()
var r="head"==t?1:0
path_end_fig=e,cpa.octo_flipped&&(t="tail"==t?"head":"tail")
var n
"path_group"==iama(currentElement)?(n=!cpa["arrow_"+t]||cpa["arrow_"+t]&&cpa["arrow_"+t]!=path_end_fig,change_path_end_fig(t,n)):(n=!currentElement.querySelector(".arrow_"+r))?ido(currentElement).add_shape_to_line(currentElement,r,path_end_fig):d3.select(currentElement.querySelector(".arrow_"+r)).remove(),n?($(".if-arrow").css("display","block"),set_currentElement(currentElement.querySelector("g.arrow_"+r)),display_fs_for_shape(currentElement),cmm.status()?currentElement=cpa.path_g:gui.frame_element(currentElement)):$(".if-arrow").css("display","none")}}(r),n=n.querySelector("svg"),path_end_figs[r].func(d3.select(n).append("g"),10,17,[2,12],!0).attr("style",path_end_figs[r].style).style("pointer-events","none")}}function change_halo(e){d3.select("#shapes_svg").selectAll(".halo").remove(),append_halo(e)}function append_halo(e){var t=d3.select(e),r=parseFloat(t.attr("width"))+10,n=parseFloat(t.attr("height"))+10
t.append("rect").attr("height",n).attr("width",r).attr("transform","translate(-5,-5)").classed("filter","true").classed("halo","true").style("fill","none").style("stroke","#A217BB").style("stroke-width",6)}function fill_example_css_styles(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:27,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:18,a=e.append("g").attr("class","example_styles"),i=0;i<colors.length;i++){var s="style_"+i
a.append("rect").attr({restore_sel:!0,x:t+(n+5)*(i%6),y:r+(o+6)*parseInt(i/6),width:n,height:o,class:s}).on("contextmenu",function(){currentElement=this,set_color_picker(this),cmm.position_and_display(200,175,"#cm-predef-styles",!1,!1),predef_styles.set_cm_for_predef_style(this.classList[0]),d3.event.preventDefault(),d3.event.stopPropagation()}).on("click",function(){var e=this,t=d3.select(this)
if(d3.event.ctrlKey){if("path_group"==iama(currentElement)&&"double"==currentElement.getAttribute("type")){var r=window.getComputedStyle(currentElement.querySelector(".inner_path")),n=window.getComputedStyle(currentElement.querySelector(".mainpath"))
set_attr_of_rule(sheet,"."+t.attr("class"),"fill",r.stroke),set_attr_of_rule(sheet,"."+t.attr("class"),"stroke",n.stroke),set_attr_of_rule(sheet,"."+t.attr("class"),"stroke-width",parseInt(n.strokeWidth)-parseInt(r.strokeWidth))}else{var o=window.getComputedStyle(currentElement)
set_attr_of_rule(sheet,"."+t.attr("class"),"fill",o.fill),set_attr_of_rule(sheet,"."+t.attr("class"),"stroke",o.stroke),set_attr_of_rule(sheet,"."+t.attr("class"),"stroke-width",o.strokeWidth),set_attr_of_rule(sheet,"."+t.attr("class"),"color",o.color),["line-height","text-align","font-family"].forEach(function(e){predef_styles.find_current_style(+t.attr("class"),e)&&set_attr_of_rule(sheet,"."+t.attr("class"),e,o[e])})}d3.select(currentElement).attr("style",null)
var a=find_current_style_class(currentElement)
a&&currentElement.classList.remove(a),currentElement.classList.add(t.attr("class")),text_to_feedback_pane("style updated")}else{"P"==currentElement.tagName&&check_for_range_when_p_form_action()
var i=set_color_picker(t.node())
if(-1!=["B","I","U","Q","P"].indexOf(currentElement.tagName))manage_groups.get_group(currentElement,!0).forEach(function(e){set_style_class_to_predef(e,t.attr("class"),d3.event.shiftKey)})
else if(drag_for_drawing)path_basic.styles.stroke=i.toRgbString()
else{if(me=iama(currentElement),currentElement.classList.contains("arrow_1")||currentElement.classList.contains("arrow_0")){type=currentElement.getAttribute("type")
var s=find_rule(sheet,function(t){return sheet.cssRules[t].selectorText=="."+e.classList[0]}).style
return fill=s.sty,currentElement.style.strokeWidth=s["stroke-width"],"filled"in path_end_figs[type]?(currentElement.style.fill=s.fill,currentElement.style.stroke=s.stroke):currentElement.style.stroke=s.fill,!1}if(!me||"knot"==me)return selected_figure.my_style_classes=[t.attr("class")],document.querySelector("#shapes_svg").querySelector("g[i_am_a="+selected_figure.my_name+"]"),text_to_feedback_pane("changed default style of  "+selected_figure.my_name,!1,!0),!1
"path_group"==me?manage_groups.get_group(currentElement,!0).forEach(function(e){copy_style_class_to_path_group(e,t.attr("class")),color_add_ons(d3.select(e))}):"path_basic"==me||"x_axis"==me||"y_axis"==me||"line_for_graph"==me?manage_groups.get_group(currentElement,!0).forEach(function(e){color_stroke_only||"x_axis"==me||"y_axis"==me||"line_for_graph"==me?(copy_style_class_to_path_group(e,t.attr("class")),"path_basic"==me&&color_add_ons(d3.select(e))):(set_style_class_to_predef(e,t.attr("class")),"path_basic"==me&&color_add_ons(d3.select(e)))}):for_group&&manage_groups.element_in_active_group(currentElement)?manage_groups.to_list().forEach(function(e){set_style_class_to_predef(e,t.attr("class"),d3.event.shiftKey),use_par_offset_colors&&e.querySelector("p")&&_.forEach(e.querySelectorAll("p"),function(t){change_color_test(random_paragraph_color_mod(e),t)})}):(set_style_class_to_predef(currentElement,t.attr("class"),d3.event.shiftKey),use_par_offset_colors&&currentElement.querySelector("p")&&_.forEach(currentElement.querySelectorAll("p"),function(e){change_color_test(random_paragraph_color_mod(currentElement),e)})),check_for_change_click_catcher_color(currentElement)}gui.add_marker_to_example_style(currentElement)}})}}function set_style_class_to_predef(e,t){clear_style_attributes(get_el_style_class(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),t),e.classList.remove("custom_style"),e.removeAttribute("border_sides_arr"),e.classList.contains("rough")&&roughing.roughen_if_needed(e)}function map_path_styles(e,t){return e.type==t?e:("plain"==t?"double"==e.type?(e["stroke-width"]=e.inner_width,e["stroke-dasharray"]=e["inner_stroke-dasharray"]):e.stroke=e.fill:"double"==t?"plain"==e.type?(e.inner_width=e["stroke-width"],e["stroke-width"]=parseFloat(e["stroke-width"])+2+"px",e["inner_stroke-dasharray"]=e["stroke-dasharray"],e.inner_stroke="white"):(e.inner_stroke=e.fill,e.inner_width=e["stroke-width"],e["stroke-width"]=parseFloat(e["stroke-width"])+2+"px"):"plain"==e.type?(e.fill=e.stroke,e.stroke="black"):(e["stroke-width"]=e.inner_width,e.fill=e.inner_stroke),e)}function set_path_style_attributes(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.querySelector(".mainpath"),o=e.getAttribute("type")
if(t=map_path_styles(t,o),e.style["stroke-dasharray"]=t["stroke-dasharray"],delete t["stroke-dasharray"],Object.keys(t).forEach(function(e){return n.style[e]=t[e]}),r&&(n.style.strokeWidth=path_specs[o].style["stroke-width"]),"double"==o){var a=e.querySelector(".inner_path")
a.style.stroke=t.inner_stroke,a.style.strokeWidth=t.inner_width,a.style["stroke-dasharray"]=t["inner_stroke-dasharray"],a.style.fill="none",n.style.fill="none",e.style["stroke-dasharray"]=null}}function get_text_block_style_attributes(e){function t(e,t){r[t]={},r[t].font_class=find_current_font_class(e),r[t].style_class=find_current_style_class(e),r[t].styles=window.getComputedStyle(e)}var r={}
return r.me="text_block",t(e,"g"),t(e.querySelector("rect"),"rect"),t(e.querySelector("text.mainfig"),"text"),r}function set_text_block_style(e,t){function r(e,t,r){var n=r(e)
n&&e.classList.remove(n),e.classList.add(t)}var n=e
t.g.font_class&&r(n,t.g.font_class,find_current_font_class),t.g.style_class&&r(n,t.g.style_class,find_current_style_class),["font-family","font-size"].forEach(function(e){return n.style[e]=t.g.styles[e]})
var n=e.querySelector("rect")
t.rect.font_class&&r(n,t.rect.font_class,find_current_font_class),t.rect.style_class&&r(n,t.rect.style_class,find_current_style_class),["stroke-width","stroke","stroke-dasharray","fill"].forEach(function(e){return n.style[e]=t.rect.styles[e]})
var n=e.querySelector("text.mainfig")
t.text.font_class&&r(n,t.text.font_class,find_current_font_class),t.text.style_class&&r(n,t.text.style_class,find_current_style_class),["stroke-width","stroke","stroke-dasharray","fill"].forEach(function(e){return n.style[e]=t.text.styles[e]}),object_mapper.text_block.resize_text(d3.select(e))}function get_path_style_attributes(e){var t={},r=["fill","stroke","stroke-width","stroke-dasharray","stroke-opacity","opacity"],n=window.getComputedStyle(e.querySelector(".mainpath"))
if(r.forEach(function(e){return t[e]=n[e]}),t["stroke-dasharray"]=t["stroke-dasharray"]||"inherit","double"==e.getAttribute("type")){var o=window.getComputedStyle(e.querySelector(".inner_path"))
t.inner_stroke=o.stroke,t.inner_width=o["stroke-width"],t["inner_stroke-dasharray"]=o["stroke-dasharray"]}return t.type=e.getAttribute("type"),t}function copy_style_class_to_path_group(e,t){var r=find_rule(sheet,function(e){return sheet.cssRules[e].selectorText=="."+t}).style,n=e.getAttribute("type"),o=e.querySelector(".mainpath"),a=find_current_style_class(e)
if(a&&e.classList.toggle(a),"plain"==n)o.style.stroke=r.fill
else if("double"==n){var i=e.querySelector(".inner_path")
o.style.stroke=r.stroke,i.style.stroke=r.fill,color_add_ons(d3.select(e))}else"octopus"==n?(o.style.stroke=r.stroke,o.style.fill=r.fill):(e.style.stroke=r.fill,e.style.fill="rgba(255, 255, 255, 0)")
e.classList.toggle(t,!0)}function css_rule_to_inline(e,t){for(var r=find_rule(sheet,function(e){return sheet.cssRules[e].selectorText=="."+t}),n=0;n<r.style.length;n++){var o=r.style[n]
e.style[o]||(e.style[o]=r.style[o])}}function from_style_class_to_custom_class(e,t){e.classList.toggle(t,!1),e.classList.toggle("custom_style"),css_rule_to_inline(e,t)}function set_class_on_element(e,t,r){var n=r(e)
n&&e.classList.remove(n),e.classList.add(t)}function find_class(e,t){for(var r=e.classList,n=0;n<r.length;n++)if(t(r[n]))return r[n]
return!1}function find_current_font_class(e){var t=/font[0-9]+/
return find_class(e,function(e){return e.match(t)})}function find_current_style_class(e){if(e.classList.contains("custom_style"))return"custom_style"
var t=/style_[0-9]+/
return find_class(e,function(e){return e.match(t)})||find_class(e,function(e){return-1!=classes.indexOf(e)})}function get_w_h_of_text_in_par(e){function t(e,t){return t.map(function(t){return parseInt(e[t])}).filter(function(e){return!isNaN(e)}).reduce(function(e,t){return e+t},0)}var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.querySelector("#dummy_p_measure")
r&&(n.style.width=r+"px")
var o=[]
return e.forEach(function(e){var r=document.createElement("span")
r.style.float="left",r.style.clear="both",r.innerText=e.innerText
var a=window.getComputedStyle(e);["fontFamily","fontSize","padding","margin"].forEach(function(t){return r.style[t]=e.style[t]||a[t]}),n.appendChild(r)
var i=$(r).width()+t(r.style,["paddingLeft","paddingRight","marginLeft","marginRight"]),s=$(r).height()+t(r.style,["paddingTop","paddingBottom","marginTop","marginBottom"])
o.push([i,s])}),$(n).children().remove(),n.style.width="400px",n.style.height="",[Math.max.apply(null,o.map(function(e){return e[0]})),o.map(function(e){return e[1]}).reduce(function(e,t){return e+t})]}function get_el_style_class(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2]
if("text_block"==e.getAttribute("i_am_a")){var n=e.querySelector(".text_block_background")
return d3.select(n).attr("class",t+" text_block_background"),n}var o=find_current_style_class(e)
if(o&&e.classList.toggle(o),e.classList.toggle(t),r&&t in predef_styles.extra.font_sizes){var a=find_current_font_class(e)
a&&e.classList.toggle(a,!1),e.classList.add(predef_styles.extra.font_sizes[t])}return e}function change_class_of_selected_figure(){var e=this.getAttribute("class"),t=d3.select("body").select("#shapes_svg")
selected_figure.my_style_classes=[e],t.select('g[i_am_a="'+selected_figure.my_name+'"]').attr("class",e)}function open_tab(e,t){var r,n
for(n=document.getElementsByClassName("modal_tab"),r=0;r<n.length;r++)n[r].style.display="none"
document.getElementsByClassName("tablink"),document.getElementById(t).style.display="block",e&&"A"!=e.target.tagName&&(d3.selectAll("#save_load_modal h2").style("display","none"),document.querySelector("#modal_"+t).style.display="block")}function add_font_awesome_icons(){function e(){selected_icon=this.textContent,icon_basic.set_text(selected_icon),d3.selectAll(".selected_example_icon").classed("selected_example_icon",!1),this.setAttribute("class","selected_example_icon"),d3.select("#shapes_svg").select('g[i_am_a="icon_basic"]').select("text").text(selected_icon),icon_to_change&&(d3.select(currentElement).select("text").text(selected_icon),icon_basic.resize_text(d3.select(currentElement)))}var t=_.keys(FONT_AWESOME)
for(t=t.sort(),j=0;j<cats.length;j++){var r=d3.select(cats[j])
for(items=indeling[j],i=0;i<items.length;i++){var n=40*parseInt(i/30)+50,o=i%30*40+50
r.append("g").attr("transform","translate("+o+","+n+")").append("text").attr("font-family","FontAwesome").attr("font-size","25px").attr("my_name",t[items[i]]).text(function(e){return FONT_AWESOME[t[items[i]]]}).on("click",e).on("dblclick",function(){close_modal("icon_modal")})}}}function display_gui_element_info(e){if(!help_on)return!1
"g"!=e.tagName&&(e=e.parentElement),"gui_rotate"==e.id?text_to_help_pane("rotate button: click, hold and drag to rotate shape",!1,!1):"gui_resize"==e.id?text_to_help_pane(["resize button: click, hold and drag to resize shape","Or hold control and press arrow keys","Double click to auto-size shape around text","Double click while holding shift to only change height"],!1,!1):"gui_connect"==e.id&&text_to_help_pane("connect button: click, hold and drag to over other shape to connect",!1,!1)}function add_math_basic_as_example_fig(e,t){var r=["M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z","M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z","M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"],n=e.append("g").attr("transform","translate(350,850) scale(1,-1)").attr("id","mathBasic_example").attr("i_am_a","math_basic").attr("width",100).attr("height",100).attr("class","mainfig")
n.append("path").attr("transform","scale(0.10)").attr("d",r[0])
var o=n.append("g").attr("class","mainfig").attr("transform","scale(0.10) translate(859,412)  scale(0.707)")
o.append("path").attr("d",r[1]),o.append("path").attr("transform","translate(500,0)").attr("d",r[2]),n.append("rect").attr("width",175).attr("height",100).on("mousedown",function(e,r){return function(){mathjax_loaded||load_math_jax(),t("math_basic",r)}}(0,n.node())).style("fill","rgba(0,0,0,0)").call(drag_warning),n.classed("example_fig",!0),n.classed("no-drag",!0),n.select(".mainfig").classed("no-drag",!0),n.classed("L1",!1),n.select(".mainfig").call(drag_warning),n.on("click",function(e,r){return function(){mathjax_loaded||load_math_jax(),t("math_basic",r)}}(0,n.node()))}function load_math_jax(){return new Promise(function(e,t){$.getScript("https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js",function(){mathjax_loaded=!0,MathJax.Hub.Config({extensions:["tex2jax.js"],jax:["input/TeX","output/SVG"]}),e()})})}function get_info_for_map(){for(var e=get_svg_children(document.querySelector("#mydefs")),t=[],r=0;r<e.length;r++)e[r].classList.contains("permanent")||t.push(parse_g(e[r]))
return{load_mathjax:mathjax_loaded,svg_color:document.querySelector("#mainsvg").style["background-color"],pos:document.querySelector("#zoomfield").getAttribute("transform"),styles:get_styles_of_classes(),extra_styles:predef_styles.extra,default_style_of_shapes:get_default_style_of_shapes(),version:VERSION,groups:manage_groups.save(),map_name:current_map_name,datetime:(new Date).toUTCString(),slides:{order:slide_manager.save_slides()},defs:t,grid:[mdd,parseInt(document.querySelector("#form_grid_lines_dx input").value),parseInt(document.querySelector("#form_grid_lines_dy input").value),document.querySelector("#grid")?1:0,catcher_width],rough:roughing.get_current_settings()}}function svg_to_json(e,t){if(manage_groups.unshow_my_group(),t&&t.length>0)var r=t
else var r=_.filter(get_svg_children(document.querySelector(e)),function(e){return"g"==e.tagName&&!e.classList.contains("plumb-group")&&"grid"!=e.id})
gs=[]
for(var n=0;n<r.length;n++)gs.push(parse_g(r[n]))
var o={gs:gs,info:get_info_for_map()}
return manage_groups.show_my_group(),o}function parse_g(e){var t=get_attributes(e),r=e.tagName
if("P"==r&&(r="xhtml:p"),"ARTICLE"==r&&(r="xhtml:article"),t.element=r,"P"==e.tagName||"text"!=e.tagName&&"textPath"!=e.tagName&&"tspan"!=e.tagName||(a=_.filter(e.childNodes,function(e){return 3==e.nodeType}),a.length>0&&(t.innerText=a[0].textContent.replace(/"/g,"'"))),"P"==e.tagName){var n=e.childNodes
t.children=[]
for(var o=0;o<n.length;o++)if(3==n[o].nodeType)t.children.push({element:"textnode",innerText:n[o].textContent,attrs:{}})
else{var i=n[o].tagName.toLowerCase()
if("b"==i||"i"==i||"u"==i||"q"==i||"a"==i){var r=get_attributes(n[o]),s=$.extend(r,{element:"xhtml:"+i,innerText:n[o].textContent},!0)
t.children.push(s)}}}else{if("graph_basic"==iama(e)||"axes_board"==iama(e)){var c=function(e){return{element:"axis",attrs:{ax:e.classList.contains("x_axis")?"x":"y",num_ticks:e.getAttribute("num_ticks"),transform:e.getAttribute("transform")},style:x_axis.get_styling(d3.select(e))}},n=Array.from(get_svg_children(e))
n=n.filter(function(e){return!(e.classList.contains("axis")||e.classList.contains("gridlines"))}),t.children=[c(e.querySelector(".x_axis")),c(e.querySelector(".y_axis"))]}else{var n=get_svg_children(e)
t.children=[]}if(0!=n.length)for(var o=0;o<n.length;o++){var i=n[o].tagName.toUpperCase()
"BR"==i||n[o].classList.contains("roughened")||t.children.push(parse_g(n[o]))}t.attrs.i_am_a&&"line_for_graph"==t.attrs.i_am_a&&t.children.forEach(function(e){e.attrs.d&&(e.attrs.d="")}),t.attrs.i_am_a&&"math_basic"==t.attrs.i_am_a&&(t.children=[])}return t}function getChildren(e){e.childNodes&&_.forEach(e.childNodes,function(e){return getChildren(e)})}function get_attributes(e){for(var t={attrs:{}},r=e.attributes,n=0;n<r.length;n++)"href"==r[n].name?t.attrs["xlink:"+r[n].name]=r[n].value:t.attrs[r[n].name]=r[n].value
return delete t.innerHTML,"style"in t&&(t.style=get_styles_from_string(t.style)),t}function get_styles_from_string(e){for(var t=e.split(";"),r={},n=0;n<t.length-1;n++){var o=t[n].replace(/\s+/g,""),a=o.split(":")
r[a[0]]=a[1]}return r}function start_adding(e,t,r,n,o){return add_me(e,t,r,n,o)}function add_me(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[]
try{me_=t.attrs.i_am_a||me_}catch(e){return!1}if(n&&exclude_from_pres_mode.find(function(e){return e==me_}))return!1
if("textnode"==t.element)return e.node().appendChild(document.createTextNode(t.innerText)),!1
if("axis"==t.element)return object_mapper[me_].add_axes_on_reload(e,t)
var a=e.append(t.element).attr(t.attrs).style(t.styles)
return"math_basic"==me_?(math_basic.trigger_math(a,t.attrs.raw_mj,!0),a):(r||(_.has(t,"text")&&a.text(t.text),_.has(t,"innerText")&&a.text(t.innerText),"xhtml:p"==t.element?n?a.node().removeAttribute("contenteditable"):object_mapper[find_g(a.node()).getAttribute("i_am_a")].add_paragraph_events(a):-1!=["xhtml:u","xhtml:i","xhtml:b","xhtml:q"].indexOf(t.element)&&(a.node().onclick=par_child_click_handler),"textPath"==t.element&&a.text(t.innerText)),me_ in object_mapper&&(object_mapper[me_].svg_fig==t.element||"catcher"==me_)&&(void 0==object_mapper[me_].drag||n||object_mapper[me_].add_drag(a),void 0!=object_mapper[me_].events&&(n&&"expander"==me_?object_mapper[me_].add_events(a):n||object_mapper[me_].add_events(a))),a.classed("connection")&&!n&&(a.on("click",path_click_handler),a.on("dblclick",path_double_click_handler)),!a.classed("endpoint_from")&&!a.classed("endpoint_to")||n||a.call(end_point_move),r&&"g"==t.element&&a.attr("id",Fig.prototype.next_id()),t.children&&t.children.forEach(function(e){add_me(a,e,!1,n)}),n&&a.on("click",function(){currentElement=find_g(this),d3.event.stopPropagation()}),a.classed("connection")&&1==t.attrs.on_top&&o.push(a.node()),"line_for_graph"==iama(a)&&a.select(".catcher").on(".drag",null),a)}function create_temp_svg(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg","svg")
return r.setAttribute("width",e),r.setAttribute("height",t),r.setAttribute("style",document.querySelector("#mainsvg").getAttribute("style")),r}function add_single_map_to_preview(e,t){var r=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments[3]),n=e,o=t.append("div").attr("id",n+"_map").attr("class","load_preview"),a=o.append("label")
a.append("h5").text(n),a.append("input").attr("type","radio").attr("name","local_maps").attr("id",n).attr("value",n),r.gs.filter(function(e){return"math_basic"==e.attrs.i_am_a}).length>0&&text_to_feedback_pane("cannot make preview for "+e+". Contains math figure"),o.node().onclick=function(e){_.forEach(document.querySelectorAll(".load_preview"),function(e){return e.classList.remove("load_selected")}),e.currentTarget.classList.add("load_selected")},o.node().setAttribute("title",r.info.datetime)}function remove_single_map_from_preview(e){var t=document.querySelector("#"+e+"_map")
return t&&t.remove(),!0}function get_default_style_of_shapes(){var e={}
return Object.keys(fig_to_pos).forEach(function(t){e[t]=object_mapper[t].my_style_classes}),e}function set_default_style_to_shapes(e){Object.keys(e).forEach(function(t){object_mapper[t].my_style_classes=e[t]
var r=document.querySelector("#shapes_svg").querySelector("g[i_am_a="+t+"]")
r&&set_style_class_to_predef(r,e[t][0])})}function check_if_data_is_valid(e){if("gs"in e&&(e=e.gs),"[object Array]"!=Object.prototype.toString.call(e))return text_to_feedback_pane("nothing to load found in file",!1,!0),!1
if(0==e.length)return!1
var t=Object.keys(e[0])
return!!_.all(["attrs","element","children"].map(function(e){return!!t.find(function(t){return t==e})}))||(text_to_feedback_pane("unknown data in json file. cannot parse",!1,!0),!1)}function check_if_data_is_tree(e){var t=["decision","left","right","id","pos","text"]
return _.all(t.map(function(t){return t in e}))}function clean_defs(){d3.selectAll("#mainsvg defs > *:not(.permanent)").remove()}function load_data(e,t){function r(){if(!n){var r=find_highest_id_and_prefix(svg.selectAll("g")[0],"_"),_=_slicedToArray(r,2),c=_[0],l=_[1]
"z"==c&&text_to_feedback_pane("expect problems. No more unique ids because of loading to many maps",!1,!0)
var u="defs"in s?s.defs:"",d=get_new_ids(e,String.fromCharCode(c.charCodeAt(0)+1),u),p=_slicedToArray(d,2)
e=p[0],u=p[1],"defs"in s&&(s.defs=u)}if(o)var f=o
else{n&&svg.selectAll("g").remove()
var f=n?svg:svg.append("g").attr("class","loaded")}var m=[]
if(e.forEach(function(e){start_adding(f,e,!1,t,m)}),m.forEach(function(e){return move_element_to_top(e)}),for_group=!1,t&&(d3.select("#mainsvg").on("dblclick",null),document.body.onkeydown=document.body.onkeyup=null),!n){var g=f.selectAll("g")[0]
g.forEach(function(e){i_am_a_indy_shape(e)&&(move_element_to_top(e),manage_groups.add(e))})}var h=find_highest_id_and_prefix(svg.selectAll("g")[0],"_"),y=_slicedToArray(h,2),c=y[0],l=y[1]
if(Fig.prototype.next_id=next_id_gen("_",l+1),l>9998){var v=get_new_id_prefix_and_num(),b=_slicedToArray(v,2),x=b[0],k=b[1]
Fig.prototype.next_id=next_id_gen(x,k)}if(posit2.reset(),s&&set_info_on_load(s,f,a,n),last_used_gist_id=!1,!a&&svg.node().querySelectorAll(".flippable").length>0&&(document.querySelector(".form_study_mode").style.display="block"),a||(n?table_init():table_update(f.node())),f.node().classList.contains("loaded")){var g=direct_child_only_selector(f.node(),"g"),w=svg.node()
g.forEach(function(e){w.appendChild(e)}),f.remove()}country_basic.init_score(),a||posit2.load_shapes_pos(),load_formulas(),recalc_axes_boards(),roughing.update_rough_shapes_on_load(),text_to_feedback_pane("done loading map "+s.map_name),i&&start_pres_after_load()}var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5]
if(t?(document.querySelector("#edit_mode_menu").classList.add("menu_hidden"),document.querySelector(".form_study_mode").classList.add("menu_hidden")):a||(document.querySelector("#edit_mode_menu").classList.remove("menu_hidden"),document.querySelector(".form_study_mode").classList.add("menu_hidden")),n&&!a&&slide_manager.clear_all_slides(),n&&clean_defs(),!check_if_data_is_valid(e))return text_to_feedback_pane("aborting load",!1,!0),!1
var s
try{if("info"in e){s=e.info
var c="version"in e.info?e.info.version:"20160101"
s=parse_info_to_current_version(s,c),e=parse_to_current_version(validate_gs(e.gs),c)}else e=_.contains(Object.keys(e),"gs")?parse_to_current_version(validate_gs(e.gs),"20160101"):parse_to_current_version(validate_gs(e),"20160101")}catch(e){return text_to_feedback_pane("map contains unknown entities. Load aborted"),!1}"load_mathjax"in s&&s.load_mathjax?(p=load_math_jax(),p.then(function(){return r()})):r()}function recalc_axes_boards(){svg.selectAll('g[i_am_a="axes_board"]')[0].forEach(function(e){axes_board.resize_me(d3.select(e),0,0,!1),Array.from(e.querySelectorAll(".axis")).forEach(function(e){e.parentElement.appendChild(e)})}),svg.selectAll('g[i_am_a="graph_basic]')[0].forEach(function(e){axes_board.resize_me(d3.select(e),0,0,!1)})}function start_pres_after_load(){slide_manager.check_if_slides_present()&&(quick_tut.end(),toggle_slide_edit_menu(),slide_manager.start_slide_show(!0,!0,"fade",!0))}function i_am_a_indy_shape(e){if(!e.hasAttribute("i_am_a"))return!1
var t=iama(e)
return"path_group"!=t&&"text_block"!=t&&"text_path"!=t&&"knot"!=t}function get_bbox_of_group(e){var t=minY=1/0,r=maxY=0,n=["path_group","text_block","text_path"]
return e.forEach(function(e){if(e.hasAttribute("i_am_a")&&!n.find(function(t){return t==iama(e)})){var o=abs_pos_to_bbox(e)
t=Math.min(t,o.left),minY=Math.min(minY,o.top),r=Math.max(r,o.right),maxY=Math.max(maxY,o.bottom)}}),[t,r,minY,maxY]}function abs_pos_to_bbox(e){var t=_slicedToArray(posit2.get_trans(e,!0,!1).translate,2),r=t[0],n=t[1],o=posit2.get_w_h(e),a=_slicedToArray(o,2),i=a[0],s=a[1]
return{top:n,bottom:n+s,left:r,right:r+i,width:i,height:s}}function parse_info_to_current_version(e,t){if(t<"20160823"&&"styles"in e){var r=e.styles
e.styles=r.map(function(e){if(e.match(/fill-opacity/)){var t=e.split(";"),r=t[1].split(":")[1]
t.splice(1,1)
var n=t[0].match(/[0-9]+\.*[0-9]*/g)
3==n.length&&n.push(r)
var o="fill: rgba("+n.join(", ")+")"
return t[0]=o,t.join(";")}return e})}return e}function parse_to_current_version(e,t){if(t<"20160523")for(var r=0;r<e.length;r++)e[r].attrs.class.match(/connection/)&&(e[r].attrs.class=e[r].attrs.id+" connection",e[r].attrs.id+="_0")
if(t<"20160620")for(var r=0;r<e.length;r++)e[r].attrs.class.match(/connection/)&&(e[r].attrs.i_am_a="path_group")
if(t<"20160710"){for(var n=function(e,t,r){var n=function(e){var t=e.attrs.class.split(" "),r=t.filter(function(e){return-1!=classes.indexOf(e)||e.match(/style_/)})
return r.forEach(function(t){return e.attrs.class=e.attrs.class.replace(t,"")})," "+r.join(" ")}(t)
e.attrs.class+=n,r||(e.attrs.style=t.attrs.style,delete t.attrs.style)},r=0;r<e.length;r++)"id"in e[r].attrs&&function e(t){if("class"in t.attrs){var r=t.attrs.class
t.attrs.class=r.replace(/(_)([0-9]{3})/g,function(e,t,r){return t+"0"+r})}"id"in t.attrs&&(t.attrs.id=t.attrs.id.replace(/(_)([0-9]{3})/g,function(e,t,r){return t+"0"+r})),get_svg_children(t).forEach(function(t){e(t)})}(e[r])
for(var r=0;r<e.length;r++){var o=e[r]
if("g"==o.element)try{if("path_group"==o.attrs.i_am_a){var a=o.children.find(function(e){return"text_path"==e.attrs.i_am_a})
a&&n(a,a.children[1],!0)}o.hasOwnProperty("children")&&o.children[0].attrs.hasOwnProperty("class")&&o.children[0].attrs.class.match(/mainfig/)&&n(o,o.children[0])}catch(e){console.log(o)}}}if(t<"20160722"){for(var i=[],r=0;r<e.length;r++)i[r]=function e(t){var r={attrs:t.attrs,styles:t.styles,element:t.element}
if(Object.keys(t).forEach(function(e){"children"!=e&&(r[e]=t[e])}),"foreignObject"==t.element){r.children=[{element:"xhtml:article",attrs:{},children:[]}]
var n=r.children[0]}else var n=r
if("children"in t){"children"in n||(n.children=[])
for(var o=0;o<t.children.length;o++)n.children[n.children.length]=e(t.children[o])}return r}(e[r])
e=i}if(t<"20160921"){var s=function e(t,r){"cp_helper"==t.attrs.i_am_a&&_(t,r),t.children.forEach(function(r){return e(r,t)})},_=function(e,t){var r=t.attrs.i_am_a
if("poly_points"==r)return!1
var n=parseInt(t.attrs.width),o=parseInt(t.attrs.height)
e.attrs={"stroke-width":"11",class:"catcher",i_am_a:"catcher",style:"stroke-dasharray: 0; stroke: rgba(35, 109, 239, 0.9);"}
var a=object_mapper[r].calc_catcher_attrs(n,o)
for(var i in a)e.attrs[i]=a[i]
e.element=object_mapper[r].svg_fig}
e.forEach(function(e){return s(e)})}if(t<"20171108"){var c=JSON.stringify(e)
c=c.replace(/&nbsp;/g," "),c=c.replace(/innerHTML/g,"innerText"),c=c.replace(/<b class='medium-b'>/g,""),c=c.replace(/<i class='medium-i'>/g,""),c=c.replace(/<u class='medium-u'>/g,""),c=c.replace(/<\/b>/g,""),c=c.replace(/<\/i>/g,""),c=c.replace(/<\/u>/g,""),e=JSON.parse(c)}return e}function set_info_on_load(e,t,r,n){var o=d3.select(find_svg(t.node()))
if(document.querySelector("#mainsvg").style["background-color"]=e.svg_color,"pos"in e&&toggle_zoom.set_start_for_load(e.pos),"styles"in e&&set_styles_of_classes(e.styles),"defs"in e){var a=o.select("#mydefs")
a.empty()&&(a=o.append("defs")),e.defs.forEach(function(e){a.append("path").attr("d",e.attrs.d).attr("id",e.attrs.id)})}if("groups"in e&&!r&&n&&manage_groups.load(e.groups),"map_name"in e&&!r&&"tut_short.json"==(current_map_name=e.map_name)){var i=new Date
i.setTime(i.getTime()+5184e6)
var s="expires="+i.toUTCString()
document.cookie="tut_seen=true;"+s}"slides"in e&&!r&&n&&e.slides.order.length>0&&slide_manager.load_slides(e.slides.order),"grid"in e&&!r&&($("#form_grid_delta input").val(e.grid[0]).trigger("change"),$("#form_grid_lines_dx input").val(e.grid[1]).trigger("change"),$("#form_grid_lines_dy input").val(e.grid[2]).trigger("change"),e.grid[3]&&$("#form_toggle_grid_lines").trigger("click"),$("#form_catcher_width input").val(e.grid[4]).trigger("change")),"extra_styles"in e&&!r&&n&&(predef_styles.extra=e.extra_styles),"default_style_of_shapes"in e&&!r&&n&&set_default_style_to_shapes(e.default_style_of_shapes),"rough"in e&&!r&&n&&roughing.load_settings(e.rough)}function allow_paragraph_drop(e){e.preventDefault()}function drag_paragraph(e){e.ctrlKey?"P"==e.target.tagName?(e.dataTransfer&&e.dataTransfer.mozSetDataAt&&e.dataTransfer.mozSetDataAt("element",0,"something"),e.target.setAttribute("draggable",!0),dragged_item=e.target):"P"==e.currentTarget.tagName&&(e.currentTarget.setAttribute("draggable",!0),dragged_item=last_selection_for_split):dragged_item=!1}function drop_paragraph(e){if(dragged_item){e.preventDefault()
var t=find_where_to_place_dragged_paragraph(e)
if(svg==t||t.classList.contains("canvas_layer")){var r=corrected_mouse_position([e.clientX,e.clientY])
Fig.prototype.split_of_paragraph(dragged_item,!1,r)}else object_mapper[iama(t)].add_existing_paragraph(t,dragged_item,e)
"tagName"in dragged_item?dragged_item.removeAttribute("draggable"):dragged_item.anchorNode.parentElement.removeAttribute("draggable"),dragged_item=!1,e.stopPropagation()}else e.target.removeAttribute("draggable")
key_pressed=[]}function find_where_to_place_dragged_paragraph(e){var t=document.elementFromPoint(e.clientX,e.clientY)
return t.classList.contains("overlay")?svg:find_g(t)}function find_highest_id_and_prefix(e,t){ids_dict=find_highest_ids_per_prefix(e)
var r="@",n="0000"
return Object.keys(ids_dict).forEach(function(e){r=get_max(e,r),n=get_max(n,ids_dict[e])}),t?t in ids_dict?[r,parseInt(ids_dict[t])]:[r,0]:[r,parseInt(ids_dict[r])]}function get_new_ids(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=JSON.stringify(e),o=JSON.stringify(r),a=function(e){var r=/"id":"([_|A-z][0-9]{4})"/g,n=[],o={}
get_new_id=next_id_gen(t,0)
for(var a=!0;a=r.exec(e);)n.push(a[1])
return n=n.sort(),n.forEach(function(e){o[e]=get_new_id()}),o}(n)
return Object.keys(a).forEach(function(e){var t=new RegExp(e,"g")
n=n.replace(t,a[e]),o=o.replace(t,a[e])}),[JSON.parse(n),JSON.parse(o)]}function select_text_in_paragraph(e){function t(e){for(;3!==e.nodeType;){var t=e.childNodes
if(0==t.length)return!1
e=t[0]}return e}if(0==e.innerText.length)return!1
var r=e.childNodes,n=t(r[0]),o=t(r[r.length-1]),a=document.createRange()
a.setStart(n,0),a.setEnd(o,o.textContent.length)
var i=window.getSelection()
return i.removeAllRanges(),i.addRange(a),!0}function saveSelection(){if(window.getSelection){if(sel=window.getSelection(),sel.getRangeAt&&sel.rangeCount)return sel.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange()
return null}function restoreSelection(e){e&&(window.getSelection?(sel=window.getSelection(),sel.removeAllRanges(),sel.addRange(e)):document.selection&&e.select&&e.select())}function clone_range(e){var t=["collapsed","commonAncestorContainer","endContainer","endOffset","startContainer","startOffset"],r={}
return t.forEach(function(t){return r[t]=e[t]}),r}function clone_to_range(e){var t=["collapsed","commonAncestorContainer","endContainer","endOffset","startContainer","startOffset"]
return range=new Range,t.forEach(function(t){return range[t]=e[t]}),range.setStart(e.startContainer,e.startOffset),range}function deepFreeze(e){return Object.getOwnPropertyNames(e).forEach(function(t){var r=e[t]
"object"==(void 0===r?"undefined":_typeof(r))&&null!==r&&deepFreeze(r)}),Object.freeze(e)}function setEndOfContenteditable(e){var t,r
t=document.createRange(),t.selectNodeContents(e),t.collapse(!1),r=window.getSelection(),r.removeAllRanges(),r.addRange(t)}function set_val_to_cookie(e,t,r){var n=new Date
n.setTime(n.getTime()+24*r*60*60*1e3)
var o="expires="+n.toUTCString()
document.cookie=e+"="+t+";"+o}function find_val_in_cookie(e){var t=document.cookie,r=t.split(";").map(function(e){return e.split("=").map(function(e){return e.trim()})}),n=r.find(function(t){return t[0]==e})
return!!n&&n[1]}function check_for_link(e){if("P"==!e.tagName)return!1
var t=e.querySelector("a")
return!!t&&(!t.hasAttribute("href")||t.getAttribute("href"))}function add_click_event_to_gist_link(){$(".gist_link").on("click",function(e){e.preventDefault()
var t=e.target.id
load_data(gist_data[t],pres_mode,new_map_for_load),last_used_gist_id=t,close_modal("save_load_modal")}),hide_wait_spinner()}function prep_modal_gist_edit(){is_user_logged_in()?document.querySelector("#modal_github_save_section").style.display="block":document.querySelector("#modal_github_save_section").style.display="none",last_used_gist_id&&is_user_logged_in()&&get_user_name()==gist_data[last_used_gist_id].owner?(document.querySelector("#modal_gist_edit input").value=last_used_gist_id,document.querySelector("#modal_gist_edit").style.display="block"):(document.querySelector("#modal_gist_edit input").value="",document.querySelector("#modal_gist_edit").style.display="none")}function check_if_map_empty(){return!document.querySelector("#zoomfield g[i_am_a]")}function set_slides_buttons(e,t,r,n,o){document.querySelector("#form_add_slide").classList.toggle("hidden",!e),document.querySelector("#form_make_slide").classList.toggle("hidden",!t),document.querySelector("#form_update_slide").classList.toggle("hidden",!r),document.querySelector("#form_hide_slide").classList.toggle("hidden",!n),document.querySelector("#form_delete_slide").classList.toggle("hidden",!o),document.querySelector("#slides_form_hide_shapes").style.display=r?"block":"none"}function make_slide_handler(e){"slide"!=iama(currentElement)||currentElement.classList.contains("existing")?text_to_feedback_pane("active element not a new slider"):(slide_manager.add_slide(currentElement),set_slides_buttons(!0))}function scale_to_viewport(e,t,r,n){return Math.max(e/r,t/n)}function update_slide_menu(e){document.querySelector("#form_delete_slide").classList.remove("hidden"),e.classList.contains("existing")?(document.querySelector("#form_make_slide").classList.add("hidden"),document.querySelector("#form_update_slide").classList.remove("hidden"),document.querySelector("#form_hide_slide").classList.remove("hidden")):(document.querySelector("#form_make_slide").classList.remove("hidden"),document.querySelector("#form_update_slide").classList.add("hidden"),document.querySelector("#form_hide_slide").classList.add("hidden"))}function parse_json_data(e){e=JSON.parse(e),check_if_data_is_valid(e)?load_data(e,!1,!1,hook=!1,!1,!1):text_to_feedback_pane("not recognized as map or tree",!1,!0)}function get_placer(e,t,r){function n(n){var a
if(n>0&&n%max_rc_before_break==0){if(write_colwise){var i=Math.max.apply(null,o.map(function(e){return e.right}))
a=[i+t/2+delta_x_import,e.bottom+r/2]}else{var i=Math.max.apply(null,o.map(function(e){return e.bottom}))
a=[e.left+t/2,i+r/2+delta_y_import]}return o=[],a}return a=0==o.length?e:o[o.length-1],write_colwise?[a.left+t/2,a.bottom+r/2+delta_y_import*(0!=n)]:[a.right+t/2+delta_x_import*(0!=n),a.top+r/2]}var e={left:e[0],right:e[0],top:e[1],bottom:e[1]},o=[]
return{get_new_pos:n,store_pos:function(e){o.push(e)}}}function parse_text_data(e){if(splitter_for_text_primary=get_splitter_text_primary(),splitter_for_text_parsing=get_splitter_text(),splitter_for_text_primary){var t=e.split(splitter_for_text_primary)
t=t.filter(function(e){return 0!=e&&""!=e&&""!=e})}else t=[e]
var r,n=(last_pos[0],last_pos[0],last_pos[1],last_pos[1],selected_figure.dims.width||100),o=selected_figure.dims.height||50,a=get_placer(last_pos,n,o),i=[]
tag_import=document.querySelector("#form_import_tag").value,show_wait_spinner("","parsing "+t.length+"lines"),setTimeout(function(){t.forEach(function(e,t){if(e.match(/[a-zA-Z0-9]+/)){r=a.get_new_pos(t)
var n=selected_figure.make(svg,r).node()
if("text_basic"!=selected_figure.my_name&&"icon_basic"!=selected_figure.my_name&&add_extra_styles_to_new_el(n),"text_basic"==selected_figure.my_name&&d3.select(n).select("text").text(""),splitter_for_text_parsing)var o=e.split(splitter_for_text_parsing).filter(function(e){return 0!=e&&""!=e&&""!=e})
else var o=[e];(auto_number_import||tag_import)&&(tag_import?selected_figure.add_paragraph(n,tag_import+" "+(t+1).toString()):selected_figure.add_paragraph(n,(t+1).toString())),o.forEach(function(e){return selected_figure.add_paragraph(n,e)}),"text_basic"==selected_figure.my_name?selected_figure.resize_text(d3.select(n)):selected_figure.size_around_paragraphs(n,!1,!0),tlbr=posit2.tlbr(n),a.store_pos(tlbr),i.push(n)}}),i.length>2&&i.forEach(function(e){manage_groups.toggle_element(e)}),hide_wait_spinner(),console.log("Done parsing")},50)}function check_if_background_img_possible(e){return"P"==e.tagName||(e=find_g(e),!d3.select(e).select("foreignObject").empty()&&"zoomfield"!=e.id)}function add_background_image(e,t){if(t=t||selected_background.querySelector("img").getAttribute("src"),check_if_background_img_possible(find_target_for_image(e)))art="P"==e.tagName?e:e.querySelectorAll("article:not(.collapsed)")[0]
else if("P"!=e.tagName)return console.log("can not add background to this element"),!1
e.querySelector("rect")&&(art.style.borderRadius=e.querySelector("rect").getAttribute("rx")+"px")
var r=new Image
r.src=t,r.onload=function(e,t){return function(){e.style["background-image"]="url("+t+")",e.style["background-size"]="cover",e.style["background-repeat"]="no-repeat",e.classList.add("has_background"),e.setAttribute("img_ratio",this.width+"/"+this.height)}}(art,t)}function xml_data_to_map(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=delta_x_import,a=delta_y_import
if("text"in e&&e.text.length>0){var i=rect_basic.make(svg,[250,250]).node()
e.text.forEach(function(e){return rect_basic.add_paragraph(i,e)}),set_style_class_to_predef(i,"style_"+n),rect_basic.size_around_paragraphs(i),rect_basic.reposition_me(i,t,r)
var s=posit2.get_top_left(i),_=posit2.get_bottom_right(i)}else var s=[t,r],_=[t,r]
return t=Math.max(_[0],t),e.children&&e.children.forEach(function(e,r){if(0==r){var i=xml_data_to_map(e,s[0],_[1]+a,n+1),c=_slicedToArray(i,2),l=c[0]
c[1]}else{var u=xml_data_to_map(e,t+o,_[1]+a,n+1),d=_slicedToArray(u,2),l=d[0]
d[1]}t=Math.max(l,t)}),[t,r]}function flatten_tree(e,t){function r(e,t){e.level=t,e.text.length>0&&n.push(e),t+=1,e.children.forEach(function(e){return r(e,t)})}var n=[]
return r(e,t),n}function arr_to_map(e,t){var r,n=_slicedToArray(t,2),o=n[0],a=n[1],s=get_placer([o,a],rect_basic.dims.width,rect_basic.dims.height)
return e.forEach(function(e,t){r=s.get_new_pos(t)
var n=selected_figure.make(svg,r).node()
set_style_class_to_predef(n,"style_"+e.level),e.text=e.text.filter(function(e){return""!=e.trim()}),e.text.forEach(function(e){return rect_basic.add_paragraph(n,e)}),rect_basic.size_around_paragraphs(n,!1,!0),s.store_pos(posit2.tlbr(n))}),s.get_new_pos(i)}function item_is_string(e){return"string"==typeof e}function item_is_array(e){return"[object Array]"===Object.prototype.toString.call(e)}function clean_arr_of_text(e){for(var t=[],r=0;r<e.length;r++){var n=e[r]
item_is_string(n)&&t.push(n),item_is_array(n)&&(test=clean_arr_of_text(n),test&&t.push(test))}return t.length>1?t:1==t.length?t[0]:void 0}function handle_docx_file(e){JSZip.loadAsync(e).then(function(e){e.files["word/document.xml"].async("string").then(function(e){xml_data_to_map(xml_parser.parse_xml(e),500,500)})},function(e){console.log(e)})}function handle_docx_paste_event(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=find_blob_of_type("application/vnd.openxmlformats-officedocument.wordprocessingml.document",e,t)
null!==r&&handle_docx_file(r)}function handle_json_drop_event(e,t){var r=find_blob_of_type("application/json",e,t)
if(null!==r){var n=new FileReader
n.onload=function(e){parse_json_data(e.target.result)},n.readAsText(r)}}function handle_unknown_file(e,t){var r=find_blob_of_type("",e,t)
if(null!==r){var n=new FileReader
n.onload=function(e){var t=r.name.split(".").slice(-1)[0]
"json"==t?parse_json_data(e.target.result):"xdot"==t?graphviz.make(e.target.result):text_to_feedback_pane("File extension of"+r.name+" unkown")},n.readAsText(r)}}function handle_text_drop_event(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2]
if("string"==e[0].kind)e[0].getAsString(parse_text_data)
else{var n=find_blob_of_type(t,e,r)
if(null!==n){var o=new FileReader
o.onload=function(e){parse_text_data(e.target.result)},o.readAsText(n)}}}function handle_svg_drop_event(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=find_blob_of_type(t,e,r)
if(null!==n){var o=new FileReader
o.onload=function(e){object_mapper.svg_icon.import(e.target.result)},o.readAsText(n)}}function handle_pdf_drop_event(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=fetch("../static/js/pdf.js").then(function(e){return e.text()}).then(function(e){var t=document.createElement("script")
return t.type="text/javascript",t.text=e,new Promise(function(e,r){try{e(document.body.appendChild(t))}catch(e){r(e)}})}),o=new FileReader,a=new Promise(function(t,n){var a=find_blob_of_type("application/pdf",e,r)
a?(o.onload=function(e){t(e)},o.readAsArrayBuffer(a)):n("geen blob")})
Promise.all([n,a,t,r]).then(function(e){var t=_slicedToArray(e,4)
t[0],t[1],t[2],t[3],text_to_feedback_pane("parsing pdf, please wait"),PDFJS.workerSrc="https://npmcdn.com/pdfjs-dist/build/pdf.worker.js",a.then(function(e){return PDFJS.getDocument(e.target.result)}).then(function(e){var t=e.numPages
if(startpage=1,endpage=t,t>30)throw"to many pages: aborting"
for(var r=startpage;r<endpage+1;r++)e.getPage(r).then(function(e){var t=e.pageNumber-1,r=e.view[2],n=e.view[3]
return Promise.all([e.objs,e.getTextContent(),e.getOperatorList(),r,n,t,e.commonObjs,e.getViewport(1)])}).then(function(e){var t=_slicedToArray(e,8),r=(t[0],t[1]),n=(t[2],t[3]),o=t[4],a=t[5]
if(t[6],t[7],r.items.length>500)throw"page "+a+" has to many items to render"
pdf_parser.do(r.items,r.styles,n,o,a)}).catch(function(e){text_to_feedback_pane(e),console.log("error making page",e)})}).catch(function(e){text_to_feedback_pane(e),console.log(e)})}).catch(function(e){text_to_feedback_pane(e),console.log("error",e),hide_wait_spinner()})}function handle_pic_paste_event(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2]
if(!check_if_background_img_possible(t))return text_to_feedback_pane("cannot add background image to this. Image can only be added to a shape",!1,!0),!1
var n=find_blob_of_type("image",e,r)
if(null!==n){var o=new FileReader
o.onload=function(e){add_background_image(find_target_for_image(t),e.target.result)},o.readAsDataURL(n)}}function find_blob_of_type(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=null,o=0;o<t.length;o++)0===t[o].type.indexOf(e)&&(n=r?t[o]:t[o].getAsFile())
return n}function handle_html_paste_data(e){if("text/html"==e[0].type)var t=e[1],r=e[0]
else var t=e[0],r=e[1]
var n=new Promise(function(e,t){r.getAsString(function(t){return e(t)})}),o=new Promise(function(e,r){t.getAsString(function(t){return e(t)})})
Promise.all([n,o]).then(function(e){m=e.map(function(e){return"validator-bn"==e.split(";")[0]}),_.any(m)?(i=m[0]?0:1,pos=e[i].match(/;/).index,bn_data=e[i].slice(pos+1),paste_bn_elements(bn_data)):parse_html_from_clipboard(e)})}function paste_bn_elements(e){var t=JSON.parse(e)
if(1==t.length)el=add_me(svg,t[0],!0,!1).node(),ido(el).reposition_me(el,last_pos[0],last_pos[1],!1)
else{load_data({gs:t,info:{version:VERSION}},!1,!1)
var r=manage_groups.get_current_group(),n=get_bbox_of_group(r),o=_slicedToArray(n,4),a=o[0],i=o[1],s=o[2],_=o[3],c=[(i+a)/2,(_+s)/2],l=last_pos[0]-c[0],u=last_pos[1]-c[1]
r.forEach(function(e){ido(e).reposition_me(e,l,u,!0)})}}function check_if_html_from_doc(e){return!!e.querySelector("style")||!!e.querySelector("meta[name]")}function parse_html_from_clipboard(e){function t(e,t){var r=walk_nodes(e,get_text_from_node,"")
if(r.length>0){var n=clean_arr_of_text(r)
if(n){var o=arr_of_text_to_tree(n),a=flatten_tree(o,0)
new_pos=arr_to_map(a,last_pos),last_pos[1]=new_pos[1]}}}var r=_slicedToArray(e,2),n=r[0],o=r[1],a=document.createElement("div")
if(a.innerHTML=n,check_if_html_from_doc(a))return parse_text_data(o),!1
var i=_.filter(a.children,function(e){return e.parentElement==a&&"META"!=e.tagName})
check_if_nodes_chainable(i)&&(i=[a]),i.forEach(function(e,r){return t(e,r)})}function check_if_nodes_chainable(e){e=_.filter(e,function(e){return 8!=e.nodeType})
var t=_.map(e,function(e){return 3==e.nodeType||chainable_tags.find(function(t){return t==e.tagName.toLowerCase()})})
return _.all(t)}function get_text_from_node(e){return"data"in e&&e.data.trim()?e.data.trim():e.innerText&&e.innerText.trim()?e.innerText.trim():void 0}function walk_nodes(e,t,r){var n=e.childNodes
return 0==n.length?[]:check_if_nodes_chainable(n)?[_.map(n,function(e){return t(e)||r}).join(" ")]:_.map(n,function(e){return 1==e.nodeType?walk_nodes(e,t,r):3==e.nodeType?t(e)||r:void 0})}function arr_of_text_to_tree(e){var t={children:[],text:[]}
if(item_is_string(e))t.text.push(e)
else for(var r=0;r<e.length;r++)item_is_string(e[r])?t.text.push(e[r]):t.children.push(arr_of_text_to_tree(e[r]))
return t}function get_placer_fill_area(e,t,r,n){function o(r){var n,o,p=posit2.get_w_h(r),f=_slicedToArray(p,2),m=f[0],g=f[1],h=c+m<s+i,y=l+g<_+i
h&&a?(n=c+i,o=l,c=n+m,u=Math.max(u,c),d=Math.max(d,l+g)):y&&!a?(n=c,o=l+i,l=o+g,u=Math.max(u,c+m),d=Math.max(d,l)):!h&&a?(n=e,o=d+i,c=n+m,l=o,u=Math.max(u,c),d=Math.max(d,l)):y||a||(n=u+i,o=t,c=n,l=o+g,u=Math.max(u,c),d=Math.max(d,l)),ido(r).reposition_me(r,n+i,o+i)}var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=25,s=e+r,_=t+n
e-=i,t-=i
var c=e,l=t,u=e,d=t
return{position_shape:o}}function get_placer_to_table(e){function t(e){pos=e.map(function(e){return posit2.tlbr(e)}),ids=e.map(function(e){return e.id})
var t=[]
return ids.forEach(function(e,r){pos[r].id=e,t.push(pos[r])}),t}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"top",n=arguments[3],o=e[h][t]
ibefore=h
do{h+=1}while(h<y&&n(e[h][r],o))
return e.slice(ibefore,h)}function n(t,n,o,a,i){h=0
var s=[],c=_.sortBy(t,function(e){return e[o]})
for(a&&c.reverse();h<e.length;)s.push(r(c,n,o,i))
return s}function o(e,t){for(var r=0;r<t.length;r++)if(t[r].includes(e))return r
return!1}function a(e,t,r,n){return e.forEach(function(e){var o=t-e[r]
e[n]+=o}),Math.max.apply(null,e.map(function(e){return e[n]}))}function i(e,t,r,n,o,s){0==r&&(s=Math.min.apply(null,t[0].map(function(e){return e[n]}))),e.push(s),new_max=a(t[r],s,n,o),(r+=1)<t.length&&i(e,t,r,n,o,new_max)}function s(t,r){var n={}
return e.forEach(function(e){return n[e.id]=[o(e.id,t),o(e.id,r)]}),n}function c(e){var t={}
return Object.values(e).forEach(function(e){e in t?t[e]+=1:t[e]=1}),t}function l(e){return Object.values(e).reduce(function(e,t){return e+(1!=t?t:0)},0)}function u(t){var r=_slicedToArray(t,4),n=r[0],a=r[1],s=r[2],_=r[3],c=[],l=[]
i(c,n,0,"top","bottom"),i(l,a,0,"left","right")
var u,d,p,f
e.forEach(function(e){u=o(e.id,s),d=o(e.id,_),p=c[u]+u*g,f=l[d]+d*m,ido(e).reposition_me(e,f,p)})}function d(){var r,o,a,i,_=t(e),u=n(_,"bottom","top",!1,function(e,t){return e<t}),d=n(_,"top","bottom",!0,function(e,t){return e>t}),p=n(_,"right","left",!1,function(e,t){return e<t}),f=n(_,"left","right",!0,function(e,t){return e>t}),m=u.map(function(e){return e.map(function(e){return e.id})}),g=p.map(function(e){return e.map(function(e){return e.id})}),h=d.map(function(e){return e.map(function(e){return e.id})}),y=f.map(function(e){return e.map(function(e){return e.id})}),v=s(m,g),b=s(h,y),x=s(m,y),k=s(h,g),w=[v,b,x,k].map(function(e){return c(e)}),E=w.map(function(e){return l(e)}),A=["ab","cd","ad","cb"],S=Math.min.apply(null,E),A=A[E.indexOf(S)]
return"cd"==A?(r=d.reverse(),o=f.reverse(),a=h.reverse(),i=y.reverse()):"ad"==A?(r=u,o=f.reverse(),a=m,i=y.reverse()):"cb"==A?(r=d.reverse(),o=p,a=h.reverse(),i=g):"ab"==A&&(r=u,o=p,a=m,i=g),[[r,o,a,i],S]}function p(t,r){var n={}
return e.forEach(function(e){return n[e.id]=[0,0]}),t.forEach(function(e,t){return e.forEach(function(e){return n[e][0]=t})}),r.forEach(function(e,t){return e.forEach(function(e){return n[e][1]=t})}),console.log(n),n}function f(e){return Object.values(e).map(function(e){return e.toString()}),pos_to_ids={},Object.keys(e).forEach(function(t){var r=e[t].toString()
r in pos_to_ids||(pos_to_ids[r]=[]),pos_to_ids[r].push(t)}),pos_to_ids}var m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,h=0
e=e.filter(function(e){return"path_group"!=iama(e)})
var y=e.length
return{place:function(){var e=d()
u(e[0]),0!=e[1]&&text_to_feedback_pane("some shapes overlaying")},make_table:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=d(),n=_slicedToArray(r,2),a=_slicedToArray(n[0],4),i=a[0],s=a[1],c=a[2],l=a[3]
if(0!=n[1]){text_to_feedback_pane(["failed. Positions overlapping. cannot make table","Some cells will be overlapping after making a table","move shapes that overlap and try again","or use align > table first to make a layout to actually                    see overlapping shapes"])
var m=f(p(c,l))
return Object.keys(m).forEach(function(e){m[e].length>1&&add_rect_around_group(m[e].map(function(e){return document.getElementById(e)}))}),!1}u([i,s,c,l])
var g=i.length,h=s.length,y=_.range(g).map(function(e){return new Array(h).fill(0)})
return t||(t=get_id_for_table()),e.forEach(function(e){rn=o(e.id,c),cn=o(e.id,l),y[rn][cn]=e,e.setAttribute("i_am_a","cell_basic"),e.setAttribute("vt",rn+"_"+cn),e.setAttribute("table",t)}),y=y.map(function(e,r){return e.map(function(e,n){return e||make_table_dummy_node(r,n,t)})}),tables[t]=y,!0}}}function init_study_one_by_one(e){function t(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1]
y[e][0]=t?Math.max(y[e][0]-1,0):Math.min(y[e][0]+1,p),y[e][1]=0,Object.keys(y).filter(function(t){return t!=e}).forEach(function(e){y[e][1]+=1})}function r(){var e=_.range(0,p+1).map(function(e){return[]})
return Object.keys(y).forEach(function(t){var r=[t,y[t]]
e[y[t][0]].push(r)}),e}function n(e){for(var t=0,r=p;r>=0&&!((t+=e[r].length)>h);r--);return r}function o(e,t){for(var r=[],n=1,o=e;o<=p;o++){var a=[]
a=t[o].map(function(e){return[e[0],Math.pow(m,e[1][1])*n]}),n*=f,r=r.concat(a)}return r}function a(){for(var e=r(),t=n(e),a=o(t,e),s=i(a),_=Math.random(),c=0,l=0;l<s.length;l++)if((c+=s[l][1])>_)return s[l][0]
return!1}function i(e){var t=e.reduce(function(e,t){return e+t[1]},0)
return e.map(function(e){return[e[0],e[1]/t]})}function s(e){return _.shuffle(e)}function c(e){var t="<p>Correct answer: "
return e.forEach(function(e){cl=e.added?"added":e.removed?"removed":"correct",e.removed||(t+="<span class="+cl+">"+e.value+"</span>")}),t+="</p>",t+="<p>Your anser:",e.forEach(function(e){cl=e.added?"added":e.removed?"removed":"correct",e.added||(t+="<span class="+cl+">"+e.value+"</span>")}),t+="</p>"}function l(e){var t=check=minus=!1
"start"==e&&(t=!0),!0===e&&(check=!0),e||(minus=!0),document.querySelector("#flash_card_check_res_icon").classList.toggle("fa-square-o",t),document.querySelector("#flash_card_check_res_icon").classList.toggle("fa-check-square-o",check),document.querySelector("#flash_card_check_res_icon").classList.toggle("fa-minus-square-o",minus)}var u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],p=5,f=2,m=1.03
e=e.filter(function(e){return e.classList.contains("flippable")})
var g=e.length
if(e.length<2)return text_to_feedback_pane("need more cards to study. Could not find any at all or just one..."),!1
var h=Math.max(Math.min(g,5),parseInt(g/5)),y={}
if(u&&d)!function(){e.forEach(function(e){y[e.id]=[3,0,0]})}()
else var v=s(e)
var b=-1
document.querySelector("#form_one_by_one_controls").style.display="flex",u?function(){document.querySelector("#input_menu").style.display="block"}():function(){document.querySelector("#input_menu").style.display="none"}()
var x=toggle_zoom.filters[document.querySelector("#form_study_filter").value]
return{next:function(){if(u&&(document.querySelector("#flash_card_val_to_check").value="",document.querySelector("#flash_card_checked_res").innerHTML="",l("start")),d){var e=a()
if(e)var t=document.querySelector("#"+e)
toggle_zoom.fade_callback(),toggle_zoom.center_on_shape(t,x,t,!1,!1,!1,.2*window.innerHeight),currentElement=t,x[1](currentElement)}else b+=1,b<g?(toggle_zoom.fade_callback(),toggle_zoom.center_on_shape(v[b],x,v[b],!1,!1,!1,.2*window.innerHeight),currentElement=v[b],x[1](currentElement)):(text_to_feedback_pane("studied all available flashcards! Restarting"),this.reset())},reset:function(){v=s(e),b=-1,this.next()},flip:function(){var e=currentElement
ido(e).flip_shape(e),reverse&&setTimeout(function(){ido(e).flip_shape(e)},reverse)},get_group:function(){return e},check_answer:function(){var e=document.querySelector("#flash_card_val_to_check").value,r=currentElement.querySelector("article.collapsed").textContent
diff=c(JsDiff.diffChars(e,r)),document.querySelector("#flash_card_checked_res").innerHTML=diff,this.flip(),l(e==r),d&&t(currentElement.id,e==r)}}}function check_triangle(e){var t=e.reduce(function(e,t){return e+t})
return t>150&&t<210}function check_rectangle(e){return res=e.map(function(e){return e>70&&e<110}),_.all(res)}function check_if_point_on_bbox(e,t){function r(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n=t.map(function(e){return[e-r,e+r]}),o=_slicedToArray(n,2),a=_slicedToArray(o[0],2),i=a[0],s=a[1],_=_slicedToArray(o[1],2),c=_[0],l=_[1]
return i<t[0]&&s>t[0]&&c<t[1]&&l>t[1]}var n=_slicedToArray(t,4),o=n[0],a=n[1],i=n[2],s=n[3],c=[o,a],l=[o+i,a],u=[o,a+s],d=[o+i,a+s],c=_.any(e.map(function(e){return r(c,e)})),l=_.any(e.map(function(e){return r(l,e)})),u=_.any(e.map(function(e){return r(u,e)})),d=_.any(e.map(function(e){return r(d,e)}))
return[c,l,u,d]}function get_points_on_path(e){var t=path_to_array(e),r=[]
if(t.length<5)r=[t[0],t[t.length-1]]
else{var r=[]
r.push(t[0])
for(var n=3;n<t.length-3;n+=3)r.push(t[n])
r.push(t[t.length-1])}return r.map(function(e){return[e.x,e.y]})}function get_angles(e){var t=e,r=e.slice(1).concat([e[0]]),n=e.slice(2).concat(e.slice(0,2))
return _.zip(t,r,n).map(function(e){var t=_slicedToArray(e,3),r=t[0],n=t[1]
return angle_between_points(r,t[2],n)})}function angle_between_points(e,t,r){var n=_slicedToArray(e,2),o=n[0],a=n[1],i=_slicedToArray(t,2),s=i[0],_=i[1],c=_slicedToArray(r,2),l=c[0],u=c[1],d=[o-l,a-u],p=[s-l,_-u],f=Math.sqrt(d[0]*d[0]+d[1]*d[1]),m=Math.sqrt(p[0]*p[0]+p[1]*p[1]),g=d[1]*p[1]+d[0]*p[0]
return 180*Math.acos(g/(f*m))/Math.PI}function clear_close_points(e){combos=_.zip(e,e.slice(1).concat([e[0]]))
var t=combos.map(function(e){var t=_slicedToArray(e,2),r=t[0],n=t[1]
return Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2)})
return e.filter(function(e,r){return t[r]>300})}function clear_straights(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:35
return e.filter(function(e){return e-180<-t&&e+180>t})}function find_changes(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:35,r=[]
r.push(e[0])
for(var n=1;n<e.length;n++)Math.abs(e[n]-e[n-1])>t&&r.push(e[n])
return r.length>1&&Math.abs(r[0]-r[r.length-1])<15&&(r=r.slice(0,-1)),r.map(function(e){return Math.round(e)})}function make_drawn_path(e,t,r,n){var o=drawn_line_to_bezier(t,200),t=drawn_line_to_bezier(t,1),a=clear_close_points(get_points_on_path(t)),i=get_angles2(a.slice(0,2)),s=get_angles2([a[a.length-2],a[a.length-1]]),_=get_side_from_angle(i[0],!0),c=get_side_from_angle(s[0],!1),l=posit2.get_top_left(e,!0),u=guess_pos_on_side(r,add_vec2(a[0],l),_),d=guess_pos_on_side(n,add_vec2(a.slice(-1)[0],l),c),p=r.id>n.id
if(p){var f=[n,r]
r=f[0],n=f[1]
var m=[c,_]
_=m[0],c=m[1]
var g=[d,u]
u=g[0],d=g[1]}var h={from_side:_,to_side:c,fixed_side:!0,flow:"fluid",pos1:u,pos2:d};[r,n].forEach(function(e){return make_new_connection(d3.select(e),!0,h)})
var y=cpa.path_g,v=path_to_array(o)
p&&v.reverse(),d3.select(y).attr("custom_flow",get_path_custom_flow_attrs(v)).attr("fixed_side","true"),y.querySelector(".mainpath").style.strokeWidth=path_basic.styles["stroke-width"],y.querySelector(".mainpath").style.stroke=path_basic.styles.stroke,d3.select(e).remove(),resize_protocol(r,0,0),document.querySelector("#form_draw_recog_del").classList.remove("hidden")}function add_vec2(e,t){return[e[0]+t[0],e[1]+t[1]]}function guess_pos_on_side(e,t,r){var n=ido(e).get_bbox_of_figure(d3.select(e),!0,!0),o=_slicedToArray(n,4),a=o[0],i=o[1],s=o[2],_=o[3]
return r%2==0?(t[0]-a)/s:(t[1]-i)/_}function get_side_from_angle(e,t){return t?e>=45&&e<135?0:e>=225&&e<315?2:e>=135&&e<225?3:1:e>=225&&e<315?0:e>=135&&e<225?1:e>=45&&e<135?2:3}function get_angles2(e){function t(e){var t=_slicedToArray(e,2),n=t[0],o=t[1]
if(dx=o[0]-n[0],dy=-(o[1]-n[1]),0==dx)return 1==Math.sign(dy)?90:270
if(0==dy)return 1==Math.sign(dx)?0:180
var a=dy/dx,i=180*Math.atan(a)/Math.PI
return(i=i>0?i:90+i)+90*r(Math.sign(dx),Math.sign(dy))}function r(e,t){return 1==e&&1==t?0:-1==e&&1==t?1:-1==e&&-1==t?2:1==e&&-1==t?3:void 0}var n=_.zip(e.slice(0,-1),e.slice(1))
return n=n.map(function(e,r){return t(e)}),n.map(function(e){return e>340?360-e:e})}function point_is_inside(e,t){for(var r=e[0],n=e[1],o=!1,a=0,i=t.length-1;a<t.length;i=a++){var s=t[a][0],_=t[a][1],c=t[i][0],l=t[i][1]
_>n!=l>n&&r<(c-s)*(n-_)/(l-_)+s&&(o=!o)}return o}function find_largest_rect(e){function t(e,t){_[c].one=e,_[c].two=t,c+=1}function r(){return c-=1,[_[c].one,_[c].two]}function n(t){e[t].forEach(function(e,t){return s[t]=e?s[t]+1:0})}var o={one:0,two:0},a={one:-1,two:-1},i=0,s=[],_=[],c=0,l=e[0].length,u=e.length
return function(){var e,c
for(e=0;e<l+1;e+=1)_[e]={one:0,two:0},s[e]=0
for(c=0;c<u;c+=1){var d=0
for(n(c),e=0;e<l+1;e+=1)if(s[e]>d&&(t(e,d),d=s[e]),s[e]<d){var p,f,m
do{var g=r(),h=_slicedToArray(g,2)
p=h[0],f=h[1],m=d*(e-p),m>i&&(i=m,o.one=p,o.two=c,a.one=e-1,a.two=c-d+1),d=f}while(s[e]<d)
0!=(d=s[e])&&t(p,f)}}return[o.one,o.two,a.one,a.two]}()}function build_initial_index(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=svg.node().querySelectorAll("g[i_am_a]")
return index=lunr(function(){e||this.pipeline.remove(lunr.stopWordFilter),this.ref("name"),this.field("text"),t.forEach(function(e){var t=this
e.querySelector("text")?this.add({name:e.id,text:e.querySelector("text").textContent}):e.querySelectorAll("p").forEach(function(r,n){t.add({name:e.id+" "+n,text:r.innerText})},this)},this)}),index}function show_search_form(){document.querySelector("#search_form").style.display="block",document.querySelector("#search_form_search_value").value="",document.querySelector("#search_results").innerHTML="",document.querySelector("#search_form_search_value").focus(),document.querySelector("#search_form_search_value").onkeydown=document.querySelector("#search_form").onkeydown=function(e){27==e.keyCode&&hide_search_form()}}function hide_search_form(e){document.querySelector("#search_form").style.display="none"}function find_search_results(e){var t=build_initial_index(document.querySelector("#filter_stopwords").checked)
res=t.search(e)
var r=document.querySelector("#search_results")
r.innerText="",0==res.length&&(r.innerText="No results found"),res.forEach(function(t){var n=t.ref.split(" "),o=_slicedToArray(n,2),a=o[0],i=(o[1],document.querySelector("#"+a))
text=Object.keys(t.matchData.metadata)[0]
var s=make_search_result_paragraph(e,text,t.score)
s.onclick=function(e){var t=find_g(i)
toggle_zoom.center_on_shape(t,!1,!1,document.querySelector("#search_flyover").checked,!1,2.5,!1,!0),set_currentElement(t),gui.frame_element(t)},r.appendChild(s)})}function make_search_result_paragraph(e,t,r){var n=document.createElement("p"),o=e.split(" ").map(function(e){return e.toLowerCase()}),a=t.split(" ").map(function(e){return e.toLowerCase()}),i=""
return a.forEach(function(e){_.any(o.map(function(t){return e.includes(t)}))?i+="<b class=search_form_found_word>"+e+"</b> ":i+=e+" "}),n.innerHTML=i+" ("+round_to(r,2)+")",n}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function validate_gs(e){function t(e){var r=e.element
if(!(r in allowed_attrs))throw console.log("unknown element "+r),"contaminated "+r
Object.keys(e.attrs).forEach(function(t){t in allowed_attrs[r]?DOMPurify.sanitize(e.attrs[t])!=e.attrs[t]&&(console.log("deleted because not sane",t,e.attrs[t]),delete e.attrs[t]):(console.log("deleted because not allowed",t,e.attrs[t]),delete e.attrs[t]),"style"!=t||""==e.attrs[t]||check_styles(e.attrs[t],allowed_styles)||delete e.attrs[t]}),e.children&&e.children.forEach(function(e){return t(e)})}return e.forEach(function(e){return t(e)}),e}function check_styles(e,t){if(valid=!0,";"==e.slice(-1)&&(e=e.slice(0,-1)),e.match("background-image")){if(regex=/background-image: url\("data:image\/png;base64,.+\);/,!e.match(regex))return console.log("with bg: invalid"),!1
e=e.replace(regex,""),console.log("with bg: valid")}return e.split(";").forEach(function(e){var r=e.split(":")
r.length>2&&(valid=!1,console.log("two many values",r)),r[0].trim()in t||(valid=!1,console.log("not allowed style attrib",r))}),valid}function math_parser(f_str){function get_pos_first_bracketed_exp(e){for(var t=0,r=-1,n=0;n<e.length;n++){var o=e[n]
if("("==o&&(t+=1,-1==r&&(r=n)),")"==o&&0==(t-=1))break}return-1==r?[0,0]:[r,n+1]}function make_checker(e){return function(t){return r=t.match(e),!(!r||r[0]!=t)}}function is_atomic(e){return""==e||!!is_number(e)||!!is_x(e)||!!is_constant(e)}function is_not_inside_brackets(e){return(e.match(/\(/g)||[]).length==(e.match(/\)/g)||[]).length}function split_on_operator(e,t){var r=e.indexOf(t)
return[e.slice(0,r),e.slice(r+1)]}function is_outer_bracketed(e){var t=get_pos_first_bracketed_exp(e),r=_slicedToArray(t,2)
return a=r[0],b=r[1],0==a&&b==e.length}function check_and_remove_outer_brackets(e){var t=is_outer_bracketed(e)
return[t,t?e.slice(1,-1):e]}function get_first_bracketed_expr(e){var t=get_pos_first_bracketed_exp(e),r=_slicedToArray(t,2)
return a=r[0],0!=(b=r[1])&&{expr:e.slice(a,b),index:[a,b]}}function find_operator_match(e,t){var r
for(t.lastIndex=0;null!=(r=t.exec(e));)if(is_not_inside_brackets(e.slice(0,r.index)))return r
return!1}function find_minus(e){var t
for(minus.lastIndex=0;null!=(t=minus.exec(e));)if(t.index=t[0].indexOf("-"),is_not_inside_brackets(e.slice(0,t.index)))return t
return!1}function find_next_operator(e){var t=!1
return t=find_operator_match(e,modulo),t||(t=find_operator_match(e,plus_minus)),t||(t=find_operator_match(e,dot_over)),!!t&&t.index}function is_word_operator(e){return 1==word_operators.filter(function(t){return e.startsWith(t)}).length&&is_outer_bracketed(e.slice(e.indexOf("(")))}function split_inside_word_operator(e){var t=get_all_regex_matches(/,/g,e),r=t.map(function(t){return is_not_inside_brackets(e.slice(0,t.index))}),n=t[r.indexOf(!0)]
return[e.slice(0,n.index),e.slice(n.index+1)]}function handle_word_operator(e){var t=get_first_bracketed_expr(e),r=e.slice(0,t.index[0]),n=check_and_remove_outer_brackets(t.expr),o=_slicedToArray(n,2),a=(o[0],o[1])
if(-1==multi_arg_word_ops.indexOf(r))return[a,r,"0"]
var i=split_inside_word_operator(a),s=_slicedToArray(i,2)
return[s[0],r,s[1]]}function get_all_regex_matches(e,t){for(var r,n=[];r=e.exec(t);)n.push(r)
return n}function split(e){var t=find_next_operator(e)
if("number"!=typeof t)throw"failed finding operator in "+e
var r=e[t]
return[e.slice(0,t),r,e.slice(t+1)]}function splitter(e){var t={a:!1,op:!1,b:!1,type:"inplace",wrapped:!1},r=check_and_remove_outer_brackets(e),n=_slicedToArray(r,2),o=n[0],e=n[1]
if(t.wrapped=o,is_atomic(e))return t.a=e,t.b="",t.op="",t
if(is_word_operator(e)){var a=handle_word_operator(e),i=_slicedToArray(a,3),s=i[0],_=i[1],c=i[2]
t.type="func"}else var l=split(e),u=_slicedToArray(l,3),s=u[0],_=u[1],c=u[2]
t.op=_
try{t.a=is_atomic(s)?s:splitter(s),t.b=is_atomic(c)?c:splitter(c)}catch(e){throw e}return t}function unpeal_to_eval(e){function t(e){if(is_constant(e)){if("PI"==e)return"Math.PI"
if("E"==e)return"Math.E"}return e}var r="string"==typeof e.a?t(e.a):unpeal_to_eval(e.a),n="string"==typeof e.b?t(e.b):unpeal_to_eval(e.b),o=""
return o="inplace"==e.type?r+e.op+n:e.b?"Math."+e.op+"("+r+","+n+")":"Math."+e.op+"("+r+")",e.wrapped&&(o="("+o+")"),o}function unpeal_to_mathjax(e){function t(e){if(is_constant(e)){if("PI"==e)return"\\pi"
if("E"==e)return"\\mathrm e"}return e}var r="string"==typeof e.a?t(e.a):unpeal_to_mathjax(e.a),n="string"==typeof e.b?t(e.b):unpeal_to_mathjax(e.b),o=""
return o="inplace"==e.type?"/"==e.op?"{"+r+"\\over "+n+"}":"*"==e.op?"{"+r+n+"}":"%"==e.op?"{"+r+"\\bmod"+n+"}":"{"+r+e.op+n+"}":"pow"==e.op?"{"+r+"}^{"+n+"}":"abs"==e.op?"|"+r+"|":"ceil"==e.op?"\\lceil "+r+"\\rceil":"floor"==e.op?"\\lfloor "+r+"\\rfloor":"max"==e.op?"\\max("+r+", "+n+")":"min"==e.op?"\\min("+r+", "+n+")":"\\"+e.op+"{"+r+"}",e.wrapped&&(o="("+o+")"),o}var to_mathjax=arguments.length>1&&void 0!==arguments[1]&&arguments[1],word_operators=["sin","cos","tan","ceil","floor","log","sqrt","abs","pow","max","min","gamma"],multi_arg_word_ops=["pow","max","min"],operator_splitter=RegExp(/[%\*\+-\/]/),modulo=RegExp(/%/g),plus_minus=/[\+-]/g,minus=/[x|\d+?(?:\.\d+?)?](-)\d+?(?:\.\d+?)?/g,plus=/\+/g,dot_over=RegExp(/[\*\/]/g),numbers_only=RegExp(/-?\d+(\.\d+)?/g),is_number=make_checker(numbers_only),is_x=function(e){return"x"==e||"-x"==e},is_constant=function(e){return"E"==e||"PI"==e}
f_str=f_str.replace(/ /g,""),f_str=f_str.replace(/\n/g,"")
try{var t=splitter(f_str)
if(to_mathjax)return[!0,unpeal_to_mathjax(t)]
var f_final=unpeal_to_eval(t)
return[!0,eval("x=>"+f_final)]}catch(e){return[!1,e]}}function testing(e,t){for(var r,n=0;null!=(r=t.exec(e))&&2!=(n+=1);)console.log(r)}function get_range_of_f(e,t){var r=e.map(function(e){return t(e)}).filter(function(e){return!isNaN(e)}),n=find_limits(e,t)
return n?(r=r.sort(function(e,t){return e-t}),miny=d3.quantile(r,.01),maxy=d3.quantile(r,.99)):(miny=d3.min(r),maxy=d3.max(r)),[round_to(miny,2),round_to(maxy,2),0!=n.length]}function find_limits(e,t){for(var r=e.map(function(e){return t(e)}).filter(function(e){return!isNaN(e)}),n=function(e){var t=e.filter(function(e,t){return t%2==0}),r=e.filter(function(e,t){return t%2==1})
return _.zip(t,r).map(function(e){return Math.abs(1-e[0]/e[1])})}(r),o=[],a=0;a<n.length;a++)n[a]>.5&&Math.abs(r[2*a]-r[2*a+1])>1&&o.push(2*a)
return o}function find_splits(e,t,r,n){for(var o=e.map(function(e){return t(e)}),a=!1,i=[],s=0;s<o.length;s++)isNaN(o[s])?"number"==typeof a&&(i.push([a,s]),a=!1):s==o.length-1?"number"==typeof a&&i.push([a,s+1]):o[s]>r||o[s]<n?("number"==typeof a&&i.push([a,s]),a=!1):"number"!=typeof a&&(a=s)
return i.length>0?i:[-1,-1]}var most_common=["form_scaling","fs_hierarchy","fs_align","form_font_class","ffw_text","fs_zoom_pos","form_border_width",,"form_border_dash","fs_grouping","fs_grouping_quick","fs_font","form_fill","form_font","form_font_size","fs_border","fs_fig_stuff","fs_drawing","form_morph","form_disperse","form_styling","ffw_fill","ffw_stroke","form_border_side","colors_svg"],figs={line_for_graph:{svg_fig:"path",my_name:"line_for_graph",myclasses:["no_fill"],dims:{width:120,height:10},styles:{"stroke-width":"3px"},my_form_elements:["form_fill","fs_graphing","ffw_stroke","fs_border","form_border_width","form_border_dash","fs_grouping","colors_svg","fs_grouping_quick"],my_menu:"empty"},x_axis:{svg_fig:"d3_axis",my_name:"x_axis",dims:{width:120,height:10},myclasses:["font4","i_am_grouped"],my_style_classes:["style_20"],styles:{"stroke-width":"2px",stroke:"rgb(75,75,75)"},copyable:!1,my_form_elements:["fs_path_label","form_fill","ffw_text","ffw_stroke","fs_font","form_font","form_font_size","fs_border","form_border_width","form_border_dash","fs_grouping_quick"],my_menu:"empty"},y_axis:{svg_fig:"d3_axis",my_name:"y_axis",dims:{width:10,height:120},myclasses:["font4","i_am_grouped"],my_style_classes:["style_20"],styles:{"stroke-width":"2px",stroke:"rgb(75,75,75)"},copyable:!1,my_form_elements:["fs_path_label","form_fill","ffw_text","ffw_stroke","fs_font","form_font","form_font_size","fs_border","form_border_width","form_border_dash","fs_grouping_quick"],my_menu:"empty"},axes_board:{svg_fig:"rect",my_name:"axes_board",dims:{graph_axis_crossed:!0,gridded:!0,width:400,height:400,domain_x:[-2,2],domain_y:[2,-2]},myclasses:["evade_me","sticky","no_nums"],my_style_classes:["style_18"],styles:{"stroke-width":"1px"},copyable:!1,my_form_elements:["form_fill","fs_board","ffw_fill","fs_grouping","fs_grouping_quick","fs_align","colors_svg","fs_border","form_border_width","form_border_dash"]},graph_basic:{svg_fig:"rect",my_name:"graph_basic",dims:{width:250,height:250,domain_x:[-2,2],domain_y:[2,-2]},myclasses:["evade_me","canvas_layer"],my_style_classes:["style_20"],styles:{"stroke-width":"0px"},copyable:!1,my_form_elements:["form_fill","fs_graphing","ffw_fill","fs_grouping","fs_grouping_quick","fs_align","colors_svg"]},country_basic:{svg_fig:"path",my_name:"path_basic",dims:{width:120,height:90},myclasses:["path",""],my_style_classes:["style_20"],my_form_elements:most_common,my_menu:"fig",copyable:!1},path_basic:{svg_fig:"path",my_name:"path_basic",dims:{width:120,height:90},myclasses:["evade_me","path",""],my_style_classes:["style_20"],styles:{"stroke-width":"2px","pointer-events":"stroke"},my_form_elements:most_common.filter(function(e){return"fs_hierarchy"!=e&&"form_border_side"!=e&&"fs_fig_stuff"!=e}).concat(["fs_path_label","fs_path_advanced"]),my_menu:"fig",copyable:!0,custom_bbox:!0},polygon:{svg_fig:"polygon",my_name:"polygon",dims:{width:120,height:90},myclasses:["evade_me","polygon_basic"],my_style_classes:["style_20"],my_form_elements:most_common,my_menu:"fig",copyable:!0},poly_points:{svg_fig:"polygon",my_name:"poly_points",myclasses:["evade_me","polygon_basic","canvas_layer"],my_style_classes:["style_6"],my_form_elements:most_common,my_menu:"poly_points",copyable:!0},poly_points_fo:{svg_fig:"polygon",my_name:"poly_points_fo",myclasses:["evade_me","polygon_basic"],my_style_classes:["style_4"],my_form_elements:most_common,my_menu:"fig",copyable:!0},slide:{svg_fig:"polygon",my_name:"slide",myclasses:["polygon_basic","canvas_layer"],my_style_classes:["slider"],my_form_elements:["fs_zoom_pos"],my_menu:"slide",copyable:!1},rect_basic:{svg_fig:"rect",my_name:"rect_basic",dims:{width:180,height:80,rx:1,ry:1},myclasses:["evade_me"],my_style_classes:["style_20"],my_form_elements:most_common.concat(["form_border_radius"]),my_menu:"fig",copyable:!0},cell_basic:{svg_fig:"rect",my_name:"cell_basic",dims:{width:180,height:80,rx:2,ry:2},myclasses:[],my_style_classes:["style_20"],my_form_elements:most_common.concat(["form_border_radius","fs_table_edit"]),my_menu:"fig",copyable:!0},tan_rect:{svg_fig:"rect",my_name:"tan_rect",dims:{width:180,height:80,rx:2,ry:2},myclasses:["evade_me"],my_style_classes:["style_6"],my_form_elements:most_common,copyable:!1},rect_canvas:{svg_fig:"rect",my_name:"rect_canvas",dims:{width:150,height:100,rx:1,ry:0},myclasses:["canvas_layer"],my_style_classes:["coney_island1"],my_form_elements:["form_fill","fs_border","form_border_width","form_border_radius","form_fill_what","fs_rect_canvas","fs_grouping_quick","form_border_width","form_group","form_disperse","ffw_fill","ffw_stroke","fs_grouping","colors_svg","fs_align","form_border_side","form_border_radius"],copyable:!0,my_menu:"rect_canvas"},ellipse_basic:{svg_fig:"ellipse",my_name:"ellipse_basic",dims:{rx:60,ry:40},myclasses:["mainfig","evade_me"],my_style_classes:["style_20"],my_form_elements:most_common.filter(function(e){return"form_border_side"!=e}),my_menu:"fig",copyable:!0},cp_resize:{svg_fig:"circle",my_name:"cp_resize",dims:{r:5},styles:{fill:"red","stroke-width":"2px",stroke:"black","stroke-dasharray":"0"},my_style_classes:["cp_resize"],style_on_fig:!0,my_form_elements:[],copyable:!1},cp_helper:{svg_fig:"circle",my_name:"cp_helper",dims:{r:5},styles:{"stroke-dasharray":"0"},my_style_classes:["cp_helper"],style_on_fig:!0,my_form_elements:[],copyable:!1},catcher:{svg_fig:"mainfig",my_name:"catcher",dims:{rx:10,ry:10},styles:{"stroke-dasharray":"0"},my_style_classes:["catcher"],style_on_fig:!1,my_form_elements:[],copyable:!1},cp_rotate:{svg_fig:"circle",my_name:"cp_rotate",dims:{r:5},styles:{fill:"orange","stroke-width":"2px",stroke:"black","stroke-dasharray":"0"},my_style_classes:["cp_rotate"],style_on_fig:!0,my_form_elements:[],copyable:!1},fo:{svg_fig:"foreignObject",my_name:"fo",dims:{},styles:{},copyable:!1},knot:{svg_fig:"circle",my_name:"knot",dims:{r:5,width:1,height:1},styles:{fill:"none",stroke:"black"},myclasses:["mainfig"],my_style_classes:["style_23"],my_form_elements:["fs_colors","form_fill","form_border_width","fs_grouping","fs_grouping_quick","fs_border","form_border_width","fs_fig_stuff","colors_svg"],my_menu:"knot",copyable:!1},knot_gui:{svg_fig:"circle",my_name:"knot_gui",dims:{r:12,width:1,height:1,transform:"translate(-10,10)"},styles:{},myclasses:["mainfig"],my_form_elements:[],copyable:!1},knot_hierarchy:{svg_fig:"circle",my_name:"knot_hierarchy",dims:{r:5,width:1,height:1},styles:{},myclasses:["mainfig"],my_form_elements:["fs_colors","form_fill","form_border_width","fs_grouping","fs_grouping_quick","fs_border","form_border_width","fs_fig_stuff"],my_menu:"knot",copyable:!1},poly_point:{svg_fig:"circle",my_name:"poly_point",dims:{r:5,width:1,height:1},styles:{},myclasses:[],my_form_elements:["fs_colors","form_fill","form_border_width","fs_grouping","fs_grouping_quick","fs_border","form_border_width","fs_fig_stuff","colors_svg"],my_menu:"knot",copyable:!0},text_basic:{svg_fig:"text",my_name:"text_basic",dims:{},myclasses:["mainfig"],my_style_classes:["style_23","font2"],my_form_elements:["fs_colors","fs_zoom_pos","form_border_width","form_border_dash","fs_grouping","fs_grouping_quick","fs_font","form_fill","form_font","form_font_size","fs_border","form_border_width","ffw_fill","ffw_stroke","form_scaling","fs_align","colors_svg"],my_menu:"text",copyable:!0},text_path:{svg_fig:"textPath",my_name:"text_path",dims:{},myclasses:["mainfig"],my_style_classes:["style_23","font4"],my_form_elements:["fs_colors","fs_zoom_pos","fs_border","form_border_width","fs_font","form_fill","form_font","form_font_size","ffw_fill","ffw_stroke","fs_grouping_quick","colors_svg"],my_menu:"text-on-path",copyable:!1},text_block:{svg_fig:"text",my_name:"text_block",dims:{},myclasses:["font4"],my_style_classes:["style_23"],my_form_elements:["fs_colors","fs_zoom_pos","fs_border","form_border_width","fs_font","form_fill","form_font","form_font_size","ffw_fill","ffw_text","ffw_stroke","ffw_stroke2","form_textblock_border","form_border_dash","form_border_radius","fs_grouping_quick","colors_svg"],my_menu:"text-on-path",copyable:!1},icon_basic:{svg_fig:"text",my_name:"icon_basic",dims:{},styles:{"font-family":"FontAwesome"},myclasses:["mainfig"],my_style_classes:["style_23","font1"],my_form_elements:["fs_colors","fs_zoom_pos","form_scaling","fs_grouping","fs_font","form_fill","form_font_size","colors_svg","form_disperse","fs_border","form_border_width","form_border_dash","ffw_fill","ffw_stroke","fs_grouping_quick"],my_menu:"icon",copyable:!0},math_basic:{svg_fig:"relay",my_name:"math_basic",dims:{width:100,height:100},myclasses:["mainfig"],my_style_classes:["style_23","font2"],my_form_elements:["fs_colors","fs_zoom_pos","form_scaling","fs_grouping","fs_font","form_fill","form_font_size","fs_fig_stuff","fs_align","colors_svg","form_disperse","fs_border","form_border_width","form_border_dash","ffw_fill","ffw_stroke","fs_grouping_quick"],my_menu:"icon",copyable:!0},svg_icon:{svg_fig:"relay",my_name:"svg_icon",myclasses:["mainfig"],my_form_elements:["fs_colors","fs_zoom_pos","form_scaling","fs_grouping","fs_font","form_fill","form_font_size","fs_fig_stuff","colors_svg","form_disperse","fs_border","form_border_width","form_border_dash","ffw_fill","ffw_stroke","fs_grouping_quick"],my_menu:"icon",copyable:!0}},poly_config={triangle_u:{points:[[.5,0],[1,1],[0,1]],fo_top_left:[.25,.5],fo_width:.5,fo_height:.5,dims:{width:90,height:90},borders:[[2,0],[0],[1],[2]]},triangle_d:{points:[[0,0],[1,0],[.5,1]],fo_top_left:[.25,0],fo_width:.5,fo_height:.5,dims:{width:90,height:90},borders:[[0],[1],[1,2],[2]]},triangle_l:{points:[[1,0],[1,1],[0,.5]],fo_top_left:[.5,.25],fo_width:.5,fo_height:.5,dims:{width:90,height:90},borders:[[2],[0],[1],[1,2]]},triangle_r:{points:[[0,0],[1,.5],[0,1]],fo_top_left:[0,.25],fo_width:.5,fo_height:.5,dims:{width:90,height:90},borders:[[0],[0,1],[1],[2]]},rhombus:{points:[[.5,0],[1,.5],[.5,1],[0,.5]],fo_top_left:[.25,.25],fo_width:.5,fo_height:.5,dims:{width:90,height:90},borders:[[3,0],[0,1],[1,2],[2,3]]},diamond:{points:[[.2,0],[.8,0],[1,.25],[.5,1],[0,.25]],fo_top_left:[.2,0],fo_width:.6,fo_height:.5,dims:{width:90,height:90},borders:[[4,0,1],[1,2],[2,3],[3,4]]},hexagon_v:{points:[[.5,0],[1,.25],[1,.75],[.5,1],[0,.75],[0,.25]],fo_top_left:[0,.25],fo_width:1,fo_height:.5,dims:{width:120,height:80},borders:[[5,0],[0,1,2],[2,3],[3,4,5]]},hexagon_h:{points:[[0,.5],[.25,0],[.75,0],[1,.5],[.75,1],[.25,1]],fo_top_left:[.25,0],fo_width:.5,fo_height:1,dims:{width:120,height:80},borders:[[0,1,2],[2,3],[3,4,5],[5,0]]},octagon:function(e){return s=1/(1+Math.sqrt(2)),x=(1-s)/2,{points:[[x,0],[x+s,0],[1,x],[1,x+s],[x+s,1],[x,1],[0,x+s],[0,x]],fo_top_left:[x/2,x/2],fo_width:x+s,fo_height:x+s,borders:[[7,0,1],[1,2,3],[3,4,5],[5,6,7]],dims:{width:90,height:90}}}(),parallellogram:{points:[[.5,0],[1,0],[.5,1],[0,1]],fo_top_left:[.25,0],dims:{width:90,height:90},fo_width:.5,fo_height:1},arrow_right:{points:[[0,.25],[2/3,.25],[2/3,0],[1,.5],[2/3,1],[2/3,.75],[0,.75]],fo_top_left:[0,.25],fo_width:2/3,fo_height:.5,borders:[[0,1,2],[2,3],[3,4,5],[4,6,1]],dims:{width:110,height:90},shape:function(e,t,r){return[1,2,5,4].forEach(function(r){return e[r][0]+=t}),[0,1].forEach(function(t){return e[t][1]+=r}),[6,5].forEach(function(t){return e[t][1]-=r}),[e,0,0]},fo_dims:function(e){return[e[0],e[1][0]-e[0][0],e[6][1]-e[0][1]]},reshape_icon:"arrows",cp_index:1},arrow_left:{points:[[1,.75],[1/3,.75],[1/3,1],[0,.5],[1/3,0],[1/3,.25],[1,.25]],fo_top_left:[1/3,.25],fo_width:2/3,fo_height:.5,borders:[[3,4,5],[4,6,1],[0,1,2],[2,3]],dims:{width:110,height:90},shape:function(e,t,r){return[1,2,5,4].forEach(function(r){return e[r][0]+=t}),[0,1].forEach(function(t){return e[t][1]-=r}),[6,5].forEach(function(t){return e[t][1]+=r}),[e,0,0]},fo_dims:function(e){return[e[5],e[0][0]-e[1][0],e[0][1]-e[6][1]]},cp_index:5,reshape_icon:"arrows"},arrow_up:{points:[[.25,1],[.25,1/3],[0,1/3],[.5,0],[1,1/3],[.75,1/3],[.75,1]],fo_top_left:[.25,1/3],fo_width:.5,fo_height:2/3,borders:[[2,3],[3,5],[4,6,1],[0,1,2]],dims:{width:70,height:110},shape:function(e,t,r){return[1,2,5,4].forEach(function(t){return e[t][1]+=r}),[0,1].forEach(function(r){return e[r][0]-=t}),[6,5].forEach(function(r){return e[r][0]+=t}),[e,0,0]},fo_dims:function(e){return[e[1],e[6][0]-e[0][0],e[0][1]-e[1][1]]},cp_index:5,reshape_icon:"arrows"},arrow_down:{points:[[.75,0],[.75,2/3],[1,2/3],[.5,1],[0,2/3],[.25,2/3],[.25,0]],fo_top_left:[.25,0],fo_width:.5,fo_height:2/3,borders:[[4,6,1],[0,2],[2,3],[3,5]],dims:{width:70,height:110},shape:function(e,t,r){return[1,2,5,4].forEach(function(t){return e[t][1]+=r}),[0,1].forEach(function(r){return e[r][0]+=t}),[6,5].forEach(function(r){return e[r][0]-=t}),[e,0,0]},fo_dims:function(e){return[e[6],e[0][0]-e[6][0],e[1][1]-e[0][1]]},reshape_icon:"arrows",cp_index:1},chevron_right:{points:[[0,0],[.8,0],[1,.5],[.8,1],[0,1],[.2,.5]],fo_top_left:[.2,0],fo_width:.6,fo_height:1,borders:[[0,1],[1,2],[2,3],[4,5]],dims:{width:130,height:70},shape:function(e,t,r){return[2,5].forEach(function(r){return e[r][0]+=t}),[e,0,0]},fo_dims:function(e){return[[e[5][0],0],e[1][0]-e[5][0],e[3][1]-e[1][1]]},reshape_icon:"arrows-h",cp_index:2},chevron_left:{points:[[.2,0],[1,0],[.8,.5],[1,1],[.2,1],[0,.5]],fo_top_left:[.2,0],fo_width:.6,fo_height:1,borders:[[5,0],[1,2],[3,4],[4,5]],dims:{width:130,height:70},shape:function(e,t,r){return[2,5].forEach(function(r){return e[r][0]+=t}),[e,0,0]},fo_dims:function(e){return[e[0],e[2][0]-e[0][0],e[4][1]-e[0][1]]},reshape_icon:"arrows-h",cp_index:2},chevron_up:{points:[[0,.2],[.5,0],[1,.2],[1,1],[.5,.8],[0,1]],fo_top_left:[0,.2],fo_width:1,fo_height:.6,borders:[[0,1],[1,2],[3,4],[5,0]],dims:{width:70,height:90},shape:function(e,t,r){return[1,4].forEach(function(t){return e[t][1]+=r}),[e,0,0]},fo_dims:function(e){return[e[0],e[2][0]-e[0][0],e[4][1]-e[0][1]]},reshape_icon:"arrows-v",cp_index:1},chevron_down:{points:[[0,0],[.5,.2],[1,0],[1,.8],[.5,1],[0,.8]],fo_top_left:[0,.2],fo_width:1,fo_height:.6,borders:[[0,1],[1,2],[2,3],[4,5]],dims:{width:70,height:90},shape:function(e,t,r){return[1,4].forEach(function(t){return e[t][1]+=r}),[e,0,0]},fo_dims:function(e){return[[0,e[1][1]],e[2][0]-e[0][0],e[3][1]-e[1][1]]},reshape_icon:"arrows-v",cp_index:1},house_up:{points:[[.5,0],[1,.3],[1,1],[0,1],[0,.3]],fo_top_left:[0,.3],fo_width:1,fo_height:.7,borders:[[4,0],[0,1],[2],[3,4]],dims:{width:70,height:90},shape:function(e,t,r){return e[0][1]-=r,[e,0,0]},fo_dims:function(e){return[e[4],e[1][0]-e[4][0],e[2][1]-e[1][1]]},reshape_icon:"arrows-v",cp_index:1},house_down:{points:[[.5,1],[0,.7],[0,0],[1,0],[1,.7]],fo_top_left:[0,0],fo_width:1,fo_height:.7,borders:[[2],[3,4],[4,0],[0,1]],dims:{width:70,height:90},shape:function(e,t,r){return e[0][1]-=r,[e,0,0]},fo_dims:function(e){return[e[2],e[4][0]-e[1][0],e[1][1]-e[2][1]]},reshape_icon:"arrows-v",cp_index:1},house_left:{points:[[0,.5],[.3,0],[1,0],[1,1],[.3,1]],fo_top_left:[.3,0],fo_width:.7,fo_height:1,borders:[[0,1],[2],[3,4],[4,0]],dims:{width:70,height:90},shape:function(e,t,r){return e[0][0]-=t,[e,0,0]},fo_dims:function(e){return[e[1],e[2][0]-e[1][0],e[3][1]-e[2][1]]},reshape_icon:"arrows-h",cp_index:1},house_right:{points:[[1,.5],[.7,1],[0,1],[0,0],[.7,0]],fo_top_left:[0,0],fo_width:.7,fo_height:1,borders:[[3,4],[4,0],[0,1],[2]],dims:{width:70,height:90},shape:function(e,t,r){return e[0][0]-=t,[e,0,0]},fo_dims:function(e){return[e[3],e[1][0]-e[2][0],e[2][1]-e[3][1]]},reshape_icon:"arrows-h",cp_index:1},parallello_hor:{points:[[.25,0],[1,0],[.75,1],[0,1]],fo_top_left:[.25,0],fo_width:.5,fo_height:1,borders:[[3,0],[1],[1,2],[3]],dims:{width:70,height:90},shape:function(e,t,r){return e[0][0]+=t,e[2][0]-=t,[e,0,0]},fo_dims:function(e){return[e[0],e[2][0]-e[0][0],e[3][1]-e[0][1]]},reshape_icon:"arrows-h",cp_index:1},parallello_hor_mirrored:{points:[[0,0],[.75,0],[1,1],[.25,1]],fo_top_left:[.25,0],fo_width:.5,fo_height:1,borders:[[0,1],[1],[2,3],[3]],dims:{width:70,height:90},shape:function(e,t,r){return e[1][0]+=t,e[3][0]-=t,[e,0,0]},fo_dims:function(e){return[[e[3][0],e[0][1]],e[1][0]-e[3][0],e[2][1]-e[1][1]]},reshape_icon:"arrows-h",cp_index:1},parallello_vert:{points:[[0,.25],[1,0],[1,.75],[0,1]],fo_top_left:[0,.25],fo_width:1,fo_height:.5,borders:[[0],[1,2],[2],[3,0]],dims:{width:70,height:90},shape:function(e,t,r){return e[0][1]-=r,e[2][1]+=r,[e,0,0]},fo_dims:function(e){return[e[0],e[1][0]-e[0][0],e[2][1]-e[0][1]]},reshape_icon:"arrows-v",cp_index:1},parallello_vert_mirrored:{points:[[0,0],[1,.25],[1,1],[0,.75]],fo_top_left:[0,.25],fo_width:1,borders:[[0],[0,1],[2],[2,3]],fo_height:.5,dims:{width:70,height:90},shape:function(e,t,r){return e[0][1]-=r,e[2][1]+=r,[e,0,0]},fo_dims:function(e){return[[e[0][0],e[1][1]],e[1][0]-e[0][0],e[3][1]-e[1][1]]},reshape_icon:"arrows-v",cp_index:1}},polygon_shapes=Object.keys(poly_config)
line_styles={straight:{perpendicular:.5,inline:.5},fluid:{perpendicular:.5,inline:0},manh_swirl:{perpendicular:1,inline:0},manhattan:{}},path_specs={part_of:{thickness:"thick_to_thin",style:{"stroke-width":"2px",stroke:"black",fill:"rgb(186, 41, 41)","fill-opacity":.8}},example_of:{thickness:"thick_to_thin",style:{"stroke-width":"3px",stroke:"rgb(51, 45, 45)",fill:"steelblue","fill-opacity":.8}},plain:{thickness:"single_stroke",style:{"stroke-width":"3px",stroke:"rgb(77,64,64)",fill:"None","fill-opacity":.9}},double:{thickness:"double",style:{"stroke-width":"6px",stroke:"rgb(207, 85, 68)",fill:"None","fill-opacity":.8}},double_inner:{thickness:"single_stroke",style:{"stroke-width":"4px",stroke:"white",fill:"None","fill-opacity":1}},octopus:{thickness:"thick_to_thin",style:{"stroke-width":"2px",stroke:"black",fill:"rgb(207, 85, 68)","fill-opacity":.8}},click_catcher:{thickness:"single_stroke",style:{"stroke-width":"20px",fill:"None","stroke-dasharray":0}}}
var active_line_flow="fluid",active_line_style="plain"
!function(){var e=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,t=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,r=!!document.documentMode,n=!r&&!!window.StyleMedia;(!!window.chrome&&!!window.chrome.webstore||e)&&window.CSS,(t||r||n)&&(document.querySelector("#browser_compat").style.display="block")}()
var classes=["coney_island1","coney_island2","coney_island3","coney_island4","coney_island5","cinnamon_mint1","cinnamon_mint2","cinnamon_mint3","cinnamon_mint4","cinnamon_mint5","french_girl1","french_girl2","french_girl3","french_girl4","french_girl5"],colors=[{fill:[237,27,36],color:"black",alpha:.9,stroke:"black"},{fill:[208,32,39],color:"black",alpha:.9,stroke:"black"},{fill:[221,105,110],color:"black",alpha:.9,stroke:"black"},{fill:[158,80,104],color:"black",alpha:.9,stroke:"black"},{fill:[161,134,189],color:"black",alpha:.9,stroke:"black"},{fill:[167,80,208],color:"black",alpha:.9,stroke:"black"},{fill:[53,148,229],color:"black",alpha:.9,stroke:"black"},{fill:[35,109,239],color:"black",alpha:.9,stroke:"black"},{fill:[86,116,188],color:"black",alpha:.9,stroke:"black"},{fill:[58,161,200],color:"black",alpha:.9,stroke:"black"},{fill:[251,174,92],color:"black",alpha:.9,stroke:"black"},{fill:[247,148,29],color:"black",alpha:.9,stroke:"black"},{fill:[0,114,54],color:"black",alpha:.9,stroke:"black"},{fill:[2,167,80],color:"black",alpha:.9,stroke:"black"},{fill:[98,178,136],color:"black",alpha:.9,stroke:"black"},{fill:[26,144,136],color:"black",alpha:.9,stroke:"black"},{fill:[233,212,22],color:"black",alpha:.9,stroke:"black"},{fill:[206,208,80],color:"black",alpha:.9,stroke:"black"},{fill:[255,255,255],color:"purple",alpha:0,stroke:"black"},{fill:[255,255,255],color:"red",alpha:0,stroke:"black"},{fill:[255,255,255],color:"black",alpha:0,stroke:"black"},{fill:[49,232,120],color:"black",alpha:.9,stroke:"black"},{fill:[246,247,56],color:"black",alpha:.9,stroke:"black"},{fill:[0,0,0],color:"black",alpha:.9,stroke:"black"}],_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),path_attrs=["class","id","e1","e2","from_side","to_side","pos1","pos2","flow","type","fixed_side","arrow_head","arrow_tail","arrow_width","arrow_height","custom_flow","path_g","manhattan_perc","hg","tail_style","head_style","on_top","flasher","offset_from","offset_to"],path_corner_penalty=1.25,cpa={}
clear_path_attrs()
var manhattan_move=d3.behavior.drag().on("drag",function(){currentElement=find_g(this)
var e=d3.mouse(this),t=get_manhattan_perc(this,e),r=d3.select(currentElement).classed("hg")
if(r){set_path_attrs(d3.select(currentElement))
var t=get_manhattan_perc(currentElement,e)
n=[currentElement]}else var n=manage_groups.get_group(currentElement,!0)
if(n.forEach(function(e){set_path_attrs(d3.select(e)),cpa.hg=!1,cpa.fixed_side=!0,cpa.manhattan_perc=t,remake_path(find_path(!0,!0)).attr("manhattan_perc",t)}),r){var o=hierarchies.is_child_of(currentElement)
if(o){var a=_slicedToArray(o,2),i=a[0],s=a[1]
hierarchies.realign_paths(document.querySelector(i),s,t,currentElement)}else{var _=path_id_to_el_ids(currentElement.getAttribute("id")),c=_slicedToArray(_,2),l=(c[0],c[1])
move_element_to_top(document.querySelector(l))}}gui.repos_plumbs_for_cp(e),!cpa.fixed_side&&g_d3.attr("fixed_side",null)}).on("dragend",function(){copy_control_points_to_top(),toggle_zoom.temp_disable_off()}),end_point_move=d3.behavior.drag().on("dragstart",function(){text_to_help_pane(help_text.end_point),cp_drag_start()}).on("drag",function(){function e(e,t,r){if("1"==r|"3"==r)var n=round_to((e[1]-t.top)/(t.bottom-t.top),4)
else var n=round_to((e[0]-t.left)/(t.right-t.left),4)
return(n<0||n>1)&&text_to_feedback_pane(['to connect path to other side of figure, "use path direction"',"you can find it by right clicking the path, or in the Path Controls menu"],!1,!1),round_to(Math.min(1,Math.max(n,0)),4)}function t(e,t,r,n){return"0"==r?round_to(t.top-e[1],0)/n:"1"==r?round_to(e[0]-t.right,0)/n:"2"==r?round_to(e[1]-t.bottom,0)/n:"3"==r?round_to(t.left-e[0],0)/n:void 0}var r=this.parentElement.getAttribute("id"),n=document.querySelector("#"+r)
currentElement=n,set_path_attrs(d3.select(n))
var o=d3.event.sourceEvent.shiftKey,a=corrected_mouse_position2(d3.mouse(this)),i=extract_elements_from_path_id(r),s=cpa.octo_flipped?function(e){return!e}:function(e){return e},_=cpa.offset_from,c=cpa.offset_to,l=toggle_zoom.get_zoom_factor()
if(s(d3.select(this).classed("endpoint_from"))){var u=n.getAttribute("from_side"),d=document.querySelector("#"+i[0]+" .mainfig").getBoundingClientRect(),p=ido(cpa.e1).get_bbox_of_figure(d3.select(cpa.e1),!0),f=_slicedToArray(p,4),m=(f[0],f[1],f[2],f[3],e(a,d,u))
_=o?0:t(a,d,u,l)}else{var u=n.getAttribute("to_side"),d=document.querySelector("#"+i[1]+" .mainfig").getBoundingClientRect(),g=e(a,d,u)
c=o?0:t(a,d,u,l)}manage_groups.get_group(currentElement,!0).forEach(function(e){set_path_attrs(d3.select(e)),cpa.pos1=m||parseFloat(cpa.pos1)||.5,cpa.pos2=g||parseFloat(cpa.pos2)||.5,cpa.fixed_side=!0,cpa.offset_from=_,cpa.offset_to=c,remake_path(find_path(!0,!0))}),!cpa.fixed_side&&g_d3.attr("fixed_side",null),gui.repos_plumbs_for_cp(a)}).on("dragend",cp_drag_end),cubic_move=d3.behavior.drag().on("dragstart",function(){text_to_help_pane(help_text.cubic_point),cp_drag_start.call(this)}).on("drag",function(){cpa.fixed_side=!0
var e=d3.mouse(this),t=parseInt(this.getAttribute("my_index")),r=this.parentElement.querySelector(".click_catcher, .catcher").getAttribute("d")
p=path_to_array(r),move_cubic_cp(p,t,e,void 0,d3.event.dx,d3.event.dy,d3.event.sourceEvent.shiftKey)
var n=find_g(this)
if("path_basic"==iama(n))var o=ido(n).get_offset_path_to_canvas(n),a=path_basic.get_path_offset(n),i=[o[0]+a[0],o[1]+a[1]]
else var o=!1
add_lines_to_control_points(p,i),"octopus"==cpa.type&&(p=p.slice(0,(p.length+1)/2),cpa.octo_flipped&&p.reverse(),make_wide_path(p),cpa.octo_flipped&&p.reverse())
var s=array_to_path(p),_=d3.select(this.parentElement)
direct_child_only_selector(_.node(),"path").forEach(function(e){e.setAttribute("d",s)}),_.select('g[i_am_a="text_path"]').empty()||object_mapper.text_path.resize_text(_.select('g[i_am_a="text_path"]')),"octopus"==cpa.type&&(p=p.slice(0,(p.length+1)/2)),cpa.octo_flipped&&p.reverse(),d3.select(this.parentElement).attr("custom_flow",get_path_custom_flow_attrs(p)).attr("fixed_side","true"),"path_basic"==iama(n)?gui.repos_plumbs_for_cp([o[0]+e[0],o[1]+e[1]]):gui.repos_plumbs_for_cp(e)}).on("dragend",cp_drag_end),cumulator_free_move=drag_discrete(),free_move=d3.behavior.drag().on("dragstart",cp_drag_start).on("drag",function(){var e=d3.mouse(this)
if(this.hasAttribute("my_index"))var t=parseInt(this.getAttribute("my_index"))
else var t=0
var r="path_group"==iama(this.parentElement),n="manhattan"==cpa.flow&&r||!r&&"lineto"==this.parentElement.getAttribute("flow"),o=d3.select(this.parentElement).select("path")[0][0],a=path_to_array(o.getAttribute("d")),i=cumulator_free_move.add(d3.event.dx,d3.event.dy)
if(move_cubic_cp(a,t,e,"free",i[0],i[1]),n)var s=array_to_line(a)
else var s=array_to_path(a)
var _=this.parentElement,c=d3.select(_)
if(r?direct_child_only_selector(_,"path").forEach(function(e){return e.setAttribute("d",s)}):c.selectAll("path.catcher, path.mainfig").attr("d",s),d3.select(this.parentElement).attr("custom_flow",get_path_custom_flow_attrs(a)).attr("fixed_side","true"),!n){if("path_basic"==iama(_))var l=ido(_).get_offset_path_to_canvas(_),u=path_basic.get_path_offset(_),d=[l[0]+u[0],l[1]+u[1]]
else var l=!1
add_lines_to_control_points(a,d)}if("path_basic"==iama(_))var d=object_mapper.path_basic.get_cp_pos(_,a[t].x,a[t].y)
else var p=posit2.get_top_left(this.parentElement),f=_slicedToArray(p,2),m=f[0],g=f[1],d=[m+e[0],g+e[1]]
gui.repos_plumbs_for_cp(d)}).on("dragend",function(){cumulator_free_move.reset(),cp_drag_end.bind(this)()}),all_cp_free,MARGIN_PREFERRED=25,MANH_OFFSET=40,path_end_figs={arrow:{filled:!0,fig:"polygon",attr:"points",style:"stroke-width:1px;fill:black;stroke:black;",func:make_arrow_head},curved_arrow:{fig:"path",attr:"d",style:"stroke-width:3px;stroke:black;",func:make_curved_arrow_head},rev_arrow:{filled:!0,fig:"polygon",attr:"points",style:"stroke-width:1px;fill:black;stroke:black;",func:make_arrow_head_rev},tripod_one:{fig:"polyline",attr:"points",style:"stroke-width:1px;fill:none;;stroke:black;",func:make_tripod_one},tripod_zero:{fig:"polyline",attr:"points",style:"stroke-width:1px;fill:none;;stroke:black;",func:make_zero_tripod},only_one:{fig:"path",attr:"d",style:"stroke-width:1px;fill:none;;stroke:black;",func:make_one_only_one},zero_one:{fig:"path",attr:"d",style:"stroke-width:1px;fill:none;;stroke:black;",func:make_zero_one},hinter:{fig:"circle",style:"stroke-width:1px;fill:grey;;stroke:black;",func:make_hinter}}
test=function(e){var t=0,r={}
id=""
var n=function(n){return t+=1,cpa.id in r?r[cpa.id]+=1:r[cpa.id]=1,cpa.id==id&&console.trace(),e(n)}
return n.reset=function(){t=0,r={}},n.print=function(){console.log(t,r)},n.set_id=function(e){id=e},n}
var DISP_AFTER=!1,OVERLAP=.95
line_generator=d3.svg.line().interpolate("cardinal").x(function(e){return e.x}).y(function(e){return e.y}),path_buffer=function(){var e={}
return{check_path:function(t){return t in e&&(Date.now()-e[t]<1e3?("c"!=e[t]&&setTimeout(this.generate_callback(t),3e3),e[t]="c",!0):"c"==e[t]||(delete e[t],!1))},generate_callback:function(t){return function(){delete e[t]}},add_path:function(t){t in e||(e[t]=Date.now())}}}()
var _slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),get_id_for_table=!1,_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()
Fig.prototype.set_info=function(e){if(!fb_menu_open)return!1
if(no_feedback)return!1
if(form_hidden)return!1
if(!(e=e?find_g(e):currentElement)||!e.hasAttribute("transform")||e.classList.contains("no_pos_info"))return text_to_feedback_pane("")
if("print_region"==e.id)show_print_region_size(e)
else{var t=posit2.get_top_left(e),r=parseInt(e.getAttribute("width")).toFixed(0),n=parseInt(e.getAttribute("height")).toFixed(0)
text_to_feedback_pane(["x: "+t[0].toFixed(0)+" y: "+t[1].toFixed(0),"width: "+r+" height: "+n])}},Fig.prototype.reposition_me=function(e,t,r,n,o){var a=d3.select(e)
return trans=posit2.get_trans(e),n?(trans.translate[0]+=t,trans.translate[1]+=r):(trans.translate[0]=t,trans.translate[1]=r),posit2.set_trans(e.id,trans),this.set_transform_attr(a,trans),e.classList.contains("gui")||this.set_info(e),o&&o.forEach(function(e){return object_mapper[iama(e)].reposition_me(e,t,r,n)}),e.classList.contains("i_have_a_group")&&_.forEach(e.querySelectorAll("g[i_am_a]"),function(e){posit2.delete_item(e.id)}),[e.getAttribute("id")]},Fig.prototype.set_transform_attr=function(e,t){e.attr("transform",transform_to_string(t))},Fig.prototype.resize_me_single=function(e,t){return e.select(this.svg_fig+'[i_am_a="'+this.my_name+'"]').attr(t)},Fig.prototype.resize_me=function(e,r,n,o){var a=posit2.get_trans(e.node()),i=a.scale
r/=i,n/=i
var s=get_scale_chain(e.node())
r/=s,n/=s
var _=parseFloat(e.attr("width"))||1,c=parseFloat(e.attr("height"))||1
if(o)var l=r,u=n
else var l=(a.translate,_+r),u=c+n
l=parseInt(l/mdd)*mdd,u=parseInt(u/mdd)*mdd,l<5|u<5&&(l=Math.max(5,l),u=Math.max(5,u),text_to_feedback_pane("no smaller possible",!1,!0))
var d={width:l,height:u}
return e.select(".mainfig").node().hasAttribute("rx")&&(d.rx=parseFloat(e.select(".mainfig").attr("rx")),d.ry=parseFloat(e.select(".mainfig").attr("ry"))),this.calc_attributes(d),e.attr(this.attrs.g),e.attr("transform",transform_to_string(a)),e.select(this.svg_fig).attr(this.attrs[this.my_name]),this.constructs.forEach(function(t){t.resize_me_single(e,this.attrs[t.my_name])}.bind(this)),this.check_for_pars_repositioning(e.node())&&this.realign_pars(e.node(),l,u,_,c),posit2.delete_item(e.attr("id")),this.set_info(e.node()),"calc_border"in this&&e.node().hasAttribute("border_sides_arr")&&(t=border_sides_attr_to_array(e.node()),this.calc_border(e.node(),t)),[e.attr("id")]},Fig.prototype.recalc_catcher=function(e){this.resize_me(d3.select(e),0,0,!1)},Fig.prototype.realign_pars=function(e,t,r,n,o){var a=e.querySelectorAll("p")
a=_.filter(a,check_if_custom_par_margin),_.forEach(a,function(e){var r=parseFloat(e.style.marginLeft)||0,o=parseFloat(e.style.marginRight)||0
e.style.marginLeft=(t*(r/n)).toPrecision(3)+"px",e.style.marginRight=(t*(o/n)).toPrecision(3)+"px"})},Fig.prototype.check_for_pars_repositioning=function(e){var t=e.querySelectorAll("p")
return 0!=t.length&&_.any(_.map(t,check_if_custom_par_margin))},Fig.prototype.rotate_me=function(e,t,r){0==t&&0==r&&(t=1)
var n=e.node(),o=posit2.get_trans(n),a=o.scale||1,i=parseFloat(e.attr("width")),s=parseFloat(e.attr("height")),c=t<0?180:360,l=(c-180*Math.atan(-r/t)/Math.PI)%360
l-=180-180*Math.atan(-s/2*2/i)/Math.PI
var u=conv_angle(-o.rotate[0],i/2,s/2,!0)
o.rotate=[parseInt(l/MDR)*MDR,i/2,s/2],o.translate[0]+=u[0]*a,o.translate[1]+=u[1]*a,o=posit2.get_trans_from_string(transform_to_string(o)),e.attr("transform",transform_to_string(o)),posit2.set_trans(n.id,o),n.classList.contains("i_have_a_group")&&_.forEach(n.querySelectorAll("g[i_am_a]"),function(e){posit2.delete_item(e.id)})},Fig.prototype.calc_attributes=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=$.extend({},this.dims,e),o=this.my_name,a={g:{}}
a.g.transform="translate("+t+") rotate(0) scale("+r+")",a.catcher=this.calc_catcher_attrs(),a.catcher_knot=this.calc_catcher_attrs(),a[o]=n,a[o].tabindex=1,this.attrs=a},Fig.prototype.add_g_element=function(e,t){var r=e.append("g").attr(t)
return r.classed(this.myclasses.join(" "),!0),this.my_style_classes&&!this.style_on_fig&&r.classed(this.my_style_classes.join(" "),!0),r},Fig.prototype.add_element=function(e,t,r,n){var o=t==this.svg_fig,a=e.append(t).attr(r)
return a.style(this.styles),o&&this.my_style_classes&&this.style_on_fig&&a.classed(this.my_style_classes.join(" "),!0),n&&a.classed("mainfig",!0),this.events&&o&&this.add_events(a),this.drag&&o&&this.add_drag(a),a},Fig.prototype.make_single=function(e,t,r,n){t=$.extend({},this.dims,t)
var o=this.add_element(e,this.svg_fig,t)
return this.constructs.forEach(function(t){t.make_single(e)}),o.attr("i_am_a",this.my_name),o},Fig.prototype.make=function(e,t,r){this.calc_attributes(r,t,1),this.id_less||(this.attrs.g.id=this.next_id()),this.attrs.g.i_am_a=this.my_name
var n=this.add_g_element(e,this.attrs.g)
return _.has(this,"events")||(events=void 0),_.has(this,"drag")||(drag=void 0),this.add_element(n,this.svg_fig,this.attrs[this.my_name],!0),this.constructs.forEach(function(e){e.make_single(n,this.attrs[e.my_name])}.bind(this)),posit2.get_trans(n.node()),help_on&&this.my_name in help_text&&("print_region"==n.attr("id")?text_to_help_pane(help_text.print_region,!1,!1):text_to_help_pane(help_text[this.my_name],!1,!1)),n},Fig.prototype.add_drag=function(e){e.call(this.drag)},Fig.prototype.add_dragfunc=function(e){this.drag=e},Fig.prototype.add_events=function(e){this.events.forEach(function(t){e.on(t.event_type,t.func)})},Fig.prototype.calc_catcher_attrs=function(e,t){var r={}
return r.style="stroke-width:"+catcher_width,r},Fig.prototype.find_my_svg=function(e){for(;"svg"!==e.parentElement.tagName;)e=e.parentElement
return e.parentElement},Fig.prototype.add_paragraph=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2]
if(arguments.length>3&&void 0!==arguments[3]&&arguments[3],e.classList.contains("flipped"))var n=d3.select(d3.select(e).selectAll("foreignObject article")[0][1])
else var n=d3.select(e).select("foreignObject article")
if(n.empty())return!0
var o=r?"xhtml:code":"xhtml:p",a=this.add_element(n,o,{contenteditable:!0})
if(this.add_paragraph_events(a),a.classed("mainfig",!1),1==e.querySelectorAll("p").length){var i=parseFloat(window.getComputedStyle(e).strokeWidth)
$(e).find("article p:first-child").css("margin-top",i/2+"px")}return t=t||"",a.text(t),set_currentElement(a.node()),medium_func(currentElement),this.size_around_paragraphs(find_g(a.node()),!0,!0),selectElementContents(a.node()),use_par_offset_colors&&change_color_test(random_paragraph_color_mod(e)),help_on&&text_to_help_pane(help_text.P,!1,!1),a},Fig.prototype.shape_fusion=function(e,t){var r=e.querySelector("article")
t.forEach(function(e){Array.from(e.querySelectorAll("p")).forEach(function(e){r.appendChild(e)})}),manage_groups.reset(),t.forEach(function(e){return delete_shape(e)}),this.size_around_paragraphs(e)},Fig.prototype.add_paragraph_events=function(e){e.on("click",function(){waiting_for_par_bind?bind_path_to_par(this):copied_styles?set_styles_for_copy(e.node(),copied_styles):(set_currentElement(this),display_fs_for_shape(currentElement),gui.frame_element(currentElement),d3.event.ctrlKey&&"click"==d3.event.type&&manage_groups.toggle_element(currentElement),medium_p=medium_func(this),d3.event.stopPropagation())}),e.on("dblclick",function(){d3.event.shiftKey&&make_new_connection(d3.select(find_g(this))),d3.event.stopPropagation()}),e.on("mouseover",function(){toggle_zoom.status()&&toggle_zoom.temp_disable_on(),this==currentElement&&svg.select("#gui_par_margin").selectAll("circle").classed("on",!0)}),e.on("mouseout",function(){last_selection=saveSelection(),toggle_zoom.temp_disable_off(),svg.select("#gui_par_margin").selectAll("circle").classed("on",!1)}),e.on("mousemove",function(){d3.event.ctrlKey&&this.setAttribute("draggable",!0)})
var t=this
e.on("input",function(e){"deleteContentForward"!=d3.event.inputType&&"deleteContentBackward"!=d3.event.inputType&&t.monitor_size_on_typing(this)}),e.node().ondragstart=drag_paragraph},Fig.prototype.add_existing_paragraph=function(e,t,r){if(!("tagName"in t)){var n=dragged_item.toString()
dragged_item.deleteFromDocument(dragged_item.getRangeAt(0)),t=ido(e).add_paragraph(e,n).node()}t=t.parentElement.removeChild(t)
var o=e.querySelectorAll("p"),a=function(){var t=corrected_mouse_position([r.clientX,r.clientY])[1],n=t-posit2.get_top_left(e)[1]
if(0==o.length)return 0
for(var a=0,i=0;i<o.length;i++)if((a+=get_w_h_of_text_in_par([o[i]])[1])>n)return i
return i}()
this.add_paragraph_in_order(e,t,a),this.size_around_paragraphs(e,!0)},Fig.prototype.add_paragraph_in_order=function(e,t,r){for(var n=e.querySelectorAll("p"),o=0;o<n.length;o++)o<r||(o==r&&e.querySelector("article").appendChild(t),e.querySelector("article").appendChild(n[o]))
r==o&&e.querySelector("article").appendChild(t)},Fig.prototype.move_par_to_flip_side=function(e,t){e.classList.contains("flippable")||this.make_flippable(e),e.querySelector("article.collapsed").appendChild(t)},Fig.prototype.even_out_paragraphs=function(e){var t=this.get_bbox_of_figure(d3.select(e)),r=t.x1y1[1]-t.x0y0[1],n=e.querySelector("article").style.padding
n&&(r-=2*parseInt(n))
var o=e.querySelector("article:not(.collapsed)").querySelectorAll("p"),a=o.length
if(0==a)return!1
var i=_.map(o,function(e){var t=e.getBoundingClientRect()
return t.bottom-t.top}),s=paragraph_bounding_box_zoom_correction(i.reduce(function(e,t){return e+t})),c=parseInt((r-s)/(a+1))
_.forEach(o,function(e){return e.style.marginTop=c+"px"})},Fig.prototype.monitor_size_on_typing=function(e){function t(e){if(find_g(e).classList.contains("rough")){var t=clone_range(saveSelection())
roughing.roughen_if_needed(find_g(e)),restoreSelection(clone_to_range(t)),currentElement.focus()}}var r=void 0,n=find_g(e),o=posit2.get_w_h(n),a=_slicedToArray(o,2),i=a[0],s=(a[1],get_w_h_of_text_in_par([e])),_=_slicedToArray(s,2),c=_[0]
if(_[1],par_to_wide=c>i-10,!par_to_wide)return!1
if(no_table=!1,(r=r=i<400?c-i+15:0)>0&&r<26)return this.resize_me(d3.select(find_g(e)),r,0),t(e),no_table=!0,!1
var l=e.parentElement.lastChild.getBoundingClientRect().bottom,u=find_g(e).querySelector("foreignObject").getBoundingClientRect().bottom
if(l>u){var d=parseInt(n.querySelector("article").style.padding)||0
this.resize_me(d3.select(n),0,((l-u+d)/mdd+1)*mdd),t(e)}no_table=!0},Fig.prototype.size_around_paragraphs=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2]
if(!(arguments.length>3&&void 0!==arguments[3]&&arguments[3]||auto_resize))return text_to_feedback_pane("auto resize on input is off (see zoom and pos menu"),!1
if(!e.querySelector("article:not(.collapsed) p"))return text_to_feedback_pane("no text to size around",!1,!0),!1
if(current_is_p="P"==currentElement.tagName,current_is_p){var n=clone_range(saveSelection())
no_table=!1}var o=this.get_correction_for_paragraph_fit(),a=_slicedToArray(o,2),i=a[0],s=a[1],_=e.querySelector("foreignObject"),c=_.getAttribute("width"),l=get_w_h_of_text_in_par(Array.from(e.querySelectorAll("p"))),u=_slicedToArray(l,2),d=u[0],p=u[1]
if(d+=2*parseInt(e.querySelector("article").style.padding||0),!r){var f=d-c+mdd;(!t||f>0)&&this.resize_me(d3.select(e),parseInt(f*i/mdd)*mdd,0)}var m=parseInt(e.querySelector("article").style.padding||0),g=e.querySelector("article:not(.collapsed)").lastChild.getBoundingClientRect().bottom+m,h=_.getBoundingClientRect().top,p=(g-h)/toggle_zoom.get_zoom_factor()
fo_bbox_correction&&(p/=window.devicePixelRatio)
var y=p-parseInt(_.getAttribute("height"));(!t||y>0)&&this.resize_me(d3.select(e),0,parseInt(y*s/mdd)*mdd),recalc_connections(e.id),current_is_p&&(restoreSelection(clone_to_range(n)),no_table=!0),gui.remove_all(),roughing.roughen_if_needed(e)},Fig.prototype.get_correction_for_paragraph_fit=function(){return[1,1]},Fig.prototype.get_position=function(e){var t=posit2.get_top_left(e.node()),r=parseFloat(t[0]),n=parseFloat(t[1])
return e.classed("i_am_grouped")&&(offset=posit2.get_top_left(e.node().parentElement),r+=offset[0],n+=offset[1]),[r,n]},Fig.prototype.get_bbox_of_figure=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=posit2.get_trans(e.node(),r),o=n.translate,a=_slicedToArray(o,2),i=a[0],s=a[1],_=posit2.get_w_h(e.node(),!0),c=_slicedToArray(_,2),l=c[0],u=c[1]
return t?[i,s,l,u]:parse_to_bbox(i,s,l,u,n.rotate[0])},Fig.prototype.find_elements_in_bbox=function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4]
bbox_area=this.get_bbox_of_figure(e,void 0,!0)
var a=e.attr("id")
return find_elements_in_bbox_test(bbox_area,t,r,n,o).filter(function(e){return e.getAttribute("id")!=a})},Fig.prototype.find_covered_elements=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=filter_elements_to_search(svg.selectAll('g.evade_me, g.i_have_a_group, g[i_am_a="text_basic"], g[i_am_a="icon_basic"]')[0])
e.node().classList.contains("i_have_a_group")&&t&&(r=r.concat(Array.from(svg.node().querySelectorAll('g[i_am_a="path_group"]'))))
var n=posit2.tlbr(e.node())
return r=r.filter(function(e){return element_overlaps_area(n,posit2.tlbr(e))}),r.filter(function(t){return t!=e.node()})},Fig.prototype.move_covered_to_top=function(e){this.find_covered_elements(e,!0).forEach(function(e){return move_element_to_top(e)})},Fig.prototype.stick_to_me=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]
return my_els=t||this.find_elements_in_bbox(e,!0),my_els=my_els.filter(function(e){return!e.classList.contains("cp")}),my_els=my_els.filter(function(e){return"path_group"!=e.getAttribute("i_am_a")}),document.querySelector("#form_merge_ignore_merged").checked&&(my_els=my_els.filter(function(e){return!e.classList.contains("i_am_grouped")})),my_els.forEach(function(t){group_elements(e,d3.select(t)),find_connections(iami(t)).forEach(function(e){return move_element_to_top(document.querySelector("#"+e))})}),e.node().classList.remove("evade_me"),my_els.length},Fig.prototype.scale_me=function(e,t){var r=posit2.get_trans(e)
r.scale=t,posit2.set_trans(e.id,r),this.set_transform_attr(d3.select(e),r),recalc_connections(e.id),recalc_paths_between_shapes_on_merged_parent(e)},Fig.prototype.next_id=next_id_gen("_",0),Fig.prototype.get_new_id=function(e,t){var r=iami(e),n=this.next_id()
if(!t)var o=manage_groups.remove_element_if_present(e)
e.setAttribute("id",n),t||manage_groups.add_element_to_multiple_groups(o,e)
var a=t||svg
if(e.classList.contains("hg_parent"))for(var i=a.node().querySelectorAll(function(){var e=".hg"+r+"_"
return[0,1,2,3].map(function(t){return e+t.toString()}).join(",")}()),s=0;s<i.length;s++)i[s].setAttribute("class",i[s].getAttribute("class").replace(r,n))
find_connections(r,a).forEach(function(e){set_path_attrs(a.select("#"+e))
var t=extract_elements_from_path_id(e),o=_slicedToArray(t,2),i=o[0],s=o[1]
if(r==i){var _=[cpa.to_side,cpa.from_side]
cpa.from_side=_[0],cpa.to_side=_[1]
var c=[cpa.pos2,cpa.pos1]
cpa.pos1=c[0],cpa.pos2=c[1]
var l="from"+i+"_to"+s,u="from"+s+"_to"+n
cpa.id=cpa.id.replace(l,u),cpa.class=cpa.class.replace(l,u)}else cpa.id=cpa.id.replace(r,n),cpa.class=cpa.class.replace(r,n)
var d=a.node().querySelector("#"+e);["from_side","to_side","pos1","pos2","id","class"].forEach(function(e){d.setAttribute(e,cpa[e])})})},Fig.prototype.morph=function(e,t){gui.remove_all()
var r=parse_g(e.node())
r=clean_specs(r,t),e.remove()
var e=start_adding(svg,r)
return object_mapper[t].resize_me(e,0,0),object_mapper[t].size_around_paragraphs(e.node(),!0),e},Fig.prototype.split_of_paragraph=function(e,t,r){if(!function(){return _.any(selected_figure.constructs,function(e){return"foreignObject"==e.svg_fig})||"text"==selected_figure.my_name.slice(0,4)}())return console.log("not a valid goal figure. Select something which can hold text"),!1
var n="text"==selected_figure.my_name.slice(0,4)
dragged_item_is_paragraph="tagName"in e,n&&(selected_figure=rect_basic,n=!1)
var o=selected_figure.make(svg,to_discrete_position(r))
if(dragged_item_is_paragraph)n?(o.select("text").text(e.innerText),d3.select(e).remove()):o.select("article").node().appendChild(e)
else{var a=e.toString()
e.deleteFromDocument(e.getRangeAt(0)),n?o.select("text").text(a):selected_figure.add_paragraph(o.node(),a)}if(!n){dragged_item_is_paragraph||function(e,t){var r=find_current_font_class(e),n=find_current_font_class(find_g(e))
r?t.classList.add(r):n?find_g(t).classList.add(n):t.style["font-size"]=window.getComputedStyle(e)["font-size"]
var o=find_current_style_class(e),a=find_current_style_class(find_g(e))
o?t.classList.add(o):a?find_g(t).classList.add(a):t.style.color=window.getComputedStyle(e).color
var i=e.style.fontFamily,s=find_g(e).style.fontFamily
i?t.style.fontFamily=i:s?find_g(t).style.fontFamily=s:t.style["font-family"]=window.getComputedStyle(e)["font-family"]}(e.focusNode.parentNode,o.select("p").node()),object_mapper[o.attr("i_am_a")].size_around_paragraphs(o.node())
var i=to_discrete_position(function(){var e=parseInt(o.attr("height")),t=parseInt(o.attr("width")),n=posit2.get_top_left(o.node())
return[r[0]-n[0]-t/2,r[1]-n[1]-e/2]}()),s=_slicedToArray(i,2),c=s[0],l=s[1]
selected_figure.reposition_me(o.node(),c,l,!0)}currentElement=o.node(),gui.frame_element(currentElement)},Fig.prototype.flip_shape=function(e){var t=(e.classList.contains("flipped"),e.querySelectorAll("article"))
e.classList.toggle("flipped"),_.forEach(t,function(e){e.classList.toggle("collapsed")})},Fig.prototype.make_flippable=function(e){if(e.classList.contains("flippable"))return text_to_feedback_pane("shape already flippable",!1,!0),!1
e.classList.add("flippable"),d3.select(e).select("foreignObject").append("xhtml:article").attr("class","collapsed"),text_to_feedback_pane("Done! figure is flippable and usable as flipcard",!1,!0),document.querySelector(".form_study_mode").style.display="block"},FO.prototype=Object.create(Fig.prototype),FO.prototype.constructor=FO,FO.prototype.add_element=function(e,t,r,n){var o=Fig.prototype.add_element.call(this,e,t,r,n)
return this.svg_fig,o.append("xhtml:article"),o},RectBasic.prototype=Object.create(Fig.prototype),RectBasic.prototype.constructor=RectBasic,RectBasic.prototype.calc_attributes=function(e,t,r){var n=$.extend({},this.dims,e),o={g:{},fo:{},cp_resize:{},cp_rotate:{},cp_helper:{},catcher:{}}
o[this.my_name]={},t?(t=to_discrete_position([t[0]-n.width/2*r,t[1]-n.height/2*r]),o.g.transform="translate("+t+") rotate(0) scale("+r+")"):_.has(e,"transform")&&(o.g.transform=e.transform),o.g.width=n.width,o.g.height=n.height,o[this.my_name].width=n.width,o[this.my_name].height=n.height,o[this.my_name].rx=n.rx||0,o[this.my_name].ry=n.rx||0,o.fo.width=n.width,o.fo.height=n.height,o.fo.transform="translate(0,0)",o.cp_resize.transform="translate("+n.width+","+n.height+")",o.cp_helper.transform="translate(22,"+n.height+")",o.catcher=this.calc_catcher_attrs(o.g.width,o.g.height),o[this.my_name].tabindex=1,this.attrs=o},RectBasic.prototype.make_rough_shape=function(e){var t=posit2.get_w_h(e),r=_slicedToArray(t,2),n=r[0],o=r[1]
return y=roughing.hook.rectangle(0,0,n,o,roughing.get_specs(e)),y},RectBasic.prototype.calc_catcher_attrs=function(e,t){var r={}
return r.width=catcher_width+e,r.height=catcher_width+t,r.transform="translate("+[-catcher_width/2,-catcher_width/2]+")",r.style="stroke-width:"+catcher_width,r},RectBasic.prototype.calc_border=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]
if(_.all(t)||_.all(t.map(function(e){return!e})))return e.style.strokeDasharray="",!1
for(var r=posit2.get_w_h(e),n=_slicedToArray(r,2),o=n[0],a=n[1],i=["rx","ry"].map(function(t){return parseFloat(e.querySelector("rect").getAttribute(t))}),s=_slicedToArray(i,2),c=s[0],l=s[1],u=(parseFloat(window.getComputedStyle(e).strokeWidth),2*Math.PI*Math.sqrt((c*c+l*l)/2)/4),d=o-2*c,p=a-2*l,f=a1=u/2,m=b1=u/2,g=[d+f,m+p+b1,f+d+a1,m+p+b1,a1],h=t[0]?[]:[0],y=0;y<g.length;y++)y>0&&t[(y-1)%4]==t[y]?h[h.length-1]+=g[y]:h.push(g[y])
e.style.strokeDasharray=h.join(" ")},EllipseBasic.prototype=Object.create(Fig.prototype),EllipseBasic.prototype.constructor=EllipseBasic,EllipseBasic.prototype.make_rough_shape=function(e){var t=posit2.get_w_h(e),r=_slicedToArray(t,2),n=r[0],o=r[1],a=parseFloat(e.querySelector("ellipse").getAttribute("cx")),i=parseFloat(e.querySelector("ellipse").getAttribute("cy"))
return i=roughing.hook.ellipse(a,i,n,o,roughing.get_specs(e))},EllipseBasic.prototype.calc_attributes=function(e,t,r){var n=$.extend({},this.dims,e),o={g:{},fo:{},cp_resize:{},cp_helper:{},catcher:{}}
o[this.my_name]={},"width"in n&&(n.rx=n.width/2,n.ry=n.height/2),t?(t=to_discrete_position([t[0]-n.rx*r,t[1]-n.ry*r]),o.g.transform="translate("+t+") rotate(0) scale("+r+")"):_.has(e,"transform")&&(o.g.transform=e.transform),o.g.width=2*n.rx,o.g.height=2*n.ry,o.fo.transform="translate("+(2*n.rx-Math.sqrt(2)*n.rx)/2+","+(2*n.ry-Math.sqrt(2)*n.ry)/2+")",o.fo.width=Math.sqrt(2)*n.rx,o.fo.height=Math.sqrt(2)*n.ry,o.cp_resize.transform="translate("+2*n.rx+","+2*n.ry+")",o.cp_helper.transform="translate(22,"+2*n.ry+")",o.catcher=this.calc_catcher_attrs(o.g.width,o.g.height),o[this.my_name].rx=n.rx,o[this.my_name].ry=n.ry,o[this.my_name].cx=n.rx,o[this.my_name].cy=n.ry,o[this.my_name].tabindex=1,this.attrs=o},EllipseBasic.prototype.calc_catcher_attrs=function(e,t){var r={}
return r.rx=e/2+catcher_width/2,r.ry=t/2+catcher_width/2,r.cx=e/2,r.cy=t/2,r.style="stroke-width:"+catcher_width,r},EllipseBasic.prototype.path_placement_correction=function(e,t,r,n,o,a){var i=o/2,s=a/2
r+=i,n+=s
var _=this.get_offset(r,i,n,s,0,t),c=this.get_offset(r,i,n,s,2,t)
return[_,this.get_offset(r,i,n,s,1,t),c,this.get_offset(r,i,n,s,3,t)]},EllipseBasic.prototype.get_offset=function(e,t,r,n,o,a){var i=Math.PI,s=(1-a)*i+0*a
return 0==o?[t+t*Math.cos(s),n+-n*Math.sin(s)]:2==o?[t+t*Math.cos(s),n+n*Math.sin(s)]:1==o?[t+t*Math.sin(s),n+n*Math.cos(s)]:3==o?[t+-t*Math.sin(s),n+n*Math.cos(s)]:void 0},EllipseBasic.prototype.get_bbox_of_figure=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=posit2.get_top_left(e.node(),r),o=_slicedToArray(n,2),a=o[0],i=o[1],s=posit2.get_w_h(e.node(),!0),_=_slicedToArray(s,2),c=_[0],l=_[1]
return t?[a,i,c,l]:parse_to_bbox(a,i,c,l)},EllipseBasic.prototype.get_correction_for_paragraph_fit=function(){return[Math.sqrt(2),Math.sqrt(2)]},MathBasic.prototype=Object.create(Fig.prototype),MathBasic.prototype.constructor=MathBasic,MathBasic.prototype.trigger_math=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=document.createElement("P")
n.innerText=t?"$$"+t+"$$":"$$ X^{27} $$",MathJax.Hub.Queue(["Typeset",MathJax.Hub,n],function(e,t,r){var n=this
return function(){return n.callback(e,t,r)}}.bind(this)(e,n,r))},MathBasic.prototype.callback=function(e,t,r){e.selectAll("g").remove(),e.select("relay").remove()
var n=t.querySelector("svg > g"),o=t.querySelector("svg")
n.classList.add("relay"),n.classList.add("mainfig"),this.add_events(d3.select(n)),this.add_drag(d3.select(n)),e.node().appendChild(o)
var a=o.getBoundingClientRect(),i=toggle_zoom.get_zoom_factor()
e.attr("width",parseInt(a.width/i)),e.attr("height",parseInt(a.height/i)),e.attr("raw_mj",t.innerText)
var s=matrix_to_transform_object(n.getTransformToElement(e.node())),_=parseInt(window.getComputedStyle(e.node()).fontSize)*(1/800)
s.scale=[-_,_],Array.from(o.querySelectorAll("use")).map(function(e){return e.getAttribute("href")}).forEach(function(e){return document.body.querySelector(e).removeAttribute("stroke-width")}),Array.from(n.querySelectorAll("g")).forEach(function(e){return e.classList.add("relay")}),n.setAttribute("transform",transform_to_string(s)),["stroke","fill","stroke-width"].forEach(function(e){return n.removeAttribute(e)}),o.remove(),e.node().appendChild(n),e.node().classList.contains("example_fig")?(e.select(".mainfig").on("click",null),e.select(".mainfig").on(".drag",null),e.select(".catcher").remove(),e.select(".mainfig").classed("no-drag",!0),e.select(".mainfig").attr("transform","translate(0,0) scale(1,-1) rotate(0)")):(this.add_catcher(e.node()),r||(set_currentElement(e.node()),display_fs_for_shape(currentElement),gui.frame_element(currentElement)))},MathBasic.prototype.make=function(e,t,r){var n=Fig.prototype.make.call(this,e,to_discrete_position(t),r)
return this.trigger_math(n),n},MathBasic.prototype.add_catcher=function(e){var t=e.querySelector("g.mainfig"),r=t.cloneNode(!0)
r.style.strokeWidth="400px",r.classList.add("catcher"),r.classList.remove("mainfig"),object_to_event.cp_helper.forEach(function(e){d3.select(r).on(e.event_type,e.func)}),d3.select(r).call(object_to_drag.cp_helper),e.appendChild(r)},MathBasic.prototype.resize_text=function(e){this.trigger_math(e,e.attr("raw_mj"))},SvgIcon.prototype=Object.create(Fig.prototype),SvgIcon.prototype.constructor=SvgIcon,SvgIcon.prototype.import=function(e){function t(e){var t=["stroke","strokeWidth","fill","strokeDasharray"],r={}
return t.forEach(function(t){r[t]=e.style[t]}),r}var r=new DOMParser,n=r.parseFromString(e,"application/xml"),o=n.querySelectorAll("path")
try{var a=this.get_w_h_scale_on_import(n),i=_slicedToArray(a,3),s=i[0],_=i[1],c=i[2]}catch(e){return text_to_feedback_pane("invalid svg"===e?"no width or height found on svg. Cannot import":"Encountered error while importing. Failed import of svg."),!1}this.calc_attributes({width:s,height:_},last_pos,c),this.id_less||(this.attrs.g.id=this.next_id()),this.attrs.g.i_am_a=this.my_name
var l=this.add_element(svg,"g",this.attrs.g)
l.attr("width",s).attr("height",_),l=l.append("g").attr("class","mainfig relay"),this.add_events(l),this.add_drag(l),o.forEach(function(e){l.append("path").attr("d",e.getAttribute("d")).style(t(e))})},SvgIcon.prototype.get_w_h_scale_on_import=function(e){var t=e.querySelector("svg"),r=!1
if(t.hasAttribute("width")&&t.hasAttribute("height")){var n=parseInt(t.getAttribute("width")),o=parseInt(t.getAttribute("height")),a=Math.max(n,o)
r=100/a}else if(t.hasAttribute("viewBox")){var i=t.getAttribute("viewBox"),s=i.split(" "),_=_slicedToArray(s,4),n=(_[0],_[1],_[2]),o=_[3],n=parseInt(n),o=parseInt(o),a=Math.max(n,o)
r=100/a}if(r)return[n,o,r]
throw"invalid svg"},Polygon.prototype=Object.create(Fig.prototype),Polygon.prototype.constructor=Polygon,Polygon.prototype.make_rough_shape=function(e){var t=this.set_poly_points(d3.select(e))
t.push(t[0])
var r=line_generator(t.map(function(e){return{x:e[0],y:e[1]}}))+"z"
return roughing.hook.path(r,roughing.get_specs(e))},Polygon.prototype.make=function(e,t,r,n){n=n||this.my_name,this.set_shape(n,!1)
var o=Fig.prototype.make.call(this,e,t,r)
return text_to_help_pane(help_text.polygon,!1,!1),o},Polygon.prototype.resize_me=function(e,t,r,n){return this.set_shape(e.attr("i_am_a"),e),Fig.prototype.resize_me.call(this,e,t,r,n)},Polygon.prototype.set_shape=function(e,t){if(t&&t.select("polygon").node().hasAttribute("points"))this.calc_shape_and_pos(this.set_poly_points(t))
else{var r=poly_config[e]||poly_config[this.my_shape]
this.points=r.points,this.fo_top_left=r.fo_top_left,this.fo_width=r.fo_width,this.fo_height=r.fo_height,"dims"in r&&(this.dims=r.dims)}this.my_name=e},Polygon.prototype.calc_polygon_points=function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return to_discrete_position([e,t],Math.round)},n=[],o=this.points,a=0;a<o.length;a++)n.push(r(o[a][0]*e,o[a][1]*t))
return n},Polygon.prototype.points_to_string=function(e){return e.reduce(function(e,t){return e+" "+t[0]+","+t[1]})},Polygon.prototype.calc_polygon=function(e){var t=this.attrs.g.width,r=this.attrs.g.height,n=this.calc_polygon_points(t,r,function(e,t){return[round_to(e,4),round_to(t,4)]})
this.abs_points=n
var o=this.points_to_string(n)
return e?[o,n]:o},Polygon.prototype.calc_fo=function(e,t,r){if(e||!poly_config[this.my_name].fo_dims)return{transform:"translate("+[this.fo_top_left[0]*t,this.fo_top_left[1]*r]+")",width:this.fo_width*t,height:this.fo_height*r}
var n={},o=this.find_inside_pos_for_fo(find_g(currentElement)),a=o[0],i=posit2.get_top_left(find_g(currentElement)),e=[a[0]-i[0],a[1]-i[1]]
return n.transform="translate("+e+")",n.width=o[1],n.height=o[2],n},Polygon.prototype.calc_border=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]
if(!_.any(t))return e.querySelector("polygon").style.strokeDasharray=null,!1
for(var r=posit2.get_w_h(e),n=_slicedToArray(r,2),o=n[0],a=n[1],i=this.calc_polygon_points(o,a),s=[],c=i.length,l=0;l<i.length;l++){var u=pyth_dist(i[l],i[(l+1)%c])
s.push(Math.sqrt(u))}var d=(s.reduce(function(e,t){return e+t}),iama(e)),p=poly_config[d].borders,f=new Array(c).fill(!1)
sides_to_draw=[],t.forEach(function(e,t){e&&sides_to_draw.push(p[t])}),sides_to_draw=_.flatten(sides_to_draw),sides_to_draw.forEach(function(e){return f[e]=!0}),vals=[],f[0]||vals.push(0),vals.push(s[0])
for(var l=1;l<c;l++)f[l-1]==f[l]?vals[vals.length-1]+=s[l]:vals.push(s[l])
e.querySelector("polygon").style.strokeDasharray=vals.join(" ")},Polygon.prototype.calc_attributes=function(e,t,r){var n=$.extend({},this.dims,e),o={g:{},fo:{},cp_resize:{},cp_rotate:{},cp_helper:{},catcher:{}}
if(o[this.my_name]={},this.attrs=o,t){var a=to_discrete_position([t[0]-n.width/2*r,t[1]-n.height/2*r])
o.g.transform="translate("+a+") rotate(0) scale("+r+")"}else _.has(e,"transform")&&(o.g.transform=e.transform)
o.g.width=n.width,o.g.height=n.height,o[this.my_name].points=this.calc_polygon(),this.constructs.find(function(e){return e===fo})&&(o.fo=this.calc_fo(t,n.width,n.height)),o.cp_resize.transform="translate("+n.width+","+n.height+")",o.cp_helper.transform="translate(22,"+n.height+")",o.catcher=this.calc_catcher_attrs(o.g.width,o.g.height),o[this.my_name].tabindex=1},Polygon.prototype.calc_catcher_attrs=function(e,t){var r={},n=this.calc_polygon_points(catcher_width+e,catcher_width+t,function(e,t){return[e,t]})
return r.points=this.points_to_string(n),r.transform="translate("+[-catcher_width/2,-catcher_width/2]+")",r.style="stroke-width:"+catcher_width,r},Polygon.prototype.set_poly_points=function(e){return this.used_points=e.select("polygon").attr("points").split(" ").map(function(e){return e.split(",").map(function(e){return parseFloat(e)})}),this.used_points},Polygon.prototype.path_placement_correction=function(e,t,r,n,o,a){this.set_shape(e.attr("i_am_a"),e)
var i=this.get_offset(r,n,o,a,0,t),s=this.get_offset(r,n,o,a,2,t)
return[i,this.get_offset(r,n,o,a,1,t),s,this.get_offset(r,n,o,a,3,t)]},Fig.prototype.inbetween=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=Math.min(e[0],t[0]),i=Math.max(e[0],t[0]),s=Math.min(e[1],t[1]),_=Math.max(e[1],t[1]),c=i-a,l=_-s
if(c<n){var u=(n-c)/2
a-=u,i+=u}if(l<n){var u=(n-l)/2
s-=u,_+=u}o>0&&(a-=o,s-=o,i+=o,_+=o)
var d=a<=r[0]&&r[0]<=i,p=s<=r[1]&&r[1]<=_
return d&&p}
var testers=[]
Polygon.prototype.get_offset=function(e,t,r,n,o,a){o=parseInt(o),a=parseFloat(a)
var i=[[r*a,0],[r,n*a],[r*a,n],[0,n*a]][o],s=o%2==0?0:1,_=find_index_of_closest_point(this.points,[i[0]/r,i[1]/n]),c=this.calc_polygon_points(r,n),l=c.length
if(3==c.length)var u=this.for_triangle(_,c,i,s)
else{var d=this.inbetween(c[_],c[(_+1)%l],i,0,1),p=this.inbetween(c[l*(_<1)+(_-1)%l],c[_],i,0,1)
if(d&&!p)var f=(_+1)%l
else if(p&&!d)var f=l*(_<1)+(_-1)%l
else if(d&&p)if(between_two_lines(c[_],c[(_+1)%l],[i]))var f=(_+1)%l
else if(between_two_lines(c[l*(_<1)+(_-1)%l],c[_],[i]))var f=l*(_<1)+(_-1)%l
else var m=find_closest_projectable(o,c,i),g=_slicedToArray(m,2),_=g[0],f=g[1]
else var h=find_closest_projectable(o,c,i),y=_slicedToArray(h,2),_=y[0],f=y[1]
var u=calc_x_from_y(c[_],c[f],i[s],s%2==0,!0)}return[u[0],u[1]]},Polygon.prototype.for_triangle=function(e,t,r,n){var o=[0,1,2]
o.splice(e,1)
var a=o[0],i=o[1],s=Math.min(Math.abs(t[e][0]-t[a][0]),Math.abs(t[e][1]-t[a][1])),_=Math.min(Math.abs(t[e][0]-t[i][0]),Math.abs(t[e][1]-t[i][1])),c=s<_?a:i
return this.inbetween(t[e],t[c],r)||(o.splice(o.indexOf(c),1),c=o[0]),calc_x_from_y(t[e],t[c],r[n],n%2==0,!0)},Polygon.prototype.get_my_points=function(e){function t(e){return[parseFloat(e.getAttribute("cx")),parseFloat(e.getAttribute("cy"))]}var r=e.querySelectorAll(".cp.poly_point")
return _.sortBy(r,function(e){return parseInt(e.getAttribute("my_index"))}).map(t)},Polygon.prototype.get_bbox_of_figure=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2]
if(arguments.length>3&&void 0!==arguments[3]&&!arguments[3])return Fig.prototype.get_bbox_of_figure.call(this,e,t,r=!1)
var n=posit2.get_top_left(e.node(),r),o=_slicedToArray(n,2),a=o[0],i=o[1],s=e.select("foreignObject"),_=posit2.get_trans_from_string(s.attr("transform")).translate
a+=_[0],i+=_[1]
var c=posit2.get_trans(e.node()).scale,l=parseFloat(s.attr("width"))*c,u=parseFloat(s.attr("height"))*c
return t?[a,i,l,u]:parse_to_bbox(a,i,l,u)},Polygon.prototype.reshape=function(e,t,r){var n=currentElement,o=poly_config[this.my_name].shape,a=this.set_poly_points(d3.select(n)),i=o(a,t,r),s=_slicedToArray(i,3)
return a=s[0],t=s[1],r=s[2],this.calc_shape_and_pos(a),Fig.prototype.resize_me.call(this,d3.select(n),t,r,!1),x=parseInt(e.getAttribute("cx")),y=parseInt(e.getAttribute("cy")),[t+x,r+y]},Polygon.prototype.get_correction_for_paragraph_fit=function(){return[1/this.fo_width,1/this.fo_height]},Polygon.prototype.get_points_on_border=function(e){try{var t=e.querySelector("polygon").getAttribute("points")}catch(e){console.log("figure corrupted: delete it")}t=t.split(" ").map(function(e){return e.split(",").map(function(e){return parseInt(e)})})
var r=posit2.get_top_left(e,!0)
return t.map(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1]
return[n+r[0],o+r[1]]})},PolyPoints.prototype=Object.create(Polygon.prototype),PolyPoints.prototype.constructor=PolyPoints,PolyPoints.prototype.get_correction_for_paragraph_fit=function(){return[1,1]},Polygon.prototype.calc_shape_and_pos=function(e){var t=this.find_min_max(e),r=_slicedToArray(t,4),n=r[0],o=r[1],a=r[2],i=r[3],s=Math.max(o-n,1),_=Math.max(i-a,1)
return this.points=e.map(function(e){var t=_slicedToArray(e,2),r=t[0],o=t[1]
return[(r-n)/s,(o-a)/_]}),this.my_name=this.my_name,this.dims={width:s,height:_},[n+(o-n)/2,a+(i-a)/2]},Polygon.prototype.find_min_max=function(e){for(var t=1/0,r=1/0,n=0,o=0,a=0;a<e.length;a++){var i=e[a]
t=Math.min(t,i[0]),n=Math.max(n,i[0]),r=Math.min(r,i[1]),o=Math.max(o,i[1])}return[t,n,r,o]},PolyPoints.prototype.make=function(e,t,r){var n=this.calc_shape_and_pos(t,r),o=Fig.prototype.make.call(this,e,n,{}),a=this.dims.width,i=this.dims.height
return this.points.forEach(function(e,t){return add_control_point(o,{x:e[0]*a,y:e[1]*i},"poly_point",t.toString())}),this.add_foreignObject(o.node()),o},PolyPoints.prototype.reshape=function(e,t,r){var n=e.parentElement
if(stop_poly_point_when_rotated(n))return!1
var o=(posit2.get_trans(n),parseFloat(e.getAttribute("my_index"))),a=this.calc_repos(o,this.get_my_points(n)),i=_slicedToArray(a,2),s=i[0],c=i[1]
x=parseInt(e.getAttribute("cx"))+t,y=parseInt(e.getAttribute("cy"))+r,d3.select(e).attr("cx",x).attr("cy",y),this.calc_shape_and_pos(this.get_my_points(n),{},e),n.setAttribute("width",this.dims.width),n.setAttribute("height",this.dims.height),this.attrs.g.width=this.dims.width,this.attrs.g.height=this.dims.height
var l=this.calc_polygon(!0),u=_slicedToArray(l,2),d=u[0],p=u[1]
n.querySelector("polygon").setAttribute("points",d)
var f=this.calc_repos(o,p),m=_slicedToArray(f,2),g=m[0],h=m[1];(c||s||g||h)&&object_mapper[iama(n)].reposition_me(n,(s||g)*t,(c||h)*r,!0)
var v=_.sortBy(n.querySelectorAll(".cp.poly_point"),function(e){return parseInt(e.getAttribute("my_index"))})
v.forEach(function(e,t){return d3.select(e).attr("cx",p[t][0]).attr("cy",p[t][1])})
var b=1/0,k=0,w=1/0,E=0
return v.forEach(function(e){var t=parseInt(e.getAttribute("cx")),r=parseInt(e.getAttribute("cy"))
b=Math.min(b,t),k=Math.max(k,t),w=Math.min(w,r),E=Math.max(E,r)}),n.setAttribute("width",k-b),n.setAttribute("height",E-w),this.repos_foreignObject(n),[x,y]},PolyPoints.prototype.resize_me=function(e,t,r,n){this.set_shape(e.attr("i_am_a"),e)
var o=Fig.prototype.resize_me.call(this,e,t,r,n)
return this.repos_foreignObject(e.node()),svg.selectAll(".cp.poly_point").empty()||(svg.selectAll(".cp.poly_point").remove(),toggle_poly_points(e.node())),o},PolyPoints.prototype.calc_repos=function(e,t){var r=ddy=!1,n=t.map(function(e){return e[0]}),o=t.map(function(e){return e[1]})
return 0==t[e][0]&&1==n.filter(function(e){return 0==e}).length&&(r=!0),0==t[e][1]&&1==o.filter(function(e){return 0==e}).length&&(ddy=!0),[r,ddy]},PolyPoints.prototype.get_bbox_of_figure=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2]
return Fig.prototype.get_bbox_of_figure.call(this,e,t,r)},Fig.prototype.insert_point=function(e,t,r){var n=this,o=posit2.get_trans(e).translate
t=[t[0]-o[0],t[1]-o[1]],t=t.map(function(e){return Math.floor(e/mdd)*mdd})
var a=r.length,i=r.map(function(e,t){return[e,r[(t+1)%a]]}).map(function(e){return n.inbetween(e[0],e[1],t,25)}).indexOf(!0)+1
if(!i)return text_to_feedback_pane(["cannot find position for new point","click in between to points, for both x and y"],!1,!0),[!1,!1,!1]
var s=r.splice(i)
return r.push(t),r=r.concat(s),[r,t,i]},PolyPoints.prototype.add_point=function(e,t){if(stop_poly_point_when_rotated(e))return!1
var r=this.get_my_points(e),n=this.insert_point(e,t,r),o=_slicedToArray(n,3),r=o[0],t=o[1],a=o[2]
if(0==r)return!1
for(var i=_.sortBy(e.querySelectorAll(".cp.poly_point"),function(e){return parseInt(e.getAttribute("my_index"))}),s=a;s<i.length;s++)i[s].setAttribute("my_index",(s+1).toString())
var c=add_control_point(d3.select(e),{x:t[0],y:t[1]},"poly_point",a.toString())
this.reshape(c.node(),0,0)},PolyPoints.prototype.add_foreignObject=function(e){var t=this.find_inside_pos_for_fo(e),r=_slicedToArray(t,3),n=_slicedToArray(r[0],2),o=n[0],a=n[1],i=r[1],s=r[2],_=posit2.get_top_left(e)
d3.select(e).append("foreignObject").attr("transform","translate("+[o-_[0],a-_[1]]+")").attr("width",i).attr("height",s).append("xhtml:article")},PolyPoints.prototype.repos_foreignObject=function(e){var t=this.find_inside_pos_for_fo(e),r=_slicedToArray(t,3),n=_slicedToArray(r[0],2),o=n[0],a=n[1],i=r[1],s=r[2],_=posit2.get_top_left(e)
d3.select(e).select("foreignObject").attr("transform","translate("+[o-_[0],a-_[1]]+")").attr("width",i).attr("height",s)},Slide.prototype=Object.create(PolyPoints.prototype),Slide.prototype.constructor=Slide,Slide.prototype.make=function(e,t,r){var n=PolyPoints.prototype.make.call(this,e,t,r)
return this.move_els_inside_to_top(n),n},Slide.prototype.reshape=function(e,t,r){var n=PolyPoints.prototype.reshape.call(this,e,t,r),o=_slicedToArray(n,2),a=o[0],i=o[1]
return this.move_els_inside_to_top(d3.select(e.parentElement)),[a,i]},Slide.prototype.move_els_inside_to_top=function(e){this.find_elements_in_bbox(e,!0,!1).forEach(function(e){return move_element_to_top(e)})},Slide.prototype.calc_shape_and_pos=function(e,t,r){if(e.length<3){var n=50,o=50
"width"in t&&(n=t.width,o=t.height),e=[e,[e[0]+n,e[1]+o]]
var a=PolyPoints.prototype.calc_shape_and_pos.call(this,e)}else{var i=parseInt(r.getAttribute("my_index")),s=(i+2)%4,_=Math.abs(e[i][0]-e[s][0]),c=Math.abs(e[i][1]-e[s][1])
this.fo_top_left=[0,0],this.dims={width:_,height:c},a=0}return this.points=[[0,0],[1,0],[1,1],[0,1]],a},Slide.prototype.calc_repos=function(e,t){return 0==e?[1,1]:1==e?[0,1]:2==e?[0,0]:3==e?[1,0]:void 0},Slide.prototype.make_snap_shot=function(e,t){function r(e,t){var r=posit2.get_trans(e,!0,!1)
return"scale("+l+") translate("+[r.translate[0]-s,r.translate[1]-c]+")  rotate("+r.rotate+") scale("+r.scale+")"}var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=_slicedToArray(posit2.get_trans(e,!1,!1).translate,2),s=i[0],c=i[1],l=find_scale_factor(slide_preview_dims.width,slide_preview_dims.height,parseInt(e.getAttribute("width")),parseInt(e.getAttribute("height")))
n&&(l=n)
var u=this.find_elements_in_bbox(d3.select(e),!0,!1,!0,a)
if(u=function(e){var t=[]
return e.forEach(function(e){return"slide"!=iama(e)&&(!e.classList.contains("i_am_grouped")||"slide"!=iama(e.parentElement))&&void t.push(e)}),t}(u),e.hasAttribute("els_to_hide")){var d=e.getAttribute("els_to_hide").split("*").slice(1).map(function(e){return"_"+e}).filter(function(e){return e.length>4})
u=u.filter(function(e){return!d.find(function(t){return t==e.id})&&"slide"!=iama(e)})}return _.forEach(u,function(e){if("math_basic"==iama(e)){var n=e.cloneNode(!0)
t.node().appendChild(n),n=d3.select(n)}else if("path_group"==iama(e))var n=copy_path_for_slide(e,t)
else var n=copy_element(e,!1,posit2.get_top_left(e),!0,t,!1)
n.attr("transform",r(e,n.node()))}),t.attr("pos_info",this.get_bbox_of_figure(d3.select(e),!0)),e.classList.add("existing"),o&&(d3.select(e).style("fill","rgb(159, 172, 201)").style("opacity",.2).transition().style("fill","white").style("opacity",.5).duration(100).transition().style("fill",null).style("opacity",null).each("end",function(){this.classList.add("hidden")}),toggle_poly_points(e)),remove_plumb_lines(),t},Slide.prototype.shrink_wrap_around_figures=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[5,5,5,5],r=this.find_elements_in_bbox(d3.select(e),!0),n=this.find_boundaries_based_on_inside_figs(r),o=parseInt(e.getAttribute("width")),a=parseInt(e.getAttribute("height")),i=n.top-t[0],s=n.left-t[2]
ido(e).reposition_me(e,s,i)
var _=n.right-n.left+t[1]+t[3],c=n.bottom-n.top+t[0]+t[2]
cp=e.querySelector('circle[my_index="2"]'),ido(e).reshape(cp,_-o,c-a)},Slide.prototype.calc_border=function(){return!1},Fig.prototype.find_boundaries_based_on_inside_figs=function(e){function t(e,t){return e.top=Math.min(e.top,t.x0y0[1]),e.bottom=Math.max(e.bottom,t.x1y1[1]),e.left=Math.min(e.left,t.x0y0[0]),e.right=Math.max(e.right,t.x1y1[0]),e}var r=_.map(e,function(e){return["path_group","text_path"].find(function(t){return t==iama(e)})?bbox=get_bbox_for_path(e):bbox=ido(e).get_bbox_of_figure(d3.select(e))})
return _.reduce(r,t,{top:1/0,bottom:0,left:1/0,right:0})}
var _slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()
TextBasic.prototype=Object.create(Fig.prototype),TextBasic.prototype.constructor=TextBasic,TextBasic.prototype.make=function(e,t,r){var n=Fig.prototype.make.call(this,e,t,r)
return text=this.text?this.text:"perfect",n.select("text").text(text),this.transform_correction(n,t),this.add_catcher(n.node()),n},TextBasic.prototype.transform_correction=function(e,t){var r=(e.select("text").node().getCTM(),e.select("text").node().getBBox()),n=t[1]-r.y,o=t[0],a=to_discrete_position([o-r.width/2,n-r.height-r.height/2])
e.attr("transform","translate("+a+")"),e.attr("width",r.width),e.attr("height",r.height),e.select("text").attr("transform"," translate("+[0,-r.y]+")")},TextBasic.prototype.resize_text=function(e){if(e.node().querySelector("tspan")){var t=1.1*parseInt(window.getComputedStyle(e.node()).fontSize)
e.selectAll("tspan").attr("dy",t)}var r=e.select("text").node().getBBox(),n=(parseFloat(e.attr("width")),parseFloat(e.attr("height"))),o=posit2.get_trans(e.node(),!1,!1)
o.translate=[o.translate[0],o.translate[1]+n-r.height],e.attr("width",r.width).attr("height",r.height).attr("transform","translate("+o.translate+")"),e.select("text").attr("transform","translate("+[0,-r.y]+")"),this.add_catcher(e.node())},TextBasic.prototype.set_text=function(e){this.text=e},TextBasic.prototype.get_text=function(e){return _.reduce(e.querySelector("text").childNodes,function(e,t){return"tspan"==t.nodeName?e+"\n"+t.textContent:e+t.textContent},"")},TextBasic.prototype.block_to_path_vv=function(e){if(e.select("textPath").empty())var t=text_block.detach(e),r=text_path.bind_to_path(svg,e.select("path"),t.select("text"))
else var t=text_path.detach(e),r=text_block.bind_to_path(e.select("path").node(),t.node())
remake_path(find_path(!0)),currentElement=r},TextBasic.prototype.add_line_break=function(e){var t=e.querySelector("text").textContent,r=t.split("\n"),n=e.querySelector("text"),o=1.1*parseInt(window.getComputedStyle(currentElement).fontSize)
r.length>1?(str=r[0]+r.slice(1).reduce(function(e,t){return e+"<tspan x=0 dy="+o+">"+t+"</tspan>"},""),n.innerHTML=str):n.innerText=t
var a=e.querySelector("text").getBBox()
e.setAttribute("width",a.width),e.setAttribute("height",a.height),this.add_catcher(e)},TextBasic.prototype.add_catcher=function(e){var t="catcher_"+this.my_name
if(!(t in object_mapper))return!1
var r=e.querySelector("text.mainfig").cloneNode(!0)
r.classList.remove("mainfig"),r.classList.add("catcher"),d3.select(e).select("text.catcher").remove(),e.appendChild(r),object_mapper[t].add_events(d3.select(r)),object_mapper[t].add_drag(d3.select(r)),this.recalc_catcher(e)},TextBasic.prototype.recalc_catcher=function(e){e.querySelector(".catcher").style["stroke-width"]=catcher_width},TextBasic.prototype.add_paragraph=function(e,t){var t=this.get_text(e)+"\n"+t
d3.select(e).select("text").text(t),this.add_line_break(e)},TextBlock.prototype=Object.create(TextBasic.prototype),TextBlock.prototype.constructor=TextBlock,TextBlock.prototype.change_text=function(e,t){e.select("text").text(t),this.resize_text(e.select("g"))},TextBlock.prototype.bind_to_path=function(e,t){return d3.select(t).selectAll("text").attr("transform",null),this.transform_correction(d3.select(t),posit2.get_top_left(t)),this.add_border(d3.select(t)),pos_perc=.5,t.setAttribute("pos_perc",pos_perc),group_elements(d3.select(e.parentElement),d3.select(t)),this.add_drag(d3.select(t).select("text")),this.add_events(d3.select(t).select("text")),t.setAttribute("i_am_a","text_block"),d3.select(t).select(".cp_rotate").empty()||t.removeChild(t.querySelector(".cp_rotate")),t},TextBlock.prototype.add_border=function(e){var t=parseFloat(e.attr("width")),r=parseFloat(e.attr("height"))
posit2.get_trans(e.node()).translate,e.append("rect").attr("class","text_block_background").attr("width",t+this.XCOR).attr("height",r+this.YCOR).attr("transform","translate("+this.TRANSCOR+")").style("stroke-width",1).style("stroke","grey").style("fill","white"),$(e.select("text").node()).appendTo(e.node()),this.resize_text(e)},TextBlock.prototype.repos_along_path=function(e,t,r){r=r||0
var n=t.getBBox(),o=n.x+n.width*parseFloat(e.getAttribute("pos_perc"))+r,a=(o-n.x)/n.width,i=e.querySelector("text"),s=t.querySelector(".click_catcher"),_=s.getPointAtLength(s.getTotalLength()*a)
e.setAttribute("pos_perc",a),e.setAttribute("transform","translate("+[_.x-i.getBBox().width/2,_.y-i.getBBox().height/2]+")"),posit2.delete_item(e.id)},TextBlock.prototype.resize_border=function(e){var t=e.querySelector("text").getBBox()
d3.select(e).select("rect").attr("width",t.width+this.XCOR).attr("height",t.height+this.YCOR)},TextBlock.prototype.resize_text=function(e){TextBasic.prototype.resize_text.call(this,e),this.resize_border(e.node())},TextBlock.prototype.add_line_break=function(e){TextBasic.prototype.add_line_break.call(this,e),this.resize_border(e)},TextBlock.prototype.detach=function(e,t){var r=e.select("text"),n=r.text(),o=posit2.get_top_left(e.select("text").node())
if(t)o[0]+=t[0],o[1]+=t[1]
else{var a=e.select("text").node().getBBox()
o[0]+=a.width/2,o[1]+=a.height/2}var i=r.node().parentElement.id,s=find_current_font_class(r.node().parentElement),_=find_current_style_class(r.node().parentElement)
text_basic.set_text(n)
var c=text_basic.make(svg,o)
return c.attr("id",i),s&&set_class_on_element(find_g(c.node()),s,find_current_font_class),_&&set_class_on_element(find_g(c.node()),_,find_current_style_class),e.select('g[i_am_a="text_block"]').remove(),text_basic.set_text("perfect"),c},TextBlock.prototype.make_rough_shape=function(e){var t=posit2.get_w_h(e),r=_slicedToArray(t,2),n=r[0],o=r[1],a=roughing.get_specs(e.querySelector("rect"))
return y=roughing.hook.rectangle(0,0,n+this.XCOR,o+this.YCOR,a),y},TextPath.prototype=Object.create(TextBasic.prototype),TextPath.prototype.constructor=TextPath,TextPath.prototype.change_text=function(e,t){e.select("textPath").text(t),this.resize_text(e.select("g"))}
var PATH_COPY_STEPS=5
TextPath.prototype.bind_to_path=function(e,t,r,n){var o=d3.select(t[0][0].parentElement)
if(!o.select("textPath").empty())return text_to_feedback_pane("only one textpath per connection",!1,!0),!1
var a=r.node().getBBox().width,i=t.node().parentElement.querySelector(".click_catcher"),s=i.getTotalLength(),_=copy_part_of_path(i,s,s/2,a,PATH_COPY_STEPS),c=copy_part_of_path(i,s,s/2,a,PATH_COPY_STEPS,this.OFFSET),l=i.getBBox()
if(n)var u=(n-l.x)/l.width
else var u=.5
var d=r[0][0].parentElement.getAttribute("id")
d3.select("#mydefs").append("path").attr("d",c).attr("id","for"+d)
var p=o.append("g").attr("i_am_a","text_path").attr("id",d).attr("pos_perc",u).attr("my_length",a).attr("class","i_am_grouped"),f=find_current_font_class(r.node().parentElement),m=find_current_style_class(r.node().parentElement),g=r.node().style.fontSize||window.getComputedStyle(r.node()).fontSize,h=(p.append("path").attr("class","text_path_background").attr("d",_).style("stroke-width",g).style("stroke-linecap","round"),p.append("text").attr("class","mainfig").attr("rel_type","custom").append("textPath").attr("xlink:href","#for"+d).call(drag_along_path).text(r.text()))
return f&&set_class_on_element(find_g(h.node()),f,find_current_font_class),m&&set_class_on_element(find_g(h.node()),m,find_current_style_class),this.add_events(h),r.node().parentNode.remove(),p.node()},TextPath.prototype.repos_along_path=function(e,t,r){var n=t.getBBox(),o=n.x+n.width*parseFloat(e.getAttribute("pos_perc"))+r,a=(o-n.x)/n.width%2
a<0&&(a=2-a),this.update_path(t,o,a)},TextPath.prototype.parent_path_move=function(e,t){var r=parseFloat(t.getAttribute("pos_perc")),n=e.getBBox(),o=n.x+r*n.width
this.update_path(e,o,r)},TextPath.prototype.resize_text=function(e){var t=e.node(),r=t.querySelector("text"),n=t.parentElement,o=r.querySelector("textPath").cloneNode(!0)
r.removeChild(r.querySelector("textPath")),r.textContent=o.textContent
var a=r.getBBox().width
r.textContent="",r.appendChild(o),this.add_drag(d3.select(r.firstChild)),this.add_events(d3.select(r.firstChild)),t.setAttribute("my_length",a)
var i=n.getBBox(),s=t.getAttribute("pos_perc"),_=i.width*s+i.x
this.update_path(n,_,s)},TextPath.prototype.update_path=function(e,t,r){var n=e.querySelector('g[i_am_a="text_path"]'),o=e.querySelector("path"),a=o.getTotalLength()*r,i=copy_part_of_path(o,a,o.getTotalLength(),parseFloat(n.getAttribute("my_length")),PATH_COPY_STEPS),s=copy_part_of_path(o,a,o.getTotalLength(),parseFloat(n.getAttribute("my_length")),PATH_COPY_STEPS,this.OFFSET),_=n.querySelector("text").style.fontSize||window.getComputedStyle(document.body).fontSize
n.setAttribute("pos_perc",r),d3.select(n).select(".text_path_background").attr("d",i).style("stroke-width",_).style("stroke-linecap","round"),d3.select("defs#mydefs").select(e.querySelector("textPath").getAttribute("href")).attr("d",s),posit2.delete_item(n.id)},TextPath.prototype.detach=function(e){var t=e.select('g[i_am_a="text_path"]'),r=t.select("text").text(),n=t.select(".text_path_background").attr("d").slice(0,40).match(/[A-Z]([0-9]*\.*[0-9]*),([0-9]*)/).slice(1,3),o=t.attr("id"),a=find_current_font_class(t.node()),i=find_current_style_class(t.node())
d3.select(t.attr("href")).remove(),t.remove(),text_basic.set_text(r)
var s=text_basic.make(svg,n)
return s.attr("id",o),a&&set_class_on_element(find_g(s.node()),a,find_current_font_class),i&&set_class_on_element(find_g(s.node()),i,find_current_style_class),text_basic.set_text("perfect"),s},PathBasic.prototype=Object.create(Fig.prototype),PathBasic.prototype.constructor=PathBasic,PathBasic.prototype.make_rough_shape=function(e){var t=e.querySelector(".mainfig").getAttribute("d"),r=roughing.hook.path(t,roughing.get_specs(e)),n=e.querySelector(".mainfig").getAttribute("transform")
return d3.select(r).selectAll("path").attr("transform",n),r},PathBasic.prototype.get_initial_bbox=function(e,t){var r=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],posit2.get_top_left(e.node())),n=path_to_array(e.node().querySelector("path").getAttribute("d"))
minX=Math.min.apply(null,n.map(function(e){return e.x}))+r[0],maxX=Math.max.apply(null,n.map(function(e){return e.x}))+r[0],minY=Math.min.apply(null,n.map(function(e){return e.y}))+r[1],maxY=Math.max.apply(null,n.map(function(e){return e.y}))+r[1]
var o=posit2.get_trans(e.node()),a=(maxX-minX)*o.scale,i=(maxY-minY)*o.scale
return t?[minX,minY,a,i]:parse_to_bbox(minX,minY,a,i)},PathBasic.prototype.get_offset_path_to_canvas=function(e){return posit2.get_top_left(e,!0)},PathBasic.prototype.get_path_offset=function(e){return d3.transform(d3.select(e).select("path.mainfig").attr("transform")).translate},PathBasic.prototype.get_tlbr=function(e){var t=this.get_bbox_of_figure(d3.select(e),!0)
return{top:t[1],left:t[0],bottom:t[1]+t[3],right:t[0]+t[2]}},PathBasic.prototype.reposition_me=function(e,t,r,n,o){var a=Fig.prototype.reposition_me.call(this,e,t,r,n,o),i=e.querySelector("path").getAttribute("d")
if(e.querySelector("circle")){var s=this.get_offset_path_to_canvas(e),_=this.get_path_offset(e),c=[s[0]+_[0],s[1]+_[1]]
move_path_control_points(i,d3.select(e),void 0,_),"lineto"!=e.getAttribute("flow")&&add_lines_to_control_points(path_to_array(i),c)}return a},PathBasic.prototype.get_pos_for_foreignObject=function(e){var t=this.find_inside_pos_for_fo(e),r=_slicedToArray(t,3),n=_slicedToArray(r[0],2),o=n[0],a=n[1],i=r[1],s=r[2],_=posit2.get_top_left(e)
return[[o-_[0],a-_[1]],i,s]},PathBasic.prototype.add_foreignObject=function(e){var t=this.get_pos_for_foreignObject(e),r=_slicedToArray(t,3),n=r[0],o=r[1],a=r[2]
if(0==o||0==a)return text_to_feedback_pane("shape to weird to add text to."),!1
d3.select(e).append("foreignObject").attr("transform","translate("+n+")").attr("width",o).attr("height",a).append("xhtml:article"),e.querySelector("path.mainfig").style.pointerEvents=null,text_to_feedback_pane("Shape can now contain text. Double click it to add text")},PathBasic.prototype.repos_foreignObject=function(e){var t=this.get_pos_for_foreignObject(e),r=_slicedToArray(t,3),n=r[0],o=r[1],a=r[2]
d3.select(e).select("foreignObject").attr("transform","translate("+n+")").attr("width",o).attr("height",a)},PathBasic.prototype.get_points_on_border=function(e){var t=e.querySelector("path").getAttribute("d"),r=get_points_on_path(t),n=this.get_offset_path_to_canvas(e),o=this.get_path_offset(e)
return r.map(function(e){var t=_slicedToArray(e,2),r=t[0],a=t[1]
return[r+n[0]+o[0],a+n[1]+o[1]]})},PathBasic.prototype.path_placement_correction=function(e,t,r,n,o,a){function i(e){var t=[e[0],e[1]],r=t[0],n=t[1],o=u.map(function(e){var t=r-e.x,o=n-e.y
return t*t+o*o}),a=_.indexOf(o,_.min(o))
return[u[a].x,u[a].y]}var s=e.node(),c=s.querySelector("path"),l=c.getTotalLength(),u=_.range(20).map(function(e){return c.getPointAtLength(e*l/20)}),d=this.get_path_offset(s),p=i([o*t-d[0],-d[1]]),f=i([o*t-d[0],a-d[1]]),m=i([-d[0],a*t-d[1]]),g=i([o-d[0],a*t-d[1]]),d=d3.transform(s.querySelector("path").getAttribute("transform")).translate
return[p,g,f,m].map(function(e){var t=_slicedToArray(e,2),r=t[0],n=t[1]
return[r+d[0],n+d[1]]})},PathBasic.prototype.remake_path=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=find_g(e)
t&&ungroup_element(d3.select(r))
var n=posit2.get_top_left(r),o=path_basic.get_initial_bbox(d3.select(r),!0),a=_slicedToArray(o,4),i=a[0],s=a[1],_=a[2],c=a[3]
r.setAttribute("width",_),r.setAttribute("height",c),d3.select(r).selectAll("path").attr("transform","translate("+[n[0]-i,n[1]-s]+")"),r.querySelector(".catcher").setAttribute("d",e.getAttribute("d"))
var l=posit2.get_trans(r)
return l.translate=[i,s],posit2.set_trans(r.id,l),r.setAttribute("transform",transform_to_string(l)),t&&path_basic.add_foreignObject(r),d3.select(r)},PathBasic.prototype.resize_me=function(e,t,r,n){var o=!e.select(".cp").empty()
o&&toggle_visible()
var a,i=(d3.transform(e.attr("transform")),get_path_points_min_max(e.node())),s=_slicedToArray(i,4),_=s[0],c=s[1],l=s[2],u=s[3],d=c-_,p=u-l,f=path_to_array(e.node().querySelector("path").getAttribute("d"))
if(n?(a=t,new_h=r):(a=d+t,new_h=p+r),2!=f.length||0!=d&&0!=p){a<5|new_h<5&&(a=Math.max(5,a),new_h=Math.max(5,new_h),text_to_feedback_pane("no smaller possible",!1,!0))
var m=f.map(function(e){return{x:e.x/d,y:e.y/p}}),g=m.map(function(e){return{x:e.x*a,y:e.y*new_h}})}else g=f,0==d&&(a=0),0==p&&(new_h=0),g[f.length-1].x=a,g[f.length-1].y=new_h
var h="lineto"==e.attr("flow")?array_to_line(g):array_to_path(g)
e.select("path.mainfig").attr("d",h),e.select('path[i_am_a="catcher"]').attr("d",h),e.attr("width",a).attr("height",new_h),new_minX=Math.min.apply(null,g.map(function(e){return e.x})),new_minY=Math.min.apply(null,g.map(function(e){return e.y})),e.select("path.mainfig").attr("transform","translate("+[-_,-l]+")"),e.select('path[i_am_a="catcher"]').attr("transform","translate("+[-_,-l]+")"),e.select("foreignObject").empty()||this.repos_foreignObject(e.node()),o&&toggle_visible(),this.update_line_end_shapes(e.node())},PathBasic.prototype._update_path_flow=function(e){toggle_visible(e)
var t=get_path_points_min_max(e),r=_slicedToArray(t,4),n=r[0],o=r[1],a=r[2],i=r[3],s=o-n,_=i-a
e.setAttribute("width",s),e.setAttribute("height",_)
var c=posit2.get_trans_from_string(e.querySelector("path").getAttribute("transform")),l=_slicedToArray(c.translate,2),u=l[0],d=l[1]
dx=Math.round(u+n),dy=Math.round(d+a)
var p=posit2.get_trans(e)
p.translate[0]+=dx,p.translate[1]+=dy,e.setAttribute("transform",transform_to_string(p)),c.translate[0]-=dx,c.translate[1]-=dy,d3.select(e).selectAll("path").attr("transform","translate("+c.translate+")"),this.update_line_end_shapes(e),toggle_visible(e)},PathBasic.prototype.recalc_catcher=function(e){e.querySelector(".catcher").style["stroke-width"]=catcher_width},PathBasic.prototype.find_completely_covered_elements=function(e){var t=Fig.prototype.find_covered_elements.call(this,e),r=this.get_points_on_border(e.node())
return t.filter(function(e){var t=posit2.tlbr_to_coords(posit2.tlbr(e)),n=t.map(function(e){return point_is_inside(e,r)})
return _.all(n)})},PathBasic.prototype.stick_to_me=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]
my_els=t||this.find_completely_covered_elements(e),Fig.prototype.stick_to_me.call(this,e,my_els)},PathBasic.prototype.add_point=function(e,t){var r=this.get_path_offset(e),n=_slicedToArray(r,2),o=n[0],a=n[1],i=path_to_array(e.querySelector("path").getAttribute("d"))
i=i.map(function(e){return[e.x+o,e.y+a]})
var s=this.insert_point(e,t,i),_=_slicedToArray(s,3),c=_[0],t=_[1],l=(_[2],array_to_line(c.map(function(e){return{x:e[0]-o,y:e[1]-a}})))
d3.select(e).selectAll("path.mainfig, path.catcher").attr("d",l),e.querySelector(".cp")&&(toggle_visible(),toggle_visible())},Fig.prototype.add_shape_to_line=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:50,a=d3.select(e).append("g").attr("class","arrow_"+t).attr("type",r),i=e.querySelector("path"),s=i.getTotalLength()
if(0==t)var _=i.getPointAtLength(s),c=i.getPointAtLength(s-o)
else var _=i.getPointAtLength(0),c=i.getPointAtLength(o)
_=[_.x,_.y],c=[c.x,c.y]
var l=_[0]-c[0],u=_[1]-c[1]
c=_
var d=posit2.get_trans_from_string(i.getAttribute("transform")).translate
p_cor=[_[0]+d[0],_[1]+d[1]],_=[_[0]+l,_[1]+u],fig=path_end_figs[r].func(a,n,o,p_cor),angle=calc_arrow_angle(_,c),a.attr("transform","rotate("+[angle,p_cor[0],p_cor[1]]+")").attr("arrow_width",n).attr("arrow_height",o).on("click",function(e){currentElement=this,d3.event.stopPropagation(),fill_fs_path_label(this),gui.frame_element(this)}),a.node().style=path_end_figs[r].style,a.node().style.strokeWidth=e.querySelector("path").style.strokeWidth
var p=e.querySelector("path").style.stroke||window.getComputedStyle(e).stroke
return a.node().style.stroke=p,p="filled"in path_end_figs[r]?p:"none",a.node().style.fill=p,a.node()},Fig.prototype.update_line_end_shapes=function(e){if("path_basic"==iama(e))var t=e.querySelector(".arrow_1"),r=e.querySelector(".arrow_0")
else if(e.classList.contains("arrow_0")){var r=e,t=!1
e=e.parentElement}else{var r=!1,t=e
e=e.parentElement}if(t){var n=t.getAttribute("style"),o=parseInt(t.getAttribute("arrow_width")),a=parseInt(t.getAttribute("arrow_height")),i=t.getAttribute("type")
t.remove(),this.add_shape_to_line(e,1,i,o,a).setAttribute("style",n)}if(r){var s=r.getAttribute("style"),_=parseInt(r.getAttribute("arrow_width")),c=parseInt(r.getAttribute("arrow_height")),i=r.getAttribute("type")
r.remove(),this.add_shape_to_line(e,0,i,_,c).setAttribute("style",s)}},PathBasic.prototype.get_cp_pos=function(e,t,r){var n=posit2.get_top_left(e,!0),o=_slicedToArray(n,2),a=o[0],i=o[1],s=this.get_path_offset(currentElement),_=_slicedToArray(s,2)
return[a+_[0]+t,i+_[1]+r]}
var testing_rects=!1
Fig.prototype.find_inside_pos_for_fo=function(e){for(var t=this.get_bbox_of_figure(d3.select(e),!0,!0,!1),r=_slicedToArray(t,4),n=r[0],o=r[1],a=r[2],i=r[3],s=[],_=0;_<=i;_+=5){for(var c=[],l=0;l<=a;l+=5)c.push([l+n,_+o])
s.push(c)}var u=this.get_points_on_border(e),d=s.map(function(e){return e.map(function(e){return point_is_inside(e,u)})})
testing_rects&&d.forEach(function(e,t){e.forEach(function(e,r){var a=rect_basic.make(svg,[n+5*r+2.5,o+5*t+2.5],{width:5,height:5}),i=e?"rgba(1,1,1,0.5)":"rgba(0,0,0,0.10)"
a.select(".mainfig").attr("fill",i)})})
var p=find_largest_rect(d),f=_slicedToArray(p,4)
tl_x=f[0],br_y=f[1],br_x=f[2],tl_y=f[3]
var m=[n+5*tl_x,o+5*tl_y],a=5*(br_x-tl_x+1),i=5*(br_y-tl_y+1)
if(e.classList.contains("i_am_grouped")){var g=posit2.get_top_left(e.parentElement,!0)
m[0]-=g[0],m[1]-=g[1]}return[m,a,i]},CountryBasic.prototype=Object.create(PathBasic.prototype),CountryBasic.prototype.constructor=CountryBasic,CountryBasic.prototype.get_bbox_of_figure=function(e,t){var r=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.get_offset_path_to_canvas(e.node())),n=path_to_array(e.node().querySelector("path").getAttribute("d"))
minX=Math.min.apply(null,n.map(function(e){return e.x})),maxX=Math.max.apply(null,n.map(function(e){return e.x})),minY=Math.min.apply(null,n.map(function(e){return e.y})),maxY=Math.max.apply(null,n.map(function(e){return e.y}))
var o=posit2.get_trans(e.node()),a=o.scale,i=(maxX-minX)*a,s=(maxY-minY)*a
return t?[minX*a+r[0],minY*a+r[1],i,s]:parse_to_bbox(minX*a+r[0],minY*a+r[1],i,s)},CountryBasic.prototype.check_position=function(e){var t=posit2.get_top_left(e)
return[t[0]-correct_final_pos[0],t[1]-correct_final_pos[1]].map(function(e){return Math.round(e)})},CountryBasic.prototype.set_info=function(e){if(e=e?find_g(e):currentElement,d3.event&&("click"==d3.event.type||"touchend"==d3.event.type||"dragend"==d3.event.type)||!d3.event){var t=this.check_position(e),r=_slicedToArray(t,2),n=r[0],o=r[1],a=e.getAttribute("country")
if(0==n&&0==o){var i=Object.values(this.countries).reduce(function(e,t){return e+t},0)
if(e.hasAttribute("done"))text_to_feedback_pane([a,i+"/"+this.num_countries])
else{var s=Math.floor(Math.random()*congrats.length)
text_to_feedback_pane([congrats[s](a),i+"/"+this.num_countries]),this.flash(e),setTimeout(function(){e.setAttribute("done",1)},500)}i==this.num_countries&&(make_congrats_modal(),console.log("you did it")),this.countries[a]=!0}else this.countries[a]=!1
text_to_help_pane("")}else text_to_feedback_pane("?")},CountryBasic.prototype.get_my_pos=function(e){var t=e.querySelector("path").getAttribute("d"),r=path_to_array(t).map(function(e){return[e.x,e.y]}),n=get_min_max(r,function(e){return e[0]},function(e){return e[1]}),o=_slicedToArray(n,4)
minX=o[0],minY=o[1],maxX=o[2],maxY=o[3]
var a=posit2.get_trans_from_string(e.getAttribute("transform")),i=(maxX-minX)*a.scale,s=(maxY-minY)*a.scale
return[minX*a.scale+a.translate[0],minY*a.scale+a.translate[1],i,s]},CountryBasic.prototype.init_score=function(){var e=this,t=Array.from(document.querySelectorAll('g[i_am_a="country_basic"]'))
this.countries={},t.forEach(function(t){e.countries[t.getAttribute("country")]="0,0"===e.check_position(t).toString()}),this.num_countries=Object.keys(country_basic.countries).length},Fig.prototype.flash=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=e.querySelector(".catcher")
if(!r)return!1
r.classList.remove("catcher"),r.style.stroke="yellowgreen",catcher_flash(r,t,r.style.strokeWidth)},AxisBasic.prototype=Object.create(Fig.prototype),AxisBasic.prototype.constructor=AxisBasic,AxisBasic.prototype.reposition_me=function(e,t,r,n,o){if(e.parentElement.hasAttribute("crossed")||!n)return!1
var a=posit2.get_trans_from_string(e.getAttribute("transform"))
e.classList.contains("x_axis")?a.translate[1]+=r:a.translate[0]+=t,e.setAttribute("transform",transform_to_string(a)),e.parentElement.setAttribute("axes_custom_pos",!0),e.parentElement.removeAttribute("graph_axis_crossed")},AxisBasic.prototype.make_axis_func=function(e,t,r){var n=d3.scale.linear().range(t).domain(e)
return d3.svg.axis().scale(n).ticks(r).orient("x_axis"==this.my_name?"bottom":"left").outerTickSize(0)},AxisBasic.prototype.add_element=function(e,t,r,n){var o=this.make_axis_func(r.domain,r.range,r.num_ticks)
x_axis_offset=e.attr("height")
var a=e.append("g").attr("class","axis "+this.my_name+" "+this.myclasses.reduce(function(e,t){return e+" "+t}),"").attr("transform",r.transform).attr("num_ticks",r.num_ticks).on("click",function(){set_currentElement(find_g(this)),display_fs_for_shape(currentElement),gui.frame_element(currentElement),d3.event.stopPropagation()}).call(o)
return a.style(this.styles),this.post_styling(a),a},AxisBasic.prototype.resize_me_single=function(e,t){var r=e.select("."+this.my_name),n=this.make_axis_func(t.domain,t.range,r.attr("num_ticks"))
r.call(n),"transform"in t&&r.attr("transform",t.transform),this.post_styling(r)},AxisBasic.prototype.change_num_ticks=function(e,t){var r=d3.select(e.node().parentElement),n="x_axis"==this.my_name?"x":"y",o=this.get_styling(e),a={domain:graph_basic.get_domain(r,n),range:graph_basic.get_range(r,n),num_ticks:t}
e.remove()
var i=this.make_single(r,a)
ido(r).position_axes(r),ido(r).redo_grid(r),this.redo_styling(i,o)},AxisBasic.prototype.get_styling=function(e){return el=e.node(),{font:el.style.fontFamily,fontSize:el.style.fontSize,strokeWidth:el.style.strokeWidth,stroke:el.querySelector(".tick > line")?el.querySelector(".tick > line").style.stroke:"",text:el.querySelector(".tick > text")?el.querySelector(".tick > text").style.fill:"",styleClass:find_current_style_class(el),fontClass:find_current_font_class(el)}},AxisBasic.prototype.redo_styling=function(e,t){el=e.node(),""!=t.font&&(el.style.fontFamily=t.font),""!=t.fontSize&&(el.style.fontSize=t.fontSize),""!=t.strokeWidth&&(el.style.strokeWidth=t.strokeWidth),""!=t.styleClass&&set_class_on_element(el,t.styleClass,find_current_style_class),""!=t.fontClass&&set_class_on_element(el,t.fontClass,find_current_font_class),""!=t.stroke&&$(el).find(".tick > line, path.domain").css("stroke",t.stroke),""!=t.text&&$(el).find(".tick > text").css("fill",t.text)},AxisBasic.prototype.post_styling=function(e){e.selectAll("g").classed("relay",!0),"x_axis"==this.my_name&&e.selectAll(".tick text").attr("dy","0.8em"),"y_axis"==this.my_name&&e.selectAll(".tick text").attr("dx","-0.1em"),e.node().parentElement.classList.contains("no_nums")?e.classed("no_nums",!0):(e.classed("no_nums",!1),this.check_zero_tick_text(e))},AxisBasic.prototype.check_zero_tick_text=function(e){function t(){arr=Array.from(e.node().querySelectorAll(".tick text")),arr.forEach(function(e){e.textContent.match(/^0(\.0+)?$/)&&e.remove()})}if(!e.node().parentElement.hasAttribute("graph_axis_crossed"))return!1
if("y_axis"==this.my_name)t()
else{var r=graph_basic.get_domain(d3.select(e.node().parentElement),"y"),n=_slicedToArray(r,2)
a=n[0],b=n[1],0!=a&&0!=b&&t()}},LineForGraph.prototype=Object.create(Fig.prototype),LineForGraph.prototype.constructor=LineForGraph,LineForGraph.prototype.get_line_f=function(e,t,r){return d3.svg.line().x(function(t){return e(t)}).y(function(e){return t(r(e))})},LineForGraph.prototype.get_d=function(e,t,r){return r.reduce(function(r,n){return r+t(e.slice.apply(e,_toConsumableArray(n)))},"")},LineForGraph.prototype.change=function(e,t,r,n){var o=formula_mapper[e.id],a=this.get_line_f(t,r,o),i=this.get_d(n,a,find_splits.apply(void 0,[n,o].concat(_toConsumableArray(r.domain()))))
d3.select(e).selectAll("path").attr("d",i),e.classList.contains("dotted")&&this.add_dots(e,o,t,r)},LineForGraph.prototype.add=function(e,t,r){var n=e.append("g").attr("id",this.next_id()).attr("i_am_a","line_for_graph").attr("class","graphed_func i_am_grouped").attr("my_func",r).style(this.styles)
return n.append("path").attr("class","mainfig no_pointing").attr("d",""),this.constructs.forEach(function(e){e.make_single(n,this.calc_catcher_attrs())}.bind(this)),formula_mapper[n.node().id]=t,n},LineForGraph.prototype.recalc_catcher=function(e){e.querySelector(".catcher").style["stroke-width"]=catcher_width},LineForGraph.prototype.add_dots=function(e,t,r,n){e=d3.select(e),e.selectAll(".dots").remove()
for(var o=r.domain(),a=_slicedToArray(o,2),i=a[0],s=a[1],_=Math.round(i);_<=s;_++)_>=i&&e.append("circle").attr("cx",r(_)).attr("cy",n(t(_))).attr("r","2px").attr("class","dots")},RectCanvas.prototype=Object.create(RectBasic.prototype),RectCanvas.prototype.constructor=RectCanvas,RectCanvas.prototype.resize_me=function(e,t,r,n){if(repos_covered=document.querySelector("#form_repos_covered").checked,repos_covered)var o=Array.from(e.node().querySelectorAll("g[i_am_a]")),a=this.get_pos_of_covered_shapes(e,o)
Fig.prototype.resize_me.call(this,e,t,r,n),repos_covered&&this.repos_covered_shapes_after_resize(e,a)},RectCanvas.prototype.get_pos_of_covered_shapes=function(e,t){var r=posit2.get_w_h(e.node()),n=_slicedToArray(r,2),o=n[0],a=n[1],i=posit2.get_top_left(e.node()),s=_slicedToArray(i,2),_=(s[0],s[1],{})
return t.forEach(function(e){var t=posit2.get_top_left(e),r=_slicedToArray(t,2),n=r[0],i=r[1]
_[e.id]=[n/o,i/a]}),_},RectCanvas.prototype.repos_covered_shapes_after_resize=function(e,t){var r=posit2.get_top_left(e.node()),n=_slicedToArray(r,2),o=(n[0],n[1],posit2.get_w_h(e.node())),a=_slicedToArray(o,2),i=a[0],s=a[1]
Object.keys(t).forEach(function(e){var r=document.getElementById(e),n=_slicedToArray(t[r.id],2),o=n[0],a=n[1]
ido(r).reposition_me(r,o*i,a*s,!1)})},AxesBoard.prototype=Object.create(Fig.prototype),AxesBoard.prototype.constructor=AxesBoard,GraphBasic.prototype=Object.create(AxesBoard.prototype),GraphBasic.prototype.constructor=GraphBasic,AxesBoard.prototype.calc_attributes=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=$.extend({},this.dims,e),o=this.my_name,a=_defineProperty({g:{}},o,{})
t?(t=to_discrete_position([t[0]-n.width/2*r,t[1]-n.height/2*r]),a.g.transform="translate("+t+") rotate(0) scale("+r+")"):_.has(e,"transform")&&(a.g.transform=e.transform),a.g.width=n.width,a.g.height=n.height,a[this.my_name].width=n.width,a[this.my_name].height=n.height,a.x_axis={},a.y_axis={},a.x_axis.domain=this.domain_x,a.y_axis.domain=this.domain_y,a.x_axis.range=[0,n.width],a.y_axis.range=[0,n.height],a.x_axis.num_ticks=n.num_ticks||5,a.y_axis.num_ticks=n.num_ticks||5,this.attrs=a},AxesBoard.prototype.set_domains_from_el_on_graph=function(e){this.domain_x=this.get_domain(e,"x"),this.domain_y=this.get_domain(e,"y"),this.asymptotic=e.node().hasAttribute("asymptotic")},AxesBoard.prototype.make=function(e,t,r){mathjax_loaded||load_math_jax(),this.domain_x=this.dims.domain_x,this.domain_y=this.dims.domain_y,this.asymptotic=!1
var n=Fig.prototype.make.call(this,e,t,r)
return this.save_domain_and_range(n),this.dims.gridded&&(this.make_gridlines(n),n.attr("gridded",!0)),this.dims.graph_axis_crossed&&n.attr("graph_axis_crossed",!0),this.position_axes(n),n},GraphBasic.prototype.resize_me=function(e,t,r,n){this.set_domains_from_el_on_graph(e),Fig.prototype.resize_me.call(this,e,t,r,n),this.save_domain_and_range(e)
var o=this.get_funcs(e)
this.make_lines(e,o),this.redo_grid(e),this.position_axes(e)},Fig.prototype.get_pos_of_covered_shapes=function(e,t){var r=posit2.get_w_h(e.node()),n=_slicedToArray(r,2),o=n[0],a=n[1],i=posit2.get_top_left(e.node()),s=_slicedToArray(i,2),_=s[0],c=s[1],l={}
return t.forEach(function(e){var t=posit2.get_top_left(e),r=_slicedToArray(t,2),n=r[0],i=r[1]
l[e.id]=[(n-_)/o,(i-c)/a]}),l},Fig.prototype.repos_covered_shapes_after_resize=function(e,t){var r=posit2.get_top_left(e.node()),n=_slicedToArray(r,2),o=n[0],a=n[1],i=posit2.get_w_h(e.node()),s=_slicedToArray(i,2),_=s[0],c=s[1]
Object.keys(t).forEach(function(e){var r=document.getElementById(e),n=_slicedToArray(t[r.id],2),i=n[0],s=n[1]
ido(r).reposition_me(r,o+i*_,a+s*c,!1)})},AxesBoard.prototype.resize_me=function(e,t,r,n){this.set_domains_from_el_on_graph(e)
var o=find_sticky_els(e.node()),a=this.get_pos_of_covered_shapes(e,o)
Fig.prototype.resize_me.call(this,e,t,r,n),this.save_domain_and_range(e),this.redo_grid(e),this.position_axes(e,t,r),this.repos_covered_shapes_after_resize(e,a)},AxesBoard.prototype.save_domain_and_range=function(e){this.set_domain(e,"x",this.domain_x),this.set_range(e,"x",this.attrs.x_axis.range),this.set_domain(e,"y",this.domain_y),this.set_range(e,"y",this.attrs.y_axis.range),this.set_asymptotic(e)},AxesBoard.prototype.set_asymptotic=function(e){this.asymptotic?e.attr("asymptotic",!0):e.node().removeAttribute("asymptotic")},AxesBoard.prototype.get_domain=function(e,r){return t=e.attr("domain_"+r),t.split(",").map(function(e){return parseFloat(e)})},AxesBoard.prototype.set_domain=function(e,t,r){e.attr("domain_"+t,r)},AxesBoard.prototype.get_range=function(e,t){return e.attr("range_"+t).split(",").map(function(e){return parseFloat(e)})},AxesBoard.prototype.set_range=function(e,t,r){e.attr("range_"+t,r)},GraphBasic.prototype.test_func=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=math_parser(e,t),n=_slicedToArray(r,2),o=n[0],a=n[1]
return o?a:(text_to_feedback_pane("failed parsing formula",a),!1)},GraphBasic.prototype.add_func=function(e,t){var r=this.test_func(t)
if(!r)return!1
this.set_domains_from_el_on_graph(e)
var n=line_for_graph.add(e,r,t)
return this.reset_domain_y(e),y_axis.resize_me_single(e,{domain:this.domain_y,range:this.get_range(e,"y"),transform:"translate(0,0)"}),this.make_lines(e),this.redo_grid(e),this.save_domain_and_range(e),this.position_axes(e),this.add_legend(e,t,n),!0},GraphBasic.prototype.add_legend=function(e,t,r){var n=this.test_func(t,!0)
if(!n)return!1
var o=e.node().querySelector('g[i_am_a="math_basic"]'),a=o?posit2.get_top_left(o,!0):posit2.get_top_left(e.node())
a[0]+=5,o&&(a[1]+=15)
var i=math_basic.make(svg,a)
math_basic.trigger_math(i,n),i.classed("font2",!1),i.classed("font4",!0),group_elements(r,i)},GraphBasic.prototype.make_lines=function(e){lines=e.selectAll(".graphed_func")[0]
var t=this.get_scale_funcs(e),r=_slicedToArray(t,2),n=r[0],o=r[1],a=this.get_xs()
lines.forEach(function(e){line_for_graph.change(e,n,o,a)}),this.redo_grid(e),this.asymptotic||e.node().hasAttribute("fixed_range")?document.querySelector("#form_if_asymptotic").style.display="flex":document.querySelector("#form_if_asymptotic").style.display="none"},AxesBoard.prototype.redo_grid=function(e){e.node().hasAttribute("gridded")&&(e.selectAll(".gridlines").remove(),this.make_gridlines(e))},GraphBasic.prototype.make_scales_even=function(e){var t=this.get_domain(e,"x"),r=this.get_range(e,"x"),n=this.get_domain(e,"y"),o=this.get_range(e,"y"),a=function(e,t){return Math.abs((e[1]-e[0])/(t[1]-t[0]))}
if(ax=a(r,t),ay=a(o,n),ax!=ay){var i=posit2.get_w_h(e.node()),s=_slicedToArray(i,2),_=s[0],c=s[1]
this.resize_me(e,ay/ax*_,c,!0),gui.frame_element(e.node())}},GraphBasic.prototype.get_funcs=function(e){return e.selectAll(".graphed_func")[0].map(function(e){return formula_mapper[e.id]})},GraphBasic.prototype.get_xs=function(){var e=_slicedToArray(this.domain_x,2),t=e[0],r=e[1],n=_.range(t,r,(r-t)/999)
return n.push(r),n},AxesBoard.prototype.change_domain_x=function(e,t,r){this.domain_x=[t,r],this.set_domain(e,"x",[t,r]),this.position_axes(e),this.redo_grid(e)},GraphBasic.prototype.change_domain_x=function(e,t,r){this.domain_x=[t,r],this.set_domain(e,"x",[t,r]),this.reset_domain_y(e),this.position_axes(e),this.redraw_lines(e)},AxesBoard.prototype.change_domain_y=function(e,t,r){this.domain_y=[r,t],this.set_domain(e,"y",[r,t]),this.position_axes(e),this.redo_grid(e)},GraphBasic.prototype.change_domain_y=function(e,t,r){this.set_domains_from_el_on_graph(e),this.domain_y=[r,t],e.attr("fixed_range",!0),this.position_axes(e),this.redraw_lines(e)},AxesBoard.prototype.position_axes=function(e,t,r){var n,o=x_axis.get_styling(e.select(".x_axis")),a=y_axis.get_styling(e.select(".y_axis")),i=this.get_scale_funcs(e),s=_slicedToArray(i,2),_=s[0],c=s[1]
if(e.node().hasAttribute("graph_axis_crossed"))n="translate("+_(0)+", 0)",trans_x="translate(0, "+c(0)+")"
else if(e.node().hasAttribute("axes_custom_pos")){var l=posit2.get_w_h(e.node()),u=_slicedToArray(l,2)
u[0],u[1],n=e.select(".y_axis").attr("transform"),trans_x=posit2.get_trans_from_string(e.select(".x_axis").attr("transform")),trans_x.translate[1]+=r,trans_x=transform_to_string(trans_x)}else n="translate(0, 0)",trans_x="translate(0,"+c.range()[1]+")"
y_axis.resize_me_single(e,{domain:this.domain_y,range:c.range(),transform:n}),x_axis.resize_me_single(e,{domain:this.domain_x,range:_.range(),transform:trans_x}),x_axis.redo_styling(e.select(".x_axis"),o),y_axis.redo_styling(e.select(".y_axis"),a)},GraphBasic.prototype.redraw_lines=function(e){var t=this.get_funcs(e)
this.make_lines(e,t),this.redo_grid(e),this.save_domain_and_range(e)},GraphBasic.prototype.reset_domain_y=function(e){var t=this
if(e.attr("fixed_range"))return this.domain_y=this.get_domain(e,"y"),!0
this.domain_x=this.get_domain(e,"x")
var r=this.get_xs(),n=1/0,o=-1/0,a=this.get_funcs(e)
a.forEach(function(e){var a=get_range_of_f(r,e),i=_slicedToArray(a,3),s=i[0],_=i[1],c=i[2]
!t.asymptotic&&c&&(t.asymptotic=!0),n=Math.min(s,n),o=Math.max(_,o)},this),0==a.length?this.domain_y=this.domain_x.slice().reverse():(o<0&&(o=0),n>0&&(n=0),this.domain_y=[round_to(1.05*o,4),round_to(n,4)])},AxesBoard.prototype.get_scale_funcs=function(e){return[d3.scale.linear().domain(this.domain_x).range(this.get_range(e,"x")).clamp(!0),d3.scale.linear().domain(this.domain_y).range(this.get_range(e,"y")).clamp(!0)]},AxesBoard.prototype.redo_axes=function(e,t){this.set_domains_from_el_on_graph(e)
var r=e.select(".x_axis").attr("num_ticks"),n=e.select(".y_axis").attr("num_ticks"),o=x_axis.get_styling(e.select(".x_axis")),a=y_axis.get_styling(e.select(".y_axis"))
e.selectAll(".axis").remove(),x_axis.make_single(e,{domain:this.get_domain(e,"x"),range:this.get_range(e,"x"),num_ticks:r}),y_axis.make_single(e,{domain:this.get_domain(e,"x"),range:this.get_range(e,"y"),num_ticks:n}),this.resize_me(e,0,0,!1),x_axis.redo_styling(e.select(".x_axis"),o),y_axis.redo_styling(e.select(".y_axis"),a),this.position_axes(e)},AxesBoard.prototype.add_axes_on_reload=function(e,t){var r=t.attrs.ax,n=this.get_domain(e,r),o=this.get_range(e,r),a=t.attrs.num_ticks,i=t.attrs.transform
"x"==r?(x_axis.make_single(e,{domain:n,range:o,num_ticks:a,transform:i}),x_axis.redo_styling(e.select(".x_axis"),t.style)):(y_axis.make_single(e,{domain:n,range:o,num_ticks:a,transform:i}),y_axis.redo_styling(e.select(".y_axis"),t.style))},AxesBoard.prototype.make_gridlines=function(e){var t=posit2.get_w_h(e.node()),r=_slicedToArray(t,2),n=r[0],o=r[1],a=this.get_scale_funcs(e),i=_slicedToArray(a,2),s=i[0],_=i[1],c=s.ticks(parseInt(e.select(".x_axis").attr("num_ticks"))),l=_.ticks(parseInt(e.select(".y_axis").attr("num_ticks"))),u=function(e,t){return Math.abs(t(e[1])-t(e[0]))}
add_grid_to_g(e,u(c,s),u(l,_),n,o,s(c[0]),_(l.slice(-1)))},CellBasic.prototype=Object.create(RectBasic.prototype),CellBasic.prototype.constructor=CellBasic,CellBasic.prototype.get_my_table=function(e){var t=e.getAttribute("table")
return tables[t]},CellBasic.prototype.recalc_connections_of_table=function(e){var t=e.getAttribute("table")
Array.from(document.querySelectorAll('g[table="'+t+'"]')).forEach(function(e){recalc_connections(e.id)})},CellBasic.prototype.resize_me=function(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=e.node()
if(a.classList.contains("dummy_cell")||RectBasic.prototype.resize_me.call(this,e,t,r,n),!no_table){var i=this.get_my_table(a),s=find_my_neighbours(i,a),_=_slicedToArray(s,4),c=_[0],l=_[1],u=_[2],d=_[3]
o?(c&&"up"==o&&0!=t&&this.resize_me(d3.select(c),t,0,!1,"up"),l&&"down"==o&&0!=t&&this.resize_me(d3.select(l),t,0,!1,"down"),u&&"right"==o&&0!=r&&this.resize_me(d3.select(u),0,r,!1,"right"),d&&"left"==o&&0!=r&&this.resize_me(d3.select(d),0,r,!1,"left")):(c&&0!=t&&this.resize_me(d3.select(c),t,0,!1,"up"),l&&0!=t&&this.resize_me(d3.select(l),t,0,!1,"down"),u&&0!=r&&this.resize_me(d3.select(u),0,r,!1,"right"),d&&0!=r&&this.resize_me(d3.select(d),0,r,!1,"left")),0!=t&&u&&this.reposition_me(u,t,0,!n,!1,"right"),0!=r&&l&&this.reposition_me(l,0,r,!n,!1,"down")}},CellBasic.prototype.reposition_me=function(e,t,r,n,o){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5]
if(my_els=[],e.classList.contains("dummy_cell")||(e.classList.contains("sticky")&&a&&(my_els=find_sticky_els(e,!1)),RectBasic.prototype.reposition_me.call(this,e,t,r,n,my_els)),!no_table){var i=this.get_my_table(e),s=find_my_neighbours(i,e),_=_slicedToArray(s,4),c=_[0],l=_[1],u=_[2],d=_[3]
a?(c&&"up"==a&&0!=t&&this.reposition_me(c,t,0,n,!1,"up"),l&&"down"==a&&0!=t&&this.reposition_me(l,t,0,n,!1,"down"),u&&"right"==a&&0!=r&&this.reposition_me(u,0,r,n,!1,"right"),d&&"left"==a&&0!=r&&this.reposition_me(d,0,r,n,!1,"left")):(c&&0!=t&&this.reposition_me(c,t,0,n,!1,"up"),l&&0!=t&&this.reposition_me(l,t,0,n,!1,"down"),u&&0!=r&&this.reposition_me(u,0,r,n,!1,"right"),d&&0!=r&&this.reposition_me(d,0,r,n,!1,"left")),0!=t&&u&&this.reposition_me(u,t,0,n,!1,"right"),0!=r&&l&&this.reposition_me(l,0,r,n,!1,"down")}}
var congrats=[function(e){return"Well done!! Solved "+e},function(e){return"Great! That was "+e},function(e){return"Yeah: "+e+" goes here!"},function(e){return"Whoomp!!, "+e+" done"},function(e){return e+"? Just did it"}],_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),msvg_w=11906,msvg_h=8419,filter_for_3d_mode=!1,scale_for_3d_mode=!1,last_selection_for_split=!1,last_selection=!1,last_pos,last_map_pos,last_rc_pos,poly_draw=!1,points_for_poly=[],drag_select=!1,drag_select_for_print_region=!1,drag_select_for_slider=!1,drag_select_for_merge=!1,start_pos_select=!1,drag_for_drawing=!1,el_to_copy=!1,el_to_style="shape",recog_shape=!1,recog_path=!1,free_draw=!0,copied_styles_for_table,MIN_IN_VIEW=250,SCROLL_DELTA=30,INIT_MDD=5,MDR=5,anim_dur=2e3,menu_scroll_placer,startscale=1,starttrans=[-parseInt(msvg_w/2),-parseInt(msvg_h/2)],minscale=.15,maxscale=6,mathjax_loaded=!1,auto_resize=!0,catcher_width=15,use_par_offset_colors=document.querySelector("#form_use_par_offset_color").checked,fo_bbox_correction,mdd=INIT_MDD,color_stroke_only=!0,help_on=!1,form_hidden=!1,fb_menu_open=!1,no_feedback=!1,smooth_paths=!1,minimal_menu=!0,show_group_borders=!1,formula_mapper={},plumbs=!0,el_to_merge_to=!1,active_canvas=!1,cumulator_poly_point=drag_discrete(),poly_point_move=d3.behavior.drag().on("dragstart",function(){gui.remove_all()}).on("drag",function(){if("gui_guided_reshape"==this.id)var e=currentElement,t=convert_dx_dy_for_zoom_and_rotate(d3.event),r=_slicedToArray(t,2),n=r[0],o=r[1]
else var e=this.parentElement,a=conv_angle(posit2.get_trans(e).rotate[0],d3.event.dx,d3.event.dy),i=_slicedToArray(a,2),n=i[0],o=i[1]
var s=cumulator_poly_point.add(n,o),_=_slicedToArray(s,2)
if(n=_[0],o=_[1],0!=n||0!=o){var c=d3.select(this),l=iama(e),u=object_mapper[l].reshape(c.node(),n,o),d=_slicedToArray(u,2),p=d[0],f=d[1],m=_slicedToArray(posit2.get_trans(e).translate,2),g=m[0],h=m[1]
"slide"!=l&&"gui_guided_reshape"!=this.id&&gui.repos_plumbs_for_cp([p+g,f+h]),"print_region"==e.id&&show_print_region_size(e),roughing.roughen_if_needed(e)}}).on("dragend",function(){toggle_zoom.temp_disable_off()}),dragging_knot=!1,el_under=!1,drag_position_knot=d3.behavior.drag().on("dragstart",function(){var e=get_x_y_from_event(d3.event.sourceEvent),t=_slicedToArray(e,2),r=t[0],n=t[1]
document.elementFromPoint(r,n)==this&&toggle_zoom.temp_disable_on(),dragging_knot=this.parentElement,this.parentElement.classList.contains("gui_knot")||(currentElement=!1)}).on("drag",function(){"gui_connect"==this.parentElement.id&&gui.make_dummy_connection()
var e=this.parentElement,t=cumulator_pos.add(d3.event.dx,d3.event.dy)
d3.event.sourceEvent.shiftKey?(ido(e).reposition_me(e,t[0],t[1],!0),shift_drag_knot_update(e,t[0],t[1])):(reposition_protocol(e,t[0],t[1]),e.classList.contains("helper_hg")||el_under_dragged_shape(this.parentElement)),d3.event.sourceEvent.preventDefault()}).on("dragend",function(){if(toggle_zoom.temp_disable_off(),"gui_connect"==this.parentElement.id)return gui.end_drag_gui_connect(el_under),el_under&&el_under.select(".under").classed("under",!1),dragging_knot=!1,el_under=!1,!1
if(el_under){if(el_under.node()==cpa.e1||el_under==cpa.e2)return text_to_feedback_pane("will not connect a shape to itself. A path needs to connect two different shapes",!1,!0),el_under.select(".under").classed("under",!1),el_under=!1,!0
if((el_under.classed("hg")||d3.select(find_g(this)).classed("hg"))&&!hierarchies.check_if_valid_attachment(el_under.node(),find_g(this)))return text_to_feedback_pane("not allowed",!1,!0),el_under.select(".under").classed("under",!1),el_under=!1,!1
var e
find_connections(find_g(this).getAttribute("id")).forEach(function(t,r){0==r&&(e=this.parentElement==cpa.e1),set_path_attrs(d3.select("#"+t)),detach_path(cpa.path_g,e,!1,el_under.node(),find_g(this))}.bind(this)),el_under.select(".under").classed("under",!1),d3.select(find_g(this)).remove()}var t=find_g(this)
!dragging_knot||t!=cpa.e1&&t!=cpa.e2||move_element_to_top(t),dragging_knot=!1,cumulator_pos.reset()}),prev_touch_pos=!1,cumulator_pos=drag_discrete(),sticky_els=!1,drag_position=d3.behavior.drag().on("dragstart",function(){if(drag_select)return!0
gui.remove_all()
var e=get_x_y_from_event(d3.event.sourceEvent),t=_slicedToArray(e,2)
t[0],t[1],toggle_zoom.temp_disable_on()
var r=find_g(this)
r!=currentElement&&(currentElement=r),r.hasAttribute("table")&&d3.event.sourceEvent.shiftKey&&(move_element_to_top(r),table_with_pos=tables[r.getAttribute("table")].map(function(e){return e.map(function(e){return get_cell_pos(e)})})),sticky_els=find_sticky_els(r),"touchstart"==d3.event.sourceEvent.type&&(prev_touch_pos=[d3.event.sourceEvent.touches[0].clientX,d3.event.sourceEvent.touches[0].clientY])}).on("drag",function(){if(d3.event.sourceEvent.touches&&d3.event.sourceEvent.touches.length>1)return!0
if(this.hasAttribute("undrag")){if(drag_for_drawing)return!1
if(!toggle_zoom.status().zoom)return!1
var e=toggle_zoom.get_translation()
if(toggle_zoom.get_zoom_factor(),"touchmove"==d3.event.sourceEvent.type){var t=d3.event.sourceEvent.touches[0].clientX-prev_touch_pos[0],r=d3.event.sourceEvent.touches[0].clientY-prev_touch_pos[1]
prev_touch_pos=[d3.event.sourceEvent.touches[0].clientX,d3.event.sourceEvent.touches[0].clientY]}else var n=[d3.event.sourceEvent.movementX,d3.event.sourceEvent.movementY],t=n[0],r=n[1]
return toggle_zoom.set_zoom_and_trans(!1,[e[0]+t,e[1]+r]),!1}var o=cumulator_pos.add(d3.event.dx,d3.event.dy)
if(0!=o[0]||0!=o[1]){var a=find_g(this)
toggle_hover_highlights.disable(a)
var i=d3.event.sourceEvent.shiftKey&&a.classList.contains("i_have_a_group")
reposition_protocol_throttled(a,o[0],o[1],sticky_els,d3.event.sourceEvent.hasOwnProperty("getModifierState")&&d3.event.sourceEvent.getModifierState("CapsLock"),!1,!1,i,d3.event.sourceEvent.shiftKey||d3.event.sourceEvent.hasOwnProperty("getModifierState")&&d3.event.sourceEvent.getModifierState("CapsLock"))}d3.event.sourceEvent.preventDefault()}).on("dragend",function(){var e=this.parentElement,t=e.getAttribute("i_am_a")
if(toggle_zoom.temp_disable_off(),ignore_svg_click=cumulator_pos.reset(),sticky_els=!1,"country_basic"==t&&ido(e).set_info(e),d3.event.sourceEvent.shiftKey&&"cell_basic"==t){var r=manage_groups.get_group(e,!0)
if(1==r.length)r.forEach(function(e){var t=find_new_pos_for_moved_cell(e),r=_slicedToArray(t,4),n=r[0],o=r[1],a=r[2],i=r[3]
n==a&&o==i||swap_cells([n,o,a,i],tables[e.getAttribute("table")])})
else{var n=(r.map(function(e){return posit2.get_top_left(e)}),get_rows_cols_of_grouped_cells(this.parentElement)),o=_slicedToArray(n,2),a=o[0],i=o[1]
Object.keys(a).forEach(function(e){return a[e].sort(function(e,t){return e[1]<t[1]})}),Object.keys(i).forEach(function(e){return i[e].sort(function(e,t){return e[0]<t[0]})})
var s={}
r.forEach(function(e){s[e.id]=find_new_pos_for_moved_cell(e)}),Object.keys(a).forEach(function(t){a[t].forEach(function(t){var r=_slicedToArray(s[t[2].id],4),n=(r[0],r[1]),o=r[2],a=r[3]
n!=a&&swap_cells([o,n,o,a],tables[e.getAttribute("table")])})}),Object.keys(i).forEach(function(t){i[t].forEach(function(t){var r=_slicedToArray(s[t[2].id],4),n=r[0],o=r[1],a=r[2]
r[3],n!=a&&swap_cells([n,o,a,o],tables[e.getAttribute("table")])})})}}show_group_borders&&add_group_hints(),toggle_hover_highlights.enable(e)}),cumulator_resize=drag_discrete(),drag_resize=d3.behavior.drag().origin(_origin).on("dragstart",function(){toggle_zoom.temp_disable_on()}).on("drag",function(){var e=convert_dx_dy_for_zoom_and_rotate(d3.event),t=_slicedToArray(e,2),r=t[0],n=t[1]
!d3.select(".gui").empty()&&r&&n&&gui.remove_all()
var o=cumulator_resize.add(r,n)
0==o[0]&&0==o[1]||(toggle_hover_highlights.disable(currentElement),resize_protocol(currentElement,o[0],o[1],d3.event.sourceEvent.hasOwnProperty("getModifierState")&&d3.event.sourceEvent.getModifierState("CapsLock"),d3.event.sourceEvent.shiftKey||d3.event.sourceEvent.hasOwnProperty("getModifierState")&&d3.event.sourceEvent.getModifierState("CapsLock"))),d3.event.sourceEvent.preventDefault()}).on("dragend",function(){toggle_zoom.temp_disable_off(),cumulator_resize.reset()
var e=find_g(currentElement)
cc=e.querySelector(".temp_off_catcher"),cc&&(cc.classList.add("catcher"),cc.classList.remove("temp_off_catcher")),d3.select(".gui").empty()&&gui.frame_element(e),toggle_hover_highlights.enable(e),roughing.roughen_if_needed(currentElement)}),cumulator_par_drag=drag_discrete(1),drag_par_margin=d3.behavior.drag().on("drag",function(){var e=this.getAttribute("side")
e=e.charAt(0).toUpperCase()+e.slice(1)
var t=parseInt(currentElement.style["margin"+e])||0,r=[d3.event.dx,d3.event.dy],n=r[0],o=r[1],a=cumulator_par_drag.add(n,o),i=_slicedToArray(a,2)
n=i[0],o=i[1],0==n&&0==o||(currentElement.style["margin"+e]="Left"==e?Math.max(t+1*n,0)+"px":"Right"==e?Math.max(t-1*n,0)+"px":t+1*o+"px",gui.frame_element(currentElement))}).on("dragend",function(){cumulator_par_drag.reset()}),cumulator_rotate=drag_discrete(),drag_rotate=d3.behavior.drag().origin(_origin_for_rotate).on("dragstart",function(){"touchstart"==d3.event.sourceEvent.type&&(prev_touch_pos=[d3.event.sourceEvent.touches[0].clientX,d3.event.sourceEvent.touches[0].clientY]),toggle_zoom.temp_disable_on(),gui.remove_all()}).on("drag",function(){var e=[d3.event.x,d3.event.y]
rotate_protocol(currentElement,e[0],e[1]),d3.event.sourceEvent.preventDefault()}).on("dragend",function(){toggle_zoom.temp_disable_off(),cumulator_rotate.reset()}),drag_along_path=d3.behavior.drag().origin(_origin).on("dragstart",function(){toggle_zoom.temp_disable_on()}).on("drag",function(){var e=find_g(this.classList.contains("gui")?currentElement:this)
posit2.delete_item(e.id),object_mapper[e.getAttribute("i_am_a")].repos_along_path(e,e.parentElement,d3.event.dx)}).on("dragend",function(){toggle_zoom.temp_disable_off()}),running_d="",origin_drawing=!1
start_el_under=!1,end_el_under=!1
var drag_draw=d3.behavior.drag().on("dragstart",function(){if(running_d="M"+[0,0],"mousedown"==d3.event.sourceEvent.type&&0!=d3.event.sourceEvent.button)return!1
document.querySelector("#form_draw_recog_del").classList.add("hidden"),toggle_zoom.temp_disable_on()
var e=corrected_mouse_position(get_x_y_from_event(d3.event.sourceEvent))
free_draw||(start_el_under=!1,start_el_under=check_if_pen_on_shape(d3.event.sourceEvent))
var t=path_basic.make(svg,e)
t.classed("drawing",!0)
var r=t.select("path").attr("d",running_d)
currentElement=r.node(),origin_drawing=e,recog_shape&&draw_shape_close_circle(e)}).on("drag",function(){if("mousemove"==d3.event.sourceEvent.type&&0!=d3.event.sourceEvent.button)return!1
if("path"!=currentElement.tagName)return!1
var e=corrected_mouse_position(get_x_y_from_event(d3.event.sourceEvent))
running_d+="L"+[e[0]-origin_drawing[0],e[1]-origin_drawing[1]].map(function(e){return round_to(e,2)}),currentElement.setAttribute("d",running_d)}).on("dragend",function(){if("mousedown"==d3.event.sourceEvent.type&&0!=d3.event.sourceEvent.button)return!1
if("path"!=currentElement.tagName)return!1
var e=currentElement.getAttribute("d"),t=e
if("M0,0"!=e||(e+="L-1,0"),currentElement.setAttribute("d",e),toggle_draggability_of_element(currentElement.parentElement,!1),currentElement.parentElement.classList.add("no_pointing_temp"),currentElement.parentElement.classList.add("unhandled"),toggle_zoom.temp_disable_off(),origin_drawing=!1,free_draw)new_el=path_basic.remake_path(currentElement,!1),new_el.node().setAttribute("flow","lineto")
else{if(end_el_under=check_if_pen_on_shape(d3.event.sourceEvent),recog_path&&start_el_under&&end_el_under&&start_el_under!=end_el_under&&!end_el_under.classList.contains("close_circle"))make_drawn_path(currentElement.parentElement,t,find_g(start_el_under),find_g(end_el_under)),currentElement=cpa.path_g,document.querySelector("#form_draw_recog_del").classList.remove("hidden")
else{var r=end_el_under&&end_el_under.classList.contains("close_circle")
if(new_el=path_basic.remake_path(currentElement,r),new_el.node().setAttribute("flow","lineto"),r&&(document.querySelector("#form_draw_recog_del").classList.remove("hidden"),currentElement=new_el.node(),text_to_feedback_pane("Shape "+new_el.node().id+" closed: double click to add text")),new_el&&new_el.node().classList.add("no_pointing_temp"),!r&&(start_el_under&&!start_el_under.classList.contains("close_circle")||end_el_under&&!end_el_under.classList.contains("close_circle"))){var n=start_el_under||end_el_under,o=d3.select(find_g(n))
ido(o).stick_to_me(o,[new_el.node()])}}end_el_under=start_el_under=!1}svg.selectAll(".close_circle").remove(),ignore_svg_click=!0}),ignore_svg_click=!1,drag_svg_for_select=d3.behavior.drag().origin(_origin).on("dragstart",function(){drag_select=!0,toggle_zoom.temp_disable_on(),start_pos_select=corrected_mouse_position(get_x_y_from_event(d3.event.sourceEvent)),svg.append("rect").attr("class","drag_select").attr("width",5).attr("height",5).attr("transform","translate("+[start_pos_select[0]-5,start_pos_select[1]-5]+")").style("fill","steelblue").style("opacity",.25).style("stroke","blue")}).on("drag",function(){if(drag_select){var e=d3.transform(d3.select("#zoomfield").attr("transform")),t=svg.select(".drag_select"),r=parseFloat(t.attr("width"))+d3.event.dx/e.scale[0],n=parseFloat(t.attr("height"))+d3.event.dy/e.scale[1]
t.attr("width",r).attr("height",n)}}).on("dragend",function(){toggle_zoom.temp_disable_off(),drag_select&&handle_drag_select(find_g(this)),drag_select_off()}),_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),WANTED_ZOOM_SCALE=1.0762401247837972,MOZ_ZOOM_SCALE=1.6471820345351462
svg=d3.select("#mainsvg"),svg=svg.append("g").attr("id","zoomcall").append("g").attr("id","zoomfield").attr("transform","translate("+starttrans+") scale("+startscale+")"),svg.append("rect").attr("width",msvg_w).attr("height",msvg_h).attr("class","overlay")
var svg_zoom_filters_on=!1,slide_exit=new CustomEvent("slide_exit"),turn_on_filters=!1,zb=d3.behavior.zoom().scaleExtent([minscale,maxscale]).translate(starttrans).scale([startscale]).on("zoom",zoom_func)
toggle_zoom=function(e,t){function r(r){r?(e.call(t),e.on("dblclick.zoom",null)):e.on(".zoom",null)}function n(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2]
f=t[0],p=t[1],o(e,r)}function o(e,t){els_to_fade=i(a(e)),t&&(els_to_fade=els_to_fade.concat(t)),els_to_fade.forEach(function(e){f(e),e.classList.add("temp_faded")})}function a(e){var t=$.extend({},e)
return t.x0y0=[t.x0y0[0]-g,t.x0y0[1]-g],t.x1y1=[t.x1y1[0]+g,t.x1y1[1]+g],t.x1y0=[t.x1y0[0]+g,t.x1y0[1]-g],t.x0y1=[t.x0y1[0]-g,t.x0y1[1]+g],[e,t]}function i(e){var t=_slicedToArray(e,2),r=t[0],n=t[1],o=find_elements_in_bbox_test(r,!0,!0),a=find_elements_in_bbox_test(n,!0,!0)
return a=a.filter(function(e){return"slide"!=iama(e)&&!e.classList.contains("frame")&&!e.classList.contains("window")&&!e.classList.contains("part_of_frame")}),a.filter(function(e){return!o.find(function(t){return t==e})})}function s(){svg.selectAll(".temp_faded")[0].forEach(function(e){return p(e)}),svg.selectAll(".temp_faded").classed("temp_faded",!1),svg.node().removeEventListener("slide_exit",s),svg.selectAll(".temp_shown").classed("temp_shown",!1).style("display","none")}function _(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=spare_margin_h=0
if(o)var i=r,s=n
else var i=Math.max(r,300),s=Math.max(n,150)
var _=e/i,c=t/s
return o&&(_=Math.min(_,o),c=Math.min(c,o)),_<c?(spare_margin_h=t-_*s+(n<s?_*(s-n):0),a=e-_*i+(r<i?_*(i-r):0)):(a=e-c*i+(r<i?c*(i-r):0),spare_margin_h=t-c*s+(n<s?c*(s-n):0)),[Math.min(_,c),a,spare_margin_h]}function c(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=document.querySelector("#sidebar").classList.contains("menu_hidden"),i="none"==a?0:m,i=a?0:m,s=window.innerWidth-i,c=window.innerHeight,l=_(s,c,r,n,o),u=_slicedToArray(l,3),d=u[0]
return[d,[-e*d+i+u[1]/2,-t*d+u[2]/2]]}function l(e,t,r,n){var o=e[0]/r-t[0]/n,a=e[1]/r-t[1]/n,i=Math.abs(n-r),s=Math.sqrt(o*o+a*a),_=s-1e3+1e3+1500*i
return Math.min(Math.max(_,v),b)}function u(e,r,o,a,i,_,c,u,p){u&&(r[1]-=u),i?(anim_dur=l(r,t.translate(),e,t.scale()),o&&2==o.length&&a&&setTimeout(function(){n(a,o,_)},.75*anim_dur),setTimeout(function(){svg.node().addEventListener("slide_exit",s)},anim_dur+25),d(e,r,i)):(d(e,r,i),o&&2==o.length&&a&&n(a,o,_),svg.node().addEventListener("slide_exit",s))}function d(r,n){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2]
n=n||t.translate(),r=r||t.scale(),o?e.transition().duration(anim_dur).call(t.translate(n).scale(r).event):e.call(t.translate(n).scale(r).event)}var p,f,m=200,g=1500,h=!1,y=!1,v=2e3,b=4e3
return{set_anim_duration:function(e,t){v=e,b=t},calc_zoom_trans:c,zoom_to_mark:function(e){var t=e.slice(5).split(",").map(function(e){return parseFloat(e)}),r=_slicedToArray(t,3),n=r[0],o=r[1],a=r[2]
this.set_zoom_and_trans(n,[o,a])},get_level:function(){for(var e=this.get_zoom_factor(),t=0;t<levels.length;t++)if(e<levels[t][1])return t+1
return t},set_start_for_load:function(r){var n=posit2.get_trans_from_string(r.replace(")",") "))
e.call(t.translate(n.translate).scale(n.scale).event)},toggle_zoom:function(){h=!h,r(h&!y)},reset_to_center:function(){e.call(t.translate(starttrans).scale(startscale).event)},center_on_group:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],_=get_bbox_of_group(e),l=_slicedToArray(_,4),d=l[0],p=l[1],f=l[2],m=l[3],g=c(d,f,p-d,m-f,a),h=_slicedToArray(g,2)
u(h[0],h[1],t,r,n,o,a,i,s)},center_on_shape:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],_=posit2.get_top_left(e,!0),l=_slicedToArray(_,2),d=l[0],p=l[1],f=posit2.get_trans(e,!0),m=posit2.get_w_h(e),g=_slicedToArray(m,2),h=g[0],y=g[1]
h*=f.scale,y*=f.scale
var v=c(d,p,h,y,a),b=_slicedToArray(v,2),x=b[0],f=b[1],k=!1
r&&(k=object_mapper[iama(e)].get_bbox_of_figure(d3.select(e))),u(x,f,t,k,n,o,a,i,s)},fade_callback:s,trans_to_top_left:function(e){var r=_slicedToArray(posit2.get_trans(e).translate,2),n=r[0],o=r[1],a=t.scale()
toggle_zoom.set_zoom_and_trans(a,[-n*a,-o*a])},status:function(){return{zoom:h,disabled:y}},get_zoom_factor:function(){return t.scale()},get_translation:function(){return t.translate()},get_zoom_and_trans:function(){return[t.scale(),t.translate()]},temp_disable_on:function(){y=!0,r(h&!y)},temp_disable_off:function(){y=!1,r(h&!y)},set_zoom_and_trans:d,get_screen_pos:function(e){var r=iama(e),n=e.getBBox()
if("text_path"==r||"path_group"==r)var o=[n.x,n.y],a=o[0],i=o[1]
else var s=posit2.get_top_left(e,!0),_=_slicedToArray(s,2),a=_[0],i=_[1]
var c=t.translate(),l=t.scale(),u=(a+c[0]/l)*l,d=(i+c[1]/l)*l
return{top:d,left:u,bottom:d+n.height*l,right:u+n.width*l}},filters:{none:[],hide:[function(e){e.style.display="none"},function(e){e.style.display="block"}],fade:[function(e){e.style.filter="url(#f_slides)"},function(e){e.style.filter=""}]}}}(d3.select("#zoomcall"),zb)
var _slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()
d3.select("#mainsvg").attr("width","100%").attr("height","100%").style("text-align","center"),document.querySelector("#form_use_par_offset_color").onclick=function(e){use_par_offset_colors=this.checked},throttle=function(e,t,r){var n,o,a,i=null,s=0
r||(r={})
var c=ddy=0,l=function(){o[1]=c,o[2]=ddy,e.apply(n,o),c=ddy=0},u=function(){s=!1===r.leading?0:_.now(),i=null,a=l.apply(n,o),i||(n=o=null)}
return function(){c+=arguments[1],ddy+=arguments[2]
var e=_.now()
s||!1!==r.leading||(s=e)
var d=t-(e-s)
return n=this,o=arguments,d<=0||d>t?(i&&(clearTimeout(i),i=null),s=e,a=l.apply(n,o),i||(n=o=null)):i||!1===r.trailing||(i=setTimeout(u,d)),a}},menu_scroll_placer=function(e){function t(e){var t=parseInt(r.style.top)
e&&(t+=e),t=Math.min(n,t)
var o=document.querySelector("#form_slide_under").getBoundingClientRect(),a=o.bottom-o.top
t=Math.max(t,-Math.max(0,a-MIN_IN_VIEW)),r.style.top=t+"px"}var r=document.querySelector("#form_slide_under"),n=0
return r.style.top=n+"px",document.querySelector("#fs_container").style.top=n+"px",{scroll:function(e){t(Math.sign(e.deltaY)*-SCROLL_DELTA/2)},up:function(e){t(-50)},down:function(e){t(50)}}}(),document.querySelector("#form_slide_under").onwheel=menu_scroll_placer.scroll,document.querySelector("#form_menu_down").onclick=menu_scroll_placer.up,document.querySelector("#form_menu_up").onclick=menu_scroll_placer.down
var MIN_WIDTH=50,MIN_HEIGHT=20,quick_del=!0,for_group=!1,paths_on_canvas_done={},reposition_protocol_throttled=throttle(reposition_protocol,5),make_new_grouping=function(){var e=!1
return function(t){e?(e.attr("id")!=t.attr("id")&&group_elements(e,t),e.classed("filter",!1),e=!1):(e=t,t.classed("filter",!0))}}(),make_new_connection=function(){function e(e,t,r,n){if(e.attr("id")!=t.attr("id")){clear_path_attrs(),n=n||{},set_path_id_and_class(e,t),cpa.pos1=.5,cpa.pos2=.5,cpa.type=active_line_style,cpa.flow=active_line_flow,n&&Object.keys(n).forEach(function(e){e in cpa&&(cpa[e]=n[e])})
var o=find_path(n.preferred,n.fixed_side),a=make_path(svg,o)
return r=r||!1,r||(disperse_path_over_side(cpa.e1,o[1].i,.1),disperse_path_over_side(cpa.e2,o[1].j,.1)),cpa.path_g=a.node(),a}}var t=!1
return function(r,n,o){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3]
if(t){var i=manage_groups.get_group(currentElement,!0)
if(i.length>1&&!a){var s=manage_groups.element_in_active_group(t.node())
i.forEach(function(a){s?e(d3.select(a),r,n,o):e(t,d3.select(a),n,o)})}else var _=e(t,r,n,o)
t.classed("filter",!1),t=!1}else t=r,t.classed("filter",!0)
return _}}()
document.querySelector("#mainsvg").setAttribute("tabindex",1)
var currentElement=void 0,first_path_element=void 0,prev_element=void 0,key_pressed=[],first_shift_down=!1,find_g=find_tag("g"),find_p=find_tag("P"),find_svg=find_tag("svg"),move_delta=mdd,size_delta=mdd,X_GRID=15,Y_GRID=15,_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),form_filled=!1,_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()
document.querySelector("#form_grid_snap").onclick=function(e){snap_to_grid()},document.querySelector("#form_grid_size").onclick=size_to_grid,svg=d3.select("#mainsvg"),zooming_and_panning=!1,svg.on("click",function(){if(ignore_svg_click)return ignore_svg_click=!1,!1
if(study_one_by_one)return study_one_by_one.next(),!1
if(cmm.status()&&cmm.off(),last_pos=corrected_mouse_position(d3.mouse(this)),tab_succes_flash(last_pos),svg.classed("copy_on")){var e=posit2.get_w_h(el_to_copy),t=_slicedToArray(e,2),r=t[0],n=t[1]
return copy_prepped_shape_to_canvas(el_to_copy,svg,[last_pos[0]-r/2,last_pos[1]-n/2]),el_to_copy=!1,!1}set_currentElement(this),display_fs_for_shape(currentElement),medium&&medium.destroy(),active_canvas=currentElement,d3.event.ctrlKey&&(poly_draw=!0,pos=to_discrete_position(corrected_mouse_position(d3.mouse(this))),poly_point.make(svg,pos,void 0),points_for_poly.length>0&&make_poly_line(svg.selectAll('g[i_am_a="poly_point"]')[0].slice(-2)),points_for_poly.push(pos)),d3.event.shiftKey&&(poly_draw=!0,pos=to_discrete_position(corrected_mouse_position(d3.mouse(this))),poly_point.make(svg,pos,void 0),points_for_poly.push(pos))}).on("dblclick",svg_dbl_click).on("touchstart",double_tap_detect(svg_dbl_click)).on("touchmove",function(){d3.event.preventDefault()}).on("mouseup",function(){turn_on_filters&&turn_on_zoom_filters(),turn_on_filters=!1}).on("touchend",function(){turn_on_filters&&turn_on_zoom_filters(),turn_on_filters=!1}),document.body.onkeydown=document.body.onkeyup=function(e){handle_keyboard(e)},document.querySelector("#form_grid_lines_extra").onclick=function(){make_gridlines(parseInt(document.querySelector("#form_grid_lines_dx_extra input").value),parseInt(document.querySelector("#form_grid_lines_dy_extra input").value))},$(".change_text_input").on("click",function(e){change_text(e.target.parentElement.querySelector("textarea").value)}),document.querySelector(".text_input").onkeyup=document.querySelector(".text_input").onkeydown=function(e){9==e.keyCode&&(document.querySelector("#form_text_field_break").focus(),e.preventDefault(),e.stopPropagation())},document.querySelector(".math_input").onkeydown=document.querySelector(".math_input").onkeyup=function(e){9==e.keyCode&&(document.querySelector("#cm-button-mathjax").focus(),e.preventDefault(),e.stopPropagation()),e.stopPropagation(),key_pressed=[]},$(".text_input").on("keyup",function(e){change_text(e.target.value)}),$(".text_input").on("paste",function(e){e.stopPropagation()}),$(".math_input").on("paste",function(e){e.stopPropagation()}),$("#cm_graph_formula_text").on("paste",function(e){e.stopPropagation()}),document.querySelector("#cm-button-mathjax").onclick=handle_math_jax_button_click
var current_map_name=""
document.querySelector("#dl_link").onclick=function(){document.getElementById("dl_vis").style.visibility="hidden",close_modal("save_load_modal")},document.querySelector("#load_ext_map").onclick=function(){var e=document.querySelector("#load_previews_ext").querySelector(":checked").value
load_data(data_ext_loaded[e],pres_mode_for_load,new_map_for_load),close_modal("save_load_modal")},document.querySelector("#load_local_map").onclick=function(){local_store.load(document.querySelector("#load_previews").querySelector(":checked").value,pres_mode_for_load)?close_modal("save_load_modal"):text_to_feedback_pane("have you selected a map ? Map not found in local storage",!1,!0)},document.querySelector("#delete_local_maps").onclick=function(){var e=document.querySelector("#load_previews").querySelector(":checked").value,t=""
confirm("delete map"+e+"?")?(local_store.delete(e),t="deleted map "+e):t="aborting delete of"+e,text_to_feedback_pane(t,!1,!0)},document.querySelector("#savebutton_local").onclick=function(){document.getElementById("dl_link").innerText
var e=document.getElementById("save_name").value
local_store.save(e.split(".")[0]),document.getElementById("dl_vis").style.visibility="hidden",close_modal("save_load_modal")}
var fonts=["default","PT Sans","Cabin","Zilla Slab","Roboto","Open Sans","Ubuntu","monospace","serif","sans-serif","Arial","Courier","Times","Times New Roman","Lato","Roboto condensed","Source Code Pro","Open Sans Condensed","Ubuntu Condensed","Amatic SC","Permanent Marker","Handlee","Caveat","Schoolbell","Athiti","Kalam","Sacramento","Quattrocento","Arimo","Exo","Cinzel","Orbitron","Audiowide","Special Elite"],directions=["north","east","south","west"]
append_options(".form_font_list",fonts),append_options("#predef_font_list",fonts),append_options("#form_disp_side",directions),document.querySelector("#cm-path-add-text").onclick=show_path_text_input_new,document.querySelector("#cm-path-change-text").onclick=show_path_text_input_existing,document.querySelector("#form_fill_what").onclick=function(e){if("DIV"==e.target.tagName)return!1
set_button_class(this,e.target),fill_what=e.target.value,set_color_picker(is_par_tag(currentElement)?currentElement:currentElement.firstChild)}
var container,medium,article
$(".button_bold").on("mousedown",function(e){add_styling_to_par("b")}),$(".button_underlined").on("mousedown",function(e){add_styling_to_par("u")}),$(".button_italic").on("mousedown",function(e){add_styling_to_par("i")}),$(".button_special").on("mousedown",function(e){add_styling_to_par("q")}),document.querySelector("#cm-link button").onclick=function(e){var t=currentElement.querySelector("a"),r=document.querySelector("#cm-link textarea").value
t&&r.match(/^www./)&&(r="http://"+r),t.setAttribute("href",r),t.setAttribute("target","_blank")},document.querySelector("#cm-button-follow-link").onclick=function(){var e=currentElement.querySelector("a"),t=e.getAttribute("href")
"mark"==t.slice(0,4)?toggle_zoom.zoom_to_mark(mark):window.open(t,"_blank")},plus_minus_generator_multi(Array.from(document.querySelectorAll(".form_scaling")),func_for_scaling,.1,4),plus_minus_generator(document.getElementById("cm_scaling"),func_for_scaling,.1,4),document.querySelector("#form_border_dash input").oninput=function(){manage_groups.get_group(currentElement,!0).forEach(function(e){if(is_par_tag(e))return text_to_feedback_pane("does not work on paragraph",!1,!0),!1
"path_group"==iama(e)&&"double"==cpa.type&&(e=document.querySelector("#form_border_inner").checked?e.querySelector(".inner_path"):e.querySelector(".mainpath")),e.style["stroke-dasharray"]=this.value}.bind(this))},plus_minus_generator(document.getElementById("form_border_width"),change_border_width,.2,2),plus_minus_generator(document.getElementById("cm_border_width"),change_border_width,.2,2),plus_minus_generator(document.getElementById("form_border_radius"),function(e){is_par_tag(currentElement)?manage_groups.get_group(currentElement,!0).forEach(function(t){d3.select(t).style("border-radius",e.value+"px")}):manage_groups.get_group(currentElement,!0).forEach(function(t){var r=iama(t)
if(!t.querySelector("rect"))return!1
s="text_block"==r?"rect":".mainfig",d3.select(t).select(s).attr("rx",e.value).attr("ry",e.value),".mainfig"==s&&t.hasAttribute("border_sides_arr")&&ido(t).calc_border(t,border_sides_attr_to_array(t)),t.querySelector("rect")&&t.querySelector("article.has_background")&&(t.querySelector("article.has_background").style.borderRadius=e.value+"px")})}),plus_minus_generator(document.getElementById("form_paragraph_margin"),function(e){var t=document.querySelector("#form_all_pars").checked
manage_groups.get_group(currentElement,!0).forEach(function(r){(t?r.parentElement.querySelectorAll("p"):[r]).forEach(function(t){"all"==margin_for?(d3.select(t).style("margin-left",e.value+"px"),d3.select(t).style("margin-right",e.value+"px"),d3.select(t).style("margin-bottom",e.value+"px"),d3.select(t).style("margin-top",e.value+"px")):d3.select(t).style("margin-"+margin_for,e.value+"px")})})}),plus_minus_generator(document.getElementById("form_paragraph_padding"),function(e){var t=document.querySelector("#form_all_pars").checked
manage_groups.get_group(currentElement,!0).forEach(function(r){(t?r.parentElement.querySelectorAll("p"):[r]).forEach(function(t){"all"==margin_for?(d3.select(t).style("padding-left",e.value+"px"),d3.select(t).style("padding-right",e.value+"px"),d3.select(t).style("padding-bottom",e.value+"px"),d3.select(t).style("padding-top",e.value+"px")):d3.select(t).style("padding-"+margin_for,e.value+"px")})})}),plus_minus_generator(document.getElementById("form_paragraph_line_height"),function(e){var t=document.querySelector("#form_all_pars").checked
manage_groups.get_group(currentElement,!0).forEach(function(r){(t?r.parentElement.querySelectorAll("p"):[r]).forEach(function(t){d3.select(t).style("line-height",parseFloat(e.value))})}),plumbs&&gui.move_plumbs(currentElement)},.1,2),plus_minus_generator(document.getElementById("form_article_padding"),function(e){manage_groups.get_group(currentElement,!0).forEach(function(t){$(t).find("article").css("padding",parseInt(e.value)+"px")})},1,1)
var margin_for="all"
document.querySelector("#form_side_for_padding_and_margin").onclick=function(e){margin_for=e.target.value,d3.selectAll("#form_side_for_padding_and_margin button").classed("onoff-on",!1),"BUTTON"==e.target.tagName&&e.target.classList.add("onoff-on")
var t=window.getComputedStyle(currentElement),r="all"==margin_for?"top":margin_for
document.querySelector("#form_paragraph_margin input").value=parseInt(t["margin-"+r]),document.querySelector("#form_paragraph_padding input").value=parseInt(t["padding-"+r])},$(".form_font_list").on("change",function(e){var t=e.target.value
"P"==currentElement.tagName&&check_for_range_when_p_form_action(currentElement),manage_groups.get_group(currentElement,!0).forEach(function(e){e.style.fontFamily="default"==t?null:t,resize_if_wanted_after_font_change(find_g(e))}),$(".form_font_list").val(t)}),document.querySelector("#form_font_size input").onchange=function(e){if("P"==currentElement.tagName&&check_for_range_when_p_form_action(),is_par_tag(currentElement))manage_groups.get_group(currentElement,!0).forEach(function(e){var t=find_current_font_class(e)
t&&e.classList.remove(t),e.style.fontSize=$("#form_font_size input").val()+"px",resize_if_wanted_after_font_change(find_g(currentElement))})
else{var t=manage_groups.get_group(currentElement,!0),r=currentElement.getAttribute("i_am_a")
t.forEach(function(e){e.style.fontSize=$("#form_font_size input").val(),"resize_text"in object_mapper[r]?object_mapper[r].resize_text(d3.select(e)):resize_if_wanted_after_font_change(e)})}},["text_align_left","text_align_center","text_align_right"].forEach(function(e){$("."+e).on("click",function(){manage_groups.get_group(currentElement,!0).forEach(function(t){t.style.textAlign=e.split("_")[2]})})}),document.querySelector("#form_print_region_view .plus").onclick=function(e){var t=document.querySelector("#form_print_region_view input"),r=parseInt(t.value)
t.value=r+10+"%",$("#form_print_region_view input").change()},document.querySelector("#form_print_region_view .minus").onclick=function(e){var t=document.querySelector("#form_print_region_view input"),r=parseInt(t.value)
t.value=r-10+"%",$("#form_print_region_view input").change()},document.querySelector("#form_print_region_view input").onchange=function(e){document.querySelector("#zoomcall").setAttribute("transform","scale("+parseInt(this.value)/100+")")},document.querySelector("#form_font_size .plus").onmousedown=function(e){var t=document.querySelector("#form_font_size input"),r=parseInt(t.value)
t.value=r+1,$("#form_font_size input").change()},document.querySelector("#form_font_size .minus").onmousedown=function(e){document.querySelector("#form_font_size input").value-=1,$("#form_font_size input").change()}
var active_par_prefix="bullet"
$(".form_paragraph_prefix").on("click",function(e){if("BUTTON"==e.target.tagName){var t=e.target.classList.contains("onoff-on")
active_par_prefix=e.target.value,d3.selectAll(".form_paragraph_prefix button").classed("onoff-on",!1),d3.selectAll('.form_paragraph_prefix button[value="'+e.target.value+'"]').classed("onoff-on",!t),manage_groups.get_group(currentElement,!0).forEach(function(e){var t=document.querySelector('.form_paragraph_prefix button[value="'+active_par_prefix+'"]').classList.contains("onoff-on"),r=search_paragraph_bullet_point(e)
r&&e.classList.remove(r),t&&e.classList.add(active_par_prefix)})}}),document.querySelector("#toggle_zoom").onclick=function(){zoom_toggle_func(this)},zoom_toggle_func(document.querySelector("#toggle_zoom"))
var get_next_add_on_id=function(){var e=-1
return function(){e+=1
var t=""
return e<10&&(t+="0"),e<100&&(t+="0"),"_"+(t+=e.toString())}}(),MARGIN_DIV=0
$(".form_disp_go").on("click",function(e){manage_groups.get_group(currentElement,!0).forEach(function(e){[0,1,2,3].forEach(function(t){disperse_path_over_side(e,t,MARGIN_DIV)})})}),$(".form_no_disp").on("click",function(e){[0,1,2,3].forEach(function(e){disperse_path_over_side(currentElement,e,.5)})}),$(".from_side").on("click",function(e){currentElement.classList.contains("hg")&&cpa.e1.classList.contains("hg_parent")&&text_to_feedback_pane("you can change the direction from the \t\t\t  parent to this group, but its name (= direction -NESW) will not change ",!1,!0)
var t=directions.indexOf(this.innerText)
manage_groups.get_group(currentElement,!0).forEach(function(e){var r=!!e.querySelector("circle")
r&&toggle_visible(),remake_path(fixed_path_side(e,t,void 0),!0),toggle_path_from_and_to(t,parseInt(e.getAttribute("to_side"))),toggle_path_reset_button(e),r&&toggle_visible()}),gui.frame_element(currentElement)}),$(".to_side").on("click",function(e){var t=this.innerText
manage_groups.get_group(currentElement,!0).forEach(function(e){var r=!!e.querySelector("circle")
r&&toggle_visible(),set_path_attrs(d3.select(e)),cpa.from_side=cpa.from_side?cpa.from_side:null,cpa.to_side=directions.indexOf(t).toString(),cpa.fixed_side=!0,remake_path(find_path(void 0,!0)),r&&toggle_visible()}),toggle_path_from_and_to(parseInt(currentElement.getAttribute("from_side")),directions.indexOf(t)),toggle_path_reset_button(currentElement),gui.frame_element(currentElement)}),$(".form_path_reset").on("click",function(){toggle_path_reset_button(currentElement),manage_groups.get_group(currentElement,!0).forEach(function(e){currentElement.classList.contains("hg")||(set_path_attrs(d3.select(e)),cpa.from_side=null,cpa.to_side=null,cpa.fixed_side=null,cpa.custom_flow=null,cpa.offset_from=null,cpa.offset_to=null,cpa.pos1=.5,cpa.pos2=.5,e.removeAttribute("custom_flow"),e.removeAttribute("offset_from"),e.removeAttribute("offset_to"),remake_path(find_path()))})})
var marge_for_copy=parseInt(40/mdd)*mdd
$(".form_group_cov").on("click",function(){manage_groups.get_group(currentElement,!0).forEach(function(e){g_d3=d3.select(e)
var t=object_mapper[g_d3.attr("i_am_a")].stick_to_me(g_d3)
0==t?text_to_feedback_pane("no elements found within this element",!1,!0):text_to_feedback_pane(t+" elements grouped",!1,!0)})}),document.querySelector("#form_ungroup").onclick=function(){ungroup_element(d3.select(currentElement)),text_to_feedback_pane("ungrouping done!")},$(".form_ungroup_all_children").on("click",function(e){manage_groups.get_group(currentElement,!0).forEach(function(e){ungroup_all_children(e),text_to_feedback_pane("done: ungrouped all children")})}),document.querySelector("#cm_fix_position").onclick=function(e){toggle_drag_listener()},$(".form_fix_position").on("click",function(e){toggle_drag_listener(),Array.from(document.querySelectorAll(".form_fix_position")).forEach(function(e){return toggle_button(e)})}),document.querySelector("#form_size_delta").onclick=toggle_size_fine,document.querySelector("#form_move_delta").onclick=toggle_move_fine,document.querySelector("#form_auto_resize").onclick=function(){auto_resize=!auto_resize,toggle_button(this)},toggle_button(document.querySelector("#form_auto_resize"))
var pres_mode_for_load=!1,new_map_for_load=!0
document.querySelector("#new_map_for_load").onclick=function(e){new_map_for_load=!new_map_for_load,toggle_button(e.target.parentElement)},[1,2,3,4,5].forEach(function(e){$(".font"+e+"_holder").on("click",function(t){"P"==currentElement.tagName&&check_for_range_when_p_form_action(),manage_groups.get_group(currentElement,!0).forEach(function(t){change_font_class_of_shape(t,e)}),document.querySelector("#form_font_size input").value=window.getComputedStyle(currentElement).fontSize})}),$(".form_pencil_size button").on("click",function(e){$(".form_pencil_size").find("button").toggleClass("onoff-on",!1),$('.form_pencil_size button[value="'+this.value+'"]').toggleClass("onoff-on",!0),path_basic.styles["stroke-width"]=this.value+"px",drag_for_drawing||drag_draw_on()})
var MORPH=!1
document.querySelector("#form_morph").onclick=function(){MORPH=!MORPH,prev_element=currentElement,MORPH&&text_to_feedback_pane("click example shape / figure",!1,!0),MORPH||text_to_feedback_pane("morping aborted...",!1,!0)}
var toggle_side_bar=function(e){var t=document.querySelector("#sidebar").classList.contains("menu_hidden")
1==arguments.length&&(t=e),document.querySelector("#sidebar").classList.toggle("menu_hidden",!t),document.querySelector("#show_button").style.display=t?"none":"block",form_hidden=!t}
$("#form_menu_hide").on("click",function(e){toggle_side_bar(),e.stopPropagation()}),document.querySelector("#show_button").onclick=function(e){toggle_side_bar(),e.stopPropagation()},svg=d3.select("#zoomfield"),document.querySelector("#modal_save").onclick=function(e){reset_save(),open_tab(e,"save")},$("#modal_load").on("click",function(e){local_store.check_if_maps_loaded(),open_tab(e,"load")}),document.querySelector("#icons_basic").onclick=function(e){open_tab(e,"basic")},document.querySelector("#icons_work").onclick=function(e){open_tab(e,"work")},document.querySelector("#icons_recreational").onclick=function(e){open_tab(e,"recreational")},document.querySelector("#icons_commercial").onclick=function(e){open_tab(e,"commercial")}
var data_ext_loaded={}
document.querySelector("#upload").onclick=function(e){this.value=""},document.querySelector("#upload").onchange=function(e){data_ext_loaded={},d3.selectAll("#load_previews_ext div").remove()
for(var t=0;t<this.files.length;t++){var r=this.files[t].name
reader=new FileReader,"json"==r.split(".").slice(-1)?(reader.readAsText(this.files[t]),reader.onload=function(e){return function(t){var r=JSON.parse(t.target.result)
if(!check_if_data_is_valid(r))return text_to_feedback_pane("file "+e+" not recognized as valid breakdown-map",!0,!0),!1
add_single_map_to_preview(e,d3.select("#load_previews_ext"),!1,r),e in data_ext_loaded||(data_ext_loaded[e]=r)}}(r),document.querySelector("#load_ext_map").style.display="block"):text_to_feedback_pane([r+" is not a json file. Will only load json files"],!0,!0)}},$(".form_deselect_group").on("click",function(e){manage_groups.deactivate_group(),update_quick_grouping_forms()}),$(".form_temp_group_to_perm").on("click",function(e){manage_groups.push_temp_to_new_group(),update_quick_grouping_forms()})
for(var t=document.querySelectorAll(".form_reset_group"),i=0;i<t.length;i++)t[i].onclick=function(){manage_groups.reset(),remove_highlights()}
for(var fs=document.querySelectorAll(".toolbar1 legend"),i=0;i<fs.length;i++)fs[i].onclick=function(){this.parentElement.classList.contains("collapsed")&&(close_other_fieldsets(),!form_filled&&currentElement&&fill_forms(currentElement)),toggle_field_set(this.parentElement)}
$(".form_path_style2 select").on("change",function(){manage_groups.get_group(currentElement,!0).forEach(function(e){currentElement=e,"octopus"==this.value&&"manhattan"==e.getAttribute("flow")?text_to_feedback_pane(["octopus style not possible for this flow","change style to 1, 3 or 4 (not the square one)."],!1,!0):"octopus"==this.value&&cpa.arrow_tail?text_to_feedback_pane(["octopus not available with add-ons (like arrow) on tail","remove tail add-ons first"],!1,!0):change_path_flow_and_style(!1,active_line_flow,this.value)}.bind(this)),gui.frame_element(currentElement)}),$(".form_copy").on("click",make_ready_for_copy),$(".form_paste_group").on("click",function(){if(manage_groups.get_current_group().length>0){if(!last_pos)return text_to_feedback_pane("First click canvas at where you want to copy. Then press copy again",!1,!0),!1
manage_groups.paste_group(last_pos)}else text_to_feedback_pane("no group so nothing to paste....",!1,!0)}),$(".form_block_or_path").on("click",function(){var e=d3.select(currentElement)
e.classed("connection")||(e=d3.select(currentElement.parentElement)),text_basic.block_to_path_vv(e),toggle_button(this)}),$(".form_label_top").on("click",function(e){var t=currentElement.getAttribute("i_am_a"),r="text_block"==t||"text_path"==t?currentElement.parentElement:currentElement
move_element_to_top(r),r.setAttribute("on_top",1)}),plus_minus_generator(document.getElementById("form_hierarchy_margin"),function(e){var t=hierarchies.get_current_group_info()
hierarchies.set_new_margin_for_group(t.parent,t.from_side,parseInt(e.value))}),plus_minus_generator(document.getElementById("form_grid_delta"),function(e){mdd=isNaN(parseInt(e.value))?INIT_MDD:Math.max(1,parseInt(e.value)),marge_for_copy=mdd,move_delta=mdd,size_delta=mdd,e.value=mdd}),plus_minus_generator(document.getElementById("form_grid_lines_width"),function(e){e.value=Math.max(0,e.value)}),plus_minus_generator(document.getElementById("form_grid_lines_dx_extra"),function(e){e.value=Math.max(0,e.value)}),plus_minus_generator(document.getElementById("form_grid_lines_dy_extra"),function(e){e.value=Math.max(0,e.value)}),document.querySelector("#form_grid_delta input").value=INIT_MDD,$(".form_hierarchy_alignment").on("click",function(){hierarchies.set_my_group(currentElement)
var e=hierarchies.get_current_group_info()
if("vert"==e.parent.getAttribute("hg_"+e.from_side))var t="hor"
else var t="vert"
hierarchies.set_alignment_for_group(e.parent,e.from_side,t),toggle_button(this)}),$(".form_hierarchy_swap_side").on("click",function(){hierarchies.set_my_group(currentElement)
var e,t=hierarchies.get_current_group_info()
"0"==t.to_side&&(e=2),"2"==t.to_side&&(e=0),"1"==t.to_side&&(e=3),"3"==t.to_side&&(e=1),hierarchies.change_to_side_for_children(e),toggle_button(this)})
for(var t=document.querySelectorAll("#form_realign button"),i=0;i<t.length;i++)d=t[i],d.onclick=function(){var e=iama(currentElement)
if(!e||"path_group"==e||"knot"==e)return text_to_feedback_pane("not a valid element for alignment",!1,!0),!1
var t=hierarchies.is_child_of(currentElement)
if(t){var r=document.querySelector(t[0])
hierarchies.realign_group(r,t[1],this.value)
var n=hierarchies.get_children(r,t[1])
hierarchies.realign_children_of_realigned_group(n)}else{var o=manage_groups.get_group(currentElement,!0)
align_figs(currentElement,o,this.value,!0),manage_groups.get_group(currentElement).forEach(function(e){resize_protocol(e,0,0),e.querySelector('g[i_am_a="knot"]')&&reposition_protocol(e.querySelector('g[i_am_a="knot"]'),0,0)})}}
for(var t=document.querySelectorAll("#form_resize button"),i=0;i<t.length;i++)d=t[i],d.onclick=function(){var e=iama(currentElement)
if(!e||"path_group"==e||"knot"==e||"text_basic"==e||"icon_basic"==e)return text_to_feedback_pane("not a valid element for alignment",!1,!0),!1
if(hierarchies.is_child_of(currentElement))hierarchies.resize_elements(currentElement,this.value)
else{var t=manage_groups.get_group(currentElement,!0)
resize_elements(currentElement,t,this.value)}manage_groups.get_group(currentElement,!0).forEach(function(e){return roughing.roughen_if_needed(e)})}
document.querySelector("#form_hierarchy_mark").onclick=function(){hierarchies.mark_as_child(currentElement)},$(".form_hierarchy_mirror").on("click",function(){var e=manage_groups.get_group(currentElement,!0)
hierarchies.mirror_elements(e)}),document.querySelector("#cm_knot_straigthen").onclick=function(){var e=hierarchies.is_child_of(currentElement),t=_slicedToArray(e,2),r=t[0],n=t[1],o=currentElement.getAttribute("id"),a=document.querySelector("#from"+r.slice(1)+"_to"+o+"_0"),i=parseFloat(a.getAttribute("pos1")),s=n%2==0?"width":"height",_=parseFloat(document.querySelector(r).getAttribute(s))*i,c=posit2.get_trans(currentElement).translate,l=_-c[0]-.5,u=_-c[1]-.5
"width"==s?reposition_protocol(currentElement,l,0):reposition_protocol(currentElement,0,u)},document.querySelector(".open_modal_save").onclick=function(e){open_modal("save_load_modal"),open_tab(e,"save"),prep_modal_gist_edit(),reset_save()},document.querySelector("#modal_github_save_section button").onclick=function(e){local_store.save_as_gist()},document.querySelector(".open_modal_load").onclick=function(e){show_wait_spinner("","loading previews for maps in local storage"),setTimeout(function(){open_modal("save_load_modal"),open_tab(e,"load"),local_store.check_if_maps_loaded(),hide_wait_spinner()}.bind(this),200)},$(".open_modal1").on("click",function(e){open_modal("save_load_modal")}),$(".close_modal").on("click",function(e){close_modal(e.target.parentElement.parentElement.id)}),document.querySelector("#dismiss_button").onclick=function(e){document.querySelector("#browser_compat").style.display="none"},document.querySelector("#form_toggle_sticky").onclick=function(e){var t=""
manage_groups.get_group(currentElement,!0).forEach(function(e){e.classList.toggle("sticky"),e.classList.toggle("evade_me"),t=e.classList.contains("sticky")?"element now sticky":"element no longer sticky"}),text_to_feedback_pane(t,!1,!0)},$(".button-new-map").on("click",function(){window.open(document.location.origin+"/makemap/new")}),document.querySelector("#button_tut_restart").onclick=function(e){quick_tut.start()},$(".button_to_tut").on("click",function(){var e=slides_mode?"tut_slides ":"tut",t=document.location.origin+"/makemap/load/"+e
window.open(t,"_blank")}),$(".button_to_hotkeys").on("click",function(){var e=document.location.origin+"/makemap/load/hotkeys"
window.open(e,"_blank")}),document.querySelector("#scale_reset_button").onclick=function(e){var t=posit2.get_trans(currentElement)
t.scale=1,currentElement.setAttribute("transform",transform_to_string(t)),posit2.set_trans(currentElement.id,t),gui.frame_element(currentElement)}
var slides_mode=!1
$(".swap_menu").on("click",toggle_slide_edit_menu),$(".form_to_top").on("click",function(e){manage_groups.get_group(currentElement,!0).forEach(function(e){move_element_to_top(e)})}),$(".form_cov_to_top").on("click",function(e){ido(currentElement).move_covered_to_top(d3.select(currentElement))})
for(var fieldsets=document.querySelectorAll("fieldset"),k=0;k<fieldsets.length;k++)for(var menu=fieldsets[k],headers=menu.querySelectorAll(".submenus h4"),_i=0;_i<headers.length;_i++){var h=headers[_i]
h.onclick=change_submenu}!function(){function e(e){if(e.target,"Image"==e.target.innerText){var t=document.querySelector("#print_region")
t&&printer.change_size_of_print_region(t,"custom")}}for(var t=document.querySelector("#fs_export").querySelectorAll(".submenus h4"),r=0;r<t.length;r++)t[r].onclick=function(t){e(t),change_submenu(t)}}(),$(window).focus(function(){key_pressed=[]}),document.querySelector("#form_bind_to_path button").onclick=function(){bind_text_to_path(currentElement)}
var waiting_for_par_bind=!1
$(".form_bind_path_to_par").on("click",function(){text_to_feedback_pane("click para to bind to",!1,!0),waiting_for_par_bind=iami(currentElement)}),document.body.onpaste=handle_paste_event,document.body.ondrop=handle_paste_event,document.querySelector("#form_toggle_grid_lines").onclick=function(){if(is_toggle_button_on(this))svg.select("#grid").remove()
else{var e=parseInt(document.querySelector("#form_grid_lines_dx input").value),t=parseInt(document.querySelector("#form_grid_lines_dy input").value)
if(!e&&!t)return text_to_feedback_pane("you have to set delta x or delta y to a value bigger then zero",!1,!0),!1
make_gridlines(e,t),svg.selectAll("g[i_am_a]")[0].forEach(function(e){return move_element_to_top(e)})}toggle_button(this)},document.querySelector("#form_toggle_plumb_lines").onclick=function(){plumbs=!is_toggle_button_on(this),toggle_button(this)},document.querySelector("#form_toggle_gui_glow").onclick=function(e){var t=is_toggle_button_on(this)
toggle_hover_highlights.toggle_glow(t),toggle_button(this)},plus_minus_generator(document.getElementById("form_grid_lines_dx"),function(e){e.value=Math.max(0,e.value)}),plus_minus_generator(document.getElementById("form_grid_lines_dy"),function(e){e.value=Math.max(0,e.value)}),plus_minus_generator(document.getElementById("form_catcher_width"),function(e){e.value=Math.max(0,e.value),gui.change_catcher_width(parseInt(e.value))}),document.querySelector("#sidebar").onclick=function(){last_pos&&(last_map_pos=last_pos),last_pos=!1},$("input").on("keydown",function(e){"flash_card_val_to_check"!=e.target.id&&e.stopPropagation()}),$(".cm-print-size").on("input",function(e){var t=document.querySelector("#print_region"),r="portrait"==document.querySelector(".cm-print-layout option:checked").value
if(!t){var n=toggle_zoom.get_zoom_and_trans(),o=_slicedToArray(n,2),a=o[0],i=o[1],s=[-i[0]/a+250,-i[1]/a+100]
t=printer.show_print_region(s,[10,10],r)}$(".cm-print-size").val(e.target.value),printer.change_size_of_print_region(t,e.target.value,r),document.querySelector("#form_print_region_if_active").style.display="block",document.querySelector("#form_print_buttons").style.display="flex"}),$(".cm-print-layout").on("change",function(e){var t=document.querySelector("#print_region"),r=document.querySelector(".cm-print-size option:checked").value
$(".cm-print-layout").val(e.target.value),printer.change_size_of_print_region(t,r,"portrait"==e.target.value)}),$(".cm-print-print").on("click",function(e){var t=document.querySelector(".cm-print-size option:checked").value,r=document.querySelector(".cm-print-layout option:checked").value
printer.print(t,r)}),document.querySelector("#form_remove_print_region").onclick=remove_print_region,document.querySelector("#form_drag_merge").onclick=function(e){drag_select=!drag_select,drag_select?(el_to_merge_to=currentElement,drag_select_for_merge=!0,drag_select_on()):(drag_select_off(),drag_select_for_merge=!1,el_to_merge_to=!1)}
var new_draw_group=!1
$(".background_size button").on("click",function(e){if(_.forEach(e.target.parentElement.querySelectorAll("button"),function(e){return e.classList.remove("onoff-on")}),e.target.classList.add("onoff-on"),"P"==currentElement.tagName)var t=currentElement
else var t=currentElement.querySelector("article:not(.collapsed)")
t.style.backgroundSize=e.target.innerText.toLowerCase()}),$(".background_fit_larger").on("click",function(e){size_fig_to_image(currentElement,!0,!1)}),$(".background_fit_smaller").on("click",function(e){size_fig_to_image(currentElement,!1,!1)}),$(".background_fit_orig").on("click",function(e){size_fig_to_image(currentElement,!1,!0)}),$(".form_make_flippable").on("click",function(e){manage_groups.get_group(currentElement,!0).forEach(function(e){ido(e).make_flippable(e)}),this.style.display="none",gui.frame_element(currentElement)}),document.querySelector("#dump_local_maps").onclick=function(e){local_store.dump_all()},$(".octo_flip").on("click",function(e){cpa.arrow_head?(cpa.arrow_tail=cpa.arrow_head,cpa.arrow_head=!1,d3.select(cpa.path_g).select("g.arrow_1").remove()):cpa.octo_flipped&&cpa.arrow_tail&&(cpa.arrow_head=cpa.arrow_tail,cpa.arrow_tail=!1,d3.select(cpa.path_g).select("g.arrow_0").remove()),cpa.octo_flipped=!cpa.octo_flipped,remake_path(find_path(!0)),cpa.octo_flipped?currentElement.setAttribute("octo_flipped",!0):currentElement.removeAttribute("octo_flipped")})
var copied_styles=!1
$(".copy_styles").on("click",make_ready_for_style_copy),document.querySelector(".cm_copy_element").onclick=function(e){make_ready_for_copy(!1)},document.querySelector("#cm_delete_button").onclick=function(e){delete_shape(currentElement)},document.querySelector("#cm_zoom_button").onclick=function(){if(for_group){var e=manage_groups.find_els_in_bbox_not_in_group(manage_groups.get_current_group()),t=_slicedToArray(e,2),r=t[0],n=t[1]
toggle_zoom.center_on_group(manage_groups.get_current_group(),toggle_zoom.filters.fade,n,!1,r,2.5),manage_groups.deactivate_group()}else{var o=find_g(currentElement)
toggle_zoom.center_on_shape(o,!1,!1,!1,!1,5)}gui.frame_element(currentElement)},document.querySelector("#cm_zoom_button_country_basic").onclick=function(){var e=ido(currentElement).get_my_pos(currentElement),t=_slicedToArray(e,4),r=t[0],n=t[1],o=t[2],a=t[3],i=toggle_zoom.calc_zoom_trans(r,n,o,a,2.5),s=_slicedToArray(i,2),_=s[0],c=s[1]
toggle_zoom.set_zoom_and_trans(_,c)},document.querySelector("#modal_feedback span").onclick=hide_feedback_modal
var text_to_feedback_pane=make_feedback_func(document.querySelector("#fs_feedback")),text_to_help_pane=make_feedback_func(document.querySelector("#fs_help")),text_to_help_pane_slides=make_feedback_func(document.querySelector("#fs_help_slides"))
$(".form_par_to_flip_side").on("click",function(e){manage_groups.get_group(currentElement,!0).forEach(function(e){var t=find_g(e)
ido(t).move_par_to_flip_side(t,e)})}),$(".form_even_out_pars").on("click",function(e){var t=manage_groups.get_group(currentElement,!1)
t=t.filter(function(e){return e.querySelector("foreignObject")}),t.forEach(function(e){return ido(e).even_out_paragraphs(e)})})
var study_mode=!1,reverse=1e3,form_update=!0
document.querySelector("#form_flash_time").onchange=function(e){reverse=parseInt(this.value)},$(".form_study_mode").on("click",function(){study_mode?turn_study_mode_off():(study_mode=!0,form_update=!1,bind_catchers_to_quick_flipper(),text_to_feedback_pane("study away!",!1,!0),document.querySelector("#fs_study_mode").style.display="flex",toggle_field_set(document.querySelector("#fs_buttons")),toggle_field_set(document.querySelector("#fs_study_mode")))}),$(".form_shuffle_flash_cards").on("click",function(e){els=get_group_for_study_mode(),shuffle_shapes.place_shapes(els)}),$(".form_flip_all_flash_cards").on("click",function(e){els=get_group_for_study_mode(),_.forEach(els,function(e){e.classList.contains("flippable")&&ido(e).flip_shape(e)})}),document.querySelector("#form_text_field_break").onclick=handle_text_break_button_click,document.querySelector("#form_show_continent").onclick=function(){g=find_g(currentElement),text_to_feedback_pane(g.getAttribute("continent"))},document.querySelector("#form_show_name").onclick=function(){g=find_g(currentElement)
var e=g.hasAttribute("country")?g.getAttribute("country"):g.getAttribute("name")
text_to_feedback_pane(e)}
var correct_final_pos=[1265,1585]
document.querySelector("#form_show_position").onclick=function(){var e=find_g(currentElement),t=correct_final_pos[0],r=correct_final_pos[1]
ido(e).reposition_me(e,t,r,!1)}
var posit2=positioning_and_store(svg.node())
document.querySelector(".form_select_nth_paragraph").onclick=function(e){manage_groups.swap_group_for_nth_paragraps(document.querySelector("#form_nth_par").value)},$(".form_copy_with_text").on("click",function(e){$(".form_copy_with_text").prop("checked",this.checked)}),$("#form_border_side button").on("click",function(e){e.target.classList.toggle("onoff-on")
var t=_.map(this.parentElement.querySelectorAll("button"),function(e){return e.classList.contains("onoff-on")})
manage_groups.get_group(currentElement,!0).forEach(function(e){if(is_par_tag(e))["border-top-style","border-right-style","border-bottom-style","border-left-style"].forEach(function(e){return currentElement.style[e]="none"}),_.all(t)||_.all(t.map(function(e){return!e}))?(e.removeAttribute("border_sides_arr"),e.style.borderStyle="inherit"):["border-top-style","border-right-style","border-bottom-style","border-left-style"].forEach(function(r,n){e.style[r]=t[n]?"solid":"none"})
else{if(!("calc_border"in ido(e)))return!1
ido(e).calc_border(e,t)}_.all(t)||_.all(t.map(function(e){return!e}))?e.removeAttribute("border_sides_arr"):e.setAttribute("border_sides_arr",t)})}),$("#form_add_on_width, #form_add_on_height").on("input",function(e){function t(e){return i_am_a=iama(e),"path_group"==i_am_a||"path_basic"==i_am_a?e.querySelector(".arrow_0, .arrow_1"):e}var r=this.name,n=parseInt(this.value)
currentElement=t(currentElement)
var o=currentElement.getAttribute("class"),a=currentElement.parentElement
"path_group"==iama(a)?manage_groups.get_group(a,!0).forEach(function(e){if(e=t(e)){clear_path_attrs(),set_path_attrs(d3.select(e.parentElement)),cpa["arrow_"+r]=n
remake_path(find_path(!0))}}):(currentElement.setAttribute("arrow_"+r,n),ido(a).update_line_end_shapes(a)),currentElement=a.querySelector("."+o),gui.frame_element(currentElement)})
var study_one_by_one
document.querySelector("#form_study_one_by_one_start").onclick=function(e){var t=manage_groups.get_current_group()
manage_groups.reset(),t.length>1?t.filter(function(e){return e.classList.contains(".flippable")}):t=Array.from(svg.node().querySelectorAll("g.flippable"))
var r=document.querySelector("#form_one_by_one_scored").checked,n=document.querySelector("#form_one_by_one_check_by_typing").checked
study_one_by_one=init_study_one_by_one(t,n,r),study_one_by_one.next()},document.querySelector("#form_study_one_by_one_next").onclick=function(){study_one_by_one.next()},document.querySelector("#form_study_one_by_one_flip").onclick=function(e){study_one_by_one.flip()},document.querySelector("#form_study_one_by_one_stop").onclick=turn_study_one_by_one_off,document.querySelector("#form_path_add_control_point").onclick=function(e){svg.node().querySelector(".cp")&&toggle_visible(),add_cp_to_path(currentElement)
var t=currentElement.querySelector("path").getAttribute("d")
cpa.custom_flow=get_path_custom_flow_attrs(path_to_array(t)),d3.select(currentElement).attr("custom_flow",cpa.custom_flow).attr("fixed_side","true"),toggle_visible()},document.querySelector("#form_path_cp_move_free").onclick=function(e){all_cp_free=!is_toggle_button_on(this),toggle_button(this)},document.querySelector("#form_path_toggle_cps").onclick=function(e){toggle_visible(),event.stopPropagation(),toggle_button(this)},document.querySelector("#form_show_group_borders").onclick=function(e){show_group_borders=!show_group_borders,toggle_button(this)},document.querySelector("#form_show_group_borders_all").onclick=function(e){d3.select(".group_highlight").empty()?add_group_hints(!1,!0):remove_highlights()},document.querySelector(".form_group_disperse_a").onclick=function(e){disperse_group(manage_groups.get_group(currentElement,!0),.9,1)},document.querySelector(".form_group_disperse_b").onclick=function(e){disperse_group(manage_groups.get_group(currentElement,!0),1.1,1)},document.querySelector(".form_group_disperse_c").onclick=function(e){disperse_group(manage_groups.get_group(currentElement,!0),1,.9)},document.querySelector(".form_group_disperse_d").onclick=function(e){disperse_group(manage_groups.get_group(currentElement,!0),1,1.1)},_.forEach([document.querySelector("#form_toggle_draw"),document.querySelector("#cm_toggle_draw")],function(e){e.onclick=function(e){cmm.off(),this.querySelector(".toggle-button").classList.contains("toggle-button-selected")?drag_draw_off():drag_draw_on()}}),$(".cm-show-path-basic-points").on("click",function(e){toggle_visible(currentElement)}),document.querySelector("#form_draw_paths").onclick=function(e){recog_path=!recog_path,toggle_button_to_status(this,recog_path),free_draw=!recog_path&&!recog_shape},document.querySelector("#form_draw_shapes").onclick=function(e){recog_shape=!recog_shape,toggle_button_to_status(this,recog_shape),free_draw=!recog_path&&!recog_shape},document.querySelector("#form_import_auto_number").onclick=function(e){auto_number_import=this.checked},document.querySelector("#form_import_delta_x").onchange=function(e){delta_x_import=parseInt(this.value)},document.querySelector("#form_import_delta_y").onchange=function(e){delta_y_import=parseInt(this.value)},document.querySelector("#form_import_break_on_rc").onchange=function(e){write_colwise="row"==this.value},document.querySelector("#form_import_max_for_break").onchange=function(e){max_rc_before_break=parseInt(this.value)},document.querySelector("#cm-change-text-path").onclick=function(e){show_text_input_area(currentElement.querySelector("text")),event.stopPropagation()},document.querySelector("#form_path_straighten_cps").onclick=function(e){straighten_cps(currentElement)},document.querySelector("#form_stroke_del").onclick=function(e){e.stopPropagation()
var t=svg.node().lastChild
"path_basic"==iama(t)&&t.classList.contains("unhandled")?t.remove():text_to_feedback_pane("no more strokes to remove")},document.querySelector("#form_draw_recog_del").onclick=function(e){e.stopPropagation(),currentElement.remove()},document.querySelector("#cm_color_stroke_only").onclick=function(e){color_stroke_only=this.checked},plus_minus_generator(document.getElementById("form_grid_lines_width"),function(e){e.value=Math.max(0,e.value),set_attr_of_rule(find_sheet("map"),".gridlines","stroke-width",e.value/1e3+"em")}),document.querySelector("#cm_path_basic_add_arrow_head").onclick=function(e){fill_fs_path_label(ido(currentElement).add_shape_to_line(currentElement,0,"curved_arrow"))},document.querySelector("#cm_path_basic_add_arrow_tail").onclick=function(e){fill_fs_path_label(ido(currentElement).add_shape_to_line(currentElement,1,"curved_arrow"))},document.querySelector("#form_one_by_one_check_by_typing").onclick=function(e){document.querySelector("#form_one_by_one_scored").disabled=!this.checked,this.checked||(document.querySelector("#form_one_by_one_scored").checked=!1)},document.querySelector("#cm_path_basic_add_fo").onclick=function(e){ido(currentElement).add_foreignObject(currentElement)},document.querySelector("#form_toggle_advanced_options").onclick=toggle_advanced_options,$(".form_fuse_shapes").on("click",function(e){var t=manage_groups.get_current_group()
t=t.sort(function(e,t){return posit2.get_top_left(e)[1]-posit2.get_top_left(t)[1]}),ido(t[0]).shape_fusion(t[0],t.slice(1))}),document.querySelector(".form_group_to_subcanvas").onclick=function(e){group_to_sub_canvas()},document.querySelector(".form_vert_align.top").onclick=make_vert_align_handler("text-top"),document.querySelector(".form_vert_align.base").onclick=make_vert_align_handler("baseline"),document.querySelector(".form_vert_align.sub").onclick=make_vert_align_handler("sub"),document.querySelector(".form_vert_align.bottom").onclick=make_vert_align_handler("text-bottom"),document.querySelector("#form_font_resize_on_change").onchange=function(e){document.querySelector("#form_font_resize_height_only").disabled=!e.target.checked}
var fig_dbl={event_type:"dblclick",func:fig_dblclick},down_pick={event_type:"mousedown",func:function(){return!1}},click_pick={event_type:"click",func:function(){cmm.status()&&cmm.off(),copied_styles&&set_styles_for_copy(find_g(this),copied_styles),copied_styles_for_table&&"cell_basic"==iama(find_g(this))&&set_styles_for_table_copy(find_g(this),copied_styles_for_table),set_currentElement(this),display_fs_for_shape(currentElement),d3.select(currentElement).classed("example_fig")||gui.frame_element(currentElement),d3.event.ctrlKey&&"click"==d3.event.type&&manage_groups.toggle_element(currentElement),d3.event.shiftKey&&(manage_groups.cycle_through_groups_of_shape(currentElement),update_quick_grouping_forms()),show_group_borders&&add_group_hints(find_g(this)),d3.event.stopPropagation()}},mouse_over={event_type:"mouseover",func:function(){toggle_catcher_glow(find_g(this),!0)}},mouse_out={event_type:"mouseout",func:function(){toggle_catcher_glow(find_g(this),!1)}},touch_events=["touchend","touchmove"].map(function(e){return{event_type:e,func:touching}}),dblclick_show_points={event_type:"dblclick",func:function(){toggle_poly_points(find_g(this)),d3.event.stopPropagation()}},fig_dbl_tap={event_type:"touchstart",func:double_tap_detect(fig_dblclick)},fig_events=[fig_dbl,fig_dbl_tap,down_pick,click_pick,mouse_over,mouse_out].concat(touch_events),canvas_events=[down_pick,{event_type:"click",func:function(){copied_styles&&set_styles_for_copy(find_g(this),copied_styles)
var e=find_g(this)
active_canvas=e,set_currentElement(e),display_fs_for_shape(e),gui.frame_element(e),last_pos=d3.mouse(svg.node()),d3.event.ctrlKey&&"click"==d3.event.type&&manage_groups.toggle_element(currentElement),d3.event.stopPropagation()}},mouse_over,mouse_out].concat(touch_events),object_to_event={polygon:fig_events,poly_points_fo:fig_events,poly_points:canvas_events,slide:canvas_events,rect_basic:fig_events,rect_canvas:canvas_events,ellipse_basic:fig_events,knot:fig_events.filter(function(e){return"dblclick"!=e.event_type}).concat([{event_type:"dblclick",func:function(){text_to_feedback_pane("to add child, make connection between wannabe child and parent, and press mark as child in hierarchy menu",!1,!0),d3.event.stopPropagation()}}]),poly_point:fig_events.filter(function(e){return"dblclick"!=e.event_type}),text_basic:fig_events,text_path:[{event_type:"click",func:text_path_click},{event_type:"mouseover",func:function(){toggle_zoom.temp_disable_on()}},{event_type:"mouseout",func:function(){toggle_zoom.temp_disable_off()}},{event_type:"dblclick",func:function(){show_text_input_area(this),d3.event.stopPropagation()}}].concat(touch_events),text_block:[{event_type:"click",func:text_path_click},{event_type:"mouseover",func:function(){toggle_zoom.temp_disable_on()}},{event_type:"mouseout",func:function(){toggle_zoom.temp_disable_off()}},{event_type:"dblclick",func:function(){show_text_input_area(this),d3.event.stopPropagation()}}].concat(touch_events),cp_resize:[{event_type:"dblclick",func:function(){manage_groups.get_group(find_g(currentElement),!0).forEach(function(e){object_mapper[iama(e)].size_around_paragraphs(e,void 0,d3.event.shiftKey),gui.remove_all(),d3.event.stopPropagation()})}},{event_type:"click",func:function(){d3.event.stopPropagation()}},{event_type:"mousedown",func:function(){display_gui_element_info(this),d3.event.stopPropagation()}}].concat(touch_events),cp_rotate:[{event_type:"dblclick",func:function(){d3.event.stopPropagation()}},{event_type:"click",func:function(){d3.event.stopPropagation()}},{event_type:"mousedown",func:function(){display_gui_element_info(this),d3.event.stopPropagation()}}].concat(touch_events),cp_helper:[{event_type:"mouseover",func:function(){toggle_zoom.temp_disable_on()}},{event_type:"mouseout",func:function(){toggle_zoom.temp_disable_off(),remove_highlights()}},{event_type:"dblclick",func:fig_dblclick},click_pick,{event_type:"mousedown",func:function(){return toggle_zoom.temp_disable_on(),!1}}].concat(touch_events),path_basic:fig_events,line_for_graph:[{event_type:"mouseover",func:function(){toggle_catcher_glow(this.parentElement.querySelector('g[i_am_a="math_basic"]'),!0)}},{event_type:"mouseout",func:function(){toggle_catcher_glow(this.parentElement.querySelector('g[i_am_a="math_basic"]'),!1)}},{event_type:"click",func:function(){set_currentElement(this),display_fs_for_shape(currentElement),gui.frame_element(currentElement),d3.event.stopPropagation()}}]},object_to_drag={polygon:drag_position,poly_points:drag_position,slide:drag_position,rect_basic:drag_position,rect_canvas:drag_position,ellipse_basic:drag_position,knot:drag_position_knot,text_basic:drag_position,text_block:drag_along_path,text_path:drag_along_path,icon_basic:drag_position,cp_helper:drag_position,graph_basic:drag_position,axes_board:drag_position,line_for_graph:null},catcher_poly=make_catcher("polygon","catcher_poly"),catcher_rect=make_catcher("rect","catcher_rect"),catcher_canvas=make_catcher("rect","catcher_canvas","rect_canvas"),catcher_ellipse=make_catcher("ellipse","catcher_ellipse"),catcher_path=make_catcher("path","catcher_path"),catcher_text_basic=make_catcher("text","catcher_text_basic","text_basic"),catcher_text_block=make_catcher("text","catcher_text_block","text_block"),catcher_text_path=make_catcher("text","catcher_text_path","text_path"),catcher_line_for_graph=make_catcher("path","catcher_line_for_graph","line_for_graph"),catcher_knot=make_catcher("ellipse","catcher_knot","knot")
catcher_line_for_graph.my_name="catcher_line_for_graph",catcher_knot.my_name="catcher_knot",fo=new FO(figs.fo)
var x_axis=new AxisBasic(figs.x_axis,[],object_to_event.axis_basic),y_axis=new AxisBasic(figs.y_axis,[],object_to_event.axis_basic),line_for_graph=new LineForGraph(figs.line_for_graph,[catcher_line_for_graph],object_to_event.line_for_graph),axes_board=new AxesBoard(figs.axes_board,[x_axis,y_axis],canvas_events)
axes_board.add_dragfunc(object_to_drag.axes_board)
var graph_basic=new GraphBasic(figs.graph_basic,[x_axis,y_axis],canvas_events)
graph_basic.add_dragfunc(object_to_drag.graph_basic)
var poly_points=new PolyPoints(figs.poly_points,[],object_to_event.poly_points)
poly_points.add_dragfunc(object_to_drag.poly_points)
var poly_points_fo=new PolyPoints(figs.poly_points_fo,[],object_to_event.poly_points_fo)
poly_points_fo.add_dragfunc(object_to_drag.poly_points)
var slide=new Slide(figs.slide,[],object_to_event.slide)
slide.add_dragfunc(object_to_drag.slide),rect_basic=new RectBasic(figs.rect_basic,[fo,catcher_rect],object_to_event.rect_basic),rect_basic.add_dragfunc(object_to_drag.rect_basic),rect_canvas=new RectCanvas(figs.rect_canvas,[catcher_canvas],object_to_event.rect_canvas),rect_canvas.add_dragfunc(object_to_drag.rect_canvas),cell_basic=new CellBasic(figs.cell_basic,[fo,catcher_rect],object_to_event.rect_basic),cell_basic.add_dragfunc(object_to_drag.rect_basic),ellipse_basic=new EllipseBasic(figs.ellipse_basic,[fo,catcher_ellipse],object_to_event.ellipse_basic),ellipse_basic.add_dragfunc(object_to_drag.ellipse_basic),knot=new Fig(figs.knot,[catcher_knot],object_to_event.knot),knot.add_dragfunc(object_to_drag.knot)
var knot_gui=new Fig(figs.knot_gui,[],object_to_event.cp_rotate,!0)
knot_gui.add_dragfunc(object_to_drag.knot),knot_hierarchy=new Fig(figs.knot_hierarchy,[],object_to_event.knot),knot_hierarchy.add_dragfunc(object_to_drag.knot),poly_point=new Fig(figs.poly_point,[],[],!0),text_basic=new TextBasic(figs.text_basic,[],object_to_event.text_basic),text_basic.add_dragfunc(object_to_drag.text_basic),icon_basic=new TextBasic(figs.icon_basic,[],object_to_event.text_basic),icon_basic.add_dragfunc(object_to_drag.text_basic),text_path=new TextPath(figs.text_path,[],object_to_event.text_path),text_path.add_dragfunc(object_to_drag.text_path),text_block=new TextBlock(figs.text_block,[],object_to_event.text_block),text_block.add_dragfunc(object_to_drag.text_block),svg_icon=new SvgIcon(figs.svg_icon,[],object_to_event.rect_basic),svg_icon.add_dragfunc(drag_position),math_basic=new MathBasic(figs.math_basic,[],object_to_event.rect_basic),math_basic.add_dragfunc(drag_position),path_basic=new PathBasic(figs.path_basic,[catcher_path],object_to_event.path_basic),path_basic.add_dragfunc(object_to_drag.rect_basic),country_basic=new CountryBasic(figs.country_basic,[catcher_path],object_to_event.path_basic.concat([{event_type:"touchend",func:function(){country_basic.set_info(find_g(this))}}])),country_basic.add_dragfunc(object_to_drag.rect_basic)
var selected_icon=""
icon_basic.set_text(selected_icon),text_block=new TextBlock(figs.text_block,[],object_to_event.text_block),text_block.add_dragfunc(object_to_drag.text_block)
var object_mapper={rect_basic:rect_basic,rect_canvas:rect_canvas,ellipse_basic:ellipse_basic,knot:knot,knot_gui:knot_gui,knot_hierarchy:knot_hierarchy,poly_point:poly_point,text_basic:text_basic,text_path:text_path,text_block:text_block,icon_basic:icon_basic,fo:fo,poly_points:poly_points,poly_points_fo:poly_points_fo,slide:slide,catcher:make_catcher("empty"),catcher_rect:catcher_rect,catcher_poly:catcher_poly,catcher_ellipse:catcher_ellipse,catcher_path:catcher_path,catcher_text_basic:catcher_text_basic,catcher_text_block:catcher_text_block,catcher_text_path:catcher_text_path,catcher_line_for_graph:catcher_line_for_graph,catcher_knot:catcher_knot,path_basic:path_basic,country_basic:country_basic,cell_basic:cell_basic,svg_icon:svg_icon,math_basic:math_basic,axes_board:axes_board,graph_basic:graph_basic,x_axis:x_axis,y_axis:y_axis,line_for_graph:line_for_graph}
Object.keys(poly_config).forEach(function(e){var t=new Polygon(figs.polygon,[fo,catcher_poly],object_to_event.polygon)
t.add_dragfunc(object_to_drag.polygon),t.my_name=e,object_mapper[e]=t})
var selected_figure=rect_basic,_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()
$(".cm_graph_min_domain, .cm_graph_max_domain").on("input",function(e){var t=get_min_max_for_graph(this.parentElement,".cm_graph_min_domain",".cm_graph_max_domain"),r=_slicedToArray(t,2),n=r[0],o=r[1]
if(isNaN(n)||isNaN(o))return!1
ido(currentElement).change_domain_x(d3.select(currentElement),n,o)}),$(".cm_graph_min_range, .cm_graph_max_range").on("input",function(e){var t=get_min_max_for_graph(this.parentElement,".cm_graph_min_range",".cm_graph_max_range"),r=_slicedToArray(t,2),n=r[0],o=r[1]
if(isNaN(n)||isNaN(o))return!1
ido(currentElement).change_domain_y(d3.select(currentElement),n,o)}),$(".cm_graph_formula_add").on("click",function(e){if(cmm.status())var t=document.querySelector("#context-menu .cm_graph_formula_text").value
else var t=document.querySelector("#edit_mode_menu .cm_graph_formula_text").value
if(""==t)return text_to_feedback_pane("no formula found..."),!1
graph_basic.add_func(d3.select(if_line_to_graph(currentElement)),t)||text_to_feedback_pane("cannot evaluate function")}),$(".cm_graph_formula_text").on("paste",function(e){e.stopPropagation()}),$(".cm_graph_formula_text").on("keydown",function(e){e.stopPropagation()}),$(".cm_graph_formula_text").on("focus",function(e){text_to_help_pane(help_mapper["add function"])}),$(".form_graph_crossed_axis").on("click",function(e){var t=this
manage_groups.get_group(currentElement,!0).forEach(function(e){e=if_line_to_graph(e),t.checked?e.setAttribute("graph_axis_crossed",!0):e.removeAttribute("graph_axis_crossed"),graph_basic.redo_axes(d3.select(e))}),$(".form_graph_crossed_axis").prop("checked",this.checked)}),$(".form_graph_grid").on("click",function(e){manage_groups.get_group(currentElement,!0).forEach(function(e){e=if_line_to_graph(e),e.hasAttribute("gridded")?(e.removeAttribute("gridded"),d3.select(e).selectAll(".gridlines").remove()):(ido(e).make_gridlines(d3.select(e)),e.setAttribute("gridded",!0))}),$(".form_graph_grid").prop("checked",currentElement.hasAttribute("gridded"))}),$(".form_graph_num_ticks_x").on("input",function(e){var t=this
manage_groups.get_group(currentElement,!0).forEach(function(e){e=if_line_to_graph(e),x_axis.change_num_ticks(d3.select(e.querySelector('g[i_am_a="x_axis"]')),parseInt(t.value))})}),$(".form_graph_num_ticks_y").on("input",function(e){var t=this
manage_groups.get_group(currentElement,!0).forEach(function(e){e=if_line_to_graph(e),y_axis.change_num_ticks(d3.select(e.querySelector('g[i_am_a="y_axis"]')),parseInt(t.value))})}),$(".form_even_scale").on("click",function(e){graph_basic.make_scales_even(d3.select(if_line_to_graph(currentElement)))}),$(".form_show_axis_num").on("change",function(e){currentElement.classList.toggle("no_nums",!this.checked),ido(currentElement).redo_axes(d3.select(currentElement))
var t="axes_board"==iama(currentElement)&&this.checked?"block":"none"
document.querySelector("#form_domain_and_ranges").style.display=t}),$(".form_line_discrete").on("click",function(e){currentElement.classList.toggle("dotted",this.checked),d3.select(currentElement).selectAll(".dots").remove(),graph_basic.make_lines(d3.select(currentElement.parentElement))}),document.querySelector("#form_fixed_range").onchange=function(e){var t
e.target.checked?(currentElement.setAttribute("fixed_range",1),t="flex"):(currentElement.removeAttribute("fixed_range"),t="none"),document.querySelector("#form_if_asymptotic").style.display=t,graph_basic.redraw_lines(d3.select(currentElement))}
var _slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()
fill_what="fill"
var colorpicker=$("#colorpicker").spectrum({showAlpha:!0,color:"#ECC",showInput:!0,className:"full-spectrum",showInitial:!0,showPalette:!0,showSelectionPalette:!0,maxSelectionSize:10,localStorageKey:"spectrum.demo",move:change_color_test,show:function(){set_color_picker(iama("path_group"==currentElement)?currentElement.firstChild:currentElement)},beforeShow:function(){},hide:function(){},change:function(){},palette:[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)","rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)","rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)","rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)","rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]]}),all_form_elements=["form_scaling","fs_hierarchy","fs_align","fs_path_label","fs_para","form_border_width","form_border_radius","form_border_dash","fs_path","fs_font","form_fill","form_font","form_font_size","fs_border","fs_fig_stuff","form_morph","fs_image","form_styling","ffw_fill","ffw_text","ffw_stroke","ffw_stroke2","form_textblock_border","fs_grouping","fs_grouping_quick","form_border_side","fs_path_advanced","fs_table","fs_table_edit","fs_import","fs_zoom_pos","fs_drawing","fs_graphing","fs_board","colors_svg","fs_set_defaults","fs_rect_canvas"],non_minimal_fieldsets=["fs_hierarchy","fs_align","fs_zoom_pos","fs_set_defaults","fs_table","fs_import","fs_grouping","fs_path_advanced"],path_form_elements=["fs_path_label","form_fill","fs_colors","fs_border","fs_grouping_quick","colors_svg","form_border_width","form_border_dash","fs_path","ffw_fill","ffw_stroke","fs_path_advanced","fs_zoom_pos"],paragraph_form_elements=["form_font_list","fs_font","form_font","form_font_size","form_fill","fs_border","form_border_radius","form_border_width","fs_para","form_font_class","form_font_size","form_styling","ffw_fill","ffw_text","ffw_stroke","form_border_side","fs_zoom_pos","colors_svg","fs_grouping_quick"],svg_form_elements=["form_scaling","form_fill","fs_drawing","fs_grouping_quick","ffw_fill","fs_table","fs_zoom_pos","fs_import","colors_svg","fs_set_defaults"],path_add_on_form_elements=["form_fill","fs_colors","fs_border","form_border_width","fs_path_label","form_border_dash","ffw_fill","ffw_stroke","colors_svg","fs_grouping_quick"]
document.querySelector("#form_border_inner").onchange=function(e){var t=iama(currentElement)
"path_group"==t||"text_block"==t?set_stroke_width_for_double(e.target.checked,"text_block"!=t):set_stroke_width_for_rough_shape(e.target.checked)}
var sheet=find_sheet("own")
!function(e){e.forEach(function(e,t){var r=e.fill,n=e.color,o=e.alpha,a=e.stroke
make_style_class_for_style_sheet(r,o,23==t?0:.8,a,n,t)})}(colors),pres_mode_manager=function(){return{set_filter_on_all:function(e){svg.selectAll("g").style("filter",'url("#'+e+'")')},unfilter_elements:function(e){e.forEach(function(e){return e.style.filter=""})},find_hier_lower_els:function(e,t){this.set_filter_on_all("f_L2")
var r=find_all_connected_elements(e,t)
this.unfilter_elements(r.map(function(e){return document.querySelector("#"+e)}))}}}()
var found={}
create_nesw_button(document.querySelector("#cm-path-directions-from"),25,"from"),create_nesw_button(document.querySelector("#cm-path-directions-to"),25,"to")
var makemap_css=find_sheet("map")
document.querySelector("#predef_font_list").onchange=function(e){change_predef_style(currentElement.classList[0],"fontFamily",this.value)}
for(var i=1;i<6;i++)document.querySelector(".predef_font"+i+"_holder").onclick=function(e){return function(t){var r=currentElement.classList[0]
predef_styles.extra.font_sizes[r]=="font"+e?delete predef_styles.extra.font_sizes[r]:predef_styles.extra.font_sizes[r]="font"+e,svg.node().querySelectorAll("."+r).forEach(function(t){change_font_class_of_shape(t,e)})}}(i)
document.querySelector(".predef_text_align_left").onclick=function(e){change_predef_style(currentElement.classList[0],"textAlign","left")},document.querySelector(".predef_text_align_right").onclick=function(e){change_predef_style(currentElement.classList[0],"textAlign","right")},document.querySelector(".predef_text_align_center").onclick=function(e){change_predef_style(currentElement.classList[0],"textAlign","center")},plus_minus_generator(document.getElementById("predef_fig_line_height"),function(e){change_predef_style(currentElement.classList[0],"lineHeight",parseFloat(e.value))},.1,2),plus_minus_generator(document.getElementById("predef_border_width"),function(e){change_predef_style(currentElement.classList[0],"strokeWidth",parseFloat(e.value))},.2,2),["form_set_font_xl","form_set_font_l","form_set_font_r","form_set_font_s","form_set_font_xs"].forEach(function(e,t){plus_minus_generator(document.getElementById(e),function(e){change_predef_style("font"+(t+1),"fontSize",parseInt(e.value)+"px")},1,1)}),plus_minus_generator(document.getElementById("predef_article_padding"),function(e){var t=currentElement.classList[0]
predef_styles.extra.padding[t]=parseInt(e.value),svg.selectAll("."+t).selectAll("article").style("padding",parseInt(e.value)+"px")},1,1)
var toggle_hover_highlights=function(){var e=find_sheet("map"),t=!0,r=!1
return{disable:function(e){!r&&t&&(d3.selectAll('[i_am_a="catcher"]').classed("catcher",!1),t=!1)},enable:function(e){r||t||(d3.selectAll('[i_am_a="catcher"]').classed("catcher",!0),t=!0)},toggle_glow:function(t){r=t,r?(set_attr_of_rule(e,".catcher:hover","opacity",0),set_attr_of_rule(e,".catcher.shine","opacity",0)):(set_attr_of_rule(e,".catcher:hover","opacity",.3),set_attr_of_rule(e,".catcher.shine","opacity",.3))}}}(),_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),searcher=function(){function e(e){var t=r(),n=window.getComputedStyle(currentElement)[e].replace(/"/g,""),o=t.filter(function(t){return window.getComputedStyle(t)[e]==n})
manage_groups.activate_temp_group(o)}function t(e){var t=r(),n=currentElement.getAttribute(e),o=t.filter(function(t){return t.hasAttribute(e)&&t.getAttribute(e)==n})
manage_groups.activate_temp_group(o)}function r(){var e=manage_groups.get_current_group()
if(0==e.length&&(e=Array.from(document.querySelectorAll("#mainsvg g[i_am_a]"))),"P"==currentElement.tagName){var t=[]
return e.forEach(function(e){Array.from(e.querySelectorAll("article:not(.collapsed) P")).forEach(function(e){return t.push(e)})}),t}return e}$("#form_search_for_grouping button.style_prop").on("click",function(t){e(this.innerText)}),$("#form_search_for_grouping button.attribute").on("click",function(e){t(this.getAttribute("search_attrib")||this.innerText)}),document.querySelector("#button_group_reset").onclick=function(){manage_groups.reset()}}(),manage_groups=function(){function e(){w.last_clicked_shape=!1,w.colors=[],w.index=-1}function t(){for(;-1!=h.indexOf(k);)k+=1
return k}function r(){p={},h.forEach(function(e){return p[e]=[]})}function n(e){return"text_basic"==e||"icon_basic"==e?1:"text_path"==e||"text_block"==e?2:"path_group"==e?3:e?"cell_basic"==e?5:"graph_basic"==e?6:0:4}function o(){v=!1,x="",p.black=[]}function a(e){var t=new Set(f),r=find_merged_shapes(e)
r.length>0&&r.forEach(function(e){t.has(e)&&i(e)})
var n=!1
return function(e){for(var t=[];e.parentElement.classList.contains("i_have_a_group");)t.push(e.parentElement),e=e.parentElement
return t}(e).forEach(function(e){t.has(e)&&(n=!0)}),!n}function i(e){var t=f.length
f=f.filter(function(t){return t!=e}),p[m]=f
var r=f.length,n=e.getAttribute("i_am_a")
return t!=r&&(s(e),text_to_feedback_pane("removed "+n+"\n Group length = "+r.toString(),!0),!0)}function s(e){"P"==e.tagName?e.style["text-shadow"]=null:e.style.filter=null}function c(e,t,r,n,o){var a={}
if(set_currentElement(e),["from_side","to_side","pos1","pos2","type","flow","custom_flow","octo_flipped","manhattan_perc"].forEach(function(e){return a[e]=cpa[e]}),a.fixed_side=!0,t>r&&n<o||t<r&&n>o){var i=[a.to_side,a.from_side]
a.from_side=i[0],a.to_side=i[1]
var s=[a.pos2,a.pos1]
a.pos1=s[0],a.pos2=s[1]}return a}function l(e){f.filter(function(e){return"path_group"==iama(e)}).forEach(function(t){var r=path_id_to_el_ids(t.id,!0),n=_slicedToArray(r,2),o=n[0],a=n[1],i=[o,a].map(function(t){return d3.select("#"+e[t])}),s=_slicedToArray(i,2),_=s[0],l=s[1]
if(_.empty()||l.empty())text_to_feedback_pane(["skipped path, need both shapes it is connected\t\t\t\t to be in group to be copied"],!1,!0)
else{var u=c(t,o,a,e[o],e[a])
make_new_connection(_,!1,u,!0)
var d=make_new_connection(l,!1,u,!0)
t.querySelector('g[i_am_a="text_block"], g[i_am_a="text_path"]')&&(add_text_to_path(t.querySelector("text").textContent,d.node().querySelector("path")),t.querySelector('g[i_am_a="text_path"]')&&text_basic.block_to_path_vv(d))}})}function u(){0==f.length&&(delete p[m],h=h.filter(function(e){return e!=m}),m="black",p[m]=f=[],h.push("black"),for_group=!1)}function d(e){e in p&&0==p[e].length&&(h=h.filter(function(t){return t!=e}),delete p[e],m==e&&(m="black"))}var p={red:[],green:[],yellow:[],blue:[],purple:[],black:[],white:[],orange:[]},f=p.red,m="red",h=[],y=!1,v=!1,b=!1,x="",k=1
u()
var w={last_clicked_shape:!1,index:0,colors:[]},E=function(){var e=msvg_w,t=msvg_h,r=0,n=0
group_no_paths=f.filter(function(e){return"path_group"!=iama(e)})
for(var o=0;o<group_no_paths.length;o++){var a=posit2.get_top_left(group_no_paths[o]),i=posit2.get_bottom_right(group_no_paths[o])
e=Math.min(e,a[0]),t=Math.min(t,a[1]),r=Math.max(r,i[0]),n=Math.max(n,i[1])}return[(r+e)/2,(n+t)/2]}
return{push_temp_to_new_group:function(){k=t(),h.push(k),p[k]=f.slice(),this.activate_group(k)},permanent_group_active:function(){return"black"!=m&&f.length>0},get_color_from_index:function(e){return h[e]},swap_group_for_nth_paragraps:function(e){var t=this,r=[]
this.get_current_group().forEach(function(t){var n=t.querySelectorAll("article:not(.collapsed) P")
0==e?_.forEach(n,function(e){return r.push(e)}):n.length>=e&&r.push(n[e-1])}),this.reset(),r.forEach(function(e){return t.add(e)})},activate_group:function(e){o(),this.unshow_my_group(),e in p?(f=p[e],m=e,this.set_my_filter(),this.show_my_group(),for_group=!0):text_to_feedback_pane("not a valid group name",!1,!0)},deactivate_group:function(){this.unshow_my_group(),update_quick_grouping_forms()},activate_temp_group:function(e,t){this.unshow_my_group(),for_group=!0,v=!0,x=t||"",f=p.black=[],m="black"
for(var r=0;r<e.length;r++)this.add(e[r])
this.set_my_filter(),y=!0,for_group=!0},get_group_of_element:function(e){for(var t=0;t<h.length;t++){var r=h[t]
if(p[r].find(function(t){return t==e}))return r}return!1},get_groups_of_element:function(e){for(var t=[],r=0;r<h.length;r++){var n=h[r]
p[n].find(function(t){return t==e})&&t.push(n)}return t},element_in_active_group:function(e){return f.find(function(t){return t==e})},add:function(e){return"slide"!=e.getAttribute("i_am_a")&&"slide"!=iama(e.parentElement)&&(for_group||this.activate_temp_group([],"temp"),f.push(e),void this.add_filter_to_el(e))},add_filter_to_el:function(e){"P"==e.tagName?e.style["text-shadow"]="2px 2px 5px red":e.style.filter='url("#f2")'},remove:i,toggle_elements:function(e){var t=this
e.forEach(function(e){return t.toggle_element(e)})},toggle_element:function(e){if(!a(e))return!1
f.filter(function(t){return t==e}).length>0?(this.remove(e),u()):this.add(e)},reset:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0]
this.unshow_my_group(),delete p[m],h=h.filter(function(e){return e!=m}),t&&text_to_feedback_pane("group has been deleted",!1,!0),e()},mapper:function(e){f.forEach(function(t){e(t)})},to_list:function(e){var t=iama(e)
if(t){var r=n(t),o=e.getAttribute("table"),a=f.filter(function(e){return n(e.getAttribute("i_am_a"))==r})
return o&&(a=a.filter(function(e){return e.getAttribute("table")==o})),a}return f.slice()},show_my_group:function(){f.forEach(function(e){d3.select(e).style("filter",'url("#f2")')}),y=!0,for_group=!0},unshow_my_group:function(){f.forEach(function(e){s(e)}),y=!1,for_group=!1,f=[]},toggle_showing:function(){y?this.unshow_my_group():this.show_my_group()},set_my_filter:function(){var e,t,r
e=t=r="0.2","red"==m&&(e="0.4"),"green"==m&&(t="0.4"),"blue"==m&&(r="0.4")
var n=e+" 0 0 0 0 0 "+t+" 0 0 0 0 0 "+r+" 0 0 0 0 0 1 0"
document.querySelector("#f2 feColorMatrix").setAttribute("values",n)},paste_group:function(e){if(!for_group)return text_to_feedback_pane("no group active",!1,!0),!1
var t=E(),r={}
if(_.any(f.map(function(e){return e.classList.contains("hg")})))return text_to_feedback_pane("Cannot copy group: there are hierarchical\t\t\t\t elements in group. Remove these to copy",!1,!0),!1
var n=[]
group_no_paths=f.filter(function(e){return"path_group"!=iama(e)}),group_no_paths.forEach(function(o){z=posit2.get_top_left(o),offset=[t[0]-z[0],t[1]-z[1]]
var a=to_discrete_position([e[0]-offset[0],e[1]-offset[1]]),i=copy_element(o,!document.querySelector(".form_copy_with_text").checked,a)
snap_to_grid(i.node()),r[o.id]=i.attr("id"),i.style("filter",null),roughing.copy(o,i.node()),n.push(i.node())}),l(r),this.activate_temp_group(n)},remove_element_if_present:function(e){var t=[]
for(key in p)-1!=p[key].indexOf(e)&&(p[key]=p[key].filter(function(t){return t!=e}),d(key),t.push(key))
return s(e),t},add_element_to_multiple_groups:function(e,t){e.forEach(function(e){e in p||(p[e]=[]),p[e].push(t),e==m&&(f=p[e])})},returninternals:function(){return{color:m,groups:p}},save:function(){var e={}
for(g in p)e[g]=p[g].map(function(e){return e.getAttribute("id")})
return e},load:function(e){r()
for(g in e)-1==h.indexOf(g)&&h.push(g),p[g]=e[g].map(function(e){return svg.select("#"+e).node()}).filter(function(e){return e})
k=d3.max(h.map(function(e){return parseInt(e)}).filter(function(e){return!isNaN(e)}))+1||1},get_group:function(e,t){if(b)return b=!1,[e]
if(for_group&&manage_groups.element_in_active_group(e))if(t)var r=manage_groups.to_list(e)
else var r=manage_groups.to_list()
else var r=[e]
return r},set_pass_on_next_call:function(){return b=!0},get_group_info:function(){return x},get_current_group:function(){return f},get_group_from_color:function(e){return e in p?p[e]:[]},ready_for_paste:!1,cycle_through_groups_of_shape:function(e){if(e!=w.last_clicked_shape&&(w.last_clicked_shape=e,w.colors=manage_groups.get_groups_of_element(e),w.index=-1),0==w.colors.length)return!1
w.index+=1
var t=w.colors[w.index%w.colors.length]
t?manage_groups.activate_group(t):manage_groups.unshow_my_group()},find_els_in_bbox_not_in_group:function(e){var t=get_bbox_of_group(e),r=_slicedToArray(t,4),n=r[0],o=r[1],a=r[2],i=r[3],s=parse_to_bbox(n-5,a-5,o-n+10,i-a+10),_=find_elements_in_bbox_test(s,!0,!0),c=new Set(e)
return[_.filter(function(e){return!c.has(e)}),s]},groups_to_slides:function(){show_wait_spinner("","making slides...\n please wait"),setTimeout(function(){var e=this
h.forEach(function(t){if(p[t].length>0){var r=e.find_els_in_bbox_not_in_group(p[t]),n=_slicedToArray(r,2),o=n[0],a=(n[1],get_bbox_of_group(p[t])),i=_slicedToArray(a,4),s=i[0],_=i[1],c=i[2],l=i[3],u=slide.make(svg,[s-10,c-10],{width:_-s+20,height:l-c+20})
slide_manager.add_slide(u.node()),o.length>0&&(currentElement=u.node(),slide_manager.set_els_to_hide_on_slide(o))}}),hide_wait_spinner()}.bind(this),100)}}}(),_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),no_table=!0,tables={},table_with_pos=[]
$(".cm_table_select_row").on("click",function(e){add_rc_to_group(get_table_row)}),$(".cm_table_select_col").on("click",function(e){add_rc_to_group(get_table_col)}),$(".cm_table_add_row").on("click",function(e){var t=currentElement.getAttribute("table"),r=get_table_dims().rm,n=add_rc_to_table(t,function(e,t,n,o){return[e,t+o+r]},function(e,t,r){return[e-1,r]},function(e,t,r){return[e,r]},0)
tables[t].push(n)}),$(".cm_table_add_col").on("click",function(e){var t=currentElement.getAttribute("table"),r=get_table_dims().cm,n=add_rc_to_table(t,function(e,t,n,o){return[e+n+r,t]},function(e,t,r){return[r,t-1]},function(e,t,r){return[r,t]},1)
tables[t].forEach(function(e,t){return e.push(n[t])})}),$(".cm_table_remove_row").on("click",function(e){var t=get_r_c_id_from_cell(currentElement),r=_slicedToArray(t,3),n=r[0],o=(r[1],r[2])
get_table_row(currentElement).forEach(function(e){return e.remove()}),tables[o].forEach(function(e,t){t>n&&e.forEach(function(e,r){e.setAttribute("vt",t-1+"_"+r)})}),tables[o].splice(n,1)}),$(".cm_table_remove_col").on("click",function(e){var t=get_r_c_id_from_cell(currentElement),r=_slicedToArray(t,3),n=(r[0],r[1]),o=r[2]
get_table_col(currentElement).forEach(function(e){return e.remove()}),tables[o].forEach(function(e,t){e.forEach(function(e,r){r>n&&e.setAttribute("vt",t+"_"+(r-1))})}),tables[o].forEach(function(e){return e.splice(n,1)})}),$(".cm_table_style_copy_col").on("click",function(e){var t=get_r_c_id_from_cell(currentElement),r=_slicedToArray(t,3),n=(r[0],r[1],r[2],get_table_col(currentElement))
copied_styles=!1,copied_styles_for_table={col:n.map(function(e){return get_styles_for_copy(e)})}}),$(".cm_table_style_copy_row").on("click",function(e){var t=get_r_c_id_from_cell(currentElement),r=_slicedToArray(t,3),n=(r[0],r[1],r[2],get_table_row(currentElement))
copied_styles=!1,copied_styles_for_table={row:n.map(function(e){return get_styles_for_copy(e)})}}),$("#cm_table_drag_toggle").on("click",function(e){var t=currentElement.getAttribute("table")
if(!t)return!1
tables[t].forEach(function(e){e.forEach(function(e){return toggle_draggability_of_element(e)})})}),$(".cm_table_align_row").on("click",function(e){var t=get_r_c_id_from_cell(currentElement),r=_slicedToArray(t,3),n=(r[0],r[1]),o=r[2]
tables[o].forEach(function(e){align_figs(e[n],e,"both",!0)})}),$(".cm_table_align_col").on("click",function(e){var t=get_r_c_id_from_cell(currentElement),r=_slicedToArray(t,3),n=r[0]
r[1],table_to_cols(r[2]).forEach(function(e){align_figs(e[n],e,"vert",!0)})}),document.querySelector("#form_table_make").onclick=document.querySelector("#cm_table_make").onclick=function(){if(!last_pos&&!last_map_pos)return text_to_feedback_pane("click map first at position where you want to add table, then press button again"),!1
make_table(to_discrete_position(last_pos||last_map_pos))},$(".form_table_make").on("click",function(e){manage_groups.get_current_group().length>0?make_table_from_existing_shapes()&&text_to_feedback_pane("Done making table!"):text_to_feedback_pane("no group active. Select rectangles to add to table")}),document.querySelector("#form_row_margin").onclick=document.querySelector("#form_col_margin").onclick=function(e){var t=currentElement.getAttribute("table")
place_existing(get_shapes_in_table(t),t)},$(".cm_table_unmake").on("click",function(e){unmake_table(currentElement.getAttribute("table")),gui.frame_element(currentElement),text_to_feedback_pane("removed table. All shapes now independent")}),$(".cm_table_even_size_row").on("click",function(e){set_row_height(currentElement)}),$(".cm_table_even_size_col").on("click",function(e){set_col_width(currentElement)}),$(".cm_table_even_size_all").on("click",function(e){get_table_row(currentElement).forEach(function(e){set_col_width(e)}),get_table_col(currentElement).forEach(function(e){set_row_height(e)})})
var _slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r1=75,r2=200,r3=325,r4=450,r5=575,r6=700,r7=790,c1=100,c2=275,c3=400,c4=500,c5=620
fig_to_pos={rect_basic:[[110,75],1],rhombus:[[275,75],1],diamond:[[385,75],1],octagon:[[500,75],1],ellipse_basic:[[635,75],1],triangle_l:[[75,r2],1],triangle_r:[[175,r2],1],triangle_u:[[275,r2],1],triangle_d:[[375,r2],1],hexagon_h:[[625,r2],1],hexagon_v:[[500,r2],1],arrow_right:[[c1,r3],1],arrow_left:[[c2,r3],1],arrow_up:[[c3,r3],1],arrow_down:[[c4,r3],1],chevron_right:[[c1,r4],1],chevron_left:[[c2,r4],1],chevron_up:[[c3,r4],1],chevron_down:[[c4,r4],1],house_up:[[c1,r5],1],house_down:[[c2,r5],1],house_left:[[c3,r5],1],house_right:[[c4,r5],1],parallello_hor:[[c1,r6],1],parallello_hor_mirrored:[[c2,r6],1],parallello_vert:[[c3,r6],1],parallello_vert_mirrored:[[c4,r6],1],axes_board:[[c5+135,r5+150],.3],graph_basic:[[c5+65,r6+80],.45],text_basic:[[c1-65,r7],2],icon_basic:[[c3-125,r7-50],3.5],rect_canvas:[[c4+100,r7+40],1]}
var SIDE_BAR_WIDTH=parseInt(window.getComputedStyle(document.querySelector("#sidebar")).width),drag_warning=d3.behavior.drag().on("dragstart",function(){svg.classed("copy_on",!0)}).on("dragend",function(){if(svg.classed("copy_on",!1),d3.event.sourceEvent.clientX<SIDE_BAR_WIDTH+50)return!1
text_to_feedback_pane("you can also just select the shape by clicking it and then just double click the canvas",!1,!0)
var e=corrected_mouse_position(get_x_y_from_event(d3.event.sourceEvent)),t=ido(find_g(this)).make(svg,e),r=d3.event.sourceEvent.target
r&&find_g(r).classList.contains("canvas_layer")&&group_elements(d3.select(find_g(r)),t),set_currentElement(t.node()),roughen_all&&roughing.roughen(currentElement),display_fs_for_shape(currentElement),gui.frame_element(currentElement)}),path_end_fig="arrow"
add_end_figs_for_path_to_buttons(),function(){var e=[["M 0 4 L 25 20","straight"],["M 0 4 L 12 4 L12 20 L25 20","manhattan"],["M 0 4 C 12 4 10 20 25 20","fluid"],["M 0 4 C 25 4 0 20 25 20","manh_swirl"],["M 0 4 L 25 20","straight"],["M 0 4 L 12 4 L12 20 L25 20","manhattan"],["M 0 4 C 12 4 10 20 25 20","fluid"],["M 0 4 C 25 4 0 20 25 20","manh_swirl"]]
d3.selectAll("#form_path_style .buttonsvg").data(e).attr("flow",function(e){return e[1]}).append("path").attr("d",function(e){return e[0]}),$("#form_path_style .svg_holder").on("click",function(e){var t=e.currentTarget.querySelector("svg").getAttribute("flow"),r=manage_groups.get_group(currentElement,!0),n=[]
r.forEach(function(e){if(e.classList.contains("hg")){var t=hierarchies.is_child_of(e)
if(t){var r=_slicedToArray(t,2),o=r[0],a=r[1],i="hg"+o.slice(1)+"_"+a,s=svg.selectAll("."+i+".connection")[0]
n=n.concat(s)
var _=document.querySelector("."+i+".helper_hg").id
n.push(document.querySelector("#from"+o.slice(1)+"_to"+_+"_0"))}}}),n.length>0&&text_to_feedback_pane("changed all paths in hierarchy: they need all be the same",!1,!0),r=new Set(r.concat(n)),r.forEach(function(e){currentElement=e,"octopus"==e.getAttribute("type")&&"manhattan"==t?text_to_feedback_pane(["this flow not available for this style","change style to plain or double"],!1,!0):change_path_flow_and_style(!0,t)}),gui.frame_element(currentElement)})}()
var predef_styles=function(){function e(e){r(e),n(e),o(e),a(e),i(e),s(e),t()}function t(){document.querySelector("#ffw_fill").style.display="flex",document.querySelector("#ffw_stroke").style.display="flex",document.querySelector("#ffw_text").style.display="flex",document.querySelector("#ffw_stroke2").style.display="none"}function r(e){if(d3.selectAll("#predef_font_sizes button.onoff-on").classed("onoff-on",!1),e in predef_styles.extra.font_sizes){var t=parseInt(predef_styles.extra.font_sizes[e].slice(-1))+1
document.querySelector("#predef_font_sizes button:nth-child("+t+")").classList.add("onoff-on")}}function n(e){d3.selectAll("#predef_text_align button.onoff-on").classed("onoff-on",!1)
var t=c(e,"text-align")
t&&document.querySelector(".predef_text_align_"+t).classList.add("onoff-on")}function o(e){var t=c(e,"stroke-width")
t&&(document.querySelector("#predef_border_width input").value=parseFloat(t))}function a(e){var t=c(e,"line-height")
"normal"==t?document.querySelector("#predef_fig_line_height input").value=1.4:t&&(document.querySelector("#predef_fig_line_height input").value=parseFloat(t))}function i(e){var t=c(e,"font-family")
document.querySelector("#predef_font_list").value=t||""}function s(e){e in predef_styles.extra.padding&&(document.querySelector("#predef_article_padding input").value=predef_styles.extra.padding[e])}function c(e,t){for(var r=find_rule(sheet,function(t){return sheet.cssRules[t].selectorText=="."+e}),n=0;n<r.style.length;n++)if(r.style[n]==t)return r.style[t].replace(/"/g,"")
return!1}var l={font_sizes:{},padding:{}}
return _.range(0,24).forEach(function(e){return l.padding["style_"+e]=5}),_.range(0,24).forEach(function(e){return l.font_sizes["style_"+e]="font3"}),{find_current_style:c,set_cm_for_predef_style:e,extra:l}}(),rubrics=[3,0,3,1,1,1,1,3,0,2,3,2,0,0,0,0,0,0,0,0,3,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,2,0,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,2,2,3,3,2,2,2,2,2,2,2,3,3,3,3,0,2,2,2,2,2,2,3,2,2,2,2,2,2,3,2,1,1,1,1,1,1,1,2,2,2,0,0,0,0,0,0,0,0,1,1,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,0,0,0,0,1,1,1,0,0,0,0,3,2,2,3,2,0,0,1,2,2,2,2,2,2,2,0,3,3,1,3,3,3,0,0,3,0,0,2,2,2,2,1,1,1,1,3,2,3,3,0,2,2,3,3,1,0,1,1,3,1,1,1,1,3,3,0,0,0,0,0,0,0,0,2,2,2,3,3,3,3,0,0,1,1,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,3,2,2,2,2,2,3,1,1,1,1,1,1,3,3,0,3,2,2,2,2,3,3,0,0,0,0,3,3,2,3,3,3,3,3,3,2,2,3,3,3,3,1,2,1,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,1,1,1,1,0,0,3,3,2,3,2,3,0,3,3,3,2,1,3,2,1,3,3,3,3,1,2,0,0,2,2,2,2,2,1,2,3,3,3,1,1,1,1,0,2,0,0,0,0,2,2,0,0,0,2,1,1,1,1,1,0,0,0,0,0,3,3,3,2,2,0,1,1,0,0,0,0,1,1,3,2,1,2,0,2,0,0,2,1,1,3,3,3,3,3,3,1,2,2,2,2,1,0,0,0,0,2,2,2,2,1,1,2,2,1,3,3,3,3,3,2,0,0,0,2,0,0,0,0,0,1,2,3,3,0,0,0,0,3,1,3,2,3,3,1,3,0,3,0,0,0,0,0,3,2,2,0,0,3,2,2,3,3,3,3,1,2,0,0,0,0,0,0,0,0,0,0,0,0,3,3,2,2,3,3,0,0,0,0,1,3,3,3,3,3,2,2,0,0,0,0,0,0,0,0,0,0,0,3,2,2,2,3,3,3,3,3,2,2,2,2,2,2,3,3,0,0,2,1,1,0,2,1,3,3,0,2,2,2,0,2,1,1,2,2,2,1,2,2,3,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,3,2,2,2,2,2,2,3,3,2,2,3,1,3,3,3,2,3,3,3,2,0,2,0,2,2,2,0,0,2,2,2,2,2,2,2,2,2,2,3,2,3,3,3,3,2,2,2,0,2,3,3,3,2,2,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3],indeling={0:[],1:[],2:[],3:[]}
rubrics.forEach(function(e,t){indeling[e].push(t)})
var cats=["#basic svg","#work svg","#recreational svg","#commercial svg"],icon_to_change=!1
fill_example_figs(),fill_example_css_styles(d3.select("#colors_svg")),fill_example_css_styles(d3.select("#cm_colors_svg"),12),set_fs(document.querySelector("#_0000_example")),fo_bbox_correction=fo_bbox_correction_test(document.querySelector("#_0000_example")),close_other_fieldsets(),close_fieldset(document.querySelector("#fs_feedback")),close_fieldset(document.querySelector("#fs_help"))
var quick_tut=function(){function e(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],t(),cmm.off(),document.querySelector("#tut_frame").style.display="none"}function t(){["left_arrow","right_arrow","up_arrow","down_arrow"].forEach(function(e){document.querySelector("#"+e).style.display="none"})}function r(e){s.innerText=a[e][l],t()
var r=a[e]
if("actions"in r&&r.actions.forEach(function(e){return e()}),"arrow"in a[e]){var n=document.querySelector("#"+r.arrow)
n.style.display="block",n.style.position="absolute"
var o="string"==typeof r.pos?document.querySelector("#"+r.pos):r.pos(),i=o.getBoundingClientRect()
c[r.arrow](i,n)}}function n(e){_.innerText="step "+e+" of 20"}var o,a=[{text:"Welcome. This is a quick introduction into the basic controls for Breakdown Notes. Use the buttons to continue, move back or exit"},{text:"Check the help menu to see what shape is active and what actions are possible",pos:"fs_help",arrow:"left_arrow",actions:[function(){return toggle_field_set(document.querySelector("#fs_help"))},function(){d3.select("#mainsvg").transition().style("background-color","white").duration(500)}]},{text:"You start out on an empty canvas (the area which is changing color). Reading the help learns that you can add shapes here by double clicking ....",text_nl:"Je start op een leeg canvas (het gebied dat nu van kleur verandert). Het lezen van de hulp \t\t    leert onder andere dat je vormen kunt toevoegen door te dubbel klikken op het canvas ...",pos:function(e){return document.querySelector("#fs_help p:nth-child(2)")},arrow:"left_arrow",actions:[function(){return d3.select("#mainsvg").style("background-color","white").transition().style("background-color","rgb(221, 189, 189)").duration(2500)}]},{text:"..and that you can zoom and pan on the canvas, among other things",pos:function(e){return document.querySelector("#fs_help p:nth-child(3)")},arrow:"left_arrow"},{text:"The menu on the left contains many options for for instance fonts, colors and shapes",pos:"fs_maps",arrow:"left_arrow",actions:[function(){d3.select("#mainsvg").transition().style("background-color","white").duration(500)}]},{text:"Menu items with this color offer controls specific to the shape that is active.  Dependend on the shape that is\t\t     active, some items may disappear",pos:"fs_border",arrow:"left_arrow",actions:[function(){g=rect_basic.make(svg,[4955,3630]),set_currentElement(g.node()),display_fs_for_shape(currentElement)}]},{text:"Just click a menu item to fully expand it, and click it again to hide it. Scroll while hovering the menu to move it up or down",actions:[function(){close_other_fieldsets(),toggle_field_set(document.querySelector("#fs_buttons"))}]},{text:"In the Options menu you can also choose to show advanced options. But you probably do not need these when you are just starting out",pos:"form_toggle_advanced_options",arrow:"left_arrow"},{text:"Lets look at a shape. Notice the green control buttons.",text_nl:"Dit hier is een vorm. Zie de groene knoppen",pos:function(){return currentElement},arrow:"left_arrow",actions:[function(){toggle_zoom.reset_to_center(),set_currentElement(g.node()),display_fs_for_shape(currentElement),gui.frame_element(currentElement)}]},{text:"This button is for resizing the shape:  just click, hold and drag",text_nl:"Deze knop is om het figuur te vergroten of te verkleinen. Dat doe je door op de knop\t\t    te drukken en deze te verslepen",pos:"gui_resize",arrow:"left_arrow"},{text:"For rotation: click, hold and drag ",text_nl:"Deze is voor roteren. Gewoon klikken en verslepen",pos:"gui_rotate",arrow:"right_arrow"},{text:"And to connect: click, hold and drag onto another shape ",text_nl:"En deze om een pad te maken: klik en versleep de knop op een andere vorm",pos:"gui_connect",arrow:"right_arrow"},{text:"To move a shape, click hold and drag its greenish border or an empty part of it. The border will appear when hovering the shape with your mouse",text_nl:"Om een vorm te verplaatsen, klik en versleep de groenige rand van de vorm, of een leeg deel van de vorn\t\t\tDe groene rand verschijnt als je met de muis over de vorm beweegt",pos:"gui_connect",arrow:"right_arrow",actions:[function(e){return toggle_catcher_glow(currentElement,!0)}]},{text:"You can see which element is active by the green controls or green border and the red lines. Any commands, like choosing fonts or colors\t\t  will have effect on the active element",pos:"gui_connect",arrow:"right_arrow",actions:[function(){return toggle_catcher_glow(currentElement,!1)}]},{text:"To add text to a shape, make sure its active and then just start typing. Notice the paragraph is now the activate shape and the help menu\t\t    is listing controls for paragraphs.",actions:[function(){rect_basic.add_paragraph(currentElement,"You guessed right! This is a paragraph")}],pos:function(){return currentElement},arrow:"right_arrow"},{text:"To add a shape and paragraph in one go, you can also just click the canvas once and start typing, or press tab from within a paragraph and continue typing"},{text:"Right click shapes and element to show the quick controls",text_nl:'KLik met de rechtermuis knop op vormen, paragrafen of paden om de "snelle opties" voor dat element te tonen',pos:"context-menu",arrow:"down_arrow",actions:[function(){return cmm.position_and_display(250,250,"#cm-par")}]},{text:"Right click buttons and labels to get additional help. This for instance is help about how to make an element flippable",actions:[function(){cmm.off(),set_currentElement(g.node()),display_fs_for_shape(currentElement),text_to_help_pane(help_mapper.flip,!0,!0)}],pos:"fs_help",arrow:"right_arrow"},{text:"Save and load your map starting in the save/load/new menu.",pos:"fs_maps",arrow:"left_arrow"},{text:"Export to pdf  using the export menu. Remember, right click buttons and labels for help",pos:"fs_export",arrow:"left_arrow"},{text:"That's it! Hope you enjoy making notes and maps with Breakdown Notes."}],i=0,s=document.querySelector("#lesson"),_=document.querySelector("#tut_progress")
document.querySelector("#close_tut").onclick=e
var c={left_arrow:function(e,t){t.style.left=e.right+"px",t.style.top=e.top+"px"},right_arrow:function(e,t){t.style.left=e.left-o+"px",t.style.top=e.top+"px"},down_arrow:function(e,t){t.style.left=e.left+"px",t.style.top=e.top-arrow_height+"px"},up_arrow:function(e,t){t.style.left=e.left+"px",t.style.top=e.bottom+arrow_height+"px"}},l="text"
return{forward:function(){i<a.length-1&&(i+=1,n(i),r(i))},backward:function(){i>0&&(i-=1,r(i),n(i))},start:function(){i=0,r(i),n(i),"NL"==language&&(l="text_nl"),arrow_height=parseInt(window.getComputedStyle(document.querySelector(".anim")).height),o=parseInt(window.getComputedStyle(document.querySelector(".anim")).width),t(),document.querySelector("#step_forward").onclick=this.forward,document.querySelector("#step_back").onclick=this.backward,document.querySelector("#tut_frame").style.display="block",set_val_to_cookie("tut_seen","true")},end:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&setTimeout(function(){document.querySelector("#tut_modal").style.display="block"},4e3),e()},check_cookie_for_tutorial:function(){return find_val_in_cookie("tut_seen")}}}(),_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),VERSION="20180423",exclude_from_pres_mode=["cp_resize","cp_rotate","cp_helper"],local_store=function(){function e(){var e=[]
for(var t in localStorage)"string"==typeof localStorage[t]&&'{"gs":['==localStorage[t].slice(0,7)&&e.push(t)
return e}function t(){d3.selectAll("#load_previews div").remove(),document.querySelector("#load_preview_buttons").style.display="flex"}function r(e){if("ok"!=e.result)return text_to_feedback_pane("failed to save: "+e.reason,!1,!0),!1
text_to_feedback_pane(e.link,!1,!0),a.push(e.link),hide_wait_spinner(),is_user_logged_in()?show_feedback_modal("Saved successfully",e.link):show_feedback_modal("Gist saved at:",e.link)}function n(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]
try{return localStorage.setItem(e,get_data_to_save()),t||show_feedback_modal("","saved as "+e),!0}catch(e){return"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||(console.log("not enough space left in local storage"),text_to_feedback_pane(["not enough space left in local storage","Use download or gist save instead"],!1,!0)),!1}}function o(){return 0==svg.node().querySelectorAll("g[i_am_a]").length}var a=[]
return"undefined"==typeof Storage?(console.log("no local storage"),text_to_feedback_pane("no local storage",!1,!0),!1):{quick_save:function(){var e="qs_"+current_map_name.split(".")[0]||"last_quicksave"
text_to_feedback_pane("quick saving as "+e,!1,!0),remove_single_map_from_preview(e),this.save(e)&&text_to_feedback_pane('saved map as "'+e+'"')},save:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]
return e=e||current_map_name,o()?(show_feedback_modal("","no data found to save on map"),text_to_feedback_pane("no data found to save on map"),!1):(this.check_if_maps_loaded(),!!n(e,t)&&(add_single_map_to_preview(e,d3.select("#load_previews"),!0,JSON.parse(localStorage.getItem(e))),t||text_to_feedback_pane("map saved locally with name: "+e,!1,!0),!0))},load:function(e,t){return e in localStorage?(load_data(JSON.parse(localStorage.getItem(e)),t,new_map_for_load),!0):(text_to_feedback_pane("could not find map",!1,!0),!1)},delete:function(e){delete localStorage[e],remove_single_map_from_preview(e)},log_size_of_storage:function(){for(var e in localStorage)console.log(e+"="+(2*localStorage[e].length/1024).toFixed(2)+" kb")},dump_all:function(){var t=current_map_name
e().forEach(function(e){current_map_name=e+".json"
var t=localStorage.getItem(e),r=prep_blob_for_download(t)
document.getElementById("dl_link").click(),URL.revokeObjectURL(r)}),current_map_name=t},reset:function(){text_to_feedback_pane("loading previews for map. may take a few seconds",!0,!1),function(){var r=e()
if(0==r.length)return d3.select("#load_previews").append("div").text("no maps in local storage"),!1
t(),r.forEach(function(e){add_single_map_to_preview(e,d3.select("#load_previews"),!0,JSON.parse(localStorage.getItem(e)))}),text_to_feedback_pane("done loading!",!0,!1)}()},check_if_maps_loaded:function(){0==document.querySelectorAll("#load_previews div").length&&this.reset()},save_as_gist:function(){show_wait_spinner("","saving gist... may take a few seconds")
var e=JSON.parse(get_data_to_save())
if(JSON.stringify(e).length>999999)return hide_wait_spinner(),show_feedback_modal("To big....","Currently not supporting saving maps bigger in size then 1mb as gist.\t\t\t\tPlease download file, or save in local storage"),!1
if(0==e.gs.length)return text_to_feedback_pane("could not find any map data to save.... The map look empty. Nothing saved",!1,!0),!1
var t=make_map_preview(e)
if(description=document.querySelector("#modal_github_save_section input").value,!is_user_logged_in()){if(!confirm("You are not logged in. Are you sure you want to save\t\t\t\t\tthis online as an anonymous gist? It will not be private, nor will you\t\t\t\t\tbe able to delete it yourself. Press OK to save, cancel to abort."))return text_to_feedback_pane("aborted saving map to gist. Nothing saved!!",!1,!0),hide_wait_spinner(),!1
console.log("saving....")}var n=JSON.stringify([e,t,description])
$.ajax({type:"POST",headers:{"Content-Type":"application/json"},url:"./makemap/save/gist",data:n,success:r,datatype:"application/json"})},edit_as_gist:function(e){var t=JSON.parse(get_data_to_save()),n=make_map_preview(t)
description=document.querySelector("#modal_github_save_section input").value,$.ajax({type:"PATCH",headers:{"Content-Type":"application/json"},url:"./gist/edit/"+e,data:JSON.stringify([t,n,description]),success:r,datatype:"application/json"})},fork_gist:function(e){var t=this
$.ajax({type:"GET",headers:{"Content-Type":"application/json"},url:"./gist/fork/"+e,success:function(e){"error"==e?(text_to_feedback_pane("failed to fork"),document.querySelector("#load_previews_gist").innerHTML="<p>failed to fork</p>"):t.get_gist_from_id(e)},datatype:"application/json"})},get_gists_from_user:function(e){show_wait_spinner("","finding /loading gists"),$("#load_previews_gist").load("./gist/"+e+"/show",add_click_event_to_gist_link)},get_gist_from_id:function(e){show_wait_spinner("","finding /loading gists"),$("#load_previews_gist").load("./gist/info/"+e,add_click_event_to_gist_link)}}}(),printer=function(){function e(){return[parseInt(r.getAttribute("width")),parseInt(r.getAttribute("height"))]}function t(e,t){var n=r.querySelector('circle[my_index="2"]')
ido(r).reshape(n,e,t)}A0=[3179,4494],A1=[2245,3179],A2=[1587,2245],A3=[1123,1587],A4=[794,1123],A5=[559,794],A6=[397,559],sizes={A0:A0,A1:A1,A2:A2,A3:A3,A4:A4,A5:A5,A6:A6}
var r=!1
return{show_print_region:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=n?t[0]:t[1],a=n?t[1]:t[0]
return r=slide.make(svg,e,{width:o,height:a}),r.attr("id","print_region"),r=r.node()},set_new_zoom_factor:function(e){if(r&&"custom"!=document.querySelector(".cm-print-size option:checked").value){var t=posit2.get_trans(r)
t.scale=1/e,r.setAttribute("transform",transform_to_string(t))}},print:function(e,t){d3.selectAll(".plumb").remove(),gui.remove_all(),document.querySelector("#zoomcall").removeAttribute("transform"),toggle_zoom.trans_to_top_left(r),window.print(),$("#form_print_region_view input").change()},set_print_region_to_A_ratio:function(){var r=e(),n=_slicedToArray(r,2),o=n[0],a=n[1],i=[o,a],s=a>o,_=s?o/a:a/o
_>3179/4494?s?a=o/(3179/4494):o=a/(3179/4494):_<3179/4494&&(s?o=a*(3179/4494):a=o*(3179/4494)),t(o-i[0],a-i[1])},change_size_of_print_region:function(r,n){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2]
if(r.querySelector(".poly_point")||toggle_poly_points(r),"custom"!=n){var a=e(),i=_slicedToArray(sizes[n],2),s=i[0],_=i[1]
if(!o)var c=[_,s],s=c[0],_=c[1]
t(s-a[0],_-a[1]),this.set_new_zoom_factor(toggle_zoom.get_zoom_factor()),d3.select(r).selectAll(".poly_point").remove(),document.querySelector(".cm-print-layout").parentElement.style.display="flex"}else{var l=posit2.get_trans(r,!1,!1)
l.scale=[1],r.setAttribute("transform",transform_to_string(l)),document.querySelector(".cm-print-layout").parentElement.style.display="none"}},remove_all_regions:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],svg.selectAll("#print_region").remove(),drag_select_off(),"print_region"==currentElement.id&&remove_plumb_lines(),document.querySelector("#zoomcall").removeAttribute("transform"),document.querySelector("#form_print_region_view input").value="100%"}}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),plumbs
$(function(){d3.select("#zoomfield"),add_font_awesome_icons()
var e=0!=quick_tut.check_cookie_for_tutorial()
reloading?(auth_logger.reload(),quick_tut.end(),currentElement=document.querySelector("#mainsvg")):start_tut&&!dataFile?(e||quick_tut.start(),currentElement=document.querySelector("#mainsvg"),table_init()):dataFile&&(quick_tut.end(!e),dataPad=dataPad,data?load_data(data,pres_mode,!0,!1,!1,starts_with_pres):$.getJSON(dataPad,function(e){load_data(e,pres_mode,!0,!1,!1,starts_with_pres)}),currentElement=document.querySelector("#mainsvg")),currentElement=document.querySelector("#mainsvg"),display_fs_for_shape(currentElement)})
var no_modal=!0,dragged_item=!1
svg.node().ondrop=drop_paragraph,svg.node().ondragover=allow_paragraph_drop
var a=document.querySelector(".sp-palette-container"),b=document.querySelector("#form_fill_what")
a.appendChild(b),text_to_help_pane(help_text.svg,!1,!0),$("[restore_sel]").on("mouseup",function(){restoreSelection(last_selection)})
for(var _slicedToArray=(function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()),away=80,cmm=(function(){function e(){i.style.display="none",s=!1}function t(e,t,r){var n,o,a,i
return n=e.x-r[0],a=e.y-r[1],o=t.x-r[0],i=t.y-r[1],n*n+a*a<o*o+i*i}function r(){for(var e=i.children,t=0;t<e.length;t++)e[t].style.display="none"
i.querySelector("#cm_closer").style.display="block"}function n(e,t){var r=e.innerText
return r in help_mapper&&(slides_mode?text_to_help_pane_slides(help_mapper[r],!1,!0):text_to_help_pane(help_mapper[r],!1,!0),t.preventDefault()),e.closest("#context-menu")&&t.preventDefault(),!1}function o(e,r){var n=!0,o=!0
if(r.target.parentElement.classList.contains("slide_preview")){var i="#cm-slide-preview"
n=!1,o=!1}else if("print_region"==find_g(r.target).id){var i="#cm-print-region"
document.querySelector(i),"Print"==find_active_submenu("fs_export")?($(".for-print").css("display","flex"),$(".for-png").css("display","none")):($(".for-print").css("display","none"),$(".for-png").css("display","flex")),n=!1,o=!1}else{if(set_currentElement(r.target),display_fs_for_shape(currentElement),gui.frame_element(currentElement),me=currentElement.getAttribute("i_am_a"),document.querySelector("#cm-fig-menu-addon-pb").style.display="none",document.querySelector("#cm-fig-menu-addon-pp").style.display="none",document.querySelector("#cm-color_stroke").style.display="none","x_axis"==me||"y_axis"==me)return r.preventDefault(),!1
if(is_par_tag(currentElement))if("A"==r.target.tagName){var i="#cm-link"
check_for_link(currentElement),n=!1}else var i="#cm-par"
else if("graph_basic"==me){var i="#cm-graph"
n=!1}else if("axes_board"==me)var i="#cm-board"
else if("path_basic"==me){if(currentElement.querySelector("foreignObject"))var i="#cm-fig"
else var i="#cm-path-basic-without-fo"
document.querySelector("#cm-fig-menu-addon-pb").style.display="flex",document.querySelector("#cm-color_stroke").style.display="flex",document.querySelector("#cm-path-basic-without-fo .cm_button_add_point").style.display=currentElement.hasAttribute("flow")?"block":"none",last_rc_pos=corrected_mouse_position([r.clientX,r.clientY])}else if("country_basic"==me){var i="#cm-country-basic",s=currentElement.hasAttribute("continent")?"block":"none"
document.querySelector("#form_show_continent").style.display=s,n=!1,o=!1}else if("path_group"==me){clear_path_attrs(),set_path_attrs(d3.select(currentElement))
var _=path_to_array(currentElement.querySelector(".mainpath").getAttribute("d")),c=_[0],l=_[3]
t(c,l,e)?(cpa.side="from",document.querySelector("#side_of_path").innerText="Tail"):(cpa.side="to",document.querySelector("#side_of_path").innerText="Head"),d3.selectAll(".path_from_to").classed("on",!1),document.querySelectorAll("#cm-path-directions-from .path_from_to")[parseInt(cpa.from_side)].classList.toggle("on",!0),document.querySelectorAll("#cm-path-directions-to .path_from_to")[parseInt(cpa.to_side)].classList.toggle("on",!0),currentElement.classList.contains("hg")?(document.querySelector("#cm-path-directions-from").style.display="none",document.querySelector("#cm-path-directions-to").style.display="none",$(".no-hg").css("display","none")):(document.querySelector("#cm-path-directions-from").style.display="flex",document.querySelector("#cm-path-directions-to").style.display="flex",$(".no-hg").css("display","block"),"octopus"!=cpa.type&&$(".octo_flip").css("display","none")),currentElement.querySelector("text")?(document.querySelector("#cm-path-change-text").style.display="block",document.querySelector("#cm-path-add-text").style.display="none"):(document.querySelector("#cm-path-change-text").style.display="none",document.querySelector("#cm-path-add-text").style.display="block")
var i="#cm-path"}else if("knot_hierarchy"==me){currentElement.classList.contains("hg")?document.querySelector("#cm_knot_straigthen").style.display="block":document.querySelector("#cm_knot_straigthen").style.display="none"
var i="#cm-knot"
n=!1}else if("slide"==me){var i="#cm-"+figs[me].my_menu,u=["#cm_slide_snap_shot","#cm_slide_repos","#cm_slide_hide","#cm_slide_delete"]
currentElement.classList.contains("existing")?vals=["none","block","block","block"]:vals=["block","none","none","block"],u.map(function(e,t){return document.querySelector(e).style.display=vals[t]}),n=!1,o=!1}else if(me in poly_config){var i="#cm-"+figs.polygon.my_menu
currentElement.classList.contains("hg")?document.querySelector("#cm-fig-childgroup").style.display="flex":document.querySelector("#cm-fig-childgroup").style.display="none"}else if("zoomfield"==iami(currentElement)||"mainsvg"==iami(currentElement)){var i="#cm-svg"
manage_groups.to_list().length>0?$(".when_group").css("display","flex"):$(".when_group").css("display","none"),update_quick_grouping_forms(),drag_for_drawing||(n=!1),o=!1}else if("text_basic"==me)0==find_connections(currentElement.getAttribute("id")).length?document.querySelector("#form_bind_to_path").style.display="flex":(document.querySelector("#form_bind_to_path").style.display="none",text_to_feedback_pane("cannot be bound to path because is attached to path",!1,!0)),i="#cm-"+figs[me].my_menu
else if("text_path"==me||"text_block"==me)i="#cm-"+figs[me].my_menu
else if("cell_basic"==me&&(r.ctrlKey||r.shiftKey))i="#cm-table",n=!1,o=!1
else if("rect_canvas"==me){i="#cm-rect_canvas"
var d=currentElement.classList.contains("i_have_a_group")?"flex":"none"
document.querySelector("#cm_unmerge").style.display=d}else if(me&&me in figs){var i="#cm-"+figs[me].my_menu
currentElement.classList.contains("hg_parent")?document.querySelector("#cm-fig-childgroup").style.display="flex":document.querySelector("#cm-fig-childgroup").style.display="none","poly_points_fo"==me&&(last_rc_pos=corrected_mouse_position([r.clientX,r.clientY]),tab_succes_flash(last_rc_pos),document.querySelector("#cm-fig-menu-addon-pp").style.display="flex")}}fill_forms(currentElement),i&&a(r.clientX,r.clientY,i,n,o),r.preventDefault()}function a(e,t,n,o,a){r(),i.querySelector(n).style.display="block",i.style.display="block",document.querySelector("#cm-colors").style.display=o?"block":"none",document.querySelector("#cm-delete").style.display=a?"block":"none",s=!0
var _=i.getBoundingClientRect(),c=window.innerWidth-e-_.width,l=window.innerHeight-t-_.height
e=c>0?e:e+c,t=l>0?t:t+l,i.style.left=e+"px",i.style.top=t+"px"}var i=document.querySelector("#context-menu"),s=!1
return i.onclick=function(t){t&&t.target&&!d3.select(t.target).classed("keep-open")&&e()},document.addEventListener("contextmenu",function(e){function t(e){r(),o(corrected_mouse_position([e.clientX,e.clientY]),e)}last_pos=corrected_mouse_position([e.clientX,e.clientY])
var a=document.elementFromPoint(e.clientX,e.clientY)
a.parentElement.classList.contains("slide_preview")?t(e):a.closest("#context-menu")?n(a,e):a.closest(".toolbar1")?n(a,e):t(e)}),{off:e,status:function(){return s},position_and_display:a,display_fs_for_current_element:o}}()),t=["#cm-fig-child button","#form-fig-child button"],j=0;j<t.length;j++)for(var sel=t[j],tt=document.querySelectorAll(sel),i=0;i<tt.length;i++){var d=tt[i]
!function(e,t){e.onclick=function(){manage_groups.get_group(currentElement).length>1?text_to_feedback_pane("works only for one element at a time. Deactivate group first",!1,!0):hierarchies.add_new_element(currentElement,t)}}(d,i)}for(var t=document.querySelectorAll("#cm-fig-childgroup button"),i=0;i<t.length;i++){var d=t[i]
!function(e,t){e.onclick=function(){if(0==t);else{var e=".hg"+currentElement.getAttribute("id")+"_"+(t-1)+".hg_child"
manage_groups.activate_temp_group(document.querySelectorAll(e),"hierarchical"),hierarchies.activate_group(currentElement,t-1,!1)}}}(d,i)}$(".path_from_to").on("click",function(){this.classList.contains("to")?$(".path_to button."+this.getAttribute("dir")).click():$(".path_from button."+this.getAttribute("dir")).click()}),$(".cm_button_toggle_poly_point").on("click",function(){toggle_poly_points(find_g(currentElement))}),$(".cm_button_add_point").on("click",function(){ido(currentElement).add_point(currentElement,last_rc_pos)}),document.querySelector("#cm-path-detach").onclick=function(){clear_path_attrs(),set_path_attrs(d3.select(currentElement)),detach_path(currentElement,"from"==cpa.side,!0)}
var hierarchies=function(){function e(e){return V.getAttribute("id"),ps=path_to_array(g(e).querySelector("path").getAttribute("d")),ps}function t(){var e,t=posit2.get_top_left(V,!0),r=_slicedToArray(t,2),n=r[0],o=r[1],a=posit2.get_w_h(V),i=_slicedToArray(a,2),s=i[0],_=i[1]
0==G&&(e=[s/2,-ne]),1==G&&(e=[s+ne,_/2]),2==G&&(e=[s/2,_+ne]),3==G&&(e=[-ne,_/2])
var c=[n+e[0],o+e[1]],l=object_mapper.knot_hierarchy.make(svg,c)
if(l.classed(U,!0),l.classed("hg",!0),l.classed("helper_hg",!0),V.classList.contains("i_am_grouped")){var u=V.parentElement
ido(u).stick_to_me(d3.select(u),[l.node()])}return l.node()}function r(t){var r=e(t),n=!1
t.id<ee.id&&(n=!0,r.reverse())
var o=[r[r.length-2],r[r.length-1]],a=o[0],i=o[1],s=dy=0
a.x==i.x?(dy=2*(a.y-i.y),dy+=Math.sign(dy)*t.getAttribute("height")):(s=2*(a.x-i.x),s+=Math.sign(s)*t.getAttribute("width")),object_mapper[iama(t)].reposition_me(t,s,dy,!0),set_path_attrs(d3.select(g(t))),cpa.manhattan_perc=manhattan_offset_for_bow_if_hg(r),n?cpa.from_side=(parseInt(cpa.from_side)+2)%4:cpa.to_side=(parseInt(cpa.to_side)+2)%4,remake_path(find_path(void 0,!0))}function n(e,t,r){function n(){var e=get_custom_bbox(d[v].querySelector(".mainfig")),t=get_custom_bbox(d[v-1].querySelector(".mainfig"))
return"hor"==W?3==G?t.left-e.right-away:t.right+away-e.left:0==G?t.top-e.bottom-away:t.bottom+away-e.top}var a,i,s,_,c,l,d=Z.filter(function(e){return"path_group"!=iama(e)})
d=r||u(d)
var p=m([e]),f=_slicedToArray(p,4),g=f[0],h=(f[1],f[2]),y=(f[3],e.hasAttribute("mirrored"))
l=o(e)
for(var v=0;v<d.length;v++)a=d[v],c=a.hasAttribute("mirrored")!=y,i=iama(a),"hor"==W?(s=v>0?n():0,_=h-posit2.get_top_left(a)[1],c&&(_+=0==K&&!y||2==K&&y?l-parseInt(a.getAttribute("height")):l+parseInt(a.getAttribute("height")))):(_=v>0?n():0,s=g-posit2.get_top_left(a)[0],c&&(s+=1==K&&!y||3==K&&y?l+parseInt(a.getAttribute("width")):l-parseInt(a.getAttribute("width")))),"hor"==t&&(s=0),"vert"==t&&(_=0),object_mapper[i].reposition_me(a,s,_,!0)}function o(e){var t=iami(ee),r=iami(e)
if(t>r){var n=[r,t]
t=n[0],r=n[1]}var o=document.querySelector("#from"+t+"_to"+r+"_0"),a=path_to_array(o.querySelector(".mainpath").getAttribute("d")),i=a[a.length-1],s=a[a.length-2]
return"hor"==W?2*(s.y-i.y):2*(s.x-i.x)}function a(e){var t=e.filter(function(e){return"path_group"!=iama(e)}),r=e.filter(function(e){return"path_group"==iama(e)}),n="vert"==W?1:0
return t=t.sort(function(e,t){return posit2.get_top_left(e)[n]-posit2.get_top_left(t)[n]}),t.concat(r)}function i(){return cpa.e1.classList.contains("helper_hg")?[cpa.e1,cpa.e2]:[cpa.e2,cpa.e1]}function s(e,t,r){var n
K=void 0==r?K:r
var o=svg.selectAll("."+U)[0].filter(function(e){return"path_group"==iama(e)})
if(0==o.length)return!1
var a=svg.selectAll(".hg_child."+U)[0],s=f(a,!0)
te=t||s,o=[te].concat(o.filter(function(e){return e!=te})),o.forEach(function(t,r){set_path_attrs(d3.select(t)),0==r&&(perc=e||cpa.manhattan_perc||re,cpa.hg=!1)
var o=S(i()),a=_slicedToArray(o,2),s=a[0],_=a[1],c=cpa.e2.classList.contains("helper_hg")
n=c?cpa.e1.hasAttribute("mirrored"):cpa.e2.hasAttribute("mirrored"),c?(cpa.from_side=n?(parseInt(s)+2)%4:parseInt(s),cpa.to_side=_):(cpa.from_side=s,cpa.to_side=n?(parseInt(_)+2)%4:parseInt(_)),cpa.fixed_side=!0,remake_path(find_path(void 0,!0),!0),0==r&&(cpa.hg=!0)}),te=!1}function c(e,t,r,n){function o(e,t){return e.bbox[t]}return n=n||o,e=e.map(function(e){return{bbox:get_custom_bbox(e),el:e}}),r?e.sort(function(e,r){return n(r,t)-n(e,t)}):e.sort(function(e,r){return n(e,t)-n(r,t)})}function l(e,t,r,n){var e=c(e,t,r,n)
return e[0].bbox[t]}function u(e){return e="hor"==W?3==G?c(e,"left",!0):c(e,"right"):0==G?c(e,"top",!0):c(e,"bottom"),e.map(function(e){return e.el})}function d(e){return e.length<2?40:"hor"==W?3==G?(e=c(e,"right",!0),e[0].bbox.left-e[1].bbox.right):(e=c(e,"left"),e[1].bbox.left-e[0].bbox.right):0==G?(e=c(e,"bottom",!0),e[0].bbox.top-e[1].bbox.bottom):(e=c(e,"top"),e[1].bbox.top-e[0].bbox.bottom)}function p(e,t,r,n){0==e.length&&(e=[ee]),Y(e)
var o=l(e,"left"),a=l(e,"top"),i=l(e,"right",!0),s=l(e,"bottom",!0)
if("hor"==W)if(3==G)var _=[o-n-t/2,a+r/2]
else var _=[i+n+t/2,a+r/2]
else if(0==G)var _=[o+t/2,a-n-r/2]
else var _=[o+t/2,s+n+r/2]
return Y(),_}function f(e,t){for(var r,n=e.map(function(e){return e.getAttribute("id")}),o=document.querySelector("g."+U+".helper_hg").getAttribute("id"),a=n.map(function(e){var t=o<e?[o,e]:[e,o],r=_slicedToArray(t,2),n=r[0],a=r[1]
return document.querySelector("#from"+n+"_to"+a+"_0")}).filter(function(e){return null!=e}),i=K%2==0?"y":"x",s=1/0,_=0;_<a.length;_++){var c=a[_],l=path_to_array(c.querySelector(".mainpath").getAttribute("d")),u=path_id_to_el_ids(c.id),d=_slicedToArray(u,2),p=d[0],f=(d[1],document.querySelector(p).classList.contains("helper_hg")?[2,3]:[0,1]),m=_slicedToArray(f,2),g=m[0],h=m[1],y=Math.abs(l[g][i]-l[h][i])
y<s&&(r=c.getAttribute("id"),s=y)}return t?document.querySelector("#"+r):document.querySelector("#"+extract_elements_from_path_id(r)[1])}function m(e){var t=l(e,"left"),r=l(e,"top")
return[t,l(e,"right",!0),r,l(e,"bottom",!0)]}function g(e){return id_knot=document.querySelector("."+U+".helper_hg").getAttribute("id"),id_child=e.getAttribute("id"),document.querySelector("#"+R(id_knot,id_child))}function h(e){for(var t=0;t<e.length;t++){var r=e[t],n=g(r)
if(n&&n.hasAttribute("to_side")){var o=path_id_to_el_ids(n.id),a=_slicedToArray(o,2),i=(a[0],a[1]),s=r==document.querySelector(i)?parseInt(n.getAttribute("to_side")):parseInt(n.getAttribute("from_side"))
return r.hasAttribute("mirrored")?(s+2)%4:s}}return x()}function y(){return 0==Z.length?G%2==0?"hor":"vert":V.getAttribute("hg_"+G)}function v(e,t,r,n){make_new_connection(d3.select(e)),make_new_connection(d3.select(t),!0,r),n||(svg.select("#"+cpa.id).classed(U,!0),svg.select("#"+cpa.id).classed("hg",!0))}function b(e){for(var t,r=e.classList,n=0;n<r.length;n++){var o=r[n]
o.match(/hg(_|[A-z]+)[0-9]{4}/)&&(t=o)}return t||!1}function x(){return"hor"==W?0==G?2:0:1==G?3:1}function k(){K=x(),V.setAttribute("hg_"+G,W),V.classList.toggle("hg",!0),V.classList.toggle("hg_parent",!0),ee=t(G),v(V,ee,{from_side:G,to_side:K,fixed_side:!0,manhattan_perc:.5},!0),make_new_grouping(d3.select(V)),make_new_grouping(d3.select(ee)),document.querySelector("#"+cpa.id).classList.toggle("hg",!0)}function w(){var e=posit2.get_top_left(ee,!0),t=selected_figure.dims.width||2*selected_figure.dims.rx||100,r=selected_figure.dims.height||2*selected_figure.dims.ry||80
0==G&&(pos=[e[0],e[1]-away-r/2]),1==G&&(pos=[e[0]+away+t/2,e[1]]),2==G&&(pos=[e[0],e[1]+away+r/2]),3==G&&(pos=[e[0]-away-t/2,e[1]])
var n=iama(currentElement),o=A(n,pos)
return o.classList.toggle("hg",!0),o.classList.toggle(U,!0),o.classList.toggle("hg_child",!0),v(ee,o,{from_side:G,to_side:K,fixed_side:!0,manhattan_perc:.7}),o}function E(){if(0==Z.length){J=selected_figure.my_name
var e=[ee],t=selected_figure.dims.width||2*selected_figure.dims.rx||100,r=selected_figure.dims.height||2*selected_figure.dims.ry||80}else{var n=Z[0]
J=iama(n)
var e=Z,t=parseInt(n.getAttribute("width")),r=parseInt(n.getAttribute("height"))}var o=p(e,t,r,away),a=[object_mapper[J].dims.width,object_mapper[J].dims.height]
object_mapper[J].dims.width=t,object_mapper[J].dims.height=r
var i=A(J,o)
return object_mapper[J].dims.width=a[0],object_mapper[J].dims.height=a[1],Z.push(i),q(i)}function A(e,t){var r=object_mapper[e].make(svg,t).node()
if(V.classList.contains("i_am_grouped")){var n=d3.select(V.parentElement)
ido(n).stick_to_me(n,[r])}return r}function S(e){var t=_slicedToArray(e,2),r=t[0],n=t[1]
return r.id>n.id?[K,G]:[G,K]}function q(e){e.classList.toggle(U,!0),e.classList.toggle("hg",!0),e.classList.toggle("hg_child",!0)
var t=S([ee,e]),r=_slicedToArray(t,2),n=r[0],o=r[1]
return v(ee,e,{from_side:n,to_side:o,fixed_side:!0,manhattan_perc:.7,hg:!0}),e}function T(e){var t=get_custom_bbox(V),r=get_custom_bbox(e)
return 1==G?"vert"==W?3:t.top<r.top?0:2:2==G?"hor"==W?0:t.left<r.left?3:1:3==G?"vert"==W?1:t.top<r.top?0:2:0==G?"hor"==W?2:t.left<r.left?3:1:void 0}function L(){var e=Z.filter(function(e){return"path_group"!=iama(e)})
margin=parseInt(d(e)),away=margin,document.querySelector("#form_hierarchy_margin input").value=away}function z(e,t){try{return"hg"+e.getAttribute("id")+"_"+t.toString()}catch(e){}}function j(e,t,r){G=t,V=e,U=z(e,G)
var n=svg.selectAll("."+U)[0]
if(ee=n.length>0&&n.find(function(e){return e.matches("g.helper_hg")}),n=n.filter(function(e){return!e.matches("g.helper_hg")}),r)var n=n.filter(function(e){return"path_group"!=iama(e)})
return n=a(n),n.length>0&&(K=h(n)),Z=n,W=y(),L(),n}function M(e){var t=b(e)
if(!t)return!1
var r=t.split("_"),n=_slicedToArray(r,3),o=n[0],a=n[1],i=n[2]
if(i){var s=a,_=i
s="_"+s}else{var s=o,_=a
s=s.slice(2)}return["#"+s,_]}function I(e,t){var r=M(e)
return!!r&&j(document.querySelector(r[0]),r[1],t)}function P(e){return res=[],[0,1,2,3].forEach(function(t){e.hasAttribute("hg_"+t)&&res.push(t)}),res.length>0&&res}function C(){V.removeAttribute("hg_"+G),P(V)||V.classList.toggle("hg",!1)}function B(e,t){e.classList.toggle(U,t),e.classList.toggle("hg",t),e.classList.toggle("helper_hg",t)}function O(e){B(e,!1),ungroup_element(d3.select(e))}function F(e){var t=path_id_to_el_ids(e),r=_slicedToArray(t,2),n=(r[0],r[1])
n=document.querySelector(n),n.classList.toggle(U,!1),n.classList.toggle("hg",!1),n.classList.toggle("hg_child",!1)}function $(e,t){e.forEach(function(e){"knot_hierarchy"==iama(e)&&t&&(e.classList.toggle("helper_hg",!0),make_new_grouping(d3.select(V)),make_new_grouping(d3.select(e)),move_element_to_top(e)),"path_group"!=iama(e)&&e.classList.toggle(U,!0),e.classList.toggle("hg",!0)})}function N(e){var t=M(e),r=t[0],n=t[1]
j(document.querySelector(r),n,!1)}function R(e,t){return"string"!=typeof e&&(e=find_g(e).getAttribute("id")),"string"!=typeof t&&(t=find_g(t).getAttribute("id")),e<t?"from"+e+"_to"+t+"_0":"from"+t+"_to"+e+"_0"}function D(e){if(e.hasAttribute("mirrored")){e.removeAttribute("mirrored")
var t=order_ids_for_path(d3.select(ee),d3.select(e)),n=_slicedToArray(t,2),o=n[0],a=n[1]
path_id="#from"+o+"_to"+a+"_0",document.querySelector(path_id).removeAttribute("manhattan_perc"),r(e)}else r(e),e.setAttribute("mirrored","true")}function Y(e){!e&&oe?(oe.forEach(function(e){D(e)}.bind(this)),oe=!1):(oe=[],e.forEach(function(e){e.hasAttribute("mirrored")&&(D(e),oe.push(e))}.bind(this)))}function H(e,t){return iami(t)<iami(e)&&(object_mapper[iama(t)].get_new_id(t),!0)}function Q(){return[G,K]}function X(e,t){var r=e.map(function(e){return path_id_to_el_ids(e,!0)})
return ids=new Set(_.flatten(r)),ids=Array.from(ids),ids=ids.filter(function(e){return e!=t}),ids.filter(function(e){return P(document.getElementById(e))})}var W,G,K,J,V,U,Z,ee,te,re=.3,ne=20,oe=!1
return{t:Q,recalc_parent_child:function(e,t){V&&ee||this.activate_group(e,t,!0)
var r="from"+iami(V)+"_to"+iami(ee)+"_0"
set_path_attrs(svg.select("#"+r)),remake_path(find_path(!0,!0))},get_children:function(e,t){return this.activate_group(e,t,!0),Z},activate_group:function(e,t,r){j(e,t,r)},get_current_group_info:function(){return{group:Z,parent:V,from_side:G,to_side:K,margin:away}},add_new_element:function(e,t){return"knot_hierarchy"==iama(e)||"path_group"==iama(e)?(text_to_feedback_pane("element cant be parent",!1,!0),!1):e.hasAttribute("i_am_a")?(j(e,parseInt(t),!0),void(ee?0==Z.length?(away=40,w()):E():(away=40,k()))):(text_to_feedback_pane("no element selected or not a valid parent element",!1,!0),!1)},set_new_margin_for_group:function(e,t,r){els=j(e,t,!0),away=r,n(els.slice(0,1)[0]),s(),document.querySelector("#form_hierarchy_margin input").value=away},set_alignment_for_group:function(e,t,r){els=j(e,t,!0),Y(els),els=u(els),W=r,V.setAttribute("hg_"+G.toString(),W),K=T(els[0]),n(els[0],"both",els),s(),Y()},realign_group:function(e,t,r){if(els=j(e,t,!0),els.length<2)return!1
n(currentElement,r),s(void 0,document.querySelector("#from"+iami(ee)+"_to"+iami(currentElement)+"_0"))},change_to_side_for_children:function(e){V.setAttribute("to_side_for_hy",e),s(.5,!1,e)},realign_paths:function(e,t,r,n){els=j(e,t,!0),s(r,n),move_element_to_top(ee)},realign_children_of_realigned_group:function(e){e.forEach(function(e){(hierarchies.is_parent(e)||[]).forEach(function(t){hierarchies.realign_paths(e,t),hierarchies.recalc_parent_child(e,t)})})},toggle_hidden_for_group:function(e,t){els=j(e,t,!0)
var r="none"==Z[0].style.display?"":"none"
els.forEach(function(e){e.style.display=r,[0,1,2,3].forEach(function(t){e.hasAttribute("hg_"+t)&&hierarchies.toggle_hidden_for_group(e,t)})})},get_shortest_path:function(e){return I(e,!0),f(Z,!0)},element_is_closest_to_parent:function(e){return!!M(e)&&(I(e,!0),e==f(Z))},mirror_elements:function(e){var t=I(e[0],!0)
els=e.filter(function(e){return e.classList.contains(U)}),els.forEach(function(e){D(e)}),_.all(t.map(function(e){return e.hasAttribute("mirrored")}))&&(K=(K+2)%4,document.querySelectorAll("."+U+'[i_am_a="path_group"]').forEach(function(e){return e.setAttribute("to_side",K)}),Z.forEach(function(e){return e.removeAttribute("mirrored")}))},get_not_mirrored_path:function(e){I(e)
for(var t=0;t<Z.length;t++){var r=Z[t]
if("path_group"==iama(r)&&!document.querySelector(path_id_to_el_ids(iami(e))[1]).hasAttribute("mirrored"))return r}return!1},is_parent:P,is_child_of:function(e){return M(e)},get_example_path_points:function(e){var t
if(te)t=te
else var t=(I(e,!1),f(Z,!0))
ps=path_to_array(t.querySelector("path").getAttribute("d"))
var r=document.querySelector(path_id_to_el_ids(t.id)[0])==ee?[0,1]:[3,2],n=_slicedToArray(r,2),o=n[0],a=n[1]
return[[ps[o].x,ps[o].y],[ps[a].x,ps[a].y]]},need_to_use_example_path:function(e,t){if(e.classList.contains("hg_parent")&&t.classList.contains("helper_hg"))return!1
for(var r=b(e),n=svg.selectAll("g."+r+'[i_am_a="path_group"]')[0],o=0;o<n.length;o++)if("manhattan"==n[o].getAttribute("flow")){var a=["from_side","to_side"].map(function(e){return parseInt(n[o].getAttribute(e))}),i=_slicedToArray(a,2),s=i[0],_=i[1]
return(s+_)%2==0}return!1},mark_unconnected_as_child:function(e,t,r){if(e.classList.contains("hg_child"))return text_to_feedback_pane("Elements cannot be child of more then one hierarchy",!1,!0),!1
j(t,r,!0),q(e)},mark_as_child:function(e){if(e.classList.contains("hg"))return text_to_feedback_pane("element already a child element. can only be child of one",!1,!0),!1
var t=e.getAttribute("id"),r=find_connections(t)
if(r.length>1){var n=X(r,t)
if(n.length>1)return text_to_feedback_pane(["element has multiple connections. Cant decide on parent","Alternative: remove connection, drag connection button from knot to shape."],!1,!0),!1
r=r.filter(function(e){return e.includes(n[0])})}var o=path_id_to_el_ids(r[0]),a=_slicedToArray(o,2),i=a[0],s=a[1],_=i=="#"+t?s:i
if(!svg.select(_).classed("hg"))return text_to_feedback_pane("no hierarchical groups found. create one first",!1,!0),!1
var c=document.querySelectorAll(_+" g.helper_hg")
if(c.length>1)var l=function(){var e=_>t?"to_side":"from_side"
e=document.querySelector("#"+r[0]).getAttribute(e)
for(var n=P(document.querySelector(_)),o=n.find(function(t){return t==e}),a=o||n[0],i="hg"+_.slice(1)+"_"+a,s=0;s<c.length;s++)if(c[s].classList.contains(i))return c[s]}()
else var l=c[0]
var u=svg.select("#"+r[0])
if(u.select("text").empty())var d=!1
else var d=u.node().querySelector("text").parentElement
if(u.remove(),I(l),H(l,e),e.classList.toggle("hg"),e.classList.toggle("hg_child"),e.classList.toggle(U),v(l,e,{from_side:G,to_side:K,fixed_side:!0,manhattan_perc:.7}),d){var p=document.querySelector("#"+cpa.id+" path")
add_text_to_path(d.textContent,p),"text_path"==iama(d)&&text_basic.block_to_path_vv(d3.select(p.parentElement))}},check_and_alter_classes_for_detach:function(e,t,r,n,o){N(r),e&&!t?(Z.forEach(function(e){e.classList.toggle(U,!1),e.classList.toggle("hg",!1)}),C(),O(r)):e||t?!e&&t?(F(n),$(o)):e&&t?F(n):(console.log("error in hierarcies.check_and_alter_classes"),console.log("hierarchies gecorrumpeerd")):(Z.forEach(function(e){e.classList.toggle(U,!1),e.classList.toggle("hg",!1)}),O(r),$(o,!0))},check_and_alter_classes_for_attach:function(e,t,r){e&&(old_el_knot="knot_hierarchy"==iama(e),old_el_hg=d3.select(e).classed("hg"),old_el_helper=d3.select(e).classed("helper_hg")),new_el_knot="knot_hierarchy"==iama(t),new_el_hg=d3.select(t).classed("hg"),new_el_helper=d3.select(t).classed("helper_hg")
var n=old_el_hg?e:t
N(n)
var o=extract_elements_from_path_id(r.getAttribute("id")),a=_slicedToArray(o,2),i=a[0],s=a[1]
if(old_el_knot&&!new_el_knot&&!old_el_helper){if(new_el_hg)return!1
t.classList.toggle(U,!0),t.classList.toggle("hg",!0),t.classList.toggle("hg_child",!0),r.classList.toggle(U,!0),r.classList.toggle("hg",!0)
var _=H(n,t)
return _&&(v(ee,t,{from_side:G,to_side:K,fixed_side:!0,manhattan_perc:.7}),d3.select(r).remove()),!1}if(old_el_knot&&new_el_knot&&!old_el_helper&&!new_el_helper){t.classList.toggle(U,!0),t.classList.toggle("hg",!0),t.classList.toggle("hg_child",!0),r.classList.toggle(U,!0),r.classList.toggle("hg",!0)
var _=H(n,t)
return _&&(v(ee,t,{from_side:G,to_side:K,fixed_side:!0,manhattan_perc:.7}),d3.select(r).remove()),!1}if(old_el_knot&&!old_el_hg&&new_el_helper){if("knot_hierarchy"==iama(svg.select("#"+i)))var c=document.querySelector("#"+s)
else var c=document.querySelector("#"+i)
c.classList.toggle(U,!0),c.classList.toggle("hg",!0),c.classList.toggle("hg_child",!0),r.classList.toggle(U,!0),r.classList.toggle("hg",!0)
var _=H(n,c)
return _&&(v(ee,c,{from_side:G,to_side:K,fixed_side:!0,manhattan_perc:.7}),d3.select(r).remove()),!1}},check_if_valid_attachment:function(e,t){return old_el_knot="knot_hierarchy"==iama(t),new_el_knot="knot_hierarchy"==iama(e),old_el_hg=d3.select(t).classed("hg"),new_el_hg=d3.select(e).classed("hg"),old_el_helper=d3.select(t).classed("helper_hg"),new_el_helper=d3.select(e).classed("helper_hg"),!(old_el_helper||old_el_hg&&new_el_hg||new_el_helper&&old_el_hg)},remove_element:function(e){if(d3.select(e).classed("hg_parent"))e.querySelectorAll('g[i_am_a="knot_hierarchy"]').forEach(function(t){var r=b(t),n=svg.selectAll("."+r)
n.classed(r,!1),n.classed("hg_child",!1),n.each(function(e){this.classList.contains("hg_parent")||this.classList.toggle("hg",!1)}),e.removeChild(t),find_connections(iami(t)).forEach(function(e){return svg.select("#"+e).remove()})})
else if(d3.select(e).classed("helper_hg")){I(e)
var t=document.querySelectorAll("."+U+".hg_child")
t.forEach(function(e){e.classList.toggle(U,!1),e.classList.contains("hg_parent")||e.classList.toggle("hg",!1),e.classList.toggle("hg_child",!1)}),V.removeAttribute("hg_"+G),1==d3.select(V).selectAll("g.helper_hg")[0].length&&(V.classList.toggle("hg_parent",!1),V.classList.contains("hg_child")||V.classList.toggle("hg",!1),V.classList.toggle("i_have_a_group",!1))}else"path_group"==iama(e)&&path_id_to_el_ids(e.getAttribute("id")).forEach(function(e){var t=document.querySelector(e)
d3.select(t).classed("hg_child")&&(t.classList.toggle(U,!1),t.classList.toggle("hg",!1),t.classList.toggle("hg_child",!1))})},set_my_group:I,is_child:function(e){return d3.select(e).classed("hg_child")},resize_elements:function(e,t){if(!e.classList.contains("hg"))return text_to_feedback_pane("selected element is no child and cannot serve as example for sizing",!1,!0),!1
I(e,!0)
var r=parseFloat(currentElement.getAttribute("width")),n=parseFloat(currentElement.getAttribute("height"))
Z.forEach(function(e){var o="height"==t?parseFloat(e.getAttribute("width")):r,a="width"==t?parseFloat(e.getAttribute("height")):n
object_mapper[iama(e)].resize_me(d3.select(e),o,a,!0),recalc_connections(e.getAttribute("id"))})}}}()
document.querySelector("#modal_load_tabs").onclick=function(e){var t=this.parentElement.querySelectorAll(".modal_sub_tab")
this.querySelector(".active").classList.remove("active"),e.target.classList.add("active"),_.forEach(t,function(e){return e.classList.add("hidden")}),i=["a","b","c"].indexOf(e.target.id),t[i].classList.remove("hidden")},document.querySelector("#modal_gist_search_button").onclick=function(e){var t=document.querySelector("#gist_search_value").value
gist_search_is_user?local_store.get_gists_from_user(t):local_store.get_gist_from_id(t)},document.querySelector("#modal_gist_edit_button").onclick=function(e){var t=document.querySelector("#modal_gist_edit input").value
local_store.edit_as_gist(t)}
var last_used_gist_id=!1,gist_search_is_user=!0
document.querySelector("#modal_gist_search_for").onclick=function(e){gist_search_is_user=!gist_search_is_user,toggle_button(e.target.parentElement,!0)}
var _slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),slide_preview_dims={width:200,height:125,class:"slide_preview"},slide_manager=function(){function e(e,t){"slide"==iama(t)&&(t=c(repos_slider)),t.parentElement.appendChild(t)
var r=d3.select(k).selectAll("svg.slide_preview")[0]
r=r.filter(function(e){return e!=t})
for(var n=e;n<r.length;n++)r[n]!=t&&t.parentElement.appendChild(r[n])}function t(e){e.append("rect").attr("width",slide_preview_dims.width).attr("height",slide_preview_dims.height).attr("class","border").style("fill","white").style("fill-opacity",0).style("stroke","palegoldenrod").style("stroke-width","3px").on("mousedown",function(){b=this.parentElement}).on("click",function(){if(text_to_help_pane(help_text.slidePreview),this.parentElement,T){var e=this.parentElement.querySelector(".slide_title").textContent.match(/[0-9]+/)[0]
e=parseInt(e),h(e)}d3.event.stopPropagation()}).on("dblclick",function(){var e=l(b).node()
toggle_zoom.center_on_shape(e,j,e)}),e.call(q)}function r(e){var t=e.getAttribute("id"),r=e.getAttribute("pos_info").split(",").map(function(e){return parseInt(e)}),n=svg.select("#"+t).node()
n.classList.add("displayed")
var o=posit2.get_trans(n)
o.translate=[r[0],r[1]],n.setAttribute("transform",transform_to_string(o)),update_slide_menu(n)}function o(e,t){e.append("text").attr("class","slide_title").attr("transform","translate(75,120)").text("slide "+t).style("font-size","8px")}function a(e,t){object_mapper.slide.make_snap_shot(e,t)}function i(e,r){if(gui.remove_all(),e.select(".slide_title").empty()){var n=k.querySelectorAll("svg").length-1
e.attr("y",n*slide_preview_dims.height+5)}else n=e.select(".slide_title").text().match(/[0-9]+/)[0],e.selectAll("*").remove()
a(r,e),r.classList.remove("displayed"),t(e),o(e,n)}function s(){var e=d3.select(k).selectAll("svg.slide_preview")[0]
e=e.filter(function(e){return!e.classList.contains("moving")})
for(var t=0;t<e.length;t++){var r=d3.select(e[t])
r.transition().ease("exp").attr("y",t*slide_preview_dims.height+5),r.select(".slide_title").remove(),o(r,t)}}function c(e){return d3.select(k).select("#"+e.getAttribute("id"))}function l(e){return d3.select("#zoomfield").select("#"+e.getAttribute("id"))}function u(){var e=d3.select(k).selectAll("svg.slide_preview")[0].length,t=slide_preview_dims.height*e+25
k.setAttribute("height",t)}function d(e){e.querySelector(".poly_point")&&toggle_poly_points(e),e.classList.remove("displayed")}function p(e,t){var r=object_mapper[iama(e)].get_bbox_of_figure(d3.select(e)),n=object_mapper[iama(t)].get_bbox_of_figure(d3.select(t))
return points_in_area(_.values(r),n)}function f(){var e=d3.select(k).selectAll("svg.slide_preview")[0]
L=e.map(function(e){return l(e).node()})}function m(){L=[]}function g(e){L.forEach(function(e){e.classList.remove("blank"),e.classList.add("hidden")}),d3.select(e).selectAll(".poly_point").remove(),e.classList.add("blank"),e.classList.remove("hidden")}function h(e){if(e>=L.length||e<0)return!1
z=e
var t=L[e]
if(c(t),svg.node().dispatchEvent(slide_exit),g(t),t.hasAttribute("els_to_hide")){var r=t.getAttribute("els_to_hide").split("*").filter(function(e){return e.length>2}).map(function(e){return document.querySelector("#"+e)})
r.map(function(e){return e.id}).forEach(function(e){return r=r.concat(find_connections(e).map(function(e){return document.getElementById(e)}))})}return toggle_zoom.center_on_shape(t,j,t,A,r),remove_plumb_lines(),document.querySelector("#slides_quick_controls p").textContent=e+1+" / "+L.length,!0}function y(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0]
if(e)t=e
else var t=document.querySelector("#form_slide_show_filter").value
j=toggle_zoom.filters[t]}function v(e){e?(document.querySelector("#form_slide_show_controls").style.display="flex",document.querySelector("#form_slide_show_start_controls ").style.display="none",document.querySelector("#slides_quick_controls").style.display="block"):(document.querySelector("#form_slide_show_controls").style.display="none",document.querySelector("#form_slide_show_start_controls ").style.display="block",document.querySelector("#slides_quick_controls").style.display="none")}var b,x,k=document.querySelector("#slides_menu svg"),w=0
k.style.position="absolute"
var E=0,A=!1,S=!1,q=d3.behavior.drag().on("dragstart",function(){w=d3.select(k).selectAll("svg.slide_preview")[0].indexOf(this),this.classList.add("moving"),x=drag_treshold(15)}).on("drag",function(){var e=x.add(0,d3.event.dy),t=_slicedToArray(e,2),r=(t[0],t[1])
if(0!=r){var n=parseInt(this.getAttribute("y"))+r
this.setAttribute("y",n)
var o=Math.floor(n/slide_preview_dims.height)+1
o!=w&&(w=o,s())}}).on("dragend",function(){if(this.classList.remove("moving"),x.treshold_reached()){var t=Math.floor(parseInt(this.getAttribute("y"))/slide_preview_dims.height)+1
t=Math.max(t,0),e(t,this),s(),T&&f()}}),T=!1,L=[],z=0,j=!1
return{setup_menu:function(){E=document.querySelector("#fs_container").getBoundingClientRect().bottom,k.style.top=E},add_slide:function(e){var t=e.getAttribute("id"),r=d3.select(k).append("svg").attr(slide_preview_dims)
r.attr("id",t),i(r,e),u()},reposition_slide:function(e){i(c(e),e)},delete_slide:function(e){e.classList.contains("existing")&&(c(e).remove(),s()),d3.select(e).remove(),u()},delete_slide_from_preview:function(){this.delete_slide(l(b).node())},save_slides:function(){for(var e=k.querySelectorAll("svg"),t=[],r=0;r<e.length;r++)t.push(e[r].getAttribute("id"))
return t},load_slides:function(e){var t=this,r=document.querySelector("#slides_menu"),n=document.querySelector("#edit_mode_menu")
r.classList.remove("menu_hidden"),n.classList.add("menu_hidden"),e.forEach(function(e){var r=svg.select("#"+e).node()
r.classList.remove("hidden"),t.add_slide(r),r.classList.add("hidden"),d(r)}),r.classList.add("menu_hidden"),n.classList.remove("menu_hidden")},update_slides:function(){var e=document.querySelectorAll('g[i_am_a="slide"]')
show_wait_spinner("","updating slides...")
for(var t=0;t<e.length;t++)e[t].classList.remove("hidden"),this.reposition_slide(e[t]),e[t].classList.add("hidden")
hide_wait_spinner()},toggle_slider_visibility:function(e){if("slide"==iama(e))var t=e,n=c(t).node()
else var n=e||b,t=l(n).node()
return t.classList.contains("displayed")?(t.classList.remove("displayed"),t.classList.add("hidden")):(r(n),t.classList.add("displayed"),t.classList.remove("hidden"),ido(t).move_els_inside_to_top(d3.select(t))),d3.select(t).selectAll(".poly_point").remove(),toggle_poly_points(t),t},find_slider:function(e){return e=e||b,l(e).node()},start_slide_show:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2])
arguments.length>3&&void 0!==arguments[3]&&arguments[3]&&(document.querySelector("#sidebar").classList.add("menu_hidden"),S=!0),A=document.querySelector("#slideshow-anim").checked||e,y(t),f(),T=!0,v(!0),z=0,h(0)},end_slide_show:function(e){m(),T=!1,v(!1),svg.node().dispatchEvent(slide_exit),_.forEach(document.querySelectorAll('g[i_am_a="slide"]'),function(e){e.classList.remove("blank"),e.classList.remove("displayed"),e.classList.add("hidden")}),S&&(S=!1,toggle_slide_edit_menu(void 0,!0),document.querySelector("#sidebar").classList.remove("menu_hidden")),this.setup_menu()},next_slide:function(){h(z+1)||text_to_feedback_pane("no more slides",!1,!0)},prev_slide:function(){h(z-1)||text_to_feedback_pane("first slide reached",!1,!0)},slide_show_on:function(){return T},scroll_slides:function(e){if(0==e)return!1
n=k.querySelectorAll("svg").length
var t=E-n*slide_preview_dims.height,r=parseInt(k.style.top)||0
r+=e*-SCROLL_DELTA,r=Math.min(Math.max(t,r),E),k.style.top=r+"px"},clear_all_slides:function(){d3.select(k).selectAll("svg").remove()},toggle_visible_on_this_slide_only:function(e){e.hasAttribute("vis_on_slide_only")?e.getAttribute("vis_on_slide_only").length>5||(e.removeAttribute("vis_on_slide_only"),e.removeEventListener("slide_exit",hide_me)):(slider=svg.select('g.displayed[i_am_a="slide"]').node(),p(e,slider)?(e.setAttribute("vis_on_slide_only",iami(slider)),e.style.display="none"):text_to_feedback_pane(["element not within bounds of displayed slider"],!1,!0))},check_if_slides_present:function(){return f(),0!=L.length},set_els_to_hide_on_slide:function(e){var t,r=svg.node().querySelectorAll('g.displayed[i_am_a="slide"]')
if("slide"==iama(currentElement)&&(t=currentElement),1!=r.length)return text_to_feedback_pane(["cannot set group because active shape is not a slider or there are more then one sliders visible","Make sure only one slider is visible on the screen"]),!1
t=r[0]
var n=e.map(function(e){return e.id}).reduce(function(e,t){return e+"*"+t})
return t.setAttribute("els_to_hide",n),text_to_feedback_pane(["shapes set to invisible"]),!0},remove_els_to_hide_from_slide:function(){"slide"==iama(currentElement)?(currentElement.removeAttribute("els_to_hide"),slide_manager.reposition_slide(currentElement),set_slides_buttons(!0),text_to_feedback_pane("undone")):text_to_feedback_pane("cannot undo because active element is not a slider")},move_slide_in_order:function(t,r){r=r||b,e(t,b),s()},remove_all_slides:function(e){m(),z=0,d3.select(k).selectAll("svg.slide_preview").remove(),svg.selectAll('g[i_am_a="slide"]').remove()},show_all_sliders:function(e){Array.from(document.querySelectorAll('g[i_am_a="slide"]')).forEach(function(e){e.classList.add("displayed"),e.classList.remove("hidden"),ido(e).move_els_inside_to_top(d3.select(e))})}}}()
document.querySelector("#form_hide_slide").onclick=document.querySelector("#cm_slide_hide").onclick=function(){slide_manager.toggle_slider_visibility(currentElement),set_slides_buttons(!0)},document.querySelector("#form_delete_slide").onclick=document.querySelector("#cm_slide_delete").onclick=function(){slide_manager.delete_slide(currentElement),set_slides_buttons(!0)},document.querySelector("#form_make_slide").onclick=make_slide_handler,document.querySelector("#cm_slide_snap_shot").onclick=make_slide_handler,document.querySelector("#form_update_slide").onclick=document.querySelector("#cm_slide_repos").onclick=function(){"slide"==iama(currentElement)?(slide_manager.reposition_slide(currentElement),set_slides_buttons(!0)):text_to_feedback_pane("select a slider to update first")},document.querySelector("#form_add_slide").onclick=function(e){drag_select_on(e),set_slides_buttons(!1,!0,!1,!1,!0)},document.querySelector("#cm-slide-preview-slide-delete").onclick=function(){slide_manager.delete_slide_from_preview()},document.querySelector("#cm-slide-preview-toggle-slider").onclick=function(e){currentElement=slide_manager.toggle_slider_visibility(),set_slides_buttons(!0,!1,!0,!0,!0)},document.querySelector("#cm-slide-preview-slide-zoom-and-show").onclick=function(e){currentElement=slide_manager.toggle_slider_visibility(),set_slides_buttons(!0,!1,!0,!0,!0),toggle_zoom.center_on_shape(currentElement)},document.querySelector("#cm_slide_wrap_around").onclick=function(){ido(currentElement).shrink_wrap_around_figures(currentElement),currentElement.classList.contains("existing")?slide_manager.reposition_slide(currentElement):slide_manager.add_slide(currentElement)},document.querySelector("#form_slide_show_start").onclick=function(e){slide_manager.start_slide_show()},$(".form_slide_show_next").on("click",slide_manager.next_slide),$(".form_slide_show_prev").on("click",slide_manager.prev_slide),$(".form_slide_show_stop").on("click",function(){slide_manager.end_slide_show()}),document.querySelector("#slides_svg").onwheel=function(e){slide_manager.scroll_slides(Math.sign(e.deltaY))},document.querySelector("#slides_menu").onclick=slide_manager.setup_menu,document.querySelector("#button_update_all_slides").onclick=function(e){slide_manager.update_slides()},$(".form_slide_hide_grouped").on("click",function(e){var t=manage_groups.get_current_group()
slide_manager.set_els_to_hide_on_slide(t)&&manage_groups.reset(!1)}),$(".form_slide_hide_grouped_undo").on("click",function(e){slide_manager.remove_els_to_hide_from_slide()}),$(".cm-slide-preview-set-order-num").on("click",function(e){var t=parseInt(this.parentElement.querySelector(".cm-slide-preview-order-num").value)
"slide"==iama(currentElement)&&cmm.status(),slide_manager.move_slide_in_order(t,slide)}),document.querySelector("#form_remove_all_slides").onclick=slide_manager.remove_all_slides,document.querySelector("#form_show_all_sliders").onclick=slide_manager.show_all_sliders
var _slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()
bestand=[]
var selected_background,splitter_for_text_primary="\n",splitter_for_text_parsing=";",auto_number_import=!1,tag_import=!1,delta_x_import=15,delta_y_import=15,write_colwise=!0,max_rc_before_break=10
xml_parser=function(){function e(e){var t=e.querySelector("pStyle")
return t?t.getAttribute("w:val"):""}function t(e){var t=e.querySelector("sz")
return t?t.getAttribute("w:val"):""}function r(e){var t=e.querySelector("rFonts")
return t?t.getAttribute("w:ascii"):""}function n(e){return e.textContent}function o(e,t){for(e=e||{level:-1,children:[]};t.length>0&&e.level<t[0].level;){var r=o(t[0],t.slice(1)),n=_slicedToArray(r,2),a=n[0],t=n[1]
a&&e.children.push(a)}return[e,t]}return xml_mapping=["Title","Heading1","Heading2","Heading3","Heading","TextBody","Normal"],html_mapping=["BODY","H1","H2","H3","H4","H5","SECTION","ARTICLE","P"],{parse_xml:function(a){var i=[],s=$.parseXML(a),c=s.querySelectorAll("p")
_.forEach(c,function(o,a){var s=o.querySelectorAll("t")
if(s.length>0){var _={}
_.class=e(o)
var a=xml_mapping.indexOf(_.class)
_.level=-1==a?xml_mapping.length:a,_.fontSize=t(o),_.font=r(o),_.text=[],s.forEach(function(e){return _.text.push(n(e))}),i.push(_)}}),i.forEach(function(e){return e.children=[]})
var l=o(!1,i),u=_slicedToArray(l,2),d=u[0]
return u[1],d}}}()
var xml_data_string,with_images=!0,TAB_DIST=3,LINEHEIGHT=.5
pdf_parser=function(){function e(e){var t=[e.transform[4],e.transform[5]],r=e.transform[3]
return{startpos:t,endpos:[t[0]+e.width,t[1]-r],size:r}}function t(e){for(var t=[],n=0;n<e.length-1;n++)t.push(r(e[n],e[n+1]))
return t}function r(e,t){return{dx:e.endpos[0]-t.startpos[0],dy:e.endpos[1]-t.startpos[1],ds:e.size-t.size,dxx:e.startpos[0]-t.startpos[0],dyy:e.startpos[1]-t.startpos[1],size:e.size}}function n(e,t){if(0==e.length)return[0]
for(var r=[],n=t[1].startpos,o=0,a=0;a<e.length;a++){var i=e[a]
Math.abs(i.dyy)<3&&i.dx>i.size*-TAB_DIST?r.push(o):Math.abs(i.dy)<(i.size-i.ds)*LINEHEIGHT&&0==i.ds&&n[0]<t[a+1].startpos[0]+i.size*TAB_DIST&&i.dx>i.size*-TAB_DIST?r.push(o):(o+=1,n=t[a+1].startpos,r.push(o))}return r}function o(e,t,r){var n=0,o=[],a=function(e){return{text:[{fontName:e.fontName,str:e.str,size:Math.round(e.transform[3])}]}},i=a(t[0])
if(1==e.length)return[i]
for(var s=0;s<e.length;s++)e[s]==n?(function(e){0==Math.abs(Math.round(r[e].dyy))&&r[e].dx<-.15*r[e].size&&(t[e+1].str=" "+t[e+1].str)}(s),function(e){i.text.push({fontName:e.fontName,str:e.str,size:Math.round(e.transform[3])})}(t[s+1])):(n=e[s],o.push(i),i=a(t[s+1]))
return o.push(i),o}function a(e,t){var r=[],n=e[e.length-1];-1!=e.lastIndexOf(0)?r.push(s(t.slice(0,e.lastIndexOf(0)+1))):r.push(s([t[0]]))
for(var o=1;o<=n;o++){var a=e.indexOf(o),i=e.lastIndexOf(o)
r.push(s(t.slice(a+1,i+2)))}return r.map(function(e){var t=_slicedToArray(e,4),r=t[0],n=t[1],o=t[2],a=t[3]
return{width:o-r,height:a-n,tl:[r,a],mid:[(o+r)/2,(a+n)/2]}})}function i(e){var t=[],r=e[0]
1==r.str.length&&(r.size=0),alter_nbs=function(e){return e.str=e.str.replace(/\s/g," ")}
for(var n=1;n<e.length;n++)0==r.size&&(r.size=e[n].size),r.str+=e[n].str
return alter_nbs(r),t.push(r),t}function s(e){var t=minY=1/0,r=maxY=0
return e.forEach(function(e){t=Math.min(t,e.startpos[0]),minY=Math.min(minY,e.startpos[1]),r=Math.max(r,e.endpos[0]),maxY=Math.max(maxY,e.startpos[1])}),[t,minY,r,maxY]}function _(e,t,r,n){var o=s(e),a=_slicedToArray(o,4),i=(a[0],a[1]),_=(a[2],a[3]),u=_-i
0==e.length&&(u=r)
var d=parseInt((msvg_h-last_pos[1])/r),p=n%d,f=parseInt(n/d),m=[last_pos[0]+f*t,last_pos[1]+p*r]
l=function(e){return[e[0]+m[0],u-e[1]+m[1]]},c.push(l)}var c=[],l=!1
return{do:function(r,i,s,c,u){r=r.filter(function(e){return" "!=e.str})
var d=r.map(function(t){return e(t)})
if(r.length>0)var p=t(d),f=n(p,d),m=o(f,r,p),g=a(f,d)
_(d,s,c,u),console.log(l([36,58])),r.length>0&&this.to_map(m,g,i)},to_map:function(e,t,r){var n=auto_resize
auto_resize=!0,Object.keys(r).forEach(function(e){"sans-serif"==r[e].fontFamily&&(r[e].fontFamily="Roboto condensed")}),e.forEach(function(e,n){var o=rect_basic.make(svg,[0,0]).node()
i(e.text).forEach(function(e){var t=ido(o).add_paragraph(o,e.str).node()
t.style.fontSize=e.size+"px",t.style.fontFamily=r[e.fontName].fontFamily})
var a=l(t[n].tl)
ido(o).reposition_me(o,a[0],a[1]),ido(o).resize_me(d3.select(o),t[n].width+15,15,!0),ido(o).size_around_paragraphs(o,!1,!0),set_style_class_to_predef(o,"style_20"),o.style.strokeWidth="1px",ido(o).calc_border(o,[!0,!1,!1,!1]),o.setAttribute("border_sides_arr",[!0,!1,!1,!1])}),auto_resize=n},get_conv_pos:function(e){return c[e]}}}()
var startpage=10,endpage=10
chainable_tags=["span","b","i","u","strong","a","em","sup","meta"]
var _slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),undoer=function(){function e(){a.length>o&&(a=a.splice(1))}function t(e){var t=e.getAttribute("vt").split("_"),r=_slicedToArray(t,2),n=r[0],o=r[1],a=e.getAttribute("table")
tables[a][n][o]=e}function r(e){var t=e.getAttribute("vt").split("_"),r=_slicedToArray(t,2),n=r[0],o=r[1],a=e.getAttribute("table"),i=make_table_dummy_node(n,o,a)
tables[a][n][o]=i}function n(e){var t=path_id_to_el_ids(e.id).map(function(e){return document.querySelector(e)}),r=_slicedToArray(t,2),n=r[0],o=r[1]
return"knot"==iama(n)&&"knot"==iama(o)?[n,o]:"knot"==iama(n)?[n]:"knot"==iama(o)?[o]:[]}var o=10,a=[],i=[]
return{start:function(){i=[]},stop:function(){a.push(i),e()},remove:function(e){var t=this
i.push([e,e.parentElement]),e.hasAttribute("table")&&r(e),"path_group"==iama(e)&&n(e).forEach(function(e){return t.remove(e)},this),d3.select(e).remove(),posit2.delete_item(e.id)},undo:function(){if(0==a.length)return text_to_feedback_pane("no more items stored",!1,!0),!1
to_add=a.pop(),to_add.forEach(function(e){var r=_slicedToArray(e,2),n=r[0]
r[1].appendChild(n),n.hasAttribute("table")&&t(n)})},show_stored:function(){return a}}}(),_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),gui=function(e){function t(t,r,n,o){var a=poly_config[iama(t)].reshape_icon||"compress",i=e.append("g")
return y(i,"guided_reshape"),i.append("text").attr("transform","translate("+[r.x,r.y]+") scale("+o/1.25+")").on("mouseover",function(){toggle_zoom.temp_disable_on()}).on("mouseout",function(){toggle_zoom.temp_disable_off()}).text(FONT_AWESOME[a]).style("cursor","cell"),i.call(poly_point_move),n&&i.attr("my_index",n),i}function r(){caret=currentElement.classList.contains("flipped")?"caret-left":"caret-right"
var t=e.append("g")
return t.append("text").attr("transform","translate(-8, 12)").text(FONT_AWESOME[caret]),t.on("click",function(){manage_groups.get_group(currentElement).forEach(function(e){e.classList.contains("flippable")&&ido(currentElement).flip_shape(e)}),d3.event.stopPropagation(),gui.frame_element(currentElement)}),t.on("dblclick",function(){d3.event.stopPropagation()}),y(t,"flip"),t}function n(){var t=e.append("g")
return["top","left","right"].forEach(function(e){t.append("circle").attr("side",e).attr("class","par_cp").attr("r",5).call(drag_par_margin)}),object_to_event.cp_rotate.forEach(function(e){return t.on(e.event_type,e.func)}),y(t,"par_margin"),t}function o(){var t=e.append("g")
return t.append("circle").attr("r",14).attr("transform","translate(-11,-10)"),t.append("path").attr("d","M 112.41029,205.01991 C 21.61837,153.87756 1.8694022,142.44562 2.9102575,141.63445 4.6709777,140.26227 224.86463,19.015318 226.64927,18.435283 c 1.14928,-0.373531 -0.24051,6.654133 -6.8199,34.485654 -4.54484,19.225132 -8.26334,35.230944 -8.26334,35.56847 0,0.33752 71.7229,0.613685 159.38421,0.613685 87.66132,0 159.38421,-0.276165 159.38421,-0.613685 0,-0.337526 -3.73659,-16.412474 -8.30352,-35.722095 -4.56694,-19.309627 -8.21181,-35.188924 -8.09973,-35.287326 0.1121,-0.0984 21.35997,11.482768 47.2175,25.735948 25.85755,14.253179 76.71134,42.27974 113.00842,62.281246 36.29717,20.00152 65.91967,36.6625 65.82788,37.02441 -0.18447,0.72773 -221.02484,125.09729 -221.46721,124.72262 -0.15213,-0.12884 2.44394,-15.66242 5.76905,-34.51907 3.3251,-18.85666 6.04608,-34.9065 6.04662,-35.66633 7.5e-4,-1.31035 -8.20974,-1.38152 -159.38322,-1.38152 -132.84743,0 -159.38421,0.17669 -159.38421,1.06122 0,0.58368 2.72483,16.63027 6.05517,35.6591 3.33034,19.02883 5.94353,34.69243 5.80709,34.80799 -0.13645,0.11556 -50.09455,-27.868 -111.018,-62.18569 z").attr("transform","translate(-25,-14 ) scale(0.04)"),t.call(drag_along_path),object_to_event.cp_rotate.forEach(function(e){return t.on(e.event_type,e.func)}),y(t,"arrowLR"),t}function a(){var t=e.append("g")
return t.append("circle").attr("r",14).attr("transform","translate(-11,-10)"),t.append("path").attr("d","m 258.50502,509.12899 c 5.04156,-2.30285 12.05879,-9.87733 14.7162,-15.88484 1.31063,-2.9629 2.05911,-6.85363 2.09719,-10.9016 0.11347,-12.06062 -9.16372,-24.88388 -20.44871,-28.26495 -2.16926,-0.64992 -9.14187,-1.82647 -15.49469,-2.61454 -6.35281,-0.78808 -15.67244,-2.1571 -20.71028,-3.04227 -10.65235,-1.87167 -17.58738,-1.42982 -24.33464,1.55043 -6.11685,2.70181 -10.78306,7.16472 -14.14503,13.52878 -3.66256,6.93306 -3.82209,18.8012 -0.34276,25.5 4.54217,8.7451 11.80588,14.45315 22.16272,17.41617 15.73608,4.50198 49.07821,6.10289 56.5,2.71282 z m 93.5,-17.56152 c 11.54999,-4.26228 37.57115,-19.65633 44.32504,-26.22257 6.62016,-6.43623 8.16943,-10.48413 8.16943,-21.3449 0,-7.87019 -0.37699,-10.20555 -2.19744,-13.61257 -3.2392,-6.06222 -11.53347,-13.0832 -17.57569,-14.87754 -10.31306,-3.06265 -16.64653,-1.71922 -30.09856,6.38439 -4.46753,2.69127 -13.07278,7.68737 -19.12278,11.10244 -18.46971,10.42569 -22.69046,16.16227 -22.80702,30.99788 -0.0764,9.72227 1.01945,12.55747 7.64184,19.77128 5.89976,6.42666 12.38162,9.23005 21.16518,9.15389 3.85,-0.0334 8.575,-0.64191 10.5,-1.3523 z M 130.11995,459.6804 c 4.9849,-1.86417 9.18849,-5.01309 12.83022,-9.61115 4.63397,-5.85087 6.05485,-10.15485 6.05485,-18.34079 0,-11.64215 -2.16391,-14.97857 -23.94506,-36.91958 -20.94569,-21.0994 -21.59629,-21.48359 -34.729236,-20.50768 -11.92078,0.88583 -19.40608,6.03197 -24.79501,17.04654 -2.37755,4.85954 -2.7042,6.57571 -2.37169,12.46036 0.67204,11.89343 4.48151,17.97559 22.80208,36.40556 17.906956,18.0139 20.974476,19.91464 33.038916,20.47206 4.68015,0.21624 8.85914,-0.16174 11.11493,-1.00532 z m 320,-62.06002 c 8.84324,-3.16023 13.83296,-8.97385 21.30641,-24.82455 12.2372,-25.95431 15.04014,-41.57039 9.39511,-52.34331 -3.32481,-6.34504 -7.90634,-10.89931 -14.31645,-14.23127 -6.75032,-3.5088 -16.97804,-3.62052 -23.91737,-0.26125 -10.10981,4.89407 -13.86604,9.93578 -20.02258,26.87479 -2.44671,6.73184 -6.27365,16.20173 -8.5043,21.0442 -3.34027,7.25128 -4.05575,9.88427 -4.05575,14.92524 0,13.0406 8.22493,25.40328 19.03707,28.61414 6.37277,1.8925 16.08684,1.98561 21.07786,0.20201 z M 61.632974,342.78826 c 5.01033,-1.61392 12.55958,-7.92077 15.84044,-13.23354 l 3.03161,-4.90915 -0.46622,-15.07279 C 79.782384,301.28275 79.577784,284.6 79.584134,272.5 c 0.0101,-19.18932 0.30376,-23.33114 2.2987,-32.41924 11.45949,-52.20446 43.501696,-94.9372 90.622186,-120.85729 12.78052,-7.03032 31.54647,-14.0447 46.5,-17.38089 9.54009,-2.128421 12.8312,-2.339215 36,-2.30577 22.60373,0.03263 26.63579,0.289337 35.5,2.26017 8.58965,1.90978 27.34069,7.52717 29.80007,8.92742 0.44004,0.25054 -0.28049,1.87754 -1.60119,3.61556 -13.3447,17.56153 -31.42111,43.75099 -33.29776,48.24245 -1.63942,3.92367 -1.0521,7.51849 1.62405,9.94037 1.99117,1.80198 26.38777,6.22318 60.47483,10.95938 10.45,1.45196 34.3,4.85859 53,7.57028 41.2962,5.98837 73.56392,9.94756 81.07343,9.94756 4.8345,0 5.97114,-0.39072 8.5035,-2.92308 C 496.00332,192.15555 494.35817,186.76207 465.96135,119 461.46687,108.275 456.33037,95.9 454.54692,91.5 452.76348,87.1 448.72248,77.425 445.56693,70 442.41138,62.575 436.88651,49.525 433.28945,41 421.03981,11.968536 418.90278,7.5005187 415.96134,4.7709879 410.98126,0.14970289 405.93186,-0.09009389 400.6749,4.0450327 399.2146,5.1937018 391.93984,14.31598 384.50875,24.316761 362.9937,53.271794 357.66571,60 356.25161,60 c -0.72944,0 -3.13254,-0.92149 -5.3402,-2.047755 -6.07885,-3.101201 -36.26984,-12.67865 -46.95958,-14.896932 -20.11429,-4.174015 -52.95147,-5.502096 -76.44681,-3.091848 -40.66297,4.171374 -84.01689,22.043464 -118.22663,48.737393 -10.571366,8.248858 -29.504236,26.909092 -38.311696,37.760002 -17.18942,21.17761 -32.3023,49.08311 -40.90999,75.53914 -9.5572,29.37437 -11.53078,44.11134 -10.75653,80.3203 0.59249,27.70845 1.57089,35.13637 5.82845,44.2491 3.09221,6.61847 10.59055,13.80446 16.50862,15.82095 5.20006,1.77184 15.11773,1.9692 19.99573,0.39791 z").attr("transform"," translate(-25,-25) scale(0.05)"),t.call(drag_rotate),object_to_event.cp_rotate.forEach(function(e){return t.on(e.event_type,e.func)}),y(t,"rotate"),t}function i(){var t=e.append("g")
return t.append("circle").attr("r",14).attr("transform","translate(11,10)"),t.append("path").attr("d","m 239.38452,254.4043 c 1.79252,-1.09292 4.15334,-3.45373 5.24626,-5.24626 1.95083,-3.19962 1.98719,-5.25922 1.99086,-112.77474 0.004,-123.968514 0.65982,-114.277381 -8.03214,-118.734393 -3.76919,-1.932742 -5.94554,-2.25 -15.43473,-2.25 l -11.04684,0 -21.48255,21.5 -21.48256,21.5 17.24128,0 17.24128,0 0,77.499993 0,77.5 -78,0 -78.000004,0 -0.0526,-17.25 -0.0526,-17.25 -21.5236,22 -21.5235996,22 0.32619,12 c 0.28995,10.66683 0.58492,12.36274 2.65503,15.26509 4.7425096,6.64911 -3.11872,6.23529 118.3715036,6.23117 108.29789,-0.004 110.35881,-0.0398 113.5588,-1.99086 z m -96.64421,-86.36109 c 7.32949,-2.66779 12.63313,-7.66499 16.08622,-15.15677 2.29833,-4.98642 2.29882,-4.99786 2.19188,-51.0106 -0.11886,-51.142016 0.19311,-48.68236 -7.06061,-55.667395 -2.10783,-2.029754 -5.09921,-4.167254 -6.64752,-4.75 -3.92524,-1.477368 -12.12104,-1.321973 -16.01155,0.303584 -3.68094,1.537996 -11.47509,9.886055 -12.18742,13.053546 -0.25769,1.145833 -0.80994,10.633332 -1.22722,21.083332 l -0.75871,19 L 70.352006,48.468769 23.578656,2.0386321 19.546216,5.9687696 c -2.21784,2.1615755 -5.46983,6.8456754 -7.22664,10.4091104 -2.9149496,5.912549 -3.1941996,7.311346 -3.1941996,16 0,15.695838 -0.26602,15.328649 41.8536796,57.771027 l 35.97438,36.249993 -15.91403,0.006 c -26.11517,0.01 -31.77462,1.85207 -36.92861,12.02298 -4.18235,8.25348 -2.88173,17.78399 3.31763,24.31051 6.02993,6.34814 4.21988,6.13857 55.19694,6.39076 36.405694,0.1801 47.284754,-0.0556 50.114944,-1.08573 z").attr("transform","scale(0.08)"),t.call(drag_resize),object_to_event.cp_resize.forEach(function(e){return t.on(e.event_type,e.func)}),y(t,"resize"),t}function s(t,r,n,o){var a=e.append("g").attr("class","plumb-group")
u(a,t,r,n,o)
var i=f(t,[t[0]+r,t[1]+n])
return l(a,0,i[0],msvg_w,i[0]),l(a,0,i[1],msvg_w,i[1]),l(a,i[2],0,i[2],msvg_h),l(a,i[3],0,i[3],msvg_h),a}function l(e,t,r,n,o){return e.append("line").attr({x1:t,y1:r,x2:n,y2:o,class:"plumb"})}function u(e,t,r,n,o){var a=[o]
0!=o&&(a[1]=t[0],a[2]=t[1]),e.attr("transform","rotate("+a+")")}function d(e,t,r,n,o){u(d3.select(e),t,r,n,o)
var a=e.querySelectorAll("line"),i=f(t,[t[0]+r,t[1]+n])
p(a[0],0,i[0],msvg_w,i[0]),p(a[1],0,i[1],msvg_w,i[1]),p(a[2],i[2],0,i[2],msvg_h),p(a[3],i[3],0,i[3],msvg_h)}function p(e,t,r,n,o){d3.select(e).attr({x1:t,y1:r,x2:n,y2:o})}function f(e,t,r){var n=e[1],o=t[1],a=e[0],i=t[0]
if(is_par_tag(currentElement)){var s=find_g(currentElement)
!function(e){var t=[],r=[]
0!=posit2.get_trans(s).rotate[0]&&(_.forEach(s.transform.baseVal,function(e,r){4===e.type&&t.push(r)}),t.reverse(),t.forEach(function(e){return r.push(s.transform.baseVal.removeItem(e))}),t.reverse())
var c=s.querySelector(".mainfig").getBoundingClientRect(),l=e.getBoundingClientRect()
t.forEach(function(e,t){return s.transform.baseVal.insertItemBefore(r[t],e)})
var u=toggle_zoom.get_zoom_factor()
fo_bbox_correction?(n+=paragraph_bounding_box_zoom_correction(l.top)-c.top/u,o=n+1*paragraph_bounding_box_zoom_correction(l.height),a+=paragraph_bounding_box_zoom_correction(l.left)-c.left/u,i=a+1*paragraph_bounding_box_zoom_correction(l.width)):(n+=(l.top-c.top)/u,o=n+1*l.height/u,a+=(l.left-c.left)/u,i=a+1*l.width/u)}(currentElement)}return[n,o,a,i]}function m(){var t=knot_gui.make(e,[0,0])
return t.append("path").attr("d","M 0 4 C 25 4 0 20 25 20 L25 22  C 0 24 22 7 0 6").attr("transform","translate(-20,0)").attr("class","no_pointing"),y(t,"connect"),t.classed("gui_knot",!0),t}function g(){var t=document.querySelector("#gui_connect"),r=posit2.get_w_h_hor(currentElement),n=_slicedToArray(r,2),o=n[0],a=n[1],i=posit2.get_top_left(currentElement,!0),s=posit2.get_trans(currentElement).scale,_=[i[0]+s*o/2,i[1]+s*a/2],c=posit2.get_trans(t).translate
e.selectAll(".gui_dummy_path").remove(),e.append("path").attr("d"," M"+_+"L "+c).attr("class","gui_dummy_path")}function h(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=t.getBBox()
if(d3.select(t).append("rect").attr("transform","translate("+[n.x-5,n.y-5]+")").attr("width",n.width+10).attr("height",n.height+10).attr("class","path_gui_highlight"),"path_group"==iama(t)){var o=path_to_array(t.querySelector(".mainpath").getAttribute("d"))
e.append("text").attr("class","gui").attr("transform","translate("+[o[0].x,o[0].y]+") scale("+r/1.25+")").text("T")
var a=o.slice(-1)[0]
e.append("text").attr("class","gui").attr("transform","translate("+[a.x,a.y]+") scale("+r/1.25+")").text("H")}}function y(e,t){e.attr("id","gui_"+t),e.attr("class","gui")}function v(t,r){var n=e.select("#gui_connect")
n.empty()&&(n=m())
var o=$.extend(!0,{},posit2.get_trans(t,!0)),a=conv_angle(o.rotate[0],0,parseInt(t.getAttribute("height")||2))
o.translate[0]-=a[0]*o.scale,o.translate[1]+=a[1]*o.scale,o.scale=r,n.attr("transform",transform_to_string(o)),e.node().appendChild(n.node())}function b(e){return 1/e*1.15}function x(e){var t,r,n=posit2.get_trans(find_g(e),!0)
if(is_par_tag(e))var o=find_g(e),a=posit2.get_top_left(o,!0),i=_slicedToArray(a,2),s=i[0],_=i[1],c=posit2.get_w_h(o),l=_slicedToArray(c,2),u=l[0],d=l[1]
else{var p=_slicedToArray(n.translate,2),s=p[0],_=p[1],f=posit2.get_w_h(e),m=_slicedToArray(f,2),u=m[0],d=m[1],g=conv_angle(-n.rotate[0],u,d),h=_slicedToArray(g,2),t=h[0],r=h[1],y=n.scale
1!=y&&(d*=y,u*=y,r*=y,t*=y)}return[s,_,u,d,t,r,n.rotate[0]]}function k(t,r,o,a){var i=e.select(".plumb-group"),s=e.select("#gui_par_margin")
s.empty()&&(s=n()),s.attr("transform",i.attr("transform"))
var _=f([t,r],[t+o,r+a]),c=_slicedToArray(_,4),l=c[0],u=c[1],d=c[2],p=c[3],m=u-l,g=p-d
return[["top",function(){return d+g/2},function(){return l}],["left",function(){return d},function(){return l+m/2}],["right",function(){return d+g},function(){return l+m/2}]].forEach(function(e){var t=_slicedToArray(e,3),r=t[0],n=t[1],o=t[2]
return s.select("circle[side="+r+"]").attr("transform","translate("+[n(),o()]+")")}),!1}function w(e){function t(e,t){var r=d3.select(t).select("rect."+e)
if(!r.empty()){var n=r.attr("x"),o=r.attr("y")
d3.select(t).append("circle").attr("cx",parseInt(n)+13).attr("cy",parseInt(o)+9).attr("r",2).attr("class","style_marker").style("stroke","#504545").style("stroke-width","1px").style("fill","white")}}d3.selectAll(".style_marker").remove(),c=find_current_style_class(e),t(c,"#colors_svg"),t(c,"#cm_colors_svg")}return{add_marker:w,init:function(){a(),i()},remove_all:function(){d3.select(".plumb-group").remove(),d3.selectAll(".gui").remove(),d3.selectAll(".path_gui_highlight").remove(),d3.select("#gui_arrowLR").remove(),d3.select("#gui_par_margin").remove(),d3.select("#gui_guided_reshape").remove(),d3.selectAll(".style_marker").remove()},hide_all:function(){d3.select(".plumb-group").style("display","none"),d3.selectAll(".gui").style("display","none"),d3.selectAll(".path_gui_highlight").style("display","none"),d3.select("#gui_arrowLR").style("display","none"),d3.select("#gui_par_margin").style("display","none"),d3.select("#gui_guided_reshape").style("display","none")},move_plumbs:function(t){if("country_basic"==iama(t))return!1
var r=x(t),n=_slicedToArray(r,7),o=n[0],a=n[1],i=n[2],_=n[3],c=(n[4],n[5],n[6]),l=e.select(".plumb-group")
l.empty()?l=s([o,a],i,_,c):d(l.node(),[o,a],i,_,c)},frame_element:function(n){if(posit2.delete_item("gui_connect"),study_mode)return this.remove_all(),!1
if("svg"==n.tagName)return!1
if(n.classList.contains("gui"))return!1
var s=iama(find_g(n))
if("country_basic"==s)return!1
if(this.remove_all(),"knot"==s||"slide"==s)return!1
if("knot_hierarchy"==s){var _=posit2.get_top_left(n),c=_slicedToArray(_,2),l=c[0],u=c[1]
return v(n,1),!1}var d=b(toggle_zoom.get_zoom_factor())
if("path_group"==s||n.classList.contains("arrow_1")||n.classList.contains("arrow_0")||n.classList.contains("axis")||"line_for_graph"==s)return h(n,d),!1
if("text_path"==s||"text_block"==s){var p=o()
return"text_path"==s?(bb=n.getBBox(),p.attr("transform","translate("+[bb.x,bb.y]+")")):p.attr("transform","translate("+posit2.get_top_left(currentElement)+")"),!1}var f=x(n),m=_slicedToArray(f,7),l=m[0],u=m[1],g=m[2],y=m[3],E=m[4],A=m[5],S=m[6]
if(this.move_plumbs(n),"P"==n.tagName&&(void 0==fo_bbox_correction&&(fo_bbox_correction=fo_bbox_correction_test(find_g(n))),k(l,u,g,y)),w(n),is_par_tag(n))return!1
var p=e.select("#gui_rotate")
if(p.empty()&&(p=a()),p.attr("transform","translate("+[l,u]+") rotate("+S+") scale("+d+")"),e.node().appendChild(p.node()),"text_basic"==s||"icon_basic"==s||"poly_points"==s||"svg_icon"==s||"math_basic"==s)e.select("#gui_resize").remove()
else if("path_basic"==s&&2==path_to_array(n.querySelector("path").getAttribute("d")).length)e.select("#gui_resize").remove()
else{var p=e.select("#gui_resize")
p.empty()&&(p=i()),p.attr("transform","translate("+[l+E,u+A]+") rotate("+S+") scale("+d+")"),e.node().appendChild(p.node())}if("poly_points"==s||"path_basic"==s?e.select("#gui_connect").remove():v(n,d),n.classList.contains("flippable")?(e.select("#gui_flip").remove(),p=r(),p.attr("transform","translate("+[l+g+10,u+y/2-6]+") rotate("+S+") scale("+d+")")):e.select("#gui_flip").remove(),Object.keys(poly_config).find(function(e){return e==s})){var q=poly_config[s].cp_index
if(!q)return!1
var T=object_mapper[s].set_poly_points(d3.select(find_g(n)))[q]
t(d3.select(find_g(n)),{x:T[0],y:T[1]},q.toString(),d).attr("transform","translate("+[l,u]+")")}},repos_plumbs_for_cp:function(t){gui.remove_all()
var r=e.select(".plumb-group")
r.empty()?r=s(t,0,0,0):d(r.node(),t,0,0,0)},make_dummy_connection:function(){g()},end_drag_gui_connect:function(t){if(e.selectAll(".gui_dummy_path").remove(),t&&t.node()!=currentElement)if(currentElement.classList.contains("helper_hg")){var r=hierarchies.is_child_of(currentElement),n=_slicedToArray(r,2),o=n[0],a=n[1]
hierarchies.mark_unconnected_as_child(t.node(),document.querySelector(o),a)}else[d3.select(currentElement),t].forEach(function(e){return make_new_connection(e)})
else path_to_nothing(corrected_mouse_position(d3.mouse(document.querySelector("#mainsvg"))),currentElement),text_to_feedback_pane("will not connect a shape to itself. A path needs to connect two different shapes",!1,!0)
gui.frame_element(currentElement)},change_catcher_width:function(t){catcher_width=Math.max(0,t),gs=e.node().querySelectorAll("g[i_am_a]:not(.gui)"),gs=_.filter(gs,function(e){return 1==direct_child_only_selector(e,".catcher").length}),gs.forEach(function(e){currentElement=e,ido(e).recalc_catcher(e)})},add_marker_to_example_style:w}}(svg),_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()
shuffle_shapes=function(){function e(e){r=t(e),n=[]
var o=get_bbox_of_group(r),a=_slicedToArray(o,4),i=a[0],s=a[1],_=a[2],c=a[3]
return n.push({x:i,y:_,w:s-i,h:c-_}),[i,s,_,c]}function t(e){var t={}
return e.forEach(function(e){var r=posit2.get_w_h(e),n=_slicedToArray(r,2),o=n[0],a=n[1]
t[e.id]=o*a}),e.sort(function(e,r){return t[r.id]-t[e.id]})}var r=[],n=[]
return{place_shapes:function(t){var r=e(t),n=_slicedToArray(r,4)
minX=n[0],maxX=n[1],minY=n[2],maxY=n[3]
var o=get_placer_fill_area(minX,minY,maxX-minX,maxY-minY)
t=_.shuffle(t),t.forEach(function(e){o.position_shape(e)})}}}(),document.querySelector("#flash_card_check").onclick=function(e){study_one_by_one.check_answer()},document.querySelector("#flash_card_next").onclick=function(e){study_one_by_one.next()},document.querySelector("#flash_card_val_to_check").onkeydown=function(e){13==e.keyCode&&study_one_by_one.check_answer(),9==e.keyCode&&(study_one_by_one.next(),e.preventDefault()),e.stopPropagation()}
var _slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),graphviz=function(){function e(e,t,r){e=svg.select("#"+w[e]),t=svg.select("#"+w[t]),[e,t].forEach(function(e){return make_new_connection(e,!0,r)})}function t(e){return e?[e.match(/c (\d)+/),e.match(/C (\d)+/)].map(function(t){if(t){var r=e.slice(t.index).match(/-/).index
return e.slice(t.index+r+1,t.index+parseInt(t[1])+r+1)}return!1}):[!1,!1]}function r(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"B",r=new RegExp(t+" (\\d+)"),n=e.match(r),o=2*parseInt(n[1]),a=new RegExp(t+" \\d+(( -?\\d+(?:\\.\\d+)*){"+o+"})"),i=e.match(a)[1].trim().split(" ").map(function(e){return parseFloat(e)}),_=[],c=0;c<i.length;c+=2){var l=s([i[c],i[c+1]]),u=_slicedToArray(l,2),d=u[0],p=u[1]
_.push({x:d,y:p})}return _}function n(e,t){return function(r){for(var n=[],o=e,a=r.match(o);a;){var i=r.slice(a.index).match(t).index+a.index+1,s=i+parseInt(a[1])
n.push(r.slice(i,s)),r=r.slice(s),a=r.match(o)}return n}}function o(){var e=document.querySelector("#"+w[m.rootGraph.id]),t=Object.values(w).map(function(e){return document.querySelector("#"+e)})
t=t.filter(function(e){return!e.classList.contains("i_am_grouped")}),ido(e).stick_to_me(d3.select(e),t)}function i(){f=m.rootGraph.attrs.bb[3]-m.rootGraph.attrs.bb[1]}function s(e){var t=_slicedToArray(e,2),r=t[0],n=t[1]
return[round_to(r,0),round_to(f-n,0)]}function c(e){var t=e.attrs.width,r=e.attrs.height,n=s(e.attrs.pos),o=_slicedToArray(n,2),a=o[0],i=o[1]
return[i-r/2,a-t/2,i+r/2,a+t/2]}function l(e,t){function r(e){return Math.min(Math.max(e,0),1)}var n=c(t),o=_slicedToArray(n,4),a=o[0],i=o[1],s=o[2],_=o[3],l=[e.x,e.y],u=l[0],d=l[1],p=[i,_].map(function(e){return Math.abs(u-e)}),f=_slicedToArray(p,2),m=f[0],g=f[1],h=[a,s].map(function(e){return Math.abs(d-e)}),y=_slicedToArray(h,2),v=y[0],b=y[1],x=[m,g,v,b].indexOf(Math.min(m,g,v,b))
return 0==x?[3,r((d-a)/(s-a))]:1==x?[1,r((d-a)/(s-a))]:2==x?[0,r((u-i)/(_-i))]:3==x?[2,r((u-i)/(_-i))]:void 0}function u(e,t,r){var n=m.nodes[e],o=m.nodes[t]
return r?[o,n]:[n,o]}function d(e,t,n,o){return e&o&n.attrs._hdraw_||e&!o&&n.attrs._tdraw_||!e&o&n.attrs._tdraw_||!e&!o&&n.attrs._hdraw_?e&&!o||!e&&o?r(n.attrs._tdraw_,"P")[1]:r(n.attrs._hdraw_,"P")[1]:e&&!o?t[0]:e&&o?t[t.length-1]:e||o?!e&&o?t[0]:void 0:t[t.length-1]}function p(e,t){var r=y(t),n=g(t),o=h(t)
if("text_basic"==iama(e)){var a=r.join("\n")
d3.select(e).select("text").text(a),object_mapper.text_basic.resize_text(d3.select(e)),object_mapper.text_basic.add_line_break(e)}else r.forEach(function(t,r){var a=ido(e).add_paragraph(e,t)
a.node().style.fontFamily=o[r],a.node().style.color=n[r]})}var f,m,g=n(/c (\d)+/,/-/),h=n(/F \d+\.*\d* (\d+)/,/-/),y=n(/T( \d+(?:\.*\d*)){5}/,/-/),v=function(e){var t=e.match(/F (\d+)/)
if(t[1])return t[1]},b=function(e){var t=e.match(/ T ((?:\d+\.*\d* ){2})/)
return!!t[1]&&t[1].trim().split(" ").map(function(e){return parseFloat(e)})},x=function(e){var t=e.match(/ P \d+ /),r=t.index+t[0].length,n=e.slice(r)
return ps=n.trim().split(" ").map(function(e){return parseFloat(e)}),_.range(0,ps.length,2).map(function(e){return s([ps[e],ps[e+1]])})},k={box:"rect_basic",ellipse:"ellipse_basic",parallelogram:"parallello_hor",triangle:"triangle_u",octagon:"octagon",tripleoctagon:"octagon",house:"house_up",invhouse:"house_down",oval:"ellipse_basic",rarraw:"arrow_right",rpromoter:"arrow_right",polygon:"poly_points_fo",plaintext:"text_basic"},w={}
return{make:function(e){this.parse_string_to_graph(e),i(),show_wait_spinner("","loading graphviz graph"),setTimeout(function(){var e=this.graph_to_svg()
o(),reposition_protocol(e,last_pos[0],last_pos[1]),hide_wait_spinner()}.bind(this),25)},parse_string_to_graph:function(e){return m=new XDotGraph(DotParser.parse(e)),m.walk(),m},graph_to_svg:function(){help_on=!1,w={},Object.keys(m.nodes).forEach(function(e){var r=m.nodes[e],n=r.attrs.width||100,o=r.attrs.height||60
if("shape"in r.attrs)if(r.attrs.shape in k)var a=k[r.attrs.shape]
else var a="rect_basic"
else var a="ellipse_basic"
var i=t(r.attrs._draw_),_=_slicedToArray(i,2),c=_[0],l=_[1],u=s(r.attrs.pos)
if("poly_points_fo"==a){ps=x(r.attrs._draw_)
var d=poly_points_fo.make(svg,ps)
currentElement=d.node(),toggle_poly_points(d.node()),poly_points.add_foreignObject(d.node())}else var d=object_mapper[a].make(svg,u,{width:n,height:o})
set_style_class_to_predef(d.node(),"style_20"),c&&change_color_test(tinycolor(c),d.node(),"stroke"),l&&change_color_test(tinycolor(l),d.node(),"fill"),r.attrs._ldraw_&&p(d.node(),r.attrs._ldraw_),w[e]=d.node().id}),Object.keys(m.edges).forEach(function(t){m.edges[t].forEach(function(t){if(t.attrs._draw_){var n={},o=r(t.attrs._draw_),a=w[t.edge[1]]<w[t.edge[0]]
t.attrs._hdraw_&&(n[a?"arrow_tail":"arrow_head"]="arrow"),t.attrs._tdraw_&&(n[a?"arrow_head":"arrow_tail"]="arrow"),n.arrow_width=5,n.arrow_height=8
var i=u(t.edge[0],t.edge[1],a),s=_slicedToArray(i,2),_=s[0],c=s[1],p=a?[o.length-1,0]:[0,o.length-1],f=_slicedToArray(p,2),m=(f[0],f[1],d(!0,o,t,a)),g=d(!1,o,t,a),h=l(m,_),y=_slicedToArray(h,2),v=y[0],b=y[1],x=l(g,c),k=_slicedToArray(x,2),E=k[0],A=k[1]
n.fixed_side=!0,n.from_side=v,n.to_side=E,n.pos1=b,n.pos2=A,e(t.edge[0],t.edge[1],n),a&&o.reverse()
var S=array_to_path(o)
d3.select(cpa.path_g).attr("custom_flow",get_path_custom_flow_attrs(o)).attr("fixed_side","true"),d3.select(cpa.path_g).selectAll("path").attr("d",S),cpa.path_g.firstChild.style.strokeWidth="1px",t.attrs.label&&add_text_to_path(t.attrs.label,cpa.path_g.querySelector("path"))}})})
var n=[]
Object.keys(m.graphs).forEach(function(e){return n.push(m.graphs[e])})
var o
return n.filter(function(e){return"cluster"==e.id.slice(0,7)||null===e.parent}).forEach(function(e,r){var n=e.attrs.bb,i=n[2]-n[0],_=n[3]-n[1],c=rect_canvas.make(svg,s([n[0]+i/2,n[1]+_/2]),{width:i,height:_})
0==r&&(o=c.node())
var l=t(e.attrs._draw_),u=_slicedToArray(l,2),d=u[0],p=u[1]
if(d&&(0==r?change_color_test(tinycolor("#bbb"),c.node(),"stroke"):change_color_test(tinycolor(d),c.node(),"stroke")),p&&change_color_test(tinycolor(p),c.node(),"fill"),w[e.id]=c.node().id,rect_canvas.stick_to_me(c),e.attrs._ldraw_){var f=e.attrs._ldraw_,m=y(f),x=g(f),k=h(f),E=s(b(f)),A=v(f)
m.forEach(function(e,t){var r=text_basic.make(svg,E)
r.select("text").text(e),a=r.node(),a.style.fontFamily=k[t],a.style.fill=x[t],a.style.fontSize=A,text_basic.resize_text(r),posit2.delete_item(r.attr("id")),rect_canvas.stick_to_me(c,[a])})}}),change_color_test(tinycolor("rgba(1,1,1,0)"),o,"fill"),change_color_test(tinycolor("rgba(0,0,0,0.75)"),o,"stroke"),Object.values(w).forEach(function(e){currentElement=document.getElementById(e),resize_protocol(currentElement,0,0)}),help_on=!0,o}}}()
!function(){"free"==service&&(["fs_drawing","fs_slides_form_edit"].forEach(function(e){document.querySelector("#"+e).style.display="none"}),["#cm_toggle_draw",".form_pencil_size"].forEach(function(e){$(e).css("display","none")}),all_form_elements=all_form_elements.filter(function(e){return"fs_drawing"!=e&&"fs_slides_form_edit"!=e}),svg_form_elements=svg_form_elements.filter(function(e){return"fs_drawing"!=e&&"fs_slides_form_edit"!=e}))}()
var auth_logger=function(){function e(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!0
return check_if_map_empty()||(t=local_store.save("reload",!0)),!(!t&&!confirm("your current map will be lost if continued: continue?")&&(text_to_feedback_pane(e?"still logged out":"still logged in"),1))}function t(t,r){e(t)&&window.open(document.location.origin+r,"_self")}return{git_login:function(){t(!0,"/git_login")},git_logout:function(){t(!1,"/git_logout")},login:function(){t(!0,"/login/reload")},logout:function(){t(!1,"/logout")},reload:function(){local_store.load("reload",!1),local_store.delete("reload")}}}()
document.querySelector("#form_github_sign_out").onclick=auth_logger.git_logout,document.querySelector("#form_github_login").onclick=auth_logger.git_login,document.querySelector("#form_sign_out").onclick=auth_logger.logout,document.querySelector("#form_login").onclick=auth_logger.login
var _slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()
document.querySelector("#search_form_search").onclick=function(e){find_search_results(document.querySelector("#search_form_search_value").value)},document.querySelector("#search_form_search_value").onkeydown=function(e){13===e.keyCode&&(e.stopPropagation(),find_search_results(this.value))},document.querySelector("#search_form_close").onclick=hide_search_form
var _slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_allowed_styles
allowed_styles=(_allowed_styles={color:!0,"background-color":!0,"stroke-width":!0,stroke:!0,"stroke-linecap":!0,"stroke-dasharray":!0,fill:!0,"fill-opacity":!0,"border-radius":!0,"background-size":!0,"background-repeat":!0,"background-image":!0,margin:!0,"margin-top":!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,padding:!0,"padding-top":!0,"padding-left":!0,"padding-right":!0,"padding-bottom":!0,"font-family":!0,"font-size":!0,opacity:!0,"stroke-opacity":!0,"text-align":!0,"border-width":!0,"border-style":!0,"line-height":!0},_defineProperty(_allowed_styles,"padding",!0),_defineProperty(_allowed_styles,"pointer-events",!0),_allowed_styles)
var allowed_attrs={textPath:{"xlink:href":!0},tspan:{dy:!0,x:!0},ellipse:{style:!0,ry:!0,i_am_a:!0,rx:!0,cy:!0,class:!0,height:!0,width:!0,tabindex:!0,transform:!0,"stroke-width":!0,cx:!0},circle:{my_index:!0,style:!0,i_am_a:!0,cy:!0,class:!0,width:!0,height:!0,transform:!0,tabindex:!0,fill:!0,r:!0,"stroke-width":!0,stroke:!0,cx:!0},"xhtml:article":{style:!0,class:!0,img_ratio:!0},path:{style:!0,ry:!0,i_am_a:!0,undrag:!0,rx:!0,height:!0,class:!0,width:!0,tabindex:!0,transform:!0,"stroke-width":!0,d:!0,stroke:!0},polygon:{arrow_width:!0,points:!0,style:!0,ry:!0,i_am_a:!0,rx:!0,height:!0,class:!0,width:!0,cy:!0,tabindex:!0,transform:!0,arrow_height:!0,"stroke-width":!0,cx:!0},"xhtml:p":{style:!0,class:!0,draggable:!0,contenteditable:!0,border_sides_arr:!0},foreignObject:{width:!0,i_am_a:!0,transform:!0,height:!0},rect:{points:!0,style:!0,ry:!0,i_am_a:!0,undrag:!0,rx:!0,height:!0,width:!0,class:!0,cy:!0,tabindex:!0,transform:!0,"stroke-width":!0,cx:!0},g:{pos2:!0,rel_type:!0,from_side:!0,height:!0,vt:!0,s1:!0,arrow_height:!0,offset_to:!0,offset_from:!0,to_side:!0,done:!0,arrow_width:!0,continent:!0,visibility:!0,country:!0,i_am_a:!0,on_top:!0,pos_perc:!0,width:!0,class:!0,flow:!0,transform:!0,type:!0,y:!0,pos1:!0,table:!0,x:!0,s2:!0,offset_for_path:!0,style:!0,deltas:!0,custom_flow:!0,tabindex:!0,to_side_for_hy:!0,fixed_side:!0,id:!0,my_length:!0,mirrored:!0,els_to_hide:!0,border_sides_arr:!0,manhattan_perc:!0,raw_mj:!0,hg_1:!0,hg_3:!0,hg_2:!0,hg_0:!0,domain_x:!0,domain_y:!0,range_x:!0,range_y:!0,my_func:!0,graph_axis_crossed:!0,gridded:!0,asymptotic:!0,fixed_range:!0,axes_custom_pos:!0,orig_p:!0,rough_pars:!0,has_url:!0,inner_width:!0},text:{rel_type:!0,style:!0,height:!0,class:!0,width:!0,tabindex:!0,transform:!0},"xhtml:b":{class:!0,style:!0},"xhtml:u":{class:!0,style:!0},"xhtml:i":{class:!0,style:!0},"xhtml:q":{class:!0,style:!0},textnode:{innerText:!0},axis:{num_ticks:!0,ax:!0,transform:!0}},_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0
try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t
if(Symbol.iterator in Object(t))return e(t,r)
throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),roughen_all=!1,roughing=function(){function e(){return[w,A,E].join(" ")}function t(e){return e.split(" ").map(function(e){return parseFloat(e)})}function r(e,t){return t.forEach(function(t){if(t.style.fill.startsWith("url("))return e.setAttribute("has_url",t.style.fill.split('"')[1]),!0}),!1}function n(e,t){var r=window.getComputedStyle(e),n=(e.style.fill||r.fill,e.style.stroke||r.stroke),o=_slicedToArray(t,2),a=o[0],i=o[1]
"none"!=a.style.fill?(a.setAttribute("is_fill",""),i.setAttribute("is_border","")):"none"!=i.style.fill?(i.setAttribute("is_fill",""),a.setAttribute("is_border","")):a.stroke!=i.stroke?a.stroke==n?(a.setAttribute("is_fill",""),i.setAttribute("is_border","")):(i.setAttribute("is_fill",""),a.setAttribute("is_border","")):(a.setAttribute("is_fill",""),i.setAttribute("is_border",""))}function o(e){return 0==t(e.getAttribute("rough_pars"))[1]}function a(e){var r=e.querySelector(".click_catcher, .catcher"),n=e.hasAttribute("rough_pars")?t(e.getAttribute("rough_pars"))[0]:rougness,o=k.path(r.getAttribute("d"),{roughness:n}),a=o.querySelector("path").getAttribute("d")
direct_child_only_selector(e,"path:not(.click_catcher):not(.catcher)").forEach(function(e){return e.setAttribute("d",a)})
var i=e.querySelector('g[i_am_a="text_block"]')
i&&_(i)}function i(e){var t=ido(e).make_rough_shape(e),o=Array.from(t.querySelectorAll("path"))
r(e,o),n(e,o),o.forEach(function(t){e.appendChild(t),t.classList.add("roughened"),t.style.strokeWidth=null})}function s(e){i(e)
var t=o(e)
e.querySelector("path[is_border]").style.stroke=null,t&&(e.querySelector("path[is_fill]").style.fill=null)
var r=e.querySelector("foreignObject")
r&&e.appendChild(r),e.hasAttribute("inner_width")&&p(e,e.getAttribute("inner_width"))}function _(e){i(e),Array.from(e.querySelectorAll("text")).forEach(function(t){return e.appendChild(t)}),e.querySelector("path[is_border").style.strokeWidth="2px",e.querySelector(".text_block_background").style.display="none",o(e)||(e.querySelector("path[is_fill").style.strokeWidth="2px")}function c(t){var r=iama(t)
t.classList.contains("rough")||(t.classList.add("rough"),t.setAttribute("rough_pars",e())),"text_block"==r?_(t):"path_group"!=r&&"make_rough_shape"in ido(t)?s(t):"path_group"==r&&a(t)}function l(e){if(!iama(e))return!1
e.classList.remove("rough"),e.removeAttribute("rough_pars"),e.removeAttribute("has_url"),e.removeAttribute("inner_width"),u(e)}function u(e){Array.from(e.querySelectorAll(".roughened")).forEach(function(e){return e.remove()}),d(e)}function d(e){if(e.hasAttribute("has_url")){var t=e.getAttribute("has_url")
document.querySelector(t).remove()}}function p(e,t){if(e.hasAttribute("has_url")){var r=e.getAttribute("has_url")
document.querySelector(r).querySelector("path").style.strokeWidth=t+"px"}else e.querySelector("path[is_fill]").style.strokeWidth=t+"px"
e.setAttribute("inner_width",t)}function f(e){e.classList.contains("rough")&&(u(e),c(e))}function m(e,t){e.classList.contains("rough")&&(t.removeAttribute("has_url"),c(t))}function g(e){return e.hasAttribute("has_url")?document.querySelector(e.getAttribute("has_url")).querySelector("path").style.strokeWidth||e.style.strokeWidth||find_attr_of_style_sheet("."+find_current_style_class(e),"stroke-width"):e.querySelector("path[is_fill]").style.strokeWidth||e.style.strokeWidth||find_attr_of_style_sheet("."+find_current_style_class(e),"stroke-width")}function h(e){var t=window.getComputedStyle(e)
return{strokeWidth:parseFloat(t.strokeWidth),strokeOpacity:parseFloat(t.strokeOpacity),stroke:t.stroke,fill:t.fill}}function y(e){var r=h(e),n=e.hasAttribute("rough_pars")
if(n){var o=t(e.getAttribute("rough_pars")),a=_slicedToArray(o,3),i=a[0],s=a[1],_=a[2]
r.roughness=i,r.hachureGap=s,r.hachureAngle=_}else r.roughness=w,r.hachureGap=A,r.hachureAngle=E
return(0==parseInt(r.hachureGap)||S&&!n)&&(r.fillStyle="solid"),r}function v(){return{roughness:w,gap:A,angle:E,roughen_all:roughen_all,fill_is_solid:S}}function b(e){document.querySelector("#form_roughness input").value=e.roughness,document.querySelector("#form_hachure_angle input").value=e.angle,document.querySelector("#form_hachure_gap input").value=parseInt(e.gap),document.querySelector("#form_roughen_all").checked=e.roughen_all,document.querySelector("#form_rough_fill").checked=!e.fill_is_solid,S=e.fill_is_solid,w=e.roughness,E=e.angle,A=e.gap,roughen_all=e.roughen_all}function x(){svg.node().querySelectorAll(".rough").forEach(function(e){c(e)})}var k=rough.svg(document.getElementById("mainsvg")),w=parseFloat(document.querySelector("#form_roughness input").value),E=parseInt(document.querySelector("#form_hachure_angle input").value),A=parseInt(document.querySelector("#form_hachure_gap input").value),S=!0
return document.querySelector("#form_make_rough").onclick=function(e){manage_groups.get_group(currentElement).forEach(function(e){l(e),c(e)})},document.querySelector("#form_undo_rough").onclick=function(e){manage_groups.get_group(currentElement).forEach(function(e){l(e)})},document.querySelector("#form_roughen_all").onchange=function(e){roughen_all=this.checked},document.querySelector("#form_rough_fill").onchange=function(e){S=!this.checked
var t=S?"none":"inherit"
document.querySelector("#form_rough_fill_lines").style.display=t,S?A=0:(document.getElementById("form_hachure_gap").querySelector("input").value=8,A=8)},plus_minus_generator(document.getElementById("form_roughness"),function(e){var t=Math.min(Math.max(1,e.value),8)
e.value=t,w=parseFloat(t)},1,1),plus_minus_generator(document.getElementById("form_hachure_angle"),function(e){var t=e.value%180
e.value=t,E=parseFloat(t)},10,0),plus_minus_generator(document.getElementById("form_hachure_gap"),function(e){var t=Math.min(Math.max(e.value,3),25)
e.value=t,A=parseFloat(t)},1,0),{get_specs:function(e){return y(e)},roughen_if_needed:f,roughen:c,hook:k,update_rough_shapes_on_load:x,remove_filter:d,shape_is_solid:o,get_current_settings:v,load_settings:b,get_stroke_width_of_inner:g,copy:m,set_inner_width:p,rough_a_path:a}}()
})()